<!DOCTYPE html>
<html class="no-js" lang="en"> <head><meta charset="utf-8"/><meta content="width=device-width,initial-scale=1" name="viewport"/><meta content="GPU-accelerated 2D/3D MERFISH data processing" name="description"/><meta content="Quantitative Imaging and Inference Lab" name="author"/><link href="https://qi2lab.github.io/merfish3d-analysis/reference/classes/qi2labDataStore/" rel="canonical"/><link href="../PixelDecoder/" rel="prev"/><link href="../../modules/dataio/" rel="next"/><link href="../../../assets/images/favicon.png" rel="icon"/><meta content="mkdocs-1.6.1, mkdocs-material-9.6.22" name="generator"/><title>qi2labDataStore - merfish3d-analysis</title><link href="../../../assets/stylesheets/main.84d31ad4.min.css" rel="stylesheet"/><link href="../../../assets/stylesheets/palette.06af60db.min.css" rel="stylesheet"/><link crossorigin="" href="https://fonts.gstatic.com" rel="preconnect"/><link href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&amp;display=fallback" rel="stylesheet"/><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><link href="../../../assets/_mkdocstrings.css" rel="stylesheet"/><link href="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.css" rel="stylesheet"/><script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script></head> <body data-md-color-accent="dark-blue" data-md-color-primary="white" data-md-color-scheme="default" dir="ltr"> <input autocomplete="off" class="md-toggle" data-md-toggle="drawer" id="__drawer" type="checkbox"/> <input autocomplete="off" class="md-toggle" data-md-toggle="search" id="__search" type="checkbox"/> <label class="md-overlay" for="__drawer"></label> <div data-md-component="skip"> <a class="md-skip" href="#datastore-class"> Skip to content </a> </div> <div data-md-component="announce"> </div> <header class="md-header md-header--shadow" data-md-component="header"> <nav aria-label="Header" class="md-header__inner md-grid"> <a aria-label="merfish3d-analysis" class="md-header__button md-logo" data-md-component="logo" href="../../.." title="merfish3d-analysis"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> <label class="md-header__button md-icon" for="__drawer"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"></path></svg> </label> <div class="md-header__title" data-md-component="header-title"> <div class="md-header__ellipsis"> <div class="md-header__topic"> <span class="md-ellipsis"> merfish3d-analysis </span> </div> <div class="md-header__topic" data-md-component="header-topic"> <span class="md-ellipsis"> qi2labDataStore </span> </div> </div> </div> <form class="md-header__option" data-md-component="palette"> <input aria-label="Switch to dark mode" class="md-option" data-md-color-accent="dark-blue" data-md-color-media="(prefers-color-scheme: light)" data-md-color-primary="white" data-md-color-scheme="default" id="__palette_0" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_1" hidden="" title="Switch to dark mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5"></path></svg> </label> <input aria-label="Switch to light mode" class="md-option" data-md-color-accent="light-blue" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-primary="grey" data-md-color-scheme="slate" id="__palette_1" name="__palette" type="radio"/> <label class="md-header__button md-icon" for="__palette_0" hidden="" title="Switch to light mode"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9z"></path></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> </label> <div class="md-search" data-md-component="search" role="dialog"> <label class="md-search__overlay" for="__search"></label> <div class="md-search__inner" role="search"> <form class="md-search__form" name="search"> <input aria-label="Search" autocapitalize="off" autocomplete="off" autocorrect="off" class="md-search__input" data-md-component="search-query" name="query" placeholder="Search" required="" spellcheck="false" type="text"/> <label class="md-search__icon md-icon" for="__search"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"></path></svg> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </label> <nav aria-label="Search" class="md-search__options"> <button aria-label="Clear" class="md-search__icon md-icon" tabindex="-1" title="Clear" type="reset"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"></path></svg> </button> </nav> </form> <div class="md-search__output"> <div class="md-search__scrollwrap" data-md-scrollfix="" tabindex="0"> <div class="md-search-result" data-md-component="search-result"> <div class="md-search-result__meta"> Initializing search </div> <ol class="md-search-result__list" role="presentation"></ol> </div> </div> </div> </div> </div> <div class="md-header__source"> <a class="md-source" data-md-component="source" href="https://github.com/qi2lab/merfish3d-analysis" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class="md-source__repository"> merfish3d-analysis </div> </a> </div> </nav> </header> <div class="md-container" data-md-component="container"> <main class="md-main" data-md-component="main"> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Navigation" class="md-nav md-nav--primary" data-md-level="0"> <label class="md-nav__title" for="__drawer"> <a aria-label="merfish3d-analysis" class="md-nav__button md-logo" data-md-component="logo" href="../../.." title="merfish3d-analysis"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"></path></svg> </a> merfish3d-analysis </label> <div class="md-nav__source"> <a class="md-source" data-md-component="source" href="https://github.com/qi2lab/merfish3d-analysis" title="Go to repository"> <div class="md-source__icon md-icon"> <svg viewbox="0 0 512 512" xmlns="http://www.w3.org/2000/svg"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"></path></svg> </div> <div class="md-source__repository"> merfish3d-analysis </div> </a> </div> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../.."> <span class="md-ellipsis"> Home </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../installation/"> <span class="md-ellipsis"> Installation </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../datastore/"> <span class="md-ellipsis"> DataStore overview </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../workflow/"> <span class="md-ellipsis"> Workflow overview </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_5" type="checkbox"/> <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0"> <span class="md-ellipsis"> Examples </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_5_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_5"> <span class="md-nav__icon md-icon"></span> Examples </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../../examples/statphysbio_synthetic/"> <span class="md-ellipsis"> Synthetic data </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../examples/zhuang_lab_mouse_brain/"> <span class="md-ellipsis"> Zhuang laboratory mouse brain </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../examples/qi2lab_human_olfactory_bulb/"> <span class="md-ellipsis"> qi2lab human olfactory bulb </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" id="__nav_6" type="checkbox"/> <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0"> <span class="md-ellipsis"> Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="true" aria-labelledby="__nav_6_label" class="md-nav" data-md-level="1"> <label class="md-nav__title" for="__nav_6"> <span class="md-nav__icon md-icon"></span> Reference </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../"> <span class="md-ellipsis"> Overview </span> </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input checked="" class="md-nav__toggle md-toggle" id="__nav_6_2" type="checkbox"/> <label class="md-nav__link" for="__nav_6_2" id="__nav_6_2_label" tabindex="0"> <span class="md-ellipsis"> Classes </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="true" aria-labelledby="__nav_6_2_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_6_2"> <span class="md-nav__icon md-icon"></span> Classes </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../DataRegistration/"> <span class="md-ellipsis"> DataRegistration </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../PixelDecoder/"> <span class="md-ellipsis"> PixelDecoder </span> </a> </li> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" id="__toc" type="checkbox"/> <label class="md-nav__link md-nav__link--active" for="__toc"> <span class="md-ellipsis"> qi2labDataStore </span> <span class="md-nav__icon md-icon"></span> </label> <a class="md-nav__link md-nav__link--active" href="./"> <span class="md-ellipsis"> qi2labDataStore </span> </a> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore"> <span class="md-ellipsis"> qi2labDataStore </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore"> <span class="md-ellipsis"> qi2labDataStore </span> </a> <nav aria-label="qi2labDataStore" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.baysor_options"> <span class="md-ellipsis"> baysor_options </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.baysor_path"> <span class="md-ellipsis"> baysor_path </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.binning"> <span class="md-ellipsis"> binning </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.bit_ids"> <span class="md-ellipsis"> bit_ids </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.camera_model"> <span class="md-ellipsis"> camera_model </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.channel_psfs"> <span class="md-ellipsis"> channel_psfs </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.channel_shading_maps"> <span class="md-ellipsis"> channel_shading_maps </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.channels_in_data"> <span class="md-ellipsis"> channels_in_data </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.codebook"> <span class="md-ellipsis"> codebook </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.datastore_state"> <span class="md-ellipsis"> datastore_state </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.e_per_ADU"> <span class="md-ellipsis"> e_per_ADU </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.experiment_order"> <span class="md-ellipsis"> experiment_order </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.global_background_vector"> <span class="md-ellipsis"> global_background_vector </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.global_normalization_vector"> <span class="md-ellipsis"> global_normalization_vector </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.iterative_background_vector"> <span class="md-ellipsis"> iterative_background_vector </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.iterative_normalization_vector"> <span class="md-ellipsis"> iterative_normalization_vector </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.julia_threads"> <span class="md-ellipsis"> julia_threads </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.microscope_type"> <span class="md-ellipsis"> microscope_type </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.na"> <span class="md-ellipsis"> na </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.noise_map"> <span class="md-ellipsis"> noise_map </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.num_bits"> <span class="md-ellipsis"> num_bits </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.num_rounds"> <span class="md-ellipsis"> num_rounds </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.num_tiles"> <span class="md-ellipsis"> num_tiles </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.ri"> <span class="md-ellipsis"> ri </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.round_ids"> <span class="md-ellipsis"> round_ids </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.tile_ids"> <span class="md-ellipsis"> tile_ids </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.tile_overlap"> <span class="md-ellipsis"> tile_overlap </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.voxel_size_zyx_um"> <span class="md-ellipsis"> voxel_size_zyx_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._check_for_zarr_array"> <span class="md-ellipsis"> _check_for_zarr_array </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._get_kvstore_key"> <span class="md-ellipsis"> _get_kvstore_key </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._init_datastore"> <span class="md-ellipsis"> _init_datastore </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._load_from_json"> <span class="md-ellipsis"> _load_from_json </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._load_from_microjson"> <span class="md-ellipsis"> _load_from_microjson </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._load_from_parquet"> <span class="md-ellipsis"> _load_from_parquet </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._load_from_zarr_array"> <span class="md-ellipsis"> _load_from_zarr_array </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._parse_datastore"> <span class="md-ellipsis"> _parse_datastore </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._save_to_json"> <span class="md-ellipsis"> _save_to_json </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._save_to_parquet"> <span class="md-ellipsis"> _save_to_parquet </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._save_to_zarr_array"> <span class="md-ellipsis"> _save_to_zarr_array </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.initialize_tile"> <span class="md-ellipsis"> initialize_tile </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_codebook_parsed"> <span class="md-ellipsis"> load_codebook_parsed </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_coord_of_xform_px"> <span class="md-ellipsis"> load_coord_of_xform_px </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_baysor_filtered_spots"> <span class="md-ellipsis"> load_global_baysor_filtered_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_baysor_outlines"> <span class="md-ellipsis"> load_global_baysor_outlines </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_cellpose_outlines"> <span class="md-ellipsis"> load_global_cellpose_outlines </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_cellpose_segmentation_image"> <span class="md-ellipsis"> load_global_cellpose_segmentation_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_coord_xforms_um"> <span class="md-ellipsis"> load_global_coord_xforms_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_fidicual_image"> <span class="md-ellipsis"> load_global_fidicual_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_filtered_decoded_spots"> <span class="md-ellipsis"> load_global_filtered_decoded_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_bit_linker"> <span class="md-ellipsis"> load_local_bit_linker </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_corrected_image"> <span class="md-ellipsis"> load_local_corrected_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_decoded_spots"> <span class="md-ellipsis"> load_local_decoded_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_registered_image"> <span class="md-ellipsis"> load_local_registered_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_rigid_xform_xyz_px"> <span class="md-ellipsis"> load_local_rigid_xform_xyz_px </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_round_linker"> <span class="md-ellipsis"> load_local_round_linker </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_stage_position_zyx_um"> <span class="md-ellipsis"> load_local_stage_position_zyx_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_ufish_image"> <span class="md-ellipsis"> load_local_ufish_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_ufish_spots"> <span class="md-ellipsis"> load_local_ufish_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_wavelengths_um"> <span class="md-ellipsis"> load_local_wavelengths_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.reformat_baysor_3D_oultines"> <span class="md-ellipsis"> reformat_baysor_3D_oultines </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.reprocess_and_save_filtered_spots_with_baysor_outlines"> <span class="md-ellipsis"> reprocess_and_save_filtered_spots_with_baysor_outlines </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.run_baysor"> <span class="md-ellipsis"> run_baysor </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_coord_of_xform_px"> <span class="md-ellipsis"> save_coord_of_xform_px </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_cellpose_segmentation_image"> <span class="md-ellipsis"> save_global_cellpose_segmentation_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_coord_xforms_um"> <span class="md-ellipsis"> save_global_coord_xforms_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_fidicual_image"> <span class="md-ellipsis"> save_global_fidicual_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_filtered_decoded_spots"> <span class="md-ellipsis"> save_global_filtered_decoded_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_bit_linker"> <span class="md-ellipsis"> save_local_bit_linker </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_corrected_image"> <span class="md-ellipsis"> save_local_corrected_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_decoded_spots"> <span class="md-ellipsis"> save_local_decoded_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_registered_image"> <span class="md-ellipsis"> save_local_registered_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_rigid_xform_xyz_px"> <span class="md-ellipsis"> save_local_rigid_xform_xyz_px </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_round_linker"> <span class="md-ellipsis"> save_local_round_linker </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_stage_position_zyx_um"> <span class="md-ellipsis"> save_local_stage_position_zyx_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_ufish_image"> <span class="md-ellipsis"> save_local_ufish_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_ufish_spots"> <span class="md-ellipsis"> save_local_ufish_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_wavelengths_um"> <span class="md-ellipsis"> save_local_wavelengths_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_mtx"> <span class="md-ellipsis"> save_mtx </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_spots_prepped_for_baysor"> <span class="md-ellipsis"> save_spots_prepped_for_baysor </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle" id="__nav_6_3" type="checkbox"/> <label class="md-nav__link" for="__nav_6_3" id="__nav_6_3_label" tabindex="0"> <span class="md-ellipsis"> Modules </span> <span class="md-nav__icon md-icon"></span> </label> <nav aria-expanded="false" aria-labelledby="__nav_6_3_label" class="md-nav" data-md-level="2"> <label class="md-nav__title" for="__nav_6_3"> <span class="md-nav__icon md-icon"></span> Modules </label> <ul class="md-nav__list" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="../../modules/dataio/"> <span class="md-ellipsis"> dataio </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../modules/imageprocessing/"> <span class="md-ellipsis"> imageprocessing </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../modules/registration/"> <span class="md-ellipsis"> registration </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item"> <a class="md-nav__link" href="../../../contributing/"> <span class="md-ellipsis"> Contributing </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc"> <div class="md-sidebar__scrollwrap"> <div class="md-sidebar__inner"> <nav aria-label="Table of contents" class="md-nav md-nav--secondary"> <label class="md-nav__title" for="__toc"> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix=""> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore"> <span class="md-ellipsis"> qi2labDataStore </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore"> <span class="md-ellipsis"> qi2labDataStore </span> </a> <nav aria-label="qi2labDataStore" class="md-nav"> <ul class="md-nav__list"> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.baysor_options"> <span class="md-ellipsis"> baysor_options </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.baysor_path"> <span class="md-ellipsis"> baysor_path </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.binning"> <span class="md-ellipsis"> binning </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.bit_ids"> <span class="md-ellipsis"> bit_ids </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.camera_model"> <span class="md-ellipsis"> camera_model </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.channel_psfs"> <span class="md-ellipsis"> channel_psfs </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.channel_shading_maps"> <span class="md-ellipsis"> channel_shading_maps </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.channels_in_data"> <span class="md-ellipsis"> channels_in_data </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.codebook"> <span class="md-ellipsis"> codebook </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.datastore_state"> <span class="md-ellipsis"> datastore_state </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.e_per_ADU"> <span class="md-ellipsis"> e_per_ADU </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.experiment_order"> <span class="md-ellipsis"> experiment_order </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.global_background_vector"> <span class="md-ellipsis"> global_background_vector </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.global_normalization_vector"> <span class="md-ellipsis"> global_normalization_vector </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.iterative_background_vector"> <span class="md-ellipsis"> iterative_background_vector </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.iterative_normalization_vector"> <span class="md-ellipsis"> iterative_normalization_vector </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.julia_threads"> <span class="md-ellipsis"> julia_threads </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.microscope_type"> <span class="md-ellipsis"> microscope_type </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.na"> <span class="md-ellipsis"> na </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.noise_map"> <span class="md-ellipsis"> noise_map </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.num_bits"> <span class="md-ellipsis"> num_bits </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.num_rounds"> <span class="md-ellipsis"> num_rounds </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.num_tiles"> <span class="md-ellipsis"> num_tiles </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.ri"> <span class="md-ellipsis"> ri </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.round_ids"> <span class="md-ellipsis"> round_ids </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.tile_ids"> <span class="md-ellipsis"> tile_ids </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.tile_overlap"> <span class="md-ellipsis"> tile_overlap </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.voxel_size_zyx_um"> <span class="md-ellipsis"> voxel_size_zyx_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._check_for_zarr_array"> <span class="md-ellipsis"> _check_for_zarr_array </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._get_kvstore_key"> <span class="md-ellipsis"> _get_kvstore_key </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._init_datastore"> <span class="md-ellipsis"> _init_datastore </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._load_from_json"> <span class="md-ellipsis"> _load_from_json </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._load_from_microjson"> <span class="md-ellipsis"> _load_from_microjson </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._load_from_parquet"> <span class="md-ellipsis"> _load_from_parquet </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._load_from_zarr_array"> <span class="md-ellipsis"> _load_from_zarr_array </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._parse_datastore"> <span class="md-ellipsis"> _parse_datastore </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._save_to_json"> <span class="md-ellipsis"> _save_to_json </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._save_to_parquet"> <span class="md-ellipsis"> _save_to_parquet </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore._save_to_zarr_array"> <span class="md-ellipsis"> _save_to_zarr_array </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.initialize_tile"> <span class="md-ellipsis"> initialize_tile </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_codebook_parsed"> <span class="md-ellipsis"> load_codebook_parsed </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_coord_of_xform_px"> <span class="md-ellipsis"> load_coord_of_xform_px </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_baysor_filtered_spots"> <span class="md-ellipsis"> load_global_baysor_filtered_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_baysor_outlines"> <span class="md-ellipsis"> load_global_baysor_outlines </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_cellpose_outlines"> <span class="md-ellipsis"> load_global_cellpose_outlines </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_cellpose_segmentation_image"> <span class="md-ellipsis"> load_global_cellpose_segmentation_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_coord_xforms_um"> <span class="md-ellipsis"> load_global_coord_xforms_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_fidicual_image"> <span class="md-ellipsis"> load_global_fidicual_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_filtered_decoded_spots"> <span class="md-ellipsis"> load_global_filtered_decoded_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_bit_linker"> <span class="md-ellipsis"> load_local_bit_linker </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_corrected_image"> <span class="md-ellipsis"> load_local_corrected_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_decoded_spots"> <span class="md-ellipsis"> load_local_decoded_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_registered_image"> <span class="md-ellipsis"> load_local_registered_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_rigid_xform_xyz_px"> <span class="md-ellipsis"> load_local_rigid_xform_xyz_px </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_round_linker"> <span class="md-ellipsis"> load_local_round_linker </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_stage_position_zyx_um"> <span class="md-ellipsis"> load_local_stage_position_zyx_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_ufish_image"> <span class="md-ellipsis"> load_local_ufish_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_ufish_spots"> <span class="md-ellipsis"> load_local_ufish_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_wavelengths_um"> <span class="md-ellipsis"> load_local_wavelengths_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.reformat_baysor_3D_oultines"> <span class="md-ellipsis"> reformat_baysor_3D_oultines </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.reprocess_and_save_filtered_spots_with_baysor_outlines"> <span class="md-ellipsis"> reprocess_and_save_filtered_spots_with_baysor_outlines </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.run_baysor"> <span class="md-ellipsis"> run_baysor </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_coord_of_xform_px"> <span class="md-ellipsis"> save_coord_of_xform_px </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_cellpose_segmentation_image"> <span class="md-ellipsis"> save_global_cellpose_segmentation_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_coord_xforms_um"> <span class="md-ellipsis"> save_global_coord_xforms_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_fidicual_image"> <span class="md-ellipsis"> save_global_fidicual_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_filtered_decoded_spots"> <span class="md-ellipsis"> save_global_filtered_decoded_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_bit_linker"> <span class="md-ellipsis"> save_local_bit_linker </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_corrected_image"> <span class="md-ellipsis"> save_local_corrected_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_decoded_spots"> <span class="md-ellipsis"> save_local_decoded_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_registered_image"> <span class="md-ellipsis"> save_local_registered_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_rigid_xform_xyz_px"> <span class="md-ellipsis"> save_local_rigid_xform_xyz_px </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_round_linker"> <span class="md-ellipsis"> save_local_round_linker </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_stage_position_zyx_um"> <span class="md-ellipsis"> save_local_stage_position_zyx_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_ufish_image"> <span class="md-ellipsis"> save_local_ufish_image </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_ufish_spots"> <span class="md-ellipsis"> save_local_ufish_spots </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_wavelengths_um"> <span class="md-ellipsis"> save_local_wavelengths_um </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_mtx"> <span class="md-ellipsis"> save_mtx </span> </a> </li> <li class="md-nav__item"> <a class="md-nav__link" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_spots_prepped_for_baysor"> <span class="md-ellipsis"> save_spots_prepped_for_baysor </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-content" data-md-component="content"> <article class="md-content__inner md-typeset"> <h1 id="datastore-class">DataStore Class</h1> <div class="doc doc-object doc-module"> <a id="merfish3danalysis.qi2labDataStore"></a> <div class="doc doc-contents first"> <p>Interface to qi2lab MERFISH datastore.</p> <p>This module provides methods and attributes to create or interact with the qi2lab MERFISH datastore. The filestore structure is further described in the merfish3d-analysis documentation.</p> <details class="history:" open=""> <summary>History:</summary> <ul> <li><strong>2024/12</strong>: Refactored repo structure.</li> <li><strong>2024/12</strong>: Updated docstrings and exception types.</li> <li><strong>2024/07</strong>: Initial commit.</li> </ul> </details> <p><span class="doc-section-title">Classes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore" title="qi2labDataStore (merfish3danalysis.qi2labDataStore.qi2labDataStore)">qi2labDataStore</a></code></td> <td> <div class="doc-md-description"> <p>API to qi2lab MERFISH store.</p> </div> </td> </tr> </tbody> </table> <div class="doc doc-children"> <div class="doc doc-object doc-class"> <h2 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore"> <code>qi2labDataStore</code> </h2> <div class="doc doc-contents"> <p>API to qi2lab MERFISH store.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>datastore_path</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="str">str</span>, <span title="pathlib.Path">Path</span>]</code> </td> <td> <div class="doc-md-description"> <p>Path to qi2lab MERFISH store</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Methods:</span></p> <table> <thead> <tr> <th>Name</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.initialize_tile" title="initialize_tile(tile) (merfish3danalysis.qi2labDataStore.qi2labDataStore.initialize_tile)">initialize_tile</a></code></td> <td> <div class="doc-md-description"> <p>Initialize directory structure for a tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_codebook_parsed" title="load_codebook_parsed() (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_codebook_parsed)">load_codebook_parsed</a></code></td> <td> <div class="doc-md-description"> <p>Load and split codebook into gene_ids and codebook matrix.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_coord_of_xform_px" title="load_coord_of_xform_px(tile, round, return_future=True) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_coord_of_xform_px)">load_coord_of_xform_px</a></code></td> <td> <div class="doc-md-description"> <p>Local fidicual optical flow matrix for one round and tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_baysor_filtered_spots" title="load_global_baysor_filtered_spots() (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_baysor_filtered_spots)">load_global_baysor_filtered_spots</a></code></td> <td> <div class="doc-md-description"> <p>Load Baysor re-assigned decoded RNA.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_baysor_outlines" title="load_global_baysor_outlines() (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_baysor_outlines)">load_global_baysor_outlines</a></code></td> <td> <div class="doc-md-description"> <p>Load Baysor cell outlines.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_cellpose_outlines" title="load_global_cellpose_outlines() (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_cellpose_outlines)">load_global_cellpose_outlines</a></code></td> <td> <div class="doc-md-description"> <p>Load Cellpose max projection cell outlines.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_cellpose_segmentation_image" title="load_global_cellpose_segmentation_image(return_future=True) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_cellpose_segmentation_image)">load_global_cellpose_segmentation_image</a></code></td> <td> <div class="doc-md-description"> <p>Load Cellpose max projection, downsampled segmentation image.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_coord_xforms_um" title="load_global_coord_xforms_um(tile) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_coord_xforms_um)">load_global_coord_xforms_um</a></code></td> <td> <div class="doc-md-description"> <p>Load global registration transform for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_fidicual_image" title="load_global_fidicual_image(return_future=True) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_fidicual_image)">load_global_fidicual_image</a></code></td> <td> <div class="doc-md-description"> <p>Load downsampled, fused fidicual image.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_filtered_decoded_spots" title="load_global_filtered_decoded_spots() (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_filtered_decoded_spots)">load_global_filtered_decoded_spots</a></code></td> <td> <div class="doc-md-description"> <p>Load all decoded and filtered spots.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_bit_linker" title="load_local_bit_linker(tile, round) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_bit_linker)">load_local_bit_linker</a></code></td> <td> <div class="doc-md-description"> <p>Load readout bits linked to fidicual round for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_corrected_image" title="load_local_corrected_image(tile, round=None, bit=None, return_future=True) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_corrected_image)">load_local_corrected_image</a></code></td> <td> <div class="doc-md-description"> <p>Load gain and offset corrected image for fiducial OR readout bit for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_decoded_spots" title="load_local_decoded_spots(tile) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_decoded_spots)">load_local_decoded_spots</a></code></td> <td> <div class="doc-md-description"> <p>Load decoded spots and features for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_registered_image" title="load_local_registered_image(tile, round=None, bit=None, return_future=True) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_registered_image)">load_local_registered_image</a></code></td> <td> <div class="doc-md-description"> <p>Local registered, deconvolved image for fidiculial OR readout bit for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_rigid_xform_xyz_px" title="load_local_rigid_xform_xyz_px(tile, round) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_rigid_xform_xyz_px)">load_local_rigid_xform_xyz_px</a></code></td> <td> <div class="doc-md-description"> <p>Load calculated rigid registration transform for one round and tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_round_linker" title="load_local_round_linker(tile, bit) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_round_linker)">load_local_round_linker</a></code></td> <td> <div class="doc-md-description"> <p>Load fidicual round linked to readout bit for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_stage_position_zyx_um" title="load_local_stage_position_zyx_um(tile, round) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_stage_position_zyx_um)">load_local_stage_position_zyx_um</a></code></td> <td> <div class="doc-md-description"> <p>Load tile stage position for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_ufish_image" title="load_local_ufish_image(tile, bit, return_future=True) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_ufish_image)">load_local_ufish_image</a></code></td> <td> <div class="doc-md-description"> <p>Load readout bit U-FISH prediction image for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_ufish_spots" title="load_local_ufish_spots(tile, bit) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_ufish_spots)">load_local_ufish_spots</a></code></td> <td> <div class="doc-md-description"> <p>Load U-FISH spot localizations and features for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_wavelengths_um" title="load_local_wavelengths_um(tile, round=None, bit=None) (merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_wavelengths_um)">load_local_wavelengths_um</a></code></td> <td> <div class="doc-md-description"> <p>Load wavelengths for fidicual OR readout bit for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.reformat_baysor_3D_oultines" title="reformat_baysor_3D_oultines() (merfish3danalysis.qi2labDataStore.qi2labDataStore.reformat_baysor_3D_oultines)">reformat_baysor_3D_oultines</a></code></td> <td> <div class="doc-md-description"> <p>Reformat baysor 3D json file into ImageJ ROIs.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.reprocess_and_save_filtered_spots_with_baysor_outlines" title="reprocess_and_save_filtered_spots_with_baysor_outlines() (merfish3danalysis.qi2labDataStore.qi2labDataStore.reprocess_and_save_filtered_spots_with_baysor_outlines)">reprocess_and_save_filtered_spots_with_baysor_outlines</a></code></td> <td> <div class="doc-md-description"> <p>Reprocess filtered spots using baysor cell outlines, then save.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.run_baysor" title="run_baysor() (merfish3danalysis.qi2labDataStore.qi2labDataStore.run_baysor)">run_baysor</a></code></td> <td> <div class="doc-md-description"> <p>Run Baysor"</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_coord_of_xform_px" title="save_coord_of_xform_px(of_xform_px, tile, block_size, block_stride, round, return_future=False) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_coord_of_xform_px)">save_coord_of_xform_px</a></code></td> <td> <div class="doc-md-description"> <p>Save fidicual optical flow matrix for one round and tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_cellpose_segmentation_image" title="save_global_cellpose_segmentation_image(cellpose_image, downsampling, return_future=False) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_cellpose_segmentation_image)">save_global_cellpose_segmentation_image</a></code></td> <td> <div class="doc-md-description"> <p>Save Cellpose max projection, downsampled segmentation image.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_coord_xforms_um" title="save_global_coord_xforms_um(affine_zyx_um, origin_zyx_um, spacing_zyx_um, tile) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_coord_xforms_um)">save_global_coord_xforms_um</a></code></td> <td> <div class="doc-md-description"> <p>Save global registration transform for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_fidicual_image" title="save_global_fidicual_image(fused_image, affine_zyx_um, origin_zyx_um, spacing_zyx_um, fusion_type='polyDT', return_future=False) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_fidicual_image)">save_global_fidicual_image</a></code></td> <td> <div class="doc-md-description"> <p>Save downsampled, fused fidicual image.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_filtered_decoded_spots" title="save_global_filtered_decoded_spots(filtered_decoded_df) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_filtered_decoded_spots)">save_global_filtered_decoded_spots</a></code></td> <td> <div class="doc-md-description"> <p>Save all decoded and filtered spots.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_bit_linker" title="save_local_bit_linker(bit_linker, tile, round) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_bit_linker)">save_local_bit_linker</a></code></td> <td> <div class="doc-md-description"> <p>Save readout bits linked to fidicual round for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_corrected_image" title="save_local_corrected_image(image, tile, gain_correction=True, hotpixel_correction=True, shading_correction=False, psf_idx=0, round=None, bit=None, return_future=False) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_corrected_image)">save_local_corrected_image</a></code></td> <td> <div class="doc-md-description"> <p>Save gain and offset corrected image.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_decoded_spots" title="save_local_decoded_spots(features_df, tile) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_decoded_spots)">save_local_decoded_spots</a></code></td> <td> <div class="doc-md-description"> <p>Save decoded spots and features for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_registered_image" title="save_local_registered_image(registered_image, tile, deconvolution=True, round=None, bit=None, return_future=False) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_registered_image)">save_local_registered_image</a></code></td> <td> <div class="doc-md-description"> <p>Save registered, deconvolved image.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_rigid_xform_xyz_px" title="save_local_rigid_xform_xyz_px(rigid_xform_xyz_px, tile, round) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_rigid_xform_xyz_px)">save_local_rigid_xform_xyz_px</a></code></td> <td> <div class="doc-md-description"> <p>Save calculated rigid registration transform for one round and tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_round_linker" title="save_local_round_linker(round_linker, tile, bit) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_round_linker)">save_local_round_linker</a></code></td> <td> <div class="doc-md-description"> <p>Save fidicual round linker attribute to readout bit for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_stage_position_zyx_um" title="save_local_stage_position_zyx_um(stage_zyx_um, affine_zyx_px, tile, round) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_stage_position_zyx_um)">save_local_stage_position_zyx_um</a></code></td> <td> <div class="doc-md-description"> <p>Save tile stage position for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_ufish_image" title="save_local_ufish_image(ufish_image, tile, bit, return_future=False) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_ufish_image)">save_local_ufish_image</a></code></td> <td> <div class="doc-md-description"> <p>Save U-FISH prediction image.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_ufish_spots" title="save_local_ufish_spots(spot_df, tile, bit) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_ufish_spots)">save_local_ufish_spots</a></code></td> <td> <div class="doc-md-description"> <p>Save U-FISH localizations and features.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_wavelengths_um" title="save_local_wavelengths_um(wavelengths_um, tile, round=None, bit=None) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_wavelengths_um)">save_local_wavelengths_um</a></code></td> <td> <div class="doc-md-description"> <p>Save wavelengths for fidicual OR readout bit for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_mtx" title="save_mtx(spots_source='baysor') (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_mtx)">save_mtx</a></code></td> <td> <div class="doc-md-description"> <p>Save mtx file for downstream analysis. Assumes Baysor has been run.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.save_spots_prepped_for_baysor" title="save_spots_prepped_for_baysor(prepped_for_baysor_df) (merfish3danalysis.qi2labDataStore.qi2labDataStore.save_spots_prepped_for_baysor)">save_spots_prepped_for_baysor</a></code></td> <td> <div class="doc-md-description"> <p>Save spots prepped for Baysor.</p> </div> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Attributes:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.baysor_options" title="baysor_options

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.baysor_options)">baysor_options</a></code></td> <td> <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Baysor options</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.baysor_path" title="baysor_path

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.baysor_path)">baysor_path</a></code></td> <td> <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Baysor path</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.binning" title="binning

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.binning)">binning</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code> </td> <td> <div class="doc-md-description"> <p>Camera binning.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.bit_ids" title="bit_ids

  
      property
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.bit_ids)">bit_ids</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Collection">Collection</span>[<span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Bit IDs.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.camera_model" title="camera_model

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.camera_model)">camera_model</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Camera model.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.channel_psfs" title="channel_psfs

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.channel_psfs)">channel_psfs</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Channel point spread functions (PSF).</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.channel_shading_maps" title="channel_shading_maps

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.channel_shading_maps)">channel_shading_maps</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Channel shaiding images.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.channels_in_data" title="channels_in_data

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.channels_in_data)">channels_in_data</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Collection">Collection</span>[<span title="int">int</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Channel indices.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.codebook" title="codebook

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.codebook)">codebook</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class="doc-md-description"> <p>Codebook.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.datastore_state" title="datastore_state

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.datastore_state)">datastore_state</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="dict">dict</span>]</code> </td> <td> <div class="doc-md-description"> <p>Datastore state.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.e_per_ADU" title="e_per_ADU

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.e_per_ADU)">e_per_ADU</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code> </td> <td> <div class="doc-md-description"> <p>Electrons per camera ADU.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.experiment_order" title="experiment_order

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.experiment_order)">experiment_order</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class="doc-md-description"> <p>Round and bit order.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.global_background_vector" title="global_background_vector

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.global_background_vector)">global_background_vector</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Global background vector.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.global_normalization_vector" title="global_normalization_vector

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.global_normalization_vector)">global_normalization_vector</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Global normalization vector.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.iterative_background_vector" title="iterative_background_vector

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.iterative_background_vector)">iterative_background_vector</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Iterative background vector.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.iterative_normalization_vector" title="iterative_normalization_vector

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.iterative_normalization_vector)">iterative_normalization_vector</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Iterative normalization vector.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.julia_threads" title="julia_threads

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.julia_threads)">julia_threads</a></code></td> <td> <code><span title="int">int</span></code> </td> <td> <div class="doc-md-description"> <p>Julia thread number</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.microscope_type" title="microscope_type

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.microscope_type)">microscope_type</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Microscope type.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.na" title="na

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.na)">na</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code> </td> <td> <div class="doc-md-description"> <p>Detection objective numerical aperture (NA).</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.noise_map" title="noise_map

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.noise_map)">noise_map</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Camera noise image.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.num_bits" title="num_bits

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.num_bits)">num_bits</a></code></td> <td> <code><span title="int">int</span></code> </td> <td> <div class="doc-md-description"> <p>Number of bits.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.num_rounds" title="num_rounds

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.num_rounds)">num_rounds</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code> </td> <td> <div class="doc-md-description"> <p>Number of rounds.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.num_tiles" title="num_tiles

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.num_tiles)">num_tiles</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="int">int</span>]</code> </td> <td> <div class="doc-md-description"> <p>Number of tiles.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.ri" title="ri

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.ri)">ri</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code> </td> <td> <div class="doc-md-description"> <p>Detection objective refractive index (RI).</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.round_ids" title="round_ids

  
      property
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.round_ids)">round_ids</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Collection">Collection</span>[<span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Round IDs.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.tile_ids" title="tile_ids

  
      property
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.tile_ids)">tile_ids</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Collection">Collection</span>[<span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Tile IDs.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.tile_overlap" title="tile_overlap

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.tile_overlap)">tile_overlap</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="float">float</span>]</code> </td> <td> <div class="doc-md-description"> <p>XY tile overlap.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code><a class="autorefs autorefs-internal" href="#merfish3danalysis.qi2labDataStore.qi2labDataStore.voxel_size_zyx_um" title="voxel_size_zyx_um

  
      property
      writable
   (merfish3danalysis.qi2labDataStore.qi2labDataStore.voxel_size_zyx_um)">voxel_size_zyx_um</a></code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Voxel size, zyx order (microns).</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-33">  33</a></span>
<span class="normal"><a href="#__codelineno-0-34">  34</a></span>
<span class="normal"><a href="#__codelineno-0-35">  35</a></span>
<span class="normal"><a href="#__codelineno-0-36">  36</a></span>
<span class="normal"><a href="#__codelineno-0-37">  37</a></span>
<span class="normal"><a href="#__codelineno-0-38">  38</a></span>
<span class="normal"><a href="#__codelineno-0-39">  39</a></span>
<span class="normal"><a href="#__codelineno-0-40">  40</a></span>
<span class="normal"><a href="#__codelineno-0-41">  41</a></span>
<span class="normal"><a href="#__codelineno-0-42">  42</a></span>
<span class="normal"><a href="#__codelineno-0-43">  43</a></span>
<span class="normal"><a href="#__codelineno-0-44">  44</a></span>
<span class="normal"><a href="#__codelineno-0-45">  45</a></span>
<span class="normal"><a href="#__codelineno-0-46">  46</a></span>
<span class="normal"><a href="#__codelineno-0-47">  47</a></span>
<span class="normal"><a href="#__codelineno-0-48">  48</a></span>
<span class="normal"><a href="#__codelineno-0-49">  49</a></span>
<span class="normal"><a href="#__codelineno-0-50">  50</a></span>
<span class="normal"><a href="#__codelineno-0-51">  51</a></span>
<span class="normal"><a href="#__codelineno-0-52">  52</a></span>
<span class="normal"><a href="#__codelineno-0-53">  53</a></span>
<span class="normal"><a href="#__codelineno-0-54">  54</a></span>
<span class="normal"><a href="#__codelineno-0-55">  55</a></span>
<span class="normal"><a href="#__codelineno-0-56">  56</a></span>
<span class="normal"><a href="#__codelineno-0-57">  57</a></span>
<span class="normal"><a href="#__codelineno-0-58">  58</a></span>
<span class="normal"><a href="#__codelineno-0-59">  59</a></span>
<span class="normal"><a href="#__codelineno-0-60">  60</a></span>
<span class="normal"><a href="#__codelineno-0-61">  61</a></span>
<span class="normal"><a href="#__codelineno-0-62">  62</a></span>
<span class="normal"><a href="#__codelineno-0-63">  63</a></span>
<span class="normal"><a href="#__codelineno-0-64">  64</a></span>
<span class="normal"><a href="#__codelineno-0-65">  65</a></span>
<span class="normal"><a href="#__codelineno-0-66">  66</a></span>
<span class="normal"><a href="#__codelineno-0-67">  67</a></span>
<span class="normal"><a href="#__codelineno-0-68">  68</a></span>
<span class="normal"><a href="#__codelineno-0-69">  69</a></span>
<span class="normal"><a href="#__codelineno-0-70">  70</a></span>
<span class="normal"><a href="#__codelineno-0-71">  71</a></span>
<span class="normal"><a href="#__codelineno-0-72">  72</a></span>
<span class="normal"><a href="#__codelineno-0-73">  73</a></span>
<span class="normal"><a href="#__codelineno-0-74">  74</a></span>
<span class="normal"><a href="#__codelineno-0-75">  75</a></span>
<span class="normal"><a href="#__codelineno-0-76">  76</a></span>
<span class="normal"><a href="#__codelineno-0-77">  77</a></span>
<span class="normal"><a href="#__codelineno-0-78">  78</a></span>
<span class="normal"><a href="#__codelineno-0-79">  79</a></span>
<span class="normal"><a href="#__codelineno-0-80">  80</a></span>
<span class="normal"><a href="#__codelineno-0-81">  81</a></span>
<span class="normal"><a href="#__codelineno-0-82">  82</a></span>
<span class="normal"><a href="#__codelineno-0-83">  83</a></span>
<span class="normal"><a href="#__codelineno-0-84">  84</a></span>
<span class="normal"><a href="#__codelineno-0-85">  85</a></span>
<span class="normal"><a href="#__codelineno-0-86">  86</a></span>
<span class="normal"><a href="#__codelineno-0-87">  87</a></span>
<span class="normal"><a href="#__codelineno-0-88">  88</a></span>
<span class="normal"><a href="#__codelineno-0-89">  89</a></span>
<span class="normal"><a href="#__codelineno-0-90">  90</a></span>
<span class="normal"><a href="#__codelineno-0-91">  91</a></span>
<span class="normal"><a href="#__codelineno-0-92">  92</a></span>
<span class="normal"><a href="#__codelineno-0-93">  93</a></span>
<span class="normal"><a href="#__codelineno-0-94">  94</a></span>
<span class="normal"><a href="#__codelineno-0-95">  95</a></span>
<span class="normal"><a href="#__codelineno-0-96">  96</a></span>
<span class="normal"><a href="#__codelineno-0-97">  97</a></span>
<span class="normal"><a href="#__codelineno-0-98">  98</a></span>
<span class="normal"><a href="#__codelineno-0-99">  99</a></span>
<span class="normal"><a href="#__codelineno-0-100"> 100</a></span>
<span class="normal"><a href="#__codelineno-0-101"> 101</a></span>
<span class="normal"><a href="#__codelineno-0-102"> 102</a></span>
<span class="normal"><a href="#__codelineno-0-103"> 103</a></span>
<span class="normal"><a href="#__codelineno-0-104"> 104</a></span>
<span class="normal"><a href="#__codelineno-0-105"> 105</a></span>
<span class="normal"><a href="#__codelineno-0-106"> 106</a></span>
<span class="normal"><a href="#__codelineno-0-107"> 107</a></span>
<span class="normal"><a href="#__codelineno-0-108"> 108</a></span>
<span class="normal"><a href="#__codelineno-0-109"> 109</a></span>
<span class="normal"><a href="#__codelineno-0-110"> 110</a></span>
<span class="normal"><a href="#__codelineno-0-111"> 111</a></span>
<span class="normal"><a href="#__codelineno-0-112"> 112</a></span>
<span class="normal"><a href="#__codelineno-0-113"> 113</a></span>
<span class="normal"><a href="#__codelineno-0-114"> 114</a></span>
<span class="normal"><a href="#__codelineno-0-115"> 115</a></span>
<span class="normal"><a href="#__codelineno-0-116"> 116</a></span>
<span class="normal"><a href="#__codelineno-0-117"> 117</a></span>
<span class="normal"><a href="#__codelineno-0-118"> 118</a></span>
<span class="normal"><a href="#__codelineno-0-119"> 119</a></span>
<span class="normal"><a href="#__codelineno-0-120"> 120</a></span>
<span class="normal"><a href="#__codelineno-0-121"> 121</a></span>
<span class="normal"><a href="#__codelineno-0-122"> 122</a></span>
<span class="normal"><a href="#__codelineno-0-123"> 123</a></span>
<span class="normal"><a href="#__codelineno-0-124"> 124</a></span>
<span class="normal"><a href="#__codelineno-0-125"> 125</a></span>
<span class="normal"><a href="#__codelineno-0-126"> 126</a></span>
<span class="normal"><a href="#__codelineno-0-127"> 127</a></span>
<span class="normal"><a href="#__codelineno-0-128"> 128</a></span>
<span class="normal"><a href="#__codelineno-0-129"> 129</a></span>
<span class="normal"><a href="#__codelineno-0-130"> 130</a></span>
<span class="normal"><a href="#__codelineno-0-131"> 131</a></span>
<span class="normal"><a href="#__codelineno-0-132"> 132</a></span>
<span class="normal"><a href="#__codelineno-0-133"> 133</a></span>
<span class="normal"><a href="#__codelineno-0-134"> 134</a></span>
<span class="normal"><a href="#__codelineno-0-135"> 135</a></span>
<span class="normal"><a href="#__codelineno-0-136"> 136</a></span>
<span class="normal"><a href="#__codelineno-0-137"> 137</a></span>
<span class="normal"><a href="#__codelineno-0-138"> 138</a></span>
<span class="normal"><a href="#__codelineno-0-139"> 139</a></span>
<span class="normal"><a href="#__codelineno-0-140"> 140</a></span>
<span class="normal"><a href="#__codelineno-0-141"> 141</a></span>
<span class="normal"><a href="#__codelineno-0-142"> 142</a></span>
<span class="normal"><a href="#__codelineno-0-143"> 143</a></span>
<span class="normal"><a href="#__codelineno-0-144"> 144</a></span>
<span class="normal"><a href="#__codelineno-0-145"> 145</a></span>
<span class="normal"><a href="#__codelineno-0-146"> 146</a></span>
<span class="normal"><a href="#__codelineno-0-147"> 147</a></span>
<span class="normal"><a href="#__codelineno-0-148"> 148</a></span>
<span class="normal"><a href="#__codelineno-0-149"> 149</a></span>
<span class="normal"><a href="#__codelineno-0-150"> 150</a></span>
<span class="normal"><a href="#__codelineno-0-151"> 151</a></span>
<span class="normal"><a href="#__codelineno-0-152"> 152</a></span>
<span class="normal"><a href="#__codelineno-0-153"> 153</a></span>
<span class="normal"><a href="#__codelineno-0-154"> 154</a></span>
<span class="normal"><a href="#__codelineno-0-155"> 155</a></span>
<span class="normal"><a href="#__codelineno-0-156"> 156</a></span>
<span class="normal"><a href="#__codelineno-0-157"> 157</a></span>
<span class="normal"><a href="#__codelineno-0-158"> 158</a></span>
<span class="normal"><a href="#__codelineno-0-159"> 159</a></span>
<span class="normal"><a href="#__codelineno-0-160"> 160</a></span>
<span class="normal"><a href="#__codelineno-0-161"> 161</a></span>
<span class="normal"><a href="#__codelineno-0-162"> 162</a></span>
<span class="normal"><a href="#__codelineno-0-163"> 163</a></span>
<span class="normal"><a href="#__codelineno-0-164"> 164</a></span>
<span class="normal"><a href="#__codelineno-0-165"> 165</a></span>
<span class="normal"><a href="#__codelineno-0-166"> 166</a></span>
<span class="normal"><a href="#__codelineno-0-167"> 167</a></span>
<span class="normal"><a href="#__codelineno-0-168"> 168</a></span>
<span class="normal"><a href="#__codelineno-0-169"> 169</a></span>
<span class="normal"><a href="#__codelineno-0-170"> 170</a></span>
<span class="normal"><a href="#__codelineno-0-171"> 171</a></span>
<span class="normal"><a href="#__codelineno-0-172"> 172</a></span>
<span class="normal"><a href="#__codelineno-0-173"> 173</a></span>
<span class="normal"><a href="#__codelineno-0-174"> 174</a></span>
<span class="normal"><a href="#__codelineno-0-175"> 175</a></span>
<span class="normal"><a href="#__codelineno-0-176"> 176</a></span>
<span class="normal"><a href="#__codelineno-0-177"> 177</a></span>
<span class="normal"><a href="#__codelineno-0-178"> 178</a></span>
<span class="normal"><a href="#__codelineno-0-179"> 179</a></span>
<span class="normal"><a href="#__codelineno-0-180"> 180</a></span>
<span class="normal"><a href="#__codelineno-0-181"> 181</a></span>
<span class="normal"><a href="#__codelineno-0-182"> 182</a></span>
<span class="normal"><a href="#__codelineno-0-183"> 183</a></span>
<span class="normal"><a href="#__codelineno-0-184"> 184</a></span>
<span class="normal"><a href="#__codelineno-0-185"> 185</a></span>
<span class="normal"><a href="#__codelineno-0-186"> 186</a></span>
<span class="normal"><a href="#__codelineno-0-187"> 187</a></span>
<span class="normal"><a href="#__codelineno-0-188"> 188</a></span>
<span class="normal"><a href="#__codelineno-0-189"> 189</a></span>
<span class="normal"><a href="#__codelineno-0-190"> 190</a></span>
<span class="normal"><a href="#__codelineno-0-191"> 191</a></span>
<span class="normal"><a href="#__codelineno-0-192"> 192</a></span>
<span class="normal"><a href="#__codelineno-0-193"> 193</a></span>
<span class="normal"><a href="#__codelineno-0-194"> 194</a></span>
<span class="normal"><a href="#__codelineno-0-195"> 195</a></span>
<span class="normal"><a href="#__codelineno-0-196"> 196</a></span>
<span class="normal"><a href="#__codelineno-0-197"> 197</a></span>
<span class="normal"><a href="#__codelineno-0-198"> 198</a></span>
<span class="normal"><a href="#__codelineno-0-199"> 199</a></span>
<span class="normal"><a href="#__codelineno-0-200"> 200</a></span>
<span class="normal"><a href="#__codelineno-0-201"> 201</a></span>
<span class="normal"><a href="#__codelineno-0-202"> 202</a></span>
<span class="normal"><a href="#__codelineno-0-203"> 203</a></span>
<span class="normal"><a href="#__codelineno-0-204"> 204</a></span>
<span class="normal"><a href="#__codelineno-0-205"> 205</a></span>
<span class="normal"><a href="#__codelineno-0-206"> 206</a></span>
<span class="normal"><a href="#__codelineno-0-207"> 207</a></span>
<span class="normal"><a href="#__codelineno-0-208"> 208</a></span>
<span class="normal"><a href="#__codelineno-0-209"> 209</a></span>
<span class="normal"><a href="#__codelineno-0-210"> 210</a></span>
<span class="normal"><a href="#__codelineno-0-211"> 211</a></span>
<span class="normal"><a href="#__codelineno-0-212"> 212</a></span>
<span class="normal"><a href="#__codelineno-0-213"> 213</a></span>
<span class="normal"><a href="#__codelineno-0-214"> 214</a></span>
<span class="normal"><a href="#__codelineno-0-215"> 215</a></span>
<span class="normal"><a href="#__codelineno-0-216"> 216</a></span>
<span class="normal"><a href="#__codelineno-0-217"> 217</a></span>
<span class="normal"><a href="#__codelineno-0-218"> 218</a></span>
<span class="normal"><a href="#__codelineno-0-219"> 219</a></span>
<span class="normal"><a href="#__codelineno-0-220"> 220</a></span>
<span class="normal"><a href="#__codelineno-0-221"> 221</a></span>
<span class="normal"><a href="#__codelineno-0-222"> 222</a></span>
<span class="normal"><a href="#__codelineno-0-223"> 223</a></span>
<span class="normal"><a href="#__codelineno-0-224"> 224</a></span>
<span class="normal"><a href="#__codelineno-0-225"> 225</a></span>
<span class="normal"><a href="#__codelineno-0-226"> 226</a></span>
<span class="normal"><a href="#__codelineno-0-227"> 227</a></span>
<span class="normal"><a href="#__codelineno-0-228"> 228</a></span>
<span class="normal"><a href="#__codelineno-0-229"> 229</a></span>
<span class="normal"><a href="#__codelineno-0-230"> 230</a></span>
<span class="normal"><a href="#__codelineno-0-231"> 231</a></span>
<span class="normal"><a href="#__codelineno-0-232"> 232</a></span>
<span class="normal"><a href="#__codelineno-0-233"> 233</a></span>
<span class="normal"><a href="#__codelineno-0-234"> 234</a></span>
<span class="normal"><a href="#__codelineno-0-235"> 235</a></span>
<span class="normal"><a href="#__codelineno-0-236"> 236</a></span>
<span class="normal"><a href="#__codelineno-0-237"> 237</a></span>
<span class="normal"><a href="#__codelineno-0-238"> 238</a></span>
<span class="normal"><a href="#__codelineno-0-239"> 239</a></span>
<span class="normal"><a href="#__codelineno-0-240"> 240</a></span>
<span class="normal"><a href="#__codelineno-0-241"> 241</a></span>
<span class="normal"><a href="#__codelineno-0-242"> 242</a></span>
<span class="normal"><a href="#__codelineno-0-243"> 243</a></span>
<span class="normal"><a href="#__codelineno-0-244"> 244</a></span>
<span class="normal"><a href="#__codelineno-0-245"> 245</a></span>
<span class="normal"><a href="#__codelineno-0-246"> 246</a></span>
<span class="normal"><a href="#__codelineno-0-247"> 247</a></span>
<span class="normal"><a href="#__codelineno-0-248"> 248</a></span>
<span class="normal"><a href="#__codelineno-0-249"> 249</a></span>
<span class="normal"><a href="#__codelineno-0-250"> 250</a></span>
<span class="normal"><a href="#__codelineno-0-251"> 251</a></span>
<span class="normal"><a href="#__codelineno-0-252"> 252</a></span>
<span class="normal"><a href="#__codelineno-0-253"> 253</a></span>
<span class="normal"><a href="#__codelineno-0-254"> 254</a></span>
<span class="normal"><a href="#__codelineno-0-255"> 255</a></span>
<span class="normal"><a href="#__codelineno-0-256"> 256</a></span>
<span class="normal"><a href="#__codelineno-0-257"> 257</a></span>
<span class="normal"><a href="#__codelineno-0-258"> 258</a></span>
<span class="normal"><a href="#__codelineno-0-259"> 259</a></span>
<span class="normal"><a href="#__codelineno-0-260"> 260</a></span>
<span class="normal"><a href="#__codelineno-0-261"> 261</a></span>
<span class="normal"><a href="#__codelineno-0-262"> 262</a></span>
<span class="normal"><a href="#__codelineno-0-263"> 263</a></span>
<span class="normal"><a href="#__codelineno-0-264"> 264</a></span>
<span class="normal"><a href="#__codelineno-0-265"> 265</a></span>
<span class="normal"><a href="#__codelineno-0-266"> 266</a></span>
<span class="normal"><a href="#__codelineno-0-267"> 267</a></span>
<span class="normal"><a href="#__codelineno-0-268"> 268</a></span>
<span class="normal"><a href="#__codelineno-0-269"> 269</a></span>
<span class="normal"><a href="#__codelineno-0-270"> 270</a></span>
<span class="normal"><a href="#__codelineno-0-271"> 271</a></span>
<span class="normal"><a href="#__codelineno-0-272"> 272</a></span>
<span class="normal"><a href="#__codelineno-0-273"> 273</a></span>
<span class="normal"><a href="#__codelineno-0-274"> 274</a></span>
<span class="normal"><a href="#__codelineno-0-275"> 275</a></span>
<span class="normal"><a href="#__codelineno-0-276"> 276</a></span>
<span class="normal"><a href="#__codelineno-0-277"> 277</a></span>
<span class="normal"><a href="#__codelineno-0-278"> 278</a></span>
<span class="normal"><a href="#__codelineno-0-279"> 279</a></span>
<span class="normal"><a href="#__codelineno-0-280"> 280</a></span>
<span class="normal"><a href="#__codelineno-0-281"> 281</a></span>
<span class="normal"><a href="#__codelineno-0-282"> 282</a></span>
<span class="normal"><a href="#__codelineno-0-283"> 283</a></span>
<span class="normal"><a href="#__codelineno-0-284"> 284</a></span>
<span class="normal"><a href="#__codelineno-0-285"> 285</a></span>
<span class="normal"><a href="#__codelineno-0-286"> 286</a></span>
<span class="normal"><a href="#__codelineno-0-287"> 287</a></span>
<span class="normal"><a href="#__codelineno-0-288"> 288</a></span>
<span class="normal"><a href="#__codelineno-0-289"> 289</a></span>
<span class="normal"><a href="#__codelineno-0-290"> 290</a></span>
<span class="normal"><a href="#__codelineno-0-291"> 291</a></span>
<span class="normal"><a href="#__codelineno-0-292"> 292</a></span>
<span class="normal"><a href="#__codelineno-0-293"> 293</a></span>
<span class="normal"><a href="#__codelineno-0-294"> 294</a></span>
<span class="normal"><a href="#__codelineno-0-295"> 295</a></span>
<span class="normal"><a href="#__codelineno-0-296"> 296</a></span>
<span class="normal"><a href="#__codelineno-0-297"> 297</a></span>
<span class="normal"><a href="#__codelineno-0-298"> 298</a></span>
<span class="normal"><a href="#__codelineno-0-299"> 299</a></span>
<span class="normal"><a href="#__codelineno-0-300"> 300</a></span>
<span class="normal"><a href="#__codelineno-0-301"> 301</a></span>
<span class="normal"><a href="#__codelineno-0-302"> 302</a></span>
<span class="normal"><a href="#__codelineno-0-303"> 303</a></span>
<span class="normal"><a href="#__codelineno-0-304"> 304</a></span>
<span class="normal"><a href="#__codelineno-0-305"> 305</a></span>
<span class="normal"><a href="#__codelineno-0-306"> 306</a></span>
<span class="normal"><a href="#__codelineno-0-307"> 307</a></span>
<span class="normal"><a href="#__codelineno-0-308"> 308</a></span>
<span class="normal"><a href="#__codelineno-0-309"> 309</a></span>
<span class="normal"><a href="#__codelineno-0-310"> 310</a></span>
<span class="normal"><a href="#__codelineno-0-311"> 311</a></span>
<span class="normal"><a href="#__codelineno-0-312"> 312</a></span>
<span class="normal"><a href="#__codelineno-0-313"> 313</a></span>
<span class="normal"><a href="#__codelineno-0-314"> 314</a></span>
<span class="normal"><a href="#__codelineno-0-315"> 315</a></span>
<span class="normal"><a href="#__codelineno-0-316"> 316</a></span>
<span class="normal"><a href="#__codelineno-0-317"> 317</a></span>
<span class="normal"><a href="#__codelineno-0-318"> 318</a></span>
<span class="normal"><a href="#__codelineno-0-319"> 319</a></span>
<span class="normal"><a href="#__codelineno-0-320"> 320</a></span>
<span class="normal"><a href="#__codelineno-0-321"> 321</a></span>
<span class="normal"><a href="#__codelineno-0-322"> 322</a></span>
<span class="normal"><a href="#__codelineno-0-323"> 323</a></span>
<span class="normal"><a href="#__codelineno-0-324"> 324</a></span>
<span class="normal"><a href="#__codelineno-0-325"> 325</a></span>
<span class="normal"><a href="#__codelineno-0-326"> 326</a></span>
<span class="normal"><a href="#__codelineno-0-327"> 327</a></span>
<span class="normal"><a href="#__codelineno-0-328"> 328</a></span>
<span class="normal"><a href="#__codelineno-0-329"> 329</a></span>
<span class="normal"><a href="#__codelineno-0-330"> 330</a></span>
<span class="normal"><a href="#__codelineno-0-331"> 331</a></span>
<span class="normal"><a href="#__codelineno-0-332"> 332</a></span>
<span class="normal"><a href="#__codelineno-0-333"> 333</a></span>
<span class="normal"><a href="#__codelineno-0-334"> 334</a></span>
<span class="normal"><a href="#__codelineno-0-335"> 335</a></span>
<span class="normal"><a href="#__codelineno-0-336"> 336</a></span>
<span class="normal"><a href="#__codelineno-0-337"> 337</a></span>
<span class="normal"><a href="#__codelineno-0-338"> 338</a></span>
<span class="normal"><a href="#__codelineno-0-339"> 339</a></span>
<span class="normal"><a href="#__codelineno-0-340"> 340</a></span>
<span class="normal"><a href="#__codelineno-0-341"> 341</a></span>
<span class="normal"><a href="#__codelineno-0-342"> 342</a></span>
<span class="normal"><a href="#__codelineno-0-343"> 343</a></span>
<span class="normal"><a href="#__codelineno-0-344"> 344</a></span>
<span class="normal"><a href="#__codelineno-0-345"> 345</a></span>
<span class="normal"><a href="#__codelineno-0-346"> 346</a></span>
<span class="normal"><a href="#__codelineno-0-347"> 347</a></span>
<span class="normal"><a href="#__codelineno-0-348"> 348</a></span>
<span class="normal"><a href="#__codelineno-0-349"> 349</a></span>
<span class="normal"><a href="#__codelineno-0-350"> 350</a></span>
<span class="normal"><a href="#__codelineno-0-351"> 351</a></span>
<span class="normal"><a href="#__codelineno-0-352"> 352</a></span>
<span class="normal"><a href="#__codelineno-0-353"> 353</a></span>
<span class="normal"><a href="#__codelineno-0-354"> 354</a></span>
<span class="normal"><a href="#__codelineno-0-355"> 355</a></span>
<span class="normal"><a href="#__codelineno-0-356"> 356</a></span>
<span class="normal"><a href="#__codelineno-0-357"> 357</a></span>
<span class="normal"><a href="#__codelineno-0-358"> 358</a></span>
<span class="normal"><a href="#__codelineno-0-359"> 359</a></span>
<span class="normal"><a href="#__codelineno-0-360"> 360</a></span>
<span class="normal"><a href="#__codelineno-0-361"> 361</a></span>
<span class="normal"><a href="#__codelineno-0-362"> 362</a></span>
<span class="normal"><a href="#__codelineno-0-363"> 363</a></span>
<span class="normal"><a href="#__codelineno-0-364"> 364</a></span>
<span class="normal"><a href="#__codelineno-0-365"> 365</a></span>
<span class="normal"><a href="#__codelineno-0-366"> 366</a></span>
<span class="normal"><a href="#__codelineno-0-367"> 367</a></span>
<span class="normal"><a href="#__codelineno-0-368"> 368</a></span>
<span class="normal"><a href="#__codelineno-0-369"> 369</a></span>
<span class="normal"><a href="#__codelineno-0-370"> 370</a></span>
<span class="normal"><a href="#__codelineno-0-371"> 371</a></span>
<span class="normal"><a href="#__codelineno-0-372"> 372</a></span>
<span class="normal"><a href="#__codelineno-0-373"> 373</a></span>
<span class="normal"><a href="#__codelineno-0-374"> 374</a></span>
<span class="normal"><a href="#__codelineno-0-375"> 375</a></span>
<span class="normal"><a href="#__codelineno-0-376"> 376</a></span>
<span class="normal"><a href="#__codelineno-0-377"> 377</a></span>
<span class="normal"><a href="#__codelineno-0-378"> 378</a></span>
<span class="normal"><a href="#__codelineno-0-379"> 379</a></span>
<span class="normal"><a href="#__codelineno-0-380"> 380</a></span>
<span class="normal"><a href="#__codelineno-0-381"> 381</a></span>
<span class="normal"><a href="#__codelineno-0-382"> 382</a></span>
<span class="normal"><a href="#__codelineno-0-383"> 383</a></span>
<span class="normal"><a href="#__codelineno-0-384"> 384</a></span>
<span class="normal"><a href="#__codelineno-0-385"> 385</a></span>
<span class="normal"><a href="#__codelineno-0-386"> 386</a></span>
<span class="normal"><a href="#__codelineno-0-387"> 387</a></span>
<span class="normal"><a href="#__codelineno-0-388"> 388</a></span>
<span class="normal"><a href="#__codelineno-0-389"> 389</a></span>
<span class="normal"><a href="#__codelineno-0-390"> 390</a></span>
<span class="normal"><a href="#__codelineno-0-391"> 391</a></span>
<span class="normal"><a href="#__codelineno-0-392"> 392</a></span>
<span class="normal"><a href="#__codelineno-0-393"> 393</a></span>
<span class="normal"><a href="#__codelineno-0-394"> 394</a></span>
<span class="normal"><a href="#__codelineno-0-395"> 395</a></span>
<span class="normal"><a href="#__codelineno-0-396"> 396</a></span>
<span class="normal"><a href="#__codelineno-0-397"> 397</a></span>
<span class="normal"><a href="#__codelineno-0-398"> 398</a></span>
<span class="normal"><a href="#__codelineno-0-399"> 399</a></span>
<span class="normal"><a href="#__codelineno-0-400"> 400</a></span>
<span class="normal"><a href="#__codelineno-0-401"> 401</a></span>
<span class="normal"><a href="#__codelineno-0-402"> 402</a></span>
<span class="normal"><a href="#__codelineno-0-403"> 403</a></span>
<span class="normal"><a href="#__codelineno-0-404"> 404</a></span>
<span class="normal"><a href="#__codelineno-0-405"> 405</a></span>
<span class="normal"><a href="#__codelineno-0-406"> 406</a></span>
<span class="normal"><a href="#__codelineno-0-407"> 407</a></span>
<span class="normal"><a href="#__codelineno-0-408"> 408</a></span>
<span class="normal"><a href="#__codelineno-0-409"> 409</a></span>
<span class="normal"><a href="#__codelineno-0-410"> 410</a></span>
<span class="normal"><a href="#__codelineno-0-411"> 411</a></span>
<span class="normal"><a href="#__codelineno-0-412"> 412</a></span>
<span class="normal"><a href="#__codelineno-0-413"> 413</a></span>
<span class="normal"><a href="#__codelineno-0-414"> 414</a></span>
<span class="normal"><a href="#__codelineno-0-415"> 415</a></span>
<span class="normal"><a href="#__codelineno-0-416"> 416</a></span>
<span class="normal"><a href="#__codelineno-0-417"> 417</a></span>
<span class="normal"><a href="#__codelineno-0-418"> 418</a></span>
<span class="normal"><a href="#__codelineno-0-419"> 419</a></span>
<span class="normal"><a href="#__codelineno-0-420"> 420</a></span>
<span class="normal"><a href="#__codelineno-0-421"> 421</a></span>
<span class="normal"><a href="#__codelineno-0-422"> 422</a></span>
<span class="normal"><a href="#__codelineno-0-423"> 423</a></span>
<span class="normal"><a href="#__codelineno-0-424"> 424</a></span>
<span class="normal"><a href="#__codelineno-0-425"> 425</a></span>
<span class="normal"><a href="#__codelineno-0-426"> 426</a></span>
<span class="normal"><a href="#__codelineno-0-427"> 427</a></span>
<span class="normal"><a href="#__codelineno-0-428"> 428</a></span>
<span class="normal"><a href="#__codelineno-0-429"> 429</a></span>
<span class="normal"><a href="#__codelineno-0-430"> 430</a></span>
<span class="normal"><a href="#__codelineno-0-431"> 431</a></span>
<span class="normal"><a href="#__codelineno-0-432"> 432</a></span>
<span class="normal"><a href="#__codelineno-0-433"> 433</a></span>
<span class="normal"><a href="#__codelineno-0-434"> 434</a></span>
<span class="normal"><a href="#__codelineno-0-435"> 435</a></span>
<span class="normal"><a href="#__codelineno-0-436"> 436</a></span>
<span class="normal"><a href="#__codelineno-0-437"> 437</a></span>
<span class="normal"><a href="#__codelineno-0-438"> 438</a></span>
<span class="normal"><a href="#__codelineno-0-439"> 439</a></span>
<span class="normal"><a href="#__codelineno-0-440"> 440</a></span>
<span class="normal"><a href="#__codelineno-0-441"> 441</a></span>
<span class="normal"><a href="#__codelineno-0-442"> 442</a></span>
<span class="normal"><a href="#__codelineno-0-443"> 443</a></span>
<span class="normal"><a href="#__codelineno-0-444"> 444</a></span>
<span class="normal"><a href="#__codelineno-0-445"> 445</a></span>
<span class="normal"><a href="#__codelineno-0-446"> 446</a></span>
<span class="normal"><a href="#__codelineno-0-447"> 447</a></span>
<span class="normal"><a href="#__codelineno-0-448"> 448</a></span>
<span class="normal"><a href="#__codelineno-0-449"> 449</a></span>
<span class="normal"><a href="#__codelineno-0-450"> 450</a></span>
<span class="normal"><a href="#__codelineno-0-451"> 451</a></span>
<span class="normal"><a href="#__codelineno-0-452"> 452</a></span>
<span class="normal"><a href="#__codelineno-0-453"> 453</a></span>
<span class="normal"><a href="#__codelineno-0-454"> 454</a></span>
<span class="normal"><a href="#__codelineno-0-455"> 455</a></span>
<span class="normal"><a href="#__codelineno-0-456"> 456</a></span>
<span class="normal"><a href="#__codelineno-0-457"> 457</a></span>
<span class="normal"><a href="#__codelineno-0-458"> 458</a></span>
<span class="normal"><a href="#__codelineno-0-459"> 459</a></span>
<span class="normal"><a href="#__codelineno-0-460"> 460</a></span>
<span class="normal"><a href="#__codelineno-0-461"> 461</a></span>
<span class="normal"><a href="#__codelineno-0-462"> 462</a></span>
<span class="normal"><a href="#__codelineno-0-463"> 463</a></span>
<span class="normal"><a href="#__codelineno-0-464"> 464</a></span>
<span class="normal"><a href="#__codelineno-0-465"> 465</a></span>
<span class="normal"><a href="#__codelineno-0-466"> 466</a></span>
<span class="normal"><a href="#__codelineno-0-467"> 467</a></span>
<span class="normal"><a href="#__codelineno-0-468"> 468</a></span>
<span class="normal"><a href="#__codelineno-0-469"> 469</a></span>
<span class="normal"><a href="#__codelineno-0-470"> 470</a></span>
<span class="normal"><a href="#__codelineno-0-471"> 471</a></span>
<span class="normal"><a href="#__codelineno-0-472"> 472</a></span>
<span class="normal"><a href="#__codelineno-0-473"> 473</a></span>
<span class="normal"><a href="#__codelineno-0-474"> 474</a></span>
<span class="normal"><a href="#__codelineno-0-475"> 475</a></span>
<span class="normal"><a href="#__codelineno-0-476"> 476</a></span>
<span class="normal"><a href="#__codelineno-0-477"> 477</a></span>
<span class="normal"><a href="#__codelineno-0-478"> 478</a></span>
<span class="normal"><a href="#__codelineno-0-479"> 479</a></span>
<span class="normal"><a href="#__codelineno-0-480"> 480</a></span>
<span class="normal"><a href="#__codelineno-0-481"> 481</a></span>
<span class="normal"><a href="#__codelineno-0-482"> 482</a></span>
<span class="normal"><a href="#__codelineno-0-483"> 483</a></span>
<span class="normal"><a href="#__codelineno-0-484"> 484</a></span>
<span class="normal"><a href="#__codelineno-0-485"> 485</a></span>
<span class="normal"><a href="#__codelineno-0-486"> 486</a></span>
<span class="normal"><a href="#__codelineno-0-487"> 487</a></span>
<span class="normal"><a href="#__codelineno-0-488"> 488</a></span>
<span class="normal"><a href="#__codelineno-0-489"> 489</a></span>
<span class="normal"><a href="#__codelineno-0-490"> 490</a></span>
<span class="normal"><a href="#__codelineno-0-491"> 491</a></span>
<span class="normal"><a href="#__codelineno-0-492"> 492</a></span>
<span class="normal"><a href="#__codelineno-0-493"> 493</a></span>
<span class="normal"><a href="#__codelineno-0-494"> 494</a></span>
<span class="normal"><a href="#__codelineno-0-495"> 495</a></span>
<span class="normal"><a href="#__codelineno-0-496"> 496</a></span>
<span class="normal"><a href="#__codelineno-0-497"> 497</a></span>
<span class="normal"><a href="#__codelineno-0-498"> 498</a></span>
<span class="normal"><a href="#__codelineno-0-499"> 499</a></span>
<span class="normal"><a href="#__codelineno-0-500"> 500</a></span>
<span class="normal"><a href="#__codelineno-0-501"> 501</a></span>
<span class="normal"><a href="#__codelineno-0-502"> 502</a></span>
<span class="normal"><a href="#__codelineno-0-503"> 503</a></span>
<span class="normal"><a href="#__codelineno-0-504"> 504</a></span>
<span class="normal"><a href="#__codelineno-0-505"> 505</a></span>
<span class="normal"><a href="#__codelineno-0-506"> 506</a></span>
<span class="normal"><a href="#__codelineno-0-507"> 507</a></span>
<span class="normal"><a href="#__codelineno-0-508"> 508</a></span>
<span class="normal"><a href="#__codelineno-0-509"> 509</a></span>
<span class="normal"><a href="#__codelineno-0-510"> 510</a></span>
<span class="normal"><a href="#__codelineno-0-511"> 511</a></span>
<span class="normal"><a href="#__codelineno-0-512"> 512</a></span>
<span class="normal"><a href="#__codelineno-0-513"> 513</a></span>
<span class="normal"><a href="#__codelineno-0-514"> 514</a></span>
<span class="normal"><a href="#__codelineno-0-515"> 515</a></span>
<span class="normal"><a href="#__codelineno-0-516"> 516</a></span>
<span class="normal"><a href="#__codelineno-0-517"> 517</a></span>
<span class="normal"><a href="#__codelineno-0-518"> 518</a></span>
<span class="normal"><a href="#__codelineno-0-519"> 519</a></span>
<span class="normal"><a href="#__codelineno-0-520"> 520</a></span>
<span class="normal"><a href="#__codelineno-0-521"> 521</a></span>
<span class="normal"><a href="#__codelineno-0-522"> 522</a></span>
<span class="normal"><a href="#__codelineno-0-523"> 523</a></span>
<span class="normal"><a href="#__codelineno-0-524"> 524</a></span>
<span class="normal"><a href="#__codelineno-0-525"> 525</a></span>
<span class="normal"><a href="#__codelineno-0-526"> 526</a></span>
<span class="normal"><a href="#__codelineno-0-527"> 527</a></span>
<span class="normal"><a href="#__codelineno-0-528"> 528</a></span>
<span class="normal"><a href="#__codelineno-0-529"> 529</a></span>
<span class="normal"><a href="#__codelineno-0-530"> 530</a></span>
<span class="normal"><a href="#__codelineno-0-531"> 531</a></span>
<span class="normal"><a href="#__codelineno-0-532"> 532</a></span>
<span class="normal"><a href="#__codelineno-0-533"> 533</a></span>
<span class="normal"><a href="#__codelineno-0-534"> 534</a></span>
<span class="normal"><a href="#__codelineno-0-535"> 535</a></span>
<span class="normal"><a href="#__codelineno-0-536"> 536</a></span>
<span class="normal"><a href="#__codelineno-0-537"> 537</a></span>
<span class="normal"><a href="#__codelineno-0-538"> 538</a></span>
<span class="normal"><a href="#__codelineno-0-539"> 539</a></span>
<span class="normal"><a href="#__codelineno-0-540"> 540</a></span>
<span class="normal"><a href="#__codelineno-0-541"> 541</a></span>
<span class="normal"><a href="#__codelineno-0-542"> 542</a></span>
<span class="normal"><a href="#__codelineno-0-543"> 543</a></span>
<span class="normal"><a href="#__codelineno-0-544"> 544</a></span>
<span class="normal"><a href="#__codelineno-0-545"> 545</a></span>
<span class="normal"><a href="#__codelineno-0-546"> 546</a></span>
<span class="normal"><a href="#__codelineno-0-547"> 547</a></span>
<span class="normal"><a href="#__codelineno-0-548"> 548</a></span>
<span class="normal"><a href="#__codelineno-0-549"> 549</a></span>
<span class="normal"><a href="#__codelineno-0-550"> 550</a></span>
<span class="normal"><a href="#__codelineno-0-551"> 551</a></span>
<span class="normal"><a href="#__codelineno-0-552"> 552</a></span>
<span class="normal"><a href="#__codelineno-0-553"> 553</a></span>
<span class="normal"><a href="#__codelineno-0-554"> 554</a></span>
<span class="normal"><a href="#__codelineno-0-555"> 555</a></span>
<span class="normal"><a href="#__codelineno-0-556"> 556</a></span>
<span class="normal"><a href="#__codelineno-0-557"> 557</a></span>
<span class="normal"><a href="#__codelineno-0-558"> 558</a></span>
<span class="normal"><a href="#__codelineno-0-559"> 559</a></span>
<span class="normal"><a href="#__codelineno-0-560"> 560</a></span>
<span class="normal"><a href="#__codelineno-0-561"> 561</a></span>
<span class="normal"><a href="#__codelineno-0-562"> 562</a></span>
<span class="normal"><a href="#__codelineno-0-563"> 563</a></span>
<span class="normal"><a href="#__codelineno-0-564"> 564</a></span>
<span class="normal"><a href="#__codelineno-0-565"> 565</a></span>
<span class="normal"><a href="#__codelineno-0-566"> 566</a></span>
<span class="normal"><a href="#__codelineno-0-567"> 567</a></span>
<span class="normal"><a href="#__codelineno-0-568"> 568</a></span>
<span class="normal"><a href="#__codelineno-0-569"> 569</a></span>
<span class="normal"><a href="#__codelineno-0-570"> 570</a></span>
<span class="normal"><a href="#__codelineno-0-571"> 571</a></span>
<span class="normal"><a href="#__codelineno-0-572"> 572</a></span>
<span class="normal"><a href="#__codelineno-0-573"> 573</a></span>
<span class="normal"><a href="#__codelineno-0-574"> 574</a></span>
<span class="normal"><a href="#__codelineno-0-575"> 575</a></span>
<span class="normal"><a href="#__codelineno-0-576"> 576</a></span>
<span class="normal"><a href="#__codelineno-0-577"> 577</a></span>
<span class="normal"><a href="#__codelineno-0-578"> 578</a></span>
<span class="normal"><a href="#__codelineno-0-579"> 579</a></span>
<span class="normal"><a href="#__codelineno-0-580"> 580</a></span>
<span class="normal"><a href="#__codelineno-0-581"> 581</a></span>
<span class="normal"><a href="#__codelineno-0-582"> 582</a></span>
<span class="normal"><a href="#__codelineno-0-583"> 583</a></span>
<span class="normal"><a href="#__codelineno-0-584"> 584</a></span>
<span class="normal"><a href="#__codelineno-0-585"> 585</a></span>
<span class="normal"><a href="#__codelineno-0-586"> 586</a></span>
<span class="normal"><a href="#__codelineno-0-587"> 587</a></span>
<span class="normal"><a href="#__codelineno-0-588"> 588</a></span>
<span class="normal"><a href="#__codelineno-0-589"> 589</a></span>
<span class="normal"><a href="#__codelineno-0-590"> 590</a></span>
<span class="normal"><a href="#__codelineno-0-591"> 591</a></span>
<span class="normal"><a href="#__codelineno-0-592"> 592</a></span>
<span class="normal"><a href="#__codelineno-0-593"> 593</a></span>
<span class="normal"><a href="#__codelineno-0-594"> 594</a></span>
<span class="normal"><a href="#__codelineno-0-595"> 595</a></span>
<span class="normal"><a href="#__codelineno-0-596"> 596</a></span>
<span class="normal"><a href="#__codelineno-0-597"> 597</a></span>
<span class="normal"><a href="#__codelineno-0-598"> 598</a></span>
<span class="normal"><a href="#__codelineno-0-599"> 599</a></span>
<span class="normal"><a href="#__codelineno-0-600"> 600</a></span>
<span class="normal"><a href="#__codelineno-0-601"> 601</a></span>
<span class="normal"><a href="#__codelineno-0-602"> 602</a></span>
<span class="normal"><a href="#__codelineno-0-603"> 603</a></span>
<span class="normal"><a href="#__codelineno-0-604"> 604</a></span>
<span class="normal"><a href="#__codelineno-0-605"> 605</a></span>
<span class="normal"><a href="#__codelineno-0-606"> 606</a></span>
<span class="normal"><a href="#__codelineno-0-607"> 607</a></span>
<span class="normal"><a href="#__codelineno-0-608"> 608</a></span>
<span class="normal"><a href="#__codelineno-0-609"> 609</a></span>
<span class="normal"><a href="#__codelineno-0-610"> 610</a></span>
<span class="normal"><a href="#__codelineno-0-611"> 611</a></span>
<span class="normal"><a href="#__codelineno-0-612"> 612</a></span>
<span class="normal"><a href="#__codelineno-0-613"> 613</a></span>
<span class="normal"><a href="#__codelineno-0-614"> 614</a></span>
<span class="normal"><a href="#__codelineno-0-615"> 615</a></span>
<span class="normal"><a href="#__codelineno-0-616"> 616</a></span>
<span class="normal"><a href="#__codelineno-0-617"> 617</a></span>
<span class="normal"><a href="#__codelineno-0-618"> 618</a></span>
<span class="normal"><a href="#__codelineno-0-619"> 619</a></span>
<span class="normal"><a href="#__codelineno-0-620"> 620</a></span>
<span class="normal"><a href="#__codelineno-0-621"> 621</a></span>
<span class="normal"><a href="#__codelineno-0-622"> 622</a></span>
<span class="normal"><a href="#__codelineno-0-623"> 623</a></span>
<span class="normal"><a href="#__codelineno-0-624"> 624</a></span>
<span class="normal"><a href="#__codelineno-0-625"> 625</a></span>
<span class="normal"><a href="#__codelineno-0-626"> 626</a></span>
<span class="normal"><a href="#__codelineno-0-627"> 627</a></span>
<span class="normal"><a href="#__codelineno-0-628"> 628</a></span>
<span class="normal"><a href="#__codelineno-0-629"> 629</a></span>
<span class="normal"><a href="#__codelineno-0-630"> 630</a></span>
<span class="normal"><a href="#__codelineno-0-631"> 631</a></span>
<span class="normal"><a href="#__codelineno-0-632"> 632</a></span>
<span class="normal"><a href="#__codelineno-0-633"> 633</a></span>
<span class="normal"><a href="#__codelineno-0-634"> 634</a></span>
<span class="normal"><a href="#__codelineno-0-635"> 635</a></span>
<span class="normal"><a href="#__codelineno-0-636"> 636</a></span>
<span class="normal"><a href="#__codelineno-0-637"> 637</a></span>
<span class="normal"><a href="#__codelineno-0-638"> 638</a></span>
<span class="normal"><a href="#__codelineno-0-639"> 639</a></span>
<span class="normal"><a href="#__codelineno-0-640"> 640</a></span>
<span class="normal"><a href="#__codelineno-0-641"> 641</a></span>
<span class="normal"><a href="#__codelineno-0-642"> 642</a></span>
<span class="normal"><a href="#__codelineno-0-643"> 643</a></span>
<span class="normal"><a href="#__codelineno-0-644"> 644</a></span>
<span class="normal"><a href="#__codelineno-0-645"> 645</a></span>
<span class="normal"><a href="#__codelineno-0-646"> 646</a></span>
<span class="normal"><a href="#__codelineno-0-647"> 647</a></span>
<span class="normal"><a href="#__codelineno-0-648"> 648</a></span>
<span class="normal"><a href="#__codelineno-0-649"> 649</a></span>
<span class="normal"><a href="#__codelineno-0-650"> 650</a></span>
<span class="normal"><a href="#__codelineno-0-651"> 651</a></span>
<span class="normal"><a href="#__codelineno-0-652"> 652</a></span>
<span class="normal"><a href="#__codelineno-0-653"> 653</a></span>
<span class="normal"><a href="#__codelineno-0-654"> 654</a></span>
<span class="normal"><a href="#__codelineno-0-655"> 655</a></span>
<span class="normal"><a href="#__codelineno-0-656"> 656</a></span>
<span class="normal"><a href="#__codelineno-0-657"> 657</a></span>
<span class="normal"><a href="#__codelineno-0-658"> 658</a></span>
<span class="normal"><a href="#__codelineno-0-659"> 659</a></span>
<span class="normal"><a href="#__codelineno-0-660"> 660</a></span>
<span class="normal"><a href="#__codelineno-0-661"> 661</a></span>
<span class="normal"><a href="#__codelineno-0-662"> 662</a></span>
<span class="normal"><a href="#__codelineno-0-663"> 663</a></span>
<span class="normal"><a href="#__codelineno-0-664"> 664</a></span>
<span class="normal"><a href="#__codelineno-0-665"> 665</a></span>
<span class="normal"><a href="#__codelineno-0-666"> 666</a></span>
<span class="normal"><a href="#__codelineno-0-667"> 667</a></span>
<span class="normal"><a href="#__codelineno-0-668"> 668</a></span>
<span class="normal"><a href="#__codelineno-0-669"> 669</a></span>
<span class="normal"><a href="#__codelineno-0-670"> 670</a></span>
<span class="normal"><a href="#__codelineno-0-671"> 671</a></span>
<span class="normal"><a href="#__codelineno-0-672"> 672</a></span>
<span class="normal"><a href="#__codelineno-0-673"> 673</a></span>
<span class="normal"><a href="#__codelineno-0-674"> 674</a></span>
<span class="normal"><a href="#__codelineno-0-675"> 675</a></span>
<span class="normal"><a href="#__codelineno-0-676"> 676</a></span>
<span class="normal"><a href="#__codelineno-0-677"> 677</a></span>
<span class="normal"><a href="#__codelineno-0-678"> 678</a></span>
<span class="normal"><a href="#__codelineno-0-679"> 679</a></span>
<span class="normal"><a href="#__codelineno-0-680"> 680</a></span>
<span class="normal"><a href="#__codelineno-0-681"> 681</a></span>
<span class="normal"><a href="#__codelineno-0-682"> 682</a></span>
<span class="normal"><a href="#__codelineno-0-683"> 683</a></span>
<span class="normal"><a href="#__codelineno-0-684"> 684</a></span>
<span class="normal"><a href="#__codelineno-0-685"> 685</a></span>
<span class="normal"><a href="#__codelineno-0-686"> 686</a></span>
<span class="normal"><a href="#__codelineno-0-687"> 687</a></span>
<span class="normal"><a href="#__codelineno-0-688"> 688</a></span>
<span class="normal"><a href="#__codelineno-0-689"> 689</a></span>
<span class="normal"><a href="#__codelineno-0-690"> 690</a></span>
<span class="normal"><a href="#__codelineno-0-691"> 691</a></span>
<span class="normal"><a href="#__codelineno-0-692"> 692</a></span>
<span class="normal"><a href="#__codelineno-0-693"> 693</a></span>
<span class="normal"><a href="#__codelineno-0-694"> 694</a></span>
<span class="normal"><a href="#__codelineno-0-695"> 695</a></span>
<span class="normal"><a href="#__codelineno-0-696"> 696</a></span>
<span class="normal"><a href="#__codelineno-0-697"> 697</a></span>
<span class="normal"><a href="#__codelineno-0-698"> 698</a></span>
<span class="normal"><a href="#__codelineno-0-699"> 699</a></span>
<span class="normal"><a href="#__codelineno-0-700"> 700</a></span>
<span class="normal"><a href="#__codelineno-0-701"> 701</a></span>
<span class="normal"><a href="#__codelineno-0-702"> 702</a></span>
<span class="normal"><a href="#__codelineno-0-703"> 703</a></span>
<span class="normal"><a href="#__codelineno-0-704"> 704</a></span>
<span class="normal"><a href="#__codelineno-0-705"> 705</a></span>
<span class="normal"><a href="#__codelineno-0-706"> 706</a></span>
<span class="normal"><a href="#__codelineno-0-707"> 707</a></span>
<span class="normal"><a href="#__codelineno-0-708"> 708</a></span>
<span class="normal"><a href="#__codelineno-0-709"> 709</a></span>
<span class="normal"><a href="#__codelineno-0-710"> 710</a></span>
<span class="normal"><a href="#__codelineno-0-711"> 711</a></span>
<span class="normal"><a href="#__codelineno-0-712"> 712</a></span>
<span class="normal"><a href="#__codelineno-0-713"> 713</a></span>
<span class="normal"><a href="#__codelineno-0-714"> 714</a></span>
<span class="normal"><a href="#__codelineno-0-715"> 715</a></span>
<span class="normal"><a href="#__codelineno-0-716"> 716</a></span>
<span class="normal"><a href="#__codelineno-0-717"> 717</a></span>
<span class="normal"><a href="#__codelineno-0-718"> 718</a></span>
<span class="normal"><a href="#__codelineno-0-719"> 719</a></span>
<span class="normal"><a href="#__codelineno-0-720"> 720</a></span>
<span class="normal"><a href="#__codelineno-0-721"> 721</a></span>
<span class="normal"><a href="#__codelineno-0-722"> 722</a></span>
<span class="normal"><a href="#__codelineno-0-723"> 723</a></span>
<span class="normal"><a href="#__codelineno-0-724"> 724</a></span>
<span class="normal"><a href="#__codelineno-0-725"> 725</a></span>
<span class="normal"><a href="#__codelineno-0-726"> 726</a></span>
<span class="normal"><a href="#__codelineno-0-727"> 727</a></span>
<span class="normal"><a href="#__codelineno-0-728"> 728</a></span>
<span class="normal"><a href="#__codelineno-0-729"> 729</a></span>
<span class="normal"><a href="#__codelineno-0-730"> 730</a></span>
<span class="normal"><a href="#__codelineno-0-731"> 731</a></span>
<span class="normal"><a href="#__codelineno-0-732"> 732</a></span>
<span class="normal"><a href="#__codelineno-0-733"> 733</a></span>
<span class="normal"><a href="#__codelineno-0-734"> 734</a></span>
<span class="normal"><a href="#__codelineno-0-735"> 735</a></span>
<span class="normal"><a href="#__codelineno-0-736"> 736</a></span>
<span class="normal"><a href="#__codelineno-0-737"> 737</a></span>
<span class="normal"><a href="#__codelineno-0-738"> 738</a></span>
<span class="normal"><a href="#__codelineno-0-739"> 739</a></span>
<span class="normal"><a href="#__codelineno-0-740"> 740</a></span>
<span class="normal"><a href="#__codelineno-0-741"> 741</a></span>
<span class="normal"><a href="#__codelineno-0-742"> 742</a></span>
<span class="normal"><a href="#__codelineno-0-743"> 743</a></span>
<span class="normal"><a href="#__codelineno-0-744"> 744</a></span>
<span class="normal"><a href="#__codelineno-0-745"> 745</a></span>
<span class="normal"><a href="#__codelineno-0-746"> 746</a></span>
<span class="normal"><a href="#__codelineno-0-747"> 747</a></span>
<span class="normal"><a href="#__codelineno-0-748"> 748</a></span>
<span class="normal"><a href="#__codelineno-0-749"> 749</a></span>
<span class="normal"><a href="#__codelineno-0-750"> 750</a></span>
<span class="normal"><a href="#__codelineno-0-751"> 751</a></span>
<span class="normal"><a href="#__codelineno-0-752"> 752</a></span>
<span class="normal"><a href="#__codelineno-0-753"> 753</a></span>
<span class="normal"><a href="#__codelineno-0-754"> 754</a></span>
<span class="normal"><a href="#__codelineno-0-755"> 755</a></span>
<span class="normal"><a href="#__codelineno-0-756"> 756</a></span>
<span class="normal"><a href="#__codelineno-0-757"> 757</a></span>
<span class="normal"><a href="#__codelineno-0-758"> 758</a></span>
<span class="normal"><a href="#__codelineno-0-759"> 759</a></span>
<span class="normal"><a href="#__codelineno-0-760"> 760</a></span>
<span class="normal"><a href="#__codelineno-0-761"> 761</a></span>
<span class="normal"><a href="#__codelineno-0-762"> 762</a></span>
<span class="normal"><a href="#__codelineno-0-763"> 763</a></span>
<span class="normal"><a href="#__codelineno-0-764"> 764</a></span>
<span class="normal"><a href="#__codelineno-0-765"> 765</a></span>
<span class="normal"><a href="#__codelineno-0-766"> 766</a></span>
<span class="normal"><a href="#__codelineno-0-767"> 767</a></span>
<span class="normal"><a href="#__codelineno-0-768"> 768</a></span>
<span class="normal"><a href="#__codelineno-0-769"> 769</a></span>
<span class="normal"><a href="#__codelineno-0-770"> 770</a></span>
<span class="normal"><a href="#__codelineno-0-771"> 771</a></span>
<span class="normal"><a href="#__codelineno-0-772"> 772</a></span>
<span class="normal"><a href="#__codelineno-0-773"> 773</a></span>
<span class="normal"><a href="#__codelineno-0-774"> 774</a></span>
<span class="normal"><a href="#__codelineno-0-775"> 775</a></span>
<span class="normal"><a href="#__codelineno-0-776"> 776</a></span>
<span class="normal"><a href="#__codelineno-0-777"> 777</a></span>
<span class="normal"><a href="#__codelineno-0-778"> 778</a></span>
<span class="normal"><a href="#__codelineno-0-779"> 779</a></span>
<span class="normal"><a href="#__codelineno-0-780"> 780</a></span>
<span class="normal"><a href="#__codelineno-0-781"> 781</a></span>
<span class="normal"><a href="#__codelineno-0-782"> 782</a></span>
<span class="normal"><a href="#__codelineno-0-783"> 783</a></span>
<span class="normal"><a href="#__codelineno-0-784"> 784</a></span>
<span class="normal"><a href="#__codelineno-0-785"> 785</a></span>
<span class="normal"><a href="#__codelineno-0-786"> 786</a></span>
<span class="normal"><a href="#__codelineno-0-787"> 787</a></span>
<span class="normal"><a href="#__codelineno-0-788"> 788</a></span>
<span class="normal"><a href="#__codelineno-0-789"> 789</a></span>
<span class="normal"><a href="#__codelineno-0-790"> 790</a></span>
<span class="normal"><a href="#__codelineno-0-791"> 791</a></span>
<span class="normal"><a href="#__codelineno-0-792"> 792</a></span>
<span class="normal"><a href="#__codelineno-0-793"> 793</a></span>
<span class="normal"><a href="#__codelineno-0-794"> 794</a></span>
<span class="normal"><a href="#__codelineno-0-795"> 795</a></span>
<span class="normal"><a href="#__codelineno-0-796"> 796</a></span>
<span class="normal"><a href="#__codelineno-0-797"> 797</a></span>
<span class="normal"><a href="#__codelineno-0-798"> 798</a></span>
<span class="normal"><a href="#__codelineno-0-799"> 799</a></span>
<span class="normal"><a href="#__codelineno-0-800"> 800</a></span>
<span class="normal"><a href="#__codelineno-0-801"> 801</a></span>
<span class="normal"><a href="#__codelineno-0-802"> 802</a></span>
<span class="normal"><a href="#__codelineno-0-803"> 803</a></span>
<span class="normal"><a href="#__codelineno-0-804"> 804</a></span>
<span class="normal"><a href="#__codelineno-0-805"> 805</a></span>
<span class="normal"><a href="#__codelineno-0-806"> 806</a></span>
<span class="normal"><a href="#__codelineno-0-807"> 807</a></span>
<span class="normal"><a href="#__codelineno-0-808"> 808</a></span>
<span class="normal"><a href="#__codelineno-0-809"> 809</a></span>
<span class="normal"><a href="#__codelineno-0-810"> 810</a></span>
<span class="normal"><a href="#__codelineno-0-811"> 811</a></span>
<span class="normal"><a href="#__codelineno-0-812"> 812</a></span>
<span class="normal"><a href="#__codelineno-0-813"> 813</a></span>
<span class="normal"><a href="#__codelineno-0-814"> 814</a></span>
<span class="normal"><a href="#__codelineno-0-815"> 815</a></span>
<span class="normal"><a href="#__codelineno-0-816"> 816</a></span>
<span class="normal"><a href="#__codelineno-0-817"> 817</a></span>
<span class="normal"><a href="#__codelineno-0-818"> 818</a></span>
<span class="normal"><a href="#__codelineno-0-819"> 819</a></span>
<span class="normal"><a href="#__codelineno-0-820"> 820</a></span>
<span class="normal"><a href="#__codelineno-0-821"> 821</a></span>
<span class="normal"><a href="#__codelineno-0-822"> 822</a></span>
<span class="normal"><a href="#__codelineno-0-823"> 823</a></span>
<span class="normal"><a href="#__codelineno-0-824"> 824</a></span>
<span class="normal"><a href="#__codelineno-0-825"> 825</a></span>
<span class="normal"><a href="#__codelineno-0-826"> 826</a></span>
<span class="normal"><a href="#__codelineno-0-827"> 827</a></span>
<span class="normal"><a href="#__codelineno-0-828"> 828</a></span>
<span class="normal"><a href="#__codelineno-0-829"> 829</a></span>
<span class="normal"><a href="#__codelineno-0-830"> 830</a></span>
<span class="normal"><a href="#__codelineno-0-831"> 831</a></span>
<span class="normal"><a href="#__codelineno-0-832"> 832</a></span>
<span class="normal"><a href="#__codelineno-0-833"> 833</a></span>
<span class="normal"><a href="#__codelineno-0-834"> 834</a></span>
<span class="normal"><a href="#__codelineno-0-835"> 835</a></span>
<span class="normal"><a href="#__codelineno-0-836"> 836</a></span>
<span class="normal"><a href="#__codelineno-0-837"> 837</a></span>
<span class="normal"><a href="#__codelineno-0-838"> 838</a></span>
<span class="normal"><a href="#__codelineno-0-839"> 839</a></span>
<span class="normal"><a href="#__codelineno-0-840"> 840</a></span>
<span class="normal"><a href="#__codelineno-0-841"> 841</a></span>
<span class="normal"><a href="#__codelineno-0-842"> 842</a></span>
<span class="normal"><a href="#__codelineno-0-843"> 843</a></span>
<span class="normal"><a href="#__codelineno-0-844"> 844</a></span>
<span class="normal"><a href="#__codelineno-0-845"> 845</a></span>
<span class="normal"><a href="#__codelineno-0-846"> 846</a></span>
<span class="normal"><a href="#__codelineno-0-847"> 847</a></span>
<span class="normal"><a href="#__codelineno-0-848"> 848</a></span>
<span class="normal"><a href="#__codelineno-0-849"> 849</a></span>
<span class="normal"><a href="#__codelineno-0-850"> 850</a></span>
<span class="normal"><a href="#__codelineno-0-851"> 851</a></span>
<span class="normal"><a href="#__codelineno-0-852"> 852</a></span>
<span class="normal"><a href="#__codelineno-0-853"> 853</a></span>
<span class="normal"><a href="#__codelineno-0-854"> 854</a></span>
<span class="normal"><a href="#__codelineno-0-855"> 855</a></span>
<span class="normal"><a href="#__codelineno-0-856"> 856</a></span>
<span class="normal"><a href="#__codelineno-0-857"> 857</a></span>
<span class="normal"><a href="#__codelineno-0-858"> 858</a></span>
<span class="normal"><a href="#__codelineno-0-859"> 859</a></span>
<span class="normal"><a href="#__codelineno-0-860"> 860</a></span>
<span class="normal"><a href="#__codelineno-0-861"> 861</a></span>
<span class="normal"><a href="#__codelineno-0-862"> 862</a></span>
<span class="normal"><a href="#__codelineno-0-863"> 863</a></span>
<span class="normal"><a href="#__codelineno-0-864"> 864</a></span>
<span class="normal"><a href="#__codelineno-0-865"> 865</a></span>
<span class="normal"><a href="#__codelineno-0-866"> 866</a></span>
<span class="normal"><a href="#__codelineno-0-867"> 867</a></span>
<span class="normal"><a href="#__codelineno-0-868"> 868</a></span>
<span class="normal"><a href="#__codelineno-0-869"> 869</a></span>
<span class="normal"><a href="#__codelineno-0-870"> 870</a></span>
<span class="normal"><a href="#__codelineno-0-871"> 871</a></span>
<span class="normal"><a href="#__codelineno-0-872"> 872</a></span>
<span class="normal"><a href="#__codelineno-0-873"> 873</a></span>
<span class="normal"><a href="#__codelineno-0-874"> 874</a></span>
<span class="normal"><a href="#__codelineno-0-875"> 875</a></span>
<span class="normal"><a href="#__codelineno-0-876"> 876</a></span>
<span class="normal"><a href="#__codelineno-0-877"> 877</a></span>
<span class="normal"><a href="#__codelineno-0-878"> 878</a></span>
<span class="normal"><a href="#__codelineno-0-879"> 879</a></span>
<span class="normal"><a href="#__codelineno-0-880"> 880</a></span>
<span class="normal"><a href="#__codelineno-0-881"> 881</a></span>
<span class="normal"><a href="#__codelineno-0-882"> 882</a></span>
<span class="normal"><a href="#__codelineno-0-883"> 883</a></span>
<span class="normal"><a href="#__codelineno-0-884"> 884</a></span>
<span class="normal"><a href="#__codelineno-0-885"> 885</a></span>
<span class="normal"><a href="#__codelineno-0-886"> 886</a></span>
<span class="normal"><a href="#__codelineno-0-887"> 887</a></span>
<span class="normal"><a href="#__codelineno-0-888"> 888</a></span>
<span class="normal"><a href="#__codelineno-0-889"> 889</a></span>
<span class="normal"><a href="#__codelineno-0-890"> 890</a></span>
<span class="normal"><a href="#__codelineno-0-891"> 891</a></span>
<span class="normal"><a href="#__codelineno-0-892"> 892</a></span>
<span class="normal"><a href="#__codelineno-0-893"> 893</a></span>
<span class="normal"><a href="#__codelineno-0-894"> 894</a></span>
<span class="normal"><a href="#__codelineno-0-895"> 895</a></span>
<span class="normal"><a href="#__codelineno-0-896"> 896</a></span>
<span class="normal"><a href="#__codelineno-0-897"> 897</a></span>
<span class="normal"><a href="#__codelineno-0-898"> 898</a></span>
<span class="normal"><a href="#__codelineno-0-899"> 899</a></span>
<span class="normal"><a href="#__codelineno-0-900"> 900</a></span>
<span class="normal"><a href="#__codelineno-0-901"> 901</a></span>
<span class="normal"><a href="#__codelineno-0-902"> 902</a></span>
<span class="normal"><a href="#__codelineno-0-903"> 903</a></span>
<span class="normal"><a href="#__codelineno-0-904"> 904</a></span>
<span class="normal"><a href="#__codelineno-0-905"> 905</a></span>
<span class="normal"><a href="#__codelineno-0-906"> 906</a></span>
<span class="normal"><a href="#__codelineno-0-907"> 907</a></span>
<span class="normal"><a href="#__codelineno-0-908"> 908</a></span>
<span class="normal"><a href="#__codelineno-0-909"> 909</a></span>
<span class="normal"><a href="#__codelineno-0-910"> 910</a></span>
<span class="normal"><a href="#__codelineno-0-911"> 911</a></span>
<span class="normal"><a href="#__codelineno-0-912"> 912</a></span>
<span class="normal"><a href="#__codelineno-0-913"> 913</a></span>
<span class="normal"><a href="#__codelineno-0-914"> 914</a></span>
<span class="normal"><a href="#__codelineno-0-915"> 915</a></span>
<span class="normal"><a href="#__codelineno-0-916"> 916</a></span>
<span class="normal"><a href="#__codelineno-0-917"> 917</a></span>
<span class="normal"><a href="#__codelineno-0-918"> 918</a></span>
<span class="normal"><a href="#__codelineno-0-919"> 919</a></span>
<span class="normal"><a href="#__codelineno-0-920"> 920</a></span>
<span class="normal"><a href="#__codelineno-0-921"> 921</a></span>
<span class="normal"><a href="#__codelineno-0-922"> 922</a></span>
<span class="normal"><a href="#__codelineno-0-923"> 923</a></span>
<span class="normal"><a href="#__codelineno-0-924"> 924</a></span>
<span class="normal"><a href="#__codelineno-0-925"> 925</a></span>
<span class="normal"><a href="#__codelineno-0-926"> 926</a></span>
<span class="normal"><a href="#__codelineno-0-927"> 927</a></span>
<span class="normal"><a href="#__codelineno-0-928"> 928</a></span>
<span class="normal"><a href="#__codelineno-0-929"> 929</a></span>
<span class="normal"><a href="#__codelineno-0-930"> 930</a></span>
<span class="normal"><a href="#__codelineno-0-931"> 931</a></span>
<span class="normal"><a href="#__codelineno-0-932"> 932</a></span>
<span class="normal"><a href="#__codelineno-0-933"> 933</a></span>
<span class="normal"><a href="#__codelineno-0-934"> 934</a></span>
<span class="normal"><a href="#__codelineno-0-935"> 935</a></span>
<span class="normal"><a href="#__codelineno-0-936"> 936</a></span>
<span class="normal"><a href="#__codelineno-0-937"> 937</a></span>
<span class="normal"><a href="#__codelineno-0-938"> 938</a></span>
<span class="normal"><a href="#__codelineno-0-939"> 939</a></span>
<span class="normal"><a href="#__codelineno-0-940"> 940</a></span>
<span class="normal"><a href="#__codelineno-0-941"> 941</a></span>
<span class="normal"><a href="#__codelineno-0-942"> 942</a></span>
<span class="normal"><a href="#__codelineno-0-943"> 943</a></span>
<span class="normal"><a href="#__codelineno-0-944"> 944</a></span>
<span class="normal"><a href="#__codelineno-0-945"> 945</a></span>
<span class="normal"><a href="#__codelineno-0-946"> 946</a></span>
<span class="normal"><a href="#__codelineno-0-947"> 947</a></span>
<span class="normal"><a href="#__codelineno-0-948"> 948</a></span>
<span class="normal"><a href="#__codelineno-0-949"> 949</a></span>
<span class="normal"><a href="#__codelineno-0-950"> 950</a></span>
<span class="normal"><a href="#__codelineno-0-951"> 951</a></span>
<span class="normal"><a href="#__codelineno-0-952"> 952</a></span>
<span class="normal"><a href="#__codelineno-0-953"> 953</a></span>
<span class="normal"><a href="#__codelineno-0-954"> 954</a></span>
<span class="normal"><a href="#__codelineno-0-955"> 955</a></span>
<span class="normal"><a href="#__codelineno-0-956"> 956</a></span>
<span class="normal"><a href="#__codelineno-0-957"> 957</a></span>
<span class="normal"><a href="#__codelineno-0-958"> 958</a></span>
<span class="normal"><a href="#__codelineno-0-959"> 959</a></span>
<span class="normal"><a href="#__codelineno-0-960"> 960</a></span>
<span class="normal"><a href="#__codelineno-0-961"> 961</a></span>
<span class="normal"><a href="#__codelineno-0-962"> 962</a></span>
<span class="normal"><a href="#__codelineno-0-963"> 963</a></span>
<span class="normal"><a href="#__codelineno-0-964"> 964</a></span>
<span class="normal"><a href="#__codelineno-0-965"> 965</a></span>
<span class="normal"><a href="#__codelineno-0-966"> 966</a></span>
<span class="normal"><a href="#__codelineno-0-967"> 967</a></span>
<span class="normal"><a href="#__codelineno-0-968"> 968</a></span>
<span class="normal"><a href="#__codelineno-0-969"> 969</a></span>
<span class="normal"><a href="#__codelineno-0-970"> 970</a></span>
<span class="normal"><a href="#__codelineno-0-971"> 971</a></span>
<span class="normal"><a href="#__codelineno-0-972"> 972</a></span>
<span class="normal"><a href="#__codelineno-0-973"> 973</a></span>
<span class="normal"><a href="#__codelineno-0-974"> 974</a></span>
<span class="normal"><a href="#__codelineno-0-975"> 975</a></span>
<span class="normal"><a href="#__codelineno-0-976"> 976</a></span>
<span class="normal"><a href="#__codelineno-0-977"> 977</a></span>
<span class="normal"><a href="#__codelineno-0-978"> 978</a></span>
<span class="normal"><a href="#__codelineno-0-979"> 979</a></span>
<span class="normal"><a href="#__codelineno-0-980"> 980</a></span>
<span class="normal"><a href="#__codelineno-0-981"> 981</a></span>
<span class="normal"><a href="#__codelineno-0-982"> 982</a></span>
<span class="normal"><a href="#__codelineno-0-983"> 983</a></span>
<span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span>
<span class="normal"><a href="#__codelineno-0-1010">1010</a></span>
<span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span>
<span class="normal"><a href="#__codelineno-0-1032">1032</a></span>
<span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span>
<span class="normal"><a href="#__codelineno-0-1047">1047</a></span>
<span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span>
<span class="normal"><a href="#__codelineno-0-1074">1074</a></span>
<span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span>
<span class="normal"><a href="#__codelineno-0-1095">1095</a></span>
<span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span>
<span class="normal"><a href="#__codelineno-0-1132">1132</a></span>
<span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span>
<span class="normal"><a href="#__codelineno-0-1201">1201</a></span>
<span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span>
<span class="normal"><a href="#__codelineno-0-1218">1218</a></span>
<span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span>
<span class="normal"><a href="#__codelineno-0-1243">1243</a></span>
<span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span>
<span class="normal"><a href="#__codelineno-0-1692">1692</a></span>
<span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span>
<span class="normal"><a href="#__codelineno-0-1722">1722</a></span>
<span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span>
<span class="normal"><a href="#__codelineno-0-1807">1807</a></span>
<span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span>
<span class="normal"><a href="#__codelineno-0-1873">1873</a></span>
<span class="normal"><a href="#__codelineno-0-1874">1874</a></span>
<span class="normal"><a href="#__codelineno-0-1875">1875</a></span>
<span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span>
<span class="normal"><a href="#__codelineno-0-1881">1881</a></span>
<span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span>
<span class="normal"><a href="#__codelineno-0-1890">1890</a></span>
<span class="normal"><a href="#__codelineno-0-1891">1891</a></span>
<span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span>
<span class="normal"><a href="#__codelineno-0-1938">1938</a></span>
<span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span>
<span class="normal"><a href="#__codelineno-0-2004">2004</a></span>
<span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span>
<span class="normal"><a href="#__codelineno-0-2059">2059</a></span>
<span class="normal"><a href="#__codelineno-0-2060">2060</a></span>
<span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span>
<span class="normal"><a href="#__codelineno-0-2068">2068</a></span>
<span class="normal"><a href="#__codelineno-0-2069">2069</a></span>
<span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span>
<span class="normal"><a href="#__codelineno-0-2078">2078</a></span>
<span class="normal"><a href="#__codelineno-0-2079">2079</a></span>
<span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span>
<span class="normal"><a href="#__codelineno-0-2097">2097</a></span>
<span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span>
<span class="normal"><a href="#__codelineno-0-2118">2118</a></span>
<span class="normal"><a href="#__codelineno-0-2119">2119</a></span>
<span class="normal"><a href="#__codelineno-0-2120">2120</a></span>
<span class="normal"><a href="#__codelineno-0-2121">2121</a></span>
<span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span>
<span class="normal"><a href="#__codelineno-0-2129">2129</a></span>
<span class="normal"><a href="#__codelineno-0-2130">2130</a></span>
<span class="normal"><a href="#__codelineno-0-2131">2131</a></span>
<span class="normal"><a href="#__codelineno-0-2132">2132</a></span>
<span class="normal"><a href="#__codelineno-0-2133">2133</a></span>
<span class="normal"><a href="#__codelineno-0-2134">2134</a></span>
<span class="normal"><a href="#__codelineno-0-2135">2135</a></span>
<span class="normal"><a href="#__codelineno-0-2136">2136</a></span>
<span class="normal"><a href="#__codelineno-0-2137">2137</a></span>
<span class="normal"><a href="#__codelineno-0-2138">2138</a></span>
<span class="normal"><a href="#__codelineno-0-2139">2139</a></span>
<span class="normal"><a href="#__codelineno-0-2140">2140</a></span>
<span class="normal"><a href="#__codelineno-0-2141">2141</a></span>
<span class="normal"><a href="#__codelineno-0-2142">2142</a></span>
<span class="normal"><a href="#__codelineno-0-2143">2143</a></span>
<span class="normal"><a href="#__codelineno-0-2144">2144</a></span>
<span class="normal"><a href="#__codelineno-0-2145">2145</a></span>
<span class="normal"><a href="#__codelineno-0-2146">2146</a></span>
<span class="normal"><a href="#__codelineno-0-2147">2147</a></span>
<span class="normal"><a href="#__codelineno-0-2148">2148</a></span>
<span class="normal"><a href="#__codelineno-0-2149">2149</a></span>
<span class="normal"><a href="#__codelineno-0-2150">2150</a></span>
<span class="normal"><a href="#__codelineno-0-2151">2151</a></span>
<span class="normal"><a href="#__codelineno-0-2152">2152</a></span>
<span class="normal"><a href="#__codelineno-0-2153">2153</a></span>
<span class="normal"><a href="#__codelineno-0-2154">2154</a></span>
<span class="normal"><a href="#__codelineno-0-2155">2155</a></span>
<span class="normal"><a href="#__codelineno-0-2156">2156</a></span>
<span class="normal"><a href="#__codelineno-0-2157">2157</a></span>
<span class="normal"><a href="#__codelineno-0-2158">2158</a></span>
<span class="normal"><a href="#__codelineno-0-2159">2159</a></span>
<span class="normal"><a href="#__codelineno-0-2160">2160</a></span>
<span class="normal"><a href="#__codelineno-0-2161">2161</a></span>
<span class="normal"><a href="#__codelineno-0-2162">2162</a></span>
<span class="normal"><a href="#__codelineno-0-2163">2163</a></span>
<span class="normal"><a href="#__codelineno-0-2164">2164</a></span>
<span class="normal"><a href="#__codelineno-0-2165">2165</a></span>
<span class="normal"><a href="#__codelineno-0-2166">2166</a></span>
<span class="normal"><a href="#__codelineno-0-2167">2167</a></span>
<span class="normal"><a href="#__codelineno-0-2168">2168</a></span>
<span class="normal"><a href="#__codelineno-0-2169">2169</a></span>
<span class="normal"><a href="#__codelineno-0-2170">2170</a></span>
<span class="normal"><a href="#__codelineno-0-2171">2171</a></span>
<span class="normal"><a href="#__codelineno-0-2172">2172</a></span>
<span class="normal"><a href="#__codelineno-0-2173">2173</a></span>
<span class="normal"><a href="#__codelineno-0-2174">2174</a></span>
<span class="normal"><a href="#__codelineno-0-2175">2175</a></span>
<span class="normal"><a href="#__codelineno-0-2176">2176</a></span>
<span class="normal"><a href="#__codelineno-0-2177">2177</a></span>
<span class="normal"><a href="#__codelineno-0-2178">2178</a></span>
<span class="normal"><a href="#__codelineno-0-2179">2179</a></span>
<span class="normal"><a href="#__codelineno-0-2180">2180</a></span>
<span class="normal"><a href="#__codelineno-0-2181">2181</a></span>
<span class="normal"><a href="#__codelineno-0-2182">2182</a></span>
<span class="normal"><a href="#__codelineno-0-2183">2183</a></span>
<span class="normal"><a href="#__codelineno-0-2184">2184</a></span>
<span class="normal"><a href="#__codelineno-0-2185">2185</a></span>
<span class="normal"><a href="#__codelineno-0-2186">2186</a></span>
<span class="normal"><a href="#__codelineno-0-2187">2187</a></span>
<span class="normal"><a href="#__codelineno-0-2188">2188</a></span>
<span class="normal"><a href="#__codelineno-0-2189">2189</a></span>
<span class="normal"><a href="#__codelineno-0-2190">2190</a></span>
<span class="normal"><a href="#__codelineno-0-2191">2191</a></span>
<span class="normal"><a href="#__codelineno-0-2192">2192</a></span>
<span class="normal"><a href="#__codelineno-0-2193">2193</a></span>
<span class="normal"><a href="#__codelineno-0-2194">2194</a></span>
<span class="normal"><a href="#__codelineno-0-2195">2195</a></span>
<span class="normal"><a href="#__codelineno-0-2196">2196</a></span>
<span class="normal"><a href="#__codelineno-0-2197">2197</a></span>
<span class="normal"><a href="#__codelineno-0-2198">2198</a></span>
<span class="normal"><a href="#__codelineno-0-2199">2199</a></span>
<span class="normal"><a href="#__codelineno-0-2200">2200</a></span>
<span class="normal"><a href="#__codelineno-0-2201">2201</a></span>
<span class="normal"><a href="#__codelineno-0-2202">2202</a></span>
<span class="normal"><a href="#__codelineno-0-2203">2203</a></span>
<span class="normal"><a href="#__codelineno-0-2204">2204</a></span>
<span class="normal"><a href="#__codelineno-0-2205">2205</a></span>
<span class="normal"><a href="#__codelineno-0-2206">2206</a></span>
<span class="normal"><a href="#__codelineno-0-2207">2207</a></span>
<span class="normal"><a href="#__codelineno-0-2208">2208</a></span>
<span class="normal"><a href="#__codelineno-0-2209">2209</a></span>
<span class="normal"><a href="#__codelineno-0-2210">2210</a></span>
<span class="normal"><a href="#__codelineno-0-2211">2211</a></span>
<span class="normal"><a href="#__codelineno-0-2212">2212</a></span>
<span class="normal"><a href="#__codelineno-0-2213">2213</a></span>
<span class="normal"><a href="#__codelineno-0-2214">2214</a></span>
<span class="normal"><a href="#__codelineno-0-2215">2215</a></span>
<span class="normal"><a href="#__codelineno-0-2216">2216</a></span>
<span class="normal"><a href="#__codelineno-0-2217">2217</a></span>
<span class="normal"><a href="#__codelineno-0-2218">2218</a></span>
<span class="normal"><a href="#__codelineno-0-2219">2219</a></span>
<span class="normal"><a href="#__codelineno-0-2220">2220</a></span>
<span class="normal"><a href="#__codelineno-0-2221">2221</a></span>
<span class="normal"><a href="#__codelineno-0-2222">2222</a></span>
<span class="normal"><a href="#__codelineno-0-2223">2223</a></span>
<span class="normal"><a href="#__codelineno-0-2224">2224</a></span>
<span class="normal"><a href="#__codelineno-0-2225">2225</a></span>
<span class="normal"><a href="#__codelineno-0-2226">2226</a></span>
<span class="normal"><a href="#__codelineno-0-2227">2227</a></span>
<span class="normal"><a href="#__codelineno-0-2228">2228</a></span>
<span class="normal"><a href="#__codelineno-0-2229">2229</a></span>
<span class="normal"><a href="#__codelineno-0-2230">2230</a></span>
<span class="normal"><a href="#__codelineno-0-2231">2231</a></span>
<span class="normal"><a href="#__codelineno-0-2232">2232</a></span>
<span class="normal"><a href="#__codelineno-0-2233">2233</a></span>
<span class="normal"><a href="#__codelineno-0-2234">2234</a></span>
<span class="normal"><a href="#__codelineno-0-2235">2235</a></span>
<span class="normal"><a href="#__codelineno-0-2236">2236</a></span>
<span class="normal"><a href="#__codelineno-0-2237">2237</a></span>
<span class="normal"><a href="#__codelineno-0-2238">2238</a></span>
<span class="normal"><a href="#__codelineno-0-2239">2239</a></span>
<span class="normal"><a href="#__codelineno-0-2240">2240</a></span>
<span class="normal"><a href="#__codelineno-0-2241">2241</a></span>
<span class="normal"><a href="#__codelineno-0-2242">2242</a></span>
<span class="normal"><a href="#__codelineno-0-2243">2243</a></span>
<span class="normal"><a href="#__codelineno-0-2244">2244</a></span>
<span class="normal"><a href="#__codelineno-0-2245">2245</a></span>
<span class="normal"><a href="#__codelineno-0-2246">2246</a></span>
<span class="normal"><a href="#__codelineno-0-2247">2247</a></span>
<span class="normal"><a href="#__codelineno-0-2248">2248</a></span>
<span class="normal"><a href="#__codelineno-0-2249">2249</a></span>
<span class="normal"><a href="#__codelineno-0-2250">2250</a></span>
<span class="normal"><a href="#__codelineno-0-2251">2251</a></span>
<span class="normal"><a href="#__codelineno-0-2252">2252</a></span>
<span class="normal"><a href="#__codelineno-0-2253">2253</a></span>
<span class="normal"><a href="#__codelineno-0-2254">2254</a></span>
<span class="normal"><a href="#__codelineno-0-2255">2255</a></span>
<span class="normal"><a href="#__codelineno-0-2256">2256</a></span>
<span class="normal"><a href="#__codelineno-0-2257">2257</a></span>
<span class="normal"><a href="#__codelineno-0-2258">2258</a></span>
<span class="normal"><a href="#__codelineno-0-2259">2259</a></span>
<span class="normal"><a href="#__codelineno-0-2260">2260</a></span>
<span class="normal"><a href="#__codelineno-0-2261">2261</a></span>
<span class="normal"><a href="#__codelineno-0-2262">2262</a></span>
<span class="normal"><a href="#__codelineno-0-2263">2263</a></span>
<span class="normal"><a href="#__codelineno-0-2264">2264</a></span>
<span class="normal"><a href="#__codelineno-0-2265">2265</a></span>
<span class="normal"><a href="#__codelineno-0-2266">2266</a></span>
<span class="normal"><a href="#__codelineno-0-2267">2267</a></span>
<span class="normal"><a href="#__codelineno-0-2268">2268</a></span>
<span class="normal"><a href="#__codelineno-0-2269">2269</a></span>
<span class="normal"><a href="#__codelineno-0-2270">2270</a></span>
<span class="normal"><a href="#__codelineno-0-2271">2271</a></span>
<span class="normal"><a href="#__codelineno-0-2272">2272</a></span>
<span class="normal"><a href="#__codelineno-0-2273">2273</a></span>
<span class="normal"><a href="#__codelineno-0-2274">2274</a></span>
<span class="normal"><a href="#__codelineno-0-2275">2275</a></span>
<span class="normal"><a href="#__codelineno-0-2276">2276</a></span>
<span class="normal"><a href="#__codelineno-0-2277">2277</a></span>
<span class="normal"><a href="#__codelineno-0-2278">2278</a></span>
<span class="normal"><a href="#__codelineno-0-2279">2279</a></span>
<span class="normal"><a href="#__codelineno-0-2280">2280</a></span>
<span class="normal"><a href="#__codelineno-0-2281">2281</a></span>
<span class="normal"><a href="#__codelineno-0-2282">2282</a></span>
<span class="normal"><a href="#__codelineno-0-2283">2283</a></span>
<span class="normal"><a href="#__codelineno-0-2284">2284</a></span>
<span class="normal"><a href="#__codelineno-0-2285">2285</a></span>
<span class="normal"><a href="#__codelineno-0-2286">2286</a></span>
<span class="normal"><a href="#__codelineno-0-2287">2287</a></span>
<span class="normal"><a href="#__codelineno-0-2288">2288</a></span>
<span class="normal"><a href="#__codelineno-0-2289">2289</a></span>
<span class="normal"><a href="#__codelineno-0-2290">2290</a></span>
<span class="normal"><a href="#__codelineno-0-2291">2291</a></span>
<span class="normal"><a href="#__codelineno-0-2292">2292</a></span>
<span class="normal"><a href="#__codelineno-0-2293">2293</a></span>
<span class="normal"><a href="#__codelineno-0-2294">2294</a></span>
<span class="normal"><a href="#__codelineno-0-2295">2295</a></span>
<span class="normal"><a href="#__codelineno-0-2296">2296</a></span>
<span class="normal"><a href="#__codelineno-0-2297">2297</a></span>
<span class="normal"><a href="#__codelineno-0-2298">2298</a></span>
<span class="normal"><a href="#__codelineno-0-2299">2299</a></span>
<span class="normal"><a href="#__codelineno-0-2300">2300</a></span>
<span class="normal"><a href="#__codelineno-0-2301">2301</a></span>
<span class="normal"><a href="#__codelineno-0-2302">2302</a></span>
<span class="normal"><a href="#__codelineno-0-2303">2303</a></span>
<span class="normal"><a href="#__codelineno-0-2304">2304</a></span>
<span class="normal"><a href="#__codelineno-0-2305">2305</a></span>
<span class="normal"><a href="#__codelineno-0-2306">2306</a></span>
<span class="normal"><a href="#__codelineno-0-2307">2307</a></span>
<span class="normal"><a href="#__codelineno-0-2308">2308</a></span>
<span class="normal"><a href="#__codelineno-0-2309">2309</a></span>
<span class="normal"><a href="#__codelineno-0-2310">2310</a></span>
<span class="normal"><a href="#__codelineno-0-2311">2311</a></span>
<span class="normal"><a href="#__codelineno-0-2312">2312</a></span>
<span class="normal"><a href="#__codelineno-0-2313">2313</a></span>
<span class="normal"><a href="#__codelineno-0-2314">2314</a></span>
<span class="normal"><a href="#__codelineno-0-2315">2315</a></span>
<span class="normal"><a href="#__codelineno-0-2316">2316</a></span>
<span class="normal"><a href="#__codelineno-0-2317">2317</a></span>
<span class="normal"><a href="#__codelineno-0-2318">2318</a></span>
<span class="normal"><a href="#__codelineno-0-2319">2319</a></span>
<span class="normal"><a href="#__codelineno-0-2320">2320</a></span>
<span class="normal"><a href="#__codelineno-0-2321">2321</a></span>
<span class="normal"><a href="#__codelineno-0-2322">2322</a></span>
<span class="normal"><a href="#__codelineno-0-2323">2323</a></span>
<span class="normal"><a href="#__codelineno-0-2324">2324</a></span>
<span class="normal"><a href="#__codelineno-0-2325">2325</a></span>
<span class="normal"><a href="#__codelineno-0-2326">2326</a></span>
<span class="normal"><a href="#__codelineno-0-2327">2327</a></span>
<span class="normal"><a href="#__codelineno-0-2328">2328</a></span>
<span class="normal"><a href="#__codelineno-0-2329">2329</a></span>
<span class="normal"><a href="#__codelineno-0-2330">2330</a></span>
<span class="normal"><a href="#__codelineno-0-2331">2331</a></span>
<span class="normal"><a href="#__codelineno-0-2332">2332</a></span>
<span class="normal"><a href="#__codelineno-0-2333">2333</a></span>
<span class="normal"><a href="#__codelineno-0-2334">2334</a></span>
<span class="normal"><a href="#__codelineno-0-2335">2335</a></span>
<span class="normal"><a href="#__codelineno-0-2336">2336</a></span>
<span class="normal"><a href="#__codelineno-0-2337">2337</a></span>
<span class="normal"><a href="#__codelineno-0-2338">2338</a></span>
<span class="normal"><a href="#__codelineno-0-2339">2339</a></span>
<span class="normal"><a href="#__codelineno-0-2340">2340</a></span>
<span class="normal"><a href="#__codelineno-0-2341">2341</a></span>
<span class="normal"><a href="#__codelineno-0-2342">2342</a></span>
<span class="normal"><a href="#__codelineno-0-2343">2343</a></span>
<span class="normal"><a href="#__codelineno-0-2344">2344</a></span>
<span class="normal"><a href="#__codelineno-0-2345">2345</a></span>
<span class="normal"><a href="#__codelineno-0-2346">2346</a></span>
<span class="normal"><a href="#__codelineno-0-2347">2347</a></span>
<span class="normal"><a href="#__codelineno-0-2348">2348</a></span>
<span class="normal"><a href="#__codelineno-0-2349">2349</a></span>
<span class="normal"><a href="#__codelineno-0-2350">2350</a></span>
<span class="normal"><a href="#__codelineno-0-2351">2351</a></span>
<span class="normal"><a href="#__codelineno-0-2352">2352</a></span>
<span class="normal"><a href="#__codelineno-0-2353">2353</a></span>
<span class="normal"><a href="#__codelineno-0-2354">2354</a></span>
<span class="normal"><a href="#__codelineno-0-2355">2355</a></span>
<span class="normal"><a href="#__codelineno-0-2356">2356</a></span>
<span class="normal"><a href="#__codelineno-0-2357">2357</a></span>
<span class="normal"><a href="#__codelineno-0-2358">2358</a></span>
<span class="normal"><a href="#__codelineno-0-2359">2359</a></span>
<span class="normal"><a href="#__codelineno-0-2360">2360</a></span>
<span class="normal"><a href="#__codelineno-0-2361">2361</a></span>
<span class="normal"><a href="#__codelineno-0-2362">2362</a></span>
<span class="normal"><a href="#__codelineno-0-2363">2363</a></span>
<span class="normal"><a href="#__codelineno-0-2364">2364</a></span>
<span class="normal"><a href="#__codelineno-0-2365">2365</a></span>
<span class="normal"><a href="#__codelineno-0-2366">2366</a></span>
<span class="normal"><a href="#__codelineno-0-2367">2367</a></span>
<span class="normal"><a href="#__codelineno-0-2368">2368</a></span>
<span class="normal"><a href="#__codelineno-0-2369">2369</a></span>
<span class="normal"><a href="#__codelineno-0-2370">2370</a></span>
<span class="normal"><a href="#__codelineno-0-2371">2371</a></span>
<span class="normal"><a href="#__codelineno-0-2372">2372</a></span>
<span class="normal"><a href="#__codelineno-0-2373">2373</a></span>
<span class="normal"><a href="#__codelineno-0-2374">2374</a></span>
<span class="normal"><a href="#__codelineno-0-2375">2375</a></span>
<span class="normal"><a href="#__codelineno-0-2376">2376</a></span>
<span class="normal"><a href="#__codelineno-0-2377">2377</a></span>
<span class="normal"><a href="#__codelineno-0-2378">2378</a></span>
<span class="normal"><a href="#__codelineno-0-2379">2379</a></span>
<span class="normal"><a href="#__codelineno-0-2380">2380</a></span>
<span class="normal"><a href="#__codelineno-0-2381">2381</a></span>
<span class="normal"><a href="#__codelineno-0-2382">2382</a></span>
<span class="normal"><a href="#__codelineno-0-2383">2383</a></span>
<span class="normal"><a href="#__codelineno-0-2384">2384</a></span>
<span class="normal"><a href="#__codelineno-0-2385">2385</a></span>
<span class="normal"><a href="#__codelineno-0-2386">2386</a></span>
<span class="normal"><a href="#__codelineno-0-2387">2387</a></span>
<span class="normal"><a href="#__codelineno-0-2388">2388</a></span>
<span class="normal"><a href="#__codelineno-0-2389">2389</a></span>
<span class="normal"><a href="#__codelineno-0-2390">2390</a></span>
<span class="normal"><a href="#__codelineno-0-2391">2391</a></span>
<span class="normal"><a href="#__codelineno-0-2392">2392</a></span>
<span class="normal"><a href="#__codelineno-0-2393">2393</a></span>
<span class="normal"><a href="#__codelineno-0-2394">2394</a></span>
<span class="normal"><a href="#__codelineno-0-2395">2395</a></span>
<span class="normal"><a href="#__codelineno-0-2396">2396</a></span>
<span class="normal"><a href="#__codelineno-0-2397">2397</a></span>
<span class="normal"><a href="#__codelineno-0-2398">2398</a></span>
<span class="normal"><a href="#__codelineno-0-2399">2399</a></span>
<span class="normal"><a href="#__codelineno-0-2400">2400</a></span>
<span class="normal"><a href="#__codelineno-0-2401">2401</a></span>
<span class="normal"><a href="#__codelineno-0-2402">2402</a></span>
<span class="normal"><a href="#__codelineno-0-2403">2403</a></span>
<span class="normal"><a href="#__codelineno-0-2404">2404</a></span>
<span class="normal"><a href="#__codelineno-0-2405">2405</a></span>
<span class="normal"><a href="#__codelineno-0-2406">2406</a></span>
<span class="normal"><a href="#__codelineno-0-2407">2407</a></span>
<span class="normal"><a href="#__codelineno-0-2408">2408</a></span>
<span class="normal"><a href="#__codelineno-0-2409">2409</a></span>
<span class="normal"><a href="#__codelineno-0-2410">2410</a></span>
<span class="normal"><a href="#__codelineno-0-2411">2411</a></span>
<span class="normal"><a href="#__codelineno-0-2412">2412</a></span>
<span class="normal"><a href="#__codelineno-0-2413">2413</a></span>
<span class="normal"><a href="#__codelineno-0-2414">2414</a></span>
<span class="normal"><a href="#__codelineno-0-2415">2415</a></span>
<span class="normal"><a href="#__codelineno-0-2416">2416</a></span>
<span class="normal"><a href="#__codelineno-0-2417">2417</a></span>
<span class="normal"><a href="#__codelineno-0-2418">2418</a></span>
<span class="normal"><a href="#__codelineno-0-2419">2419</a></span>
<span class="normal"><a href="#__codelineno-0-2420">2420</a></span>
<span class="normal"><a href="#__codelineno-0-2421">2421</a></span>
<span class="normal"><a href="#__codelineno-0-2422">2422</a></span>
<span class="normal"><a href="#__codelineno-0-2423">2423</a></span>
<span class="normal"><a href="#__codelineno-0-2424">2424</a></span>
<span class="normal"><a href="#__codelineno-0-2425">2425</a></span>
<span class="normal"><a href="#__codelineno-0-2426">2426</a></span>
<span class="normal"><a href="#__codelineno-0-2427">2427</a></span>
<span class="normal"><a href="#__codelineno-0-2428">2428</a></span>
<span class="normal"><a href="#__codelineno-0-2429">2429</a></span>
<span class="normal"><a href="#__codelineno-0-2430">2430</a></span>
<span class="normal"><a href="#__codelineno-0-2431">2431</a></span>
<span class="normal"><a href="#__codelineno-0-2432">2432</a></span>
<span class="normal"><a href="#__codelineno-0-2433">2433</a></span>
<span class="normal"><a href="#__codelineno-0-2434">2434</a></span>
<span class="normal"><a href="#__codelineno-0-2435">2435</a></span>
<span class="normal"><a href="#__codelineno-0-2436">2436</a></span>
<span class="normal"><a href="#__codelineno-0-2437">2437</a></span>
<span class="normal"><a href="#__codelineno-0-2438">2438</a></span>
<span class="normal"><a href="#__codelineno-0-2439">2439</a></span>
<span class="normal"><a href="#__codelineno-0-2440">2440</a></span>
<span class="normal"><a href="#__codelineno-0-2441">2441</a></span>
<span class="normal"><a href="#__codelineno-0-2442">2442</a></span>
<span class="normal"><a href="#__codelineno-0-2443">2443</a></span>
<span class="normal"><a href="#__codelineno-0-2444">2444</a></span>
<span class="normal"><a href="#__codelineno-0-2445">2445</a></span>
<span class="normal"><a href="#__codelineno-0-2446">2446</a></span>
<span class="normal"><a href="#__codelineno-0-2447">2447</a></span>
<span class="normal"><a href="#__codelineno-0-2448">2448</a></span>
<span class="normal"><a href="#__codelineno-0-2449">2449</a></span>
<span class="normal"><a href="#__codelineno-0-2450">2450</a></span>
<span class="normal"><a href="#__codelineno-0-2451">2451</a></span>
<span class="normal"><a href="#__codelineno-0-2452">2452</a></span>
<span class="normal"><a href="#__codelineno-0-2453">2453</a></span>
<span class="normal"><a href="#__codelineno-0-2454">2454</a></span>
<span class="normal"><a href="#__codelineno-0-2455">2455</a></span>
<span class="normal"><a href="#__codelineno-0-2456">2456</a></span>
<span class="normal"><a href="#__codelineno-0-2457">2457</a></span>
<span class="normal"><a href="#__codelineno-0-2458">2458</a></span>
<span class="normal"><a href="#__codelineno-0-2459">2459</a></span>
<span class="normal"><a href="#__codelineno-0-2460">2460</a></span>
<span class="normal"><a href="#__codelineno-0-2461">2461</a></span>
<span class="normal"><a href="#__codelineno-0-2462">2462</a></span>
<span class="normal"><a href="#__codelineno-0-2463">2463</a></span>
<span class="normal"><a href="#__codelineno-0-2464">2464</a></span>
<span class="normal"><a href="#__codelineno-0-2465">2465</a></span>
<span class="normal"><a href="#__codelineno-0-2466">2466</a></span>
<span class="normal"><a href="#__codelineno-0-2467">2467</a></span>
<span class="normal"><a href="#__codelineno-0-2468">2468</a></span>
<span class="normal"><a href="#__codelineno-0-2469">2469</a></span>
<span class="normal"><a href="#__codelineno-0-2470">2470</a></span>
<span class="normal"><a href="#__codelineno-0-2471">2471</a></span>
<span class="normal"><a href="#__codelineno-0-2472">2472</a></span>
<span class="normal"><a href="#__codelineno-0-2473">2473</a></span>
<span class="normal"><a href="#__codelineno-0-2474">2474</a></span>
<span class="normal"><a href="#__codelineno-0-2475">2475</a></span>
<span class="normal"><a href="#__codelineno-0-2476">2476</a></span>
<span class="normal"><a href="#__codelineno-0-2477">2477</a></span>
<span class="normal"><a href="#__codelineno-0-2478">2478</a></span>
<span class="normal"><a href="#__codelineno-0-2479">2479</a></span>
<span class="normal"><a href="#__codelineno-0-2480">2480</a></span>
<span class="normal"><a href="#__codelineno-0-2481">2481</a></span>
<span class="normal"><a href="#__codelineno-0-2482">2482</a></span>
<span class="normal"><a href="#__codelineno-0-2483">2483</a></span>
<span class="normal"><a href="#__codelineno-0-2484">2484</a></span>
<span class="normal"><a href="#__codelineno-0-2485">2485</a></span>
<span class="normal"><a href="#__codelineno-0-2486">2486</a></span>
<span class="normal"><a href="#__codelineno-0-2487">2487</a></span>
<span class="normal"><a href="#__codelineno-0-2488">2488</a></span>
<span class="normal"><a href="#__codelineno-0-2489">2489</a></span>
<span class="normal"><a href="#__codelineno-0-2490">2490</a></span>
<span class="normal"><a href="#__codelineno-0-2491">2491</a></span>
<span class="normal"><a href="#__codelineno-0-2492">2492</a></span>
<span class="normal"><a href="#__codelineno-0-2493">2493</a></span>
<span class="normal"><a href="#__codelineno-0-2494">2494</a></span>
<span class="normal"><a href="#__codelineno-0-2495">2495</a></span>
<span class="normal"><a href="#__codelineno-0-2496">2496</a></span>
<span class="normal"><a href="#__codelineno-0-2497">2497</a></span>
<span class="normal"><a href="#__codelineno-0-2498">2498</a></span>
<span class="normal"><a href="#__codelineno-0-2499">2499</a></span>
<span class="normal"><a href="#__codelineno-0-2500">2500</a></span>
<span class="normal"><a href="#__codelineno-0-2501">2501</a></span>
<span class="normal"><a href="#__codelineno-0-2502">2502</a></span>
<span class="normal"><a href="#__codelineno-0-2503">2503</a></span>
<span class="normal"><a href="#__codelineno-0-2504">2504</a></span>
<span class="normal"><a href="#__codelineno-0-2505">2505</a></span>
<span class="normal"><a href="#__codelineno-0-2506">2506</a></span>
<span class="normal"><a href="#__codelineno-0-2507">2507</a></span>
<span class="normal"><a href="#__codelineno-0-2508">2508</a></span>
<span class="normal"><a href="#__codelineno-0-2509">2509</a></span>
<span class="normal"><a href="#__codelineno-0-2510">2510</a></span>
<span class="normal"><a href="#__codelineno-0-2511">2511</a></span>
<span class="normal"><a href="#__codelineno-0-2512">2512</a></span>
<span class="normal"><a href="#__codelineno-0-2513">2513</a></span>
<span class="normal"><a href="#__codelineno-0-2514">2514</a></span>
<span class="normal"><a href="#__codelineno-0-2515">2515</a></span>
<span class="normal"><a href="#__codelineno-0-2516">2516</a></span>
<span class="normal"><a href="#__codelineno-0-2517">2517</a></span>
<span class="normal"><a href="#__codelineno-0-2518">2518</a></span>
<span class="normal"><a href="#__codelineno-0-2519">2519</a></span>
<span class="normal"><a href="#__codelineno-0-2520">2520</a></span>
<span class="normal"><a href="#__codelineno-0-2521">2521</a></span>
<span class="normal"><a href="#__codelineno-0-2522">2522</a></span>
<span class="normal"><a href="#__codelineno-0-2523">2523</a></span>
<span class="normal"><a href="#__codelineno-0-2524">2524</a></span>
<span class="normal"><a href="#__codelineno-0-2525">2525</a></span>
<span class="normal"><a href="#__codelineno-0-2526">2526</a></span>
<span class="normal"><a href="#__codelineno-0-2527">2527</a></span>
<span class="normal"><a href="#__codelineno-0-2528">2528</a></span>
<span class="normal"><a href="#__codelineno-0-2529">2529</a></span>
<span class="normal"><a href="#__codelineno-0-2530">2530</a></span>
<span class="normal"><a href="#__codelineno-0-2531">2531</a></span>
<span class="normal"><a href="#__codelineno-0-2532">2532</a></span>
<span class="normal"><a href="#__codelineno-0-2533">2533</a></span>
<span class="normal"><a href="#__codelineno-0-2534">2534</a></span>
<span class="normal"><a href="#__codelineno-0-2535">2535</a></span>
<span class="normal"><a href="#__codelineno-0-2536">2536</a></span>
<span class="normal"><a href="#__codelineno-0-2537">2537</a></span>
<span class="normal"><a href="#__codelineno-0-2538">2538</a></span>
<span class="normal"><a href="#__codelineno-0-2539">2539</a></span>
<span class="normal"><a href="#__codelineno-0-2540">2540</a></span>
<span class="normal"><a href="#__codelineno-0-2541">2541</a></span>
<span class="normal"><a href="#__codelineno-0-2542">2542</a></span>
<span class="normal"><a href="#__codelineno-0-2543">2543</a></span>
<span class="normal"><a href="#__codelineno-0-2544">2544</a></span>
<span class="normal"><a href="#__codelineno-0-2545">2545</a></span>
<span class="normal"><a href="#__codelineno-0-2546">2546</a></span>
<span class="normal"><a href="#__codelineno-0-2547">2547</a></span>
<span class="normal"><a href="#__codelineno-0-2548">2548</a></span>
<span class="normal"><a href="#__codelineno-0-2549">2549</a></span>
<span class="normal"><a href="#__codelineno-0-2550">2550</a></span>
<span class="normal"><a href="#__codelineno-0-2551">2551</a></span>
<span class="normal"><a href="#__codelineno-0-2552">2552</a></span>
<span class="normal"><a href="#__codelineno-0-2553">2553</a></span>
<span class="normal"><a href="#__codelineno-0-2554">2554</a></span>
<span class="normal"><a href="#__codelineno-0-2555">2555</a></span>
<span class="normal"><a href="#__codelineno-0-2556">2556</a></span>
<span class="normal"><a href="#__codelineno-0-2557">2557</a></span>
<span class="normal"><a href="#__codelineno-0-2558">2558</a></span>
<span class="normal"><a href="#__codelineno-0-2559">2559</a></span>
<span class="normal"><a href="#__codelineno-0-2560">2560</a></span>
<span class="normal"><a href="#__codelineno-0-2561">2561</a></span>
<span class="normal"><a href="#__codelineno-0-2562">2562</a></span>
<span class="normal"><a href="#__codelineno-0-2563">2563</a></span>
<span class="normal"><a href="#__codelineno-0-2564">2564</a></span>
<span class="normal"><a href="#__codelineno-0-2565">2565</a></span>
<span class="normal"><a href="#__codelineno-0-2566">2566</a></span>
<span class="normal"><a href="#__codelineno-0-2567">2567</a></span>
<span class="normal"><a href="#__codelineno-0-2568">2568</a></span>
<span class="normal"><a href="#__codelineno-0-2569">2569</a></span>
<span class="normal"><a href="#__codelineno-0-2570">2570</a></span>
<span class="normal"><a href="#__codelineno-0-2571">2571</a></span>
<span class="normal"><a href="#__codelineno-0-2572">2572</a></span>
<span class="normal"><a href="#__codelineno-0-2573">2573</a></span>
<span class="normal"><a href="#__codelineno-0-2574">2574</a></span>
<span class="normal"><a href="#__codelineno-0-2575">2575</a></span>
<span class="normal"><a href="#__codelineno-0-2576">2576</a></span>
<span class="normal"><a href="#__codelineno-0-2577">2577</a></span>
<span class="normal"><a href="#__codelineno-0-2578">2578</a></span>
<span class="normal"><a href="#__codelineno-0-2579">2579</a></span>
<span class="normal"><a href="#__codelineno-0-2580">2580</a></span>
<span class="normal"><a href="#__codelineno-0-2581">2581</a></span>
<span class="normal"><a href="#__codelineno-0-2582">2582</a></span>
<span class="normal"><a href="#__codelineno-0-2583">2583</a></span>
<span class="normal"><a href="#__codelineno-0-2584">2584</a></span>
<span class="normal"><a href="#__codelineno-0-2585">2585</a></span>
<span class="normal"><a href="#__codelineno-0-2586">2586</a></span>
<span class="normal"><a href="#__codelineno-0-2587">2587</a></span>
<span class="normal"><a href="#__codelineno-0-2588">2588</a></span>
<span class="normal"><a href="#__codelineno-0-2589">2589</a></span>
<span class="normal"><a href="#__codelineno-0-2590">2590</a></span>
<span class="normal"><a href="#__codelineno-0-2591">2591</a></span>
<span class="normal"><a href="#__codelineno-0-2592">2592</a></span>
<span class="normal"><a href="#__codelineno-0-2593">2593</a></span>
<span class="normal"><a href="#__codelineno-0-2594">2594</a></span>
<span class="normal"><a href="#__codelineno-0-2595">2595</a></span>
<span class="normal"><a href="#__codelineno-0-2596">2596</a></span>
<span class="normal"><a href="#__codelineno-0-2597">2597</a></span>
<span class="normal"><a href="#__codelineno-0-2598">2598</a></span>
<span class="normal"><a href="#__codelineno-0-2599">2599</a></span>
<span class="normal"><a href="#__codelineno-0-2600">2600</a></span>
<span class="normal"><a href="#__codelineno-0-2601">2601</a></span>
<span class="normal"><a href="#__codelineno-0-2602">2602</a></span>
<span class="normal"><a href="#__codelineno-0-2603">2603</a></span>
<span class="normal"><a href="#__codelineno-0-2604">2604</a></span>
<span class="normal"><a href="#__codelineno-0-2605">2605</a></span>
<span class="normal"><a href="#__codelineno-0-2606">2606</a></span>
<span class="normal"><a href="#__codelineno-0-2607">2607</a></span>
<span class="normal"><a href="#__codelineno-0-2608">2608</a></span>
<span class="normal"><a href="#__codelineno-0-2609">2609</a></span>
<span class="normal"><a href="#__codelineno-0-2610">2610</a></span>
<span class="normal"><a href="#__codelineno-0-2611">2611</a></span>
<span class="normal"><a href="#__codelineno-0-2612">2612</a></span>
<span class="normal"><a href="#__codelineno-0-2613">2613</a></span>
<span class="normal"><a href="#__codelineno-0-2614">2614</a></span>
<span class="normal"><a href="#__codelineno-0-2615">2615</a></span>
<span class="normal"><a href="#__codelineno-0-2616">2616</a></span>
<span class="normal"><a href="#__codelineno-0-2617">2617</a></span>
<span class="normal"><a href="#__codelineno-0-2618">2618</a></span>
<span class="normal"><a href="#__codelineno-0-2619">2619</a></span>
<span class="normal"><a href="#__codelineno-0-2620">2620</a></span>
<span class="normal"><a href="#__codelineno-0-2621">2621</a></span>
<span class="normal"><a href="#__codelineno-0-2622">2622</a></span>
<span class="normal"><a href="#__codelineno-0-2623">2623</a></span>
<span class="normal"><a href="#__codelineno-0-2624">2624</a></span>
<span class="normal"><a href="#__codelineno-0-2625">2625</a></span>
<span class="normal"><a href="#__codelineno-0-2626">2626</a></span>
<span class="normal"><a href="#__codelineno-0-2627">2627</a></span>
<span class="normal"><a href="#__codelineno-0-2628">2628</a></span>
<span class="normal"><a href="#__codelineno-0-2629">2629</a></span>
<span class="normal"><a href="#__codelineno-0-2630">2630</a></span>
<span class="normal"><a href="#__codelineno-0-2631">2631</a></span>
<span class="normal"><a href="#__codelineno-0-2632">2632</a></span>
<span class="normal"><a href="#__codelineno-0-2633">2633</a></span>
<span class="normal"><a href="#__codelineno-0-2634">2634</a></span>
<span class="normal"><a href="#__codelineno-0-2635">2635</a></span>
<span class="normal"><a href="#__codelineno-0-2636">2636</a></span>
<span class="normal"><a href="#__codelineno-0-2637">2637</a></span>
<span class="normal"><a href="#__codelineno-0-2638">2638</a></span>
<span class="normal"><a href="#__codelineno-0-2639">2639</a></span>
<span class="normal"><a href="#__codelineno-0-2640">2640</a></span>
<span class="normal"><a href="#__codelineno-0-2641">2641</a></span>
<span class="normal"><a href="#__codelineno-0-2642">2642</a></span>
<span class="normal"><a href="#__codelineno-0-2643">2643</a></span>
<span class="normal"><a href="#__codelineno-0-2644">2644</a></span>
<span class="normal"><a href="#__codelineno-0-2645">2645</a></span>
<span class="normal"><a href="#__codelineno-0-2646">2646</a></span>
<span class="normal"><a href="#__codelineno-0-2647">2647</a></span>
<span class="normal"><a href="#__codelineno-0-2648">2648</a></span>
<span class="normal"><a href="#__codelineno-0-2649">2649</a></span>
<span class="normal"><a href="#__codelineno-0-2650">2650</a></span>
<span class="normal"><a href="#__codelineno-0-2651">2651</a></span>
<span class="normal"><a href="#__codelineno-0-2652">2652</a></span>
<span class="normal"><a href="#__codelineno-0-2653">2653</a></span>
<span class="normal"><a href="#__codelineno-0-2654">2654</a></span>
<span class="normal"><a href="#__codelineno-0-2655">2655</a></span>
<span class="normal"><a href="#__codelineno-0-2656">2656</a></span>
<span class="normal"><a href="#__codelineno-0-2657">2657</a></span>
<span class="normal"><a href="#__codelineno-0-2658">2658</a></span>
<span class="normal"><a href="#__codelineno-0-2659">2659</a></span>
<span class="normal"><a href="#__codelineno-0-2660">2660</a></span>
<span class="normal"><a href="#__codelineno-0-2661">2661</a></span>
<span class="normal"><a href="#__codelineno-0-2662">2662</a></span>
<span class="normal"><a href="#__codelineno-0-2663">2663</a></span>
<span class="normal"><a href="#__codelineno-0-2664">2664</a></span>
<span class="normal"><a href="#__codelineno-0-2665">2665</a></span>
<span class="normal"><a href="#__codelineno-0-2666">2666</a></span>
<span class="normal"><a href="#__codelineno-0-2667">2667</a></span>
<span class="normal"><a href="#__codelineno-0-2668">2668</a></span>
<span class="normal"><a href="#__codelineno-0-2669">2669</a></span>
<span class="normal"><a href="#__codelineno-0-2670">2670</a></span>
<span class="normal"><a href="#__codelineno-0-2671">2671</a></span>
<span class="normal"><a href="#__codelineno-0-2672">2672</a></span>
<span class="normal"><a href="#__codelineno-0-2673">2673</a></span>
<span class="normal"><a href="#__codelineno-0-2674">2674</a></span>
<span class="normal"><a href="#__codelineno-0-2675">2675</a></span>
<span class="normal"><a href="#__codelineno-0-2676">2676</a></span>
<span class="normal"><a href="#__codelineno-0-2677">2677</a></span>
<span class="normal"><a href="#__codelineno-0-2678">2678</a></span>
<span class="normal"><a href="#__codelineno-0-2679">2679</a></span>
<span class="normal"><a href="#__codelineno-0-2680">2680</a></span>
<span class="normal"><a href="#__codelineno-0-2681">2681</a></span>
<span class="normal"><a href="#__codelineno-0-2682">2682</a></span>
<span class="normal"><a href="#__codelineno-0-2683">2683</a></span>
<span class="normal"><a href="#__codelineno-0-2684">2684</a></span>
<span class="normal"><a href="#__codelineno-0-2685">2685</a></span>
<span class="normal"><a href="#__codelineno-0-2686">2686</a></span>
<span class="normal"><a href="#__codelineno-0-2687">2687</a></span>
<span class="normal"><a href="#__codelineno-0-2688">2688</a></span>
<span class="normal"><a href="#__codelineno-0-2689">2689</a></span>
<span class="normal"><a href="#__codelineno-0-2690">2690</a></span>
<span class="normal"><a href="#__codelineno-0-2691">2691</a></span>
<span class="normal"><a href="#__codelineno-0-2692">2692</a></span>
<span class="normal"><a href="#__codelineno-0-2693">2693</a></span>
<span class="normal"><a href="#__codelineno-0-2694">2694</a></span>
<span class="normal"><a href="#__codelineno-0-2695">2695</a></span>
<span class="normal"><a href="#__codelineno-0-2696">2696</a></span>
<span class="normal"><a href="#__codelineno-0-2697">2697</a></span>
<span class="normal"><a href="#__codelineno-0-2698">2698</a></span>
<span class="normal"><a href="#__codelineno-0-2699">2699</a></span>
<span class="normal"><a href="#__codelineno-0-2700">2700</a></span>
<span class="normal"><a href="#__codelineno-0-2701">2701</a></span>
<span class="normal"><a href="#__codelineno-0-2702">2702</a></span>
<span class="normal"><a href="#__codelineno-0-2703">2703</a></span>
<span class="normal"><a href="#__codelineno-0-2704">2704</a></span>
<span class="normal"><a href="#__codelineno-0-2705">2705</a></span>
<span class="normal"><a href="#__codelineno-0-2706">2706</a></span>
<span class="normal"><a href="#__codelineno-0-2707">2707</a></span>
<span class="normal"><a href="#__codelineno-0-2708">2708</a></span>
<span class="normal"><a href="#__codelineno-0-2709">2709</a></span>
<span class="normal"><a href="#__codelineno-0-2710">2710</a></span>
<span class="normal"><a href="#__codelineno-0-2711">2711</a></span>
<span class="normal"><a href="#__codelineno-0-2712">2712</a></span>
<span class="normal"><a href="#__codelineno-0-2713">2713</a></span>
<span class="normal"><a href="#__codelineno-0-2714">2714</a></span>
<span class="normal"><a href="#__codelineno-0-2715">2715</a></span>
<span class="normal"><a href="#__codelineno-0-2716">2716</a></span>
<span class="normal"><a href="#__codelineno-0-2717">2717</a></span>
<span class="normal"><a href="#__codelineno-0-2718">2718</a></span>
<span class="normal"><a href="#__codelineno-0-2719">2719</a></span>
<span class="normal"><a href="#__codelineno-0-2720">2720</a></span>
<span class="normal"><a href="#__codelineno-0-2721">2721</a></span>
<span class="normal"><a href="#__codelineno-0-2722">2722</a></span>
<span class="normal"><a href="#__codelineno-0-2723">2723</a></span>
<span class="normal"><a href="#__codelineno-0-2724">2724</a></span>
<span class="normal"><a href="#__codelineno-0-2725">2725</a></span>
<span class="normal"><a href="#__codelineno-0-2726">2726</a></span>
<span class="normal"><a href="#__codelineno-0-2727">2727</a></span>
<span class="normal"><a href="#__codelineno-0-2728">2728</a></span>
<span class="normal"><a href="#__codelineno-0-2729">2729</a></span>
<span class="normal"><a href="#__codelineno-0-2730">2730</a></span>
<span class="normal"><a href="#__codelineno-0-2731">2731</a></span>
<span class="normal"><a href="#__codelineno-0-2732">2732</a></span>
<span class="normal"><a href="#__codelineno-0-2733">2733</a></span>
<span class="normal"><a href="#__codelineno-0-2734">2734</a></span>
<span class="normal"><a href="#__codelineno-0-2735">2735</a></span>
<span class="normal"><a href="#__codelineno-0-2736">2736</a></span>
<span class="normal"><a href="#__codelineno-0-2737">2737</a></span>
<span class="normal"><a href="#__codelineno-0-2738">2738</a></span>
<span class="normal"><a href="#__codelineno-0-2739">2739</a></span>
<span class="normal"><a href="#__codelineno-0-2740">2740</a></span>
<span class="normal"><a href="#__codelineno-0-2741">2741</a></span>
<span class="normal"><a href="#__codelineno-0-2742">2742</a></span>
<span class="normal"><a href="#__codelineno-0-2743">2743</a></span>
<span class="normal"><a href="#__codelineno-0-2744">2744</a></span>
<span class="normal"><a href="#__codelineno-0-2745">2745</a></span>
<span class="normal"><a href="#__codelineno-0-2746">2746</a></span>
<span class="normal"><a href="#__codelineno-0-2747">2747</a></span>
<span class="normal"><a href="#__codelineno-0-2748">2748</a></span>
<span class="normal"><a href="#__codelineno-0-2749">2749</a></span>
<span class="normal"><a href="#__codelineno-0-2750">2750</a></span>
<span class="normal"><a href="#__codelineno-0-2751">2751</a></span>
<span class="normal"><a href="#__codelineno-0-2752">2752</a></span>
<span class="normal"><a href="#__codelineno-0-2753">2753</a></span>
<span class="normal"><a href="#__codelineno-0-2754">2754</a></span>
<span class="normal"><a href="#__codelineno-0-2755">2755</a></span>
<span class="normal"><a href="#__codelineno-0-2756">2756</a></span>
<span class="normal"><a href="#__codelineno-0-2757">2757</a></span>
<span class="normal"><a href="#__codelineno-0-2758">2758</a></span>
<span class="normal"><a href="#__codelineno-0-2759">2759</a></span>
<span class="normal"><a href="#__codelineno-0-2760">2760</a></span>
<span class="normal"><a href="#__codelineno-0-2761">2761</a></span>
<span class="normal"><a href="#__codelineno-0-2762">2762</a></span>
<span class="normal"><a href="#__codelineno-0-2763">2763</a></span>
<span class="normal"><a href="#__codelineno-0-2764">2764</a></span>
<span class="normal"><a href="#__codelineno-0-2765">2765</a></span>
<span class="normal"><a href="#__codelineno-0-2766">2766</a></span>
<span class="normal"><a href="#__codelineno-0-2767">2767</a></span>
<span class="normal"><a href="#__codelineno-0-2768">2768</a></span>
<span class="normal"><a href="#__codelineno-0-2769">2769</a></span>
<span class="normal"><a href="#__codelineno-0-2770">2770</a></span>
<span class="normal"><a href="#__codelineno-0-2771">2771</a></span>
<span class="normal"><a href="#__codelineno-0-2772">2772</a></span>
<span class="normal"><a href="#__codelineno-0-2773">2773</a></span>
<span class="normal"><a href="#__codelineno-0-2774">2774</a></span>
<span class="normal"><a href="#__codelineno-0-2775">2775</a></span>
<span class="normal"><a href="#__codelineno-0-2776">2776</a></span>
<span class="normal"><a href="#__codelineno-0-2777">2777</a></span>
<span class="normal"><a href="#__codelineno-0-2778">2778</a></span>
<span class="normal"><a href="#__codelineno-0-2779">2779</a></span>
<span class="normal"><a href="#__codelineno-0-2780">2780</a></span>
<span class="normal"><a href="#__codelineno-0-2781">2781</a></span>
<span class="normal"><a href="#__codelineno-0-2782">2782</a></span>
<span class="normal"><a href="#__codelineno-0-2783">2783</a></span>
<span class="normal"><a href="#__codelineno-0-2784">2784</a></span>
<span class="normal"><a href="#__codelineno-0-2785">2785</a></span>
<span class="normal"><a href="#__codelineno-0-2786">2786</a></span>
<span class="normal"><a href="#__codelineno-0-2787">2787</a></span>
<span class="normal"><a href="#__codelineno-0-2788">2788</a></span>
<span class="normal"><a href="#__codelineno-0-2789">2789</a></span>
<span class="normal"><a href="#__codelineno-0-2790">2790</a></span>
<span class="normal"><a href="#__codelineno-0-2791">2791</a></span>
<span class="normal"><a href="#__codelineno-0-2792">2792</a></span>
<span class="normal"><a href="#__codelineno-0-2793">2793</a></span>
<span class="normal"><a href="#__codelineno-0-2794">2794</a></span>
<span class="normal"><a href="#__codelineno-0-2795">2795</a></span>
<span class="normal"><a href="#__codelineno-0-2796">2796</a></span>
<span class="normal"><a href="#__codelineno-0-2797">2797</a></span>
<span class="normal"><a href="#__codelineno-0-2798">2798</a></span>
<span class="normal"><a href="#__codelineno-0-2799">2799</a></span>
<span class="normal"><a href="#__codelineno-0-2800">2800</a></span>
<span class="normal"><a href="#__codelineno-0-2801">2801</a></span>
<span class="normal"><a href="#__codelineno-0-2802">2802</a></span>
<span class="normal"><a href="#__codelineno-0-2803">2803</a></span>
<span class="normal"><a href="#__codelineno-0-2804">2804</a></span>
<span class="normal"><a href="#__codelineno-0-2805">2805</a></span>
<span class="normal"><a href="#__codelineno-0-2806">2806</a></span>
<span class="normal"><a href="#__codelineno-0-2807">2807</a></span>
<span class="normal"><a href="#__codelineno-0-2808">2808</a></span>
<span class="normal"><a href="#__codelineno-0-2809">2809</a></span>
<span class="normal"><a href="#__codelineno-0-2810">2810</a></span>
<span class="normal"><a href="#__codelineno-0-2811">2811</a></span>
<span class="normal"><a href="#__codelineno-0-2812">2812</a></span>
<span class="normal"><a href="#__codelineno-0-2813">2813</a></span>
<span class="normal"><a href="#__codelineno-0-2814">2814</a></span>
<span class="normal"><a href="#__codelineno-0-2815">2815</a></span>
<span class="normal"><a href="#__codelineno-0-2816">2816</a></span>
<span class="normal"><a href="#__codelineno-0-2817">2817</a></span>
<span class="normal"><a href="#__codelineno-0-2818">2818</a></span>
<span class="normal"><a href="#__codelineno-0-2819">2819</a></span>
<span class="normal"><a href="#__codelineno-0-2820">2820</a></span>
<span class="normal"><a href="#__codelineno-0-2821">2821</a></span>
<span class="normal"><a href="#__codelineno-0-2822">2822</a></span>
<span class="normal"><a href="#__codelineno-0-2823">2823</a></span>
<span class="normal"><a href="#__codelineno-0-2824">2824</a></span>
<span class="normal"><a href="#__codelineno-0-2825">2825</a></span>
<span class="normal"><a href="#__codelineno-0-2826">2826</a></span>
<span class="normal"><a href="#__codelineno-0-2827">2827</a></span>
<span class="normal"><a href="#__codelineno-0-2828">2828</a></span>
<span class="normal"><a href="#__codelineno-0-2829">2829</a></span>
<span class="normal"><a href="#__codelineno-0-2830">2830</a></span>
<span class="normal"><a href="#__codelineno-0-2831">2831</a></span>
<span class="normal"><a href="#__codelineno-0-2832">2832</a></span>
<span class="normal"><a href="#__codelineno-0-2833">2833</a></span>
<span class="normal"><a href="#__codelineno-0-2834">2834</a></span>
<span class="normal"><a href="#__codelineno-0-2835">2835</a></span>
<span class="normal"><a href="#__codelineno-0-2836">2836</a></span>
<span class="normal"><a href="#__codelineno-0-2837">2837</a></span>
<span class="normal"><a href="#__codelineno-0-2838">2838</a></span>
<span class="normal"><a href="#__codelineno-0-2839">2839</a></span>
<span class="normal"><a href="#__codelineno-0-2840">2840</a></span>
<span class="normal"><a href="#__codelineno-0-2841">2841</a></span>
<span class="normal"><a href="#__codelineno-0-2842">2842</a></span>
<span class="normal"><a href="#__codelineno-0-2843">2843</a></span>
<span class="normal"><a href="#__codelineno-0-2844">2844</a></span>
<span class="normal"><a href="#__codelineno-0-2845">2845</a></span>
<span class="normal"><a href="#__codelineno-0-2846">2846</a></span>
<span class="normal"><a href="#__codelineno-0-2847">2847</a></span>
<span class="normal"><a href="#__codelineno-0-2848">2848</a></span>
<span class="normal"><a href="#__codelineno-0-2849">2849</a></span>
<span class="normal"><a href="#__codelineno-0-2850">2850</a></span>
<span class="normal"><a href="#__codelineno-0-2851">2851</a></span>
<span class="normal"><a href="#__codelineno-0-2852">2852</a></span>
<span class="normal"><a href="#__codelineno-0-2853">2853</a></span>
<span class="normal"><a href="#__codelineno-0-2854">2854</a></span>
<span class="normal"><a href="#__codelineno-0-2855">2855</a></span>
<span class="normal"><a href="#__codelineno-0-2856">2856</a></span>
<span class="normal"><a href="#__codelineno-0-2857">2857</a></span>
<span class="normal"><a href="#__codelineno-0-2858">2858</a></span>
<span class="normal"><a href="#__codelineno-0-2859">2859</a></span>
<span class="normal"><a href="#__codelineno-0-2860">2860</a></span>
<span class="normal"><a href="#__codelineno-0-2861">2861</a></span>
<span class="normal"><a href="#__codelineno-0-2862">2862</a></span>
<span class="normal"><a href="#__codelineno-0-2863">2863</a></span>
<span class="normal"><a href="#__codelineno-0-2864">2864</a></span>
<span class="normal"><a href="#__codelineno-0-2865">2865</a></span>
<span class="normal"><a href="#__codelineno-0-2866">2866</a></span>
<span class="normal"><a href="#__codelineno-0-2867">2867</a></span>
<span class="normal"><a href="#__codelineno-0-2868">2868</a></span>
<span class="normal"><a href="#__codelineno-0-2869">2869</a></span>
<span class="normal"><a href="#__codelineno-0-2870">2870</a></span>
<span class="normal"><a href="#__codelineno-0-2871">2871</a></span>
<span class="normal"><a href="#__codelineno-0-2872">2872</a></span>
<span class="normal"><a href="#__codelineno-0-2873">2873</a></span>
<span class="normal"><a href="#__codelineno-0-2874">2874</a></span>
<span class="normal"><a href="#__codelineno-0-2875">2875</a></span>
<span class="normal"><a href="#__codelineno-0-2876">2876</a></span>
<span class="normal"><a href="#__codelineno-0-2877">2877</a></span>
<span class="normal"><a href="#__codelineno-0-2878">2878</a></span>
<span class="normal"><a href="#__codelineno-0-2879">2879</a></span>
<span class="normal"><a href="#__codelineno-0-2880">2880</a></span>
<span class="normal"><a href="#__codelineno-0-2881">2881</a></span>
<span class="normal"><a href="#__codelineno-0-2882">2882</a></span>
<span class="normal"><a href="#__codelineno-0-2883">2883</a></span>
<span class="normal"><a href="#__codelineno-0-2884">2884</a></span>
<span class="normal"><a href="#__codelineno-0-2885">2885</a></span>
<span class="normal"><a href="#__codelineno-0-2886">2886</a></span>
<span class="normal"><a href="#__codelineno-0-2887">2887</a></span>
<span class="normal"><a href="#__codelineno-0-2888">2888</a></span>
<span class="normal"><a href="#__codelineno-0-2889">2889</a></span>
<span class="normal"><a href="#__codelineno-0-2890">2890</a></span>
<span class="normal"><a href="#__codelineno-0-2891">2891</a></span>
<span class="normal"><a href="#__codelineno-0-2892">2892</a></span>
<span class="normal"><a href="#__codelineno-0-2893">2893</a></span>
<span class="normal"><a href="#__codelineno-0-2894">2894</a></span>
<span class="normal"><a href="#__codelineno-0-2895">2895</a></span>
<span class="normal"><a href="#__codelineno-0-2896">2896</a></span>
<span class="normal"><a href="#__codelineno-0-2897">2897</a></span>
<span class="normal"><a href="#__codelineno-0-2898">2898</a></span>
<span class="normal"><a href="#__codelineno-0-2899">2899</a></span>
<span class="normal"><a href="#__codelineno-0-2900">2900</a></span>
<span class="normal"><a href="#__codelineno-0-2901">2901</a></span>
<span class="normal"><a href="#__codelineno-0-2902">2902</a></span>
<span class="normal"><a href="#__codelineno-0-2903">2903</a></span>
<span class="normal"><a href="#__codelineno-0-2904">2904</a></span>
<span class="normal"><a href="#__codelineno-0-2905">2905</a></span>
<span class="normal"><a href="#__codelineno-0-2906">2906</a></span>
<span class="normal"><a href="#__codelineno-0-2907">2907</a></span>
<span class="normal"><a href="#__codelineno-0-2908">2908</a></span>
<span class="normal"><a href="#__codelineno-0-2909">2909</a></span>
<span class="normal"><a href="#__codelineno-0-2910">2910</a></span>
<span class="normal"><a href="#__codelineno-0-2911">2911</a></span>
<span class="normal"><a href="#__codelineno-0-2912">2912</a></span>
<span class="normal"><a href="#__codelineno-0-2913">2913</a></span>
<span class="normal"><a href="#__codelineno-0-2914">2914</a></span>
<span class="normal"><a href="#__codelineno-0-2915">2915</a></span>
<span class="normal"><a href="#__codelineno-0-2916">2916</a></span>
<span class="normal"><a href="#__codelineno-0-2917">2917</a></span>
<span class="normal"><a href="#__codelineno-0-2918">2918</a></span>
<span class="normal"><a href="#__codelineno-0-2919">2919</a></span>
<span class="normal"><a href="#__codelineno-0-2920">2920</a></span>
<span class="normal"><a href="#__codelineno-0-2921">2921</a></span>
<span class="normal"><a href="#__codelineno-0-2922">2922</a></span>
<span class="normal"><a href="#__codelineno-0-2923">2923</a></span>
<span class="normal"><a href="#__codelineno-0-2924">2924</a></span>
<span class="normal"><a href="#__codelineno-0-2925">2925</a></span>
<span class="normal"><a href="#__codelineno-0-2926">2926</a></span>
<span class="normal"><a href="#__codelineno-0-2927">2927</a></span>
<span class="normal"><a href="#__codelineno-0-2928">2928</a></span>
<span class="normal"><a href="#__codelineno-0-2929">2929</a></span>
<span class="normal"><a href="#__codelineno-0-2930">2930</a></span>
<span class="normal"><a href="#__codelineno-0-2931">2931</a></span>
<span class="normal"><a href="#__codelineno-0-2932">2932</a></span>
<span class="normal"><a href="#__codelineno-0-2933">2933</a></span>
<span class="normal"><a href="#__codelineno-0-2934">2934</a></span>
<span class="normal"><a href="#__codelineno-0-2935">2935</a></span>
<span class="normal"><a href="#__codelineno-0-2936">2936</a></span>
<span class="normal"><a href="#__codelineno-0-2937">2937</a></span>
<span class="normal"><a href="#__codelineno-0-2938">2938</a></span>
<span class="normal"><a href="#__codelineno-0-2939">2939</a></span>
<span class="normal"><a href="#__codelineno-0-2940">2940</a></span>
<span class="normal"><a href="#__codelineno-0-2941">2941</a></span>
<span class="normal"><a href="#__codelineno-0-2942">2942</a></span>
<span class="normal"><a href="#__codelineno-0-2943">2943</a></span>
<span class="normal"><a href="#__codelineno-0-2944">2944</a></span>
<span class="normal"><a href="#__codelineno-0-2945">2945</a></span>
<span class="normal"><a href="#__codelineno-0-2946">2946</a></span>
<span class="normal"><a href="#__codelineno-0-2947">2947</a></span>
<span class="normal"><a href="#__codelineno-0-2948">2948</a></span>
<span class="normal"><a href="#__codelineno-0-2949">2949</a></span>
<span class="normal"><a href="#__codelineno-0-2950">2950</a></span>
<span class="normal"><a href="#__codelineno-0-2951">2951</a></span>
<span class="normal"><a href="#__codelineno-0-2952">2952</a></span>
<span class="normal"><a href="#__codelineno-0-2953">2953</a></span>
<span class="normal"><a href="#__codelineno-0-2954">2954</a></span>
<span class="normal"><a href="#__codelineno-0-2955">2955</a></span>
<span class="normal"><a href="#__codelineno-0-2956">2956</a></span>
<span class="normal"><a href="#__codelineno-0-2957">2957</a></span>
<span class="normal"><a href="#__codelineno-0-2958">2958</a></span>
<span class="normal"><a href="#__codelineno-0-2959">2959</a></span>
<span class="normal"><a href="#__codelineno-0-2960">2960</a></span>
<span class="normal"><a href="#__codelineno-0-2961">2961</a></span>
<span class="normal"><a href="#__codelineno-0-2962">2962</a></span>
<span class="normal"><a href="#__codelineno-0-2963">2963</a></span>
<span class="normal"><a href="#__codelineno-0-2964">2964</a></span>
<span class="normal"><a href="#__codelineno-0-2965">2965</a></span>
<span class="normal"><a href="#__codelineno-0-2966">2966</a></span>
<span class="normal"><a href="#__codelineno-0-2967">2967</a></span>
<span class="normal"><a href="#__codelineno-0-2968">2968</a></span>
<span class="normal"><a href="#__codelineno-0-2969">2969</a></span>
<span class="normal"><a href="#__codelineno-0-2970">2970</a></span>
<span class="normal"><a href="#__codelineno-0-2971">2971</a></span>
<span class="normal"><a href="#__codelineno-0-2972">2972</a></span>
<span class="normal"><a href="#__codelineno-0-2973">2973</a></span>
<span class="normal"><a href="#__codelineno-0-2974">2974</a></span>
<span class="normal"><a href="#__codelineno-0-2975">2975</a></span>
<span class="normal"><a href="#__codelineno-0-2976">2976</a></span>
<span class="normal"><a href="#__codelineno-0-2977">2977</a></span>
<span class="normal"><a href="#__codelineno-0-2978">2978</a></span>
<span class="normal"><a href="#__codelineno-0-2979">2979</a></span>
<span class="normal"><a href="#__codelineno-0-2980">2980</a></span>
<span class="normal"><a href="#__codelineno-0-2981">2981</a></span>
<span class="normal"><a href="#__codelineno-0-2982">2982</a></span>
<span class="normal"><a href="#__codelineno-0-2983">2983</a></span>
<span class="normal"><a href="#__codelineno-0-2984">2984</a></span>
<span class="normal"><a href="#__codelineno-0-2985">2985</a></span>
<span class="normal"><a href="#__codelineno-0-2986">2986</a></span>
<span class="normal"><a href="#__codelineno-0-2987">2987</a></span>
<span class="normal"><a href="#__codelineno-0-2988">2988</a></span>
<span class="normal"><a href="#__codelineno-0-2989">2989</a></span>
<span class="normal"><a href="#__codelineno-0-2990">2990</a></span>
<span class="normal"><a href="#__codelineno-0-2991">2991</a></span>
<span class="normal"><a href="#__codelineno-0-2992">2992</a></span>
<span class="normal"><a href="#__codelineno-0-2993">2993</a></span>
<span class="normal"><a href="#__codelineno-0-2994">2994</a></span>
<span class="normal"><a href="#__codelineno-0-2995">2995</a></span>
<span class="normal"><a href="#__codelineno-0-2996">2996</a></span>
<span class="normal"><a href="#__codelineno-0-2997">2997</a></span>
<span class="normal"><a href="#__codelineno-0-2998">2998</a></span>
<span class="normal"><a href="#__codelineno-0-2999">2999</a></span>
<span class="normal"><a href="#__codelineno-0-3000">3000</a></span>
<span class="normal"><a href="#__codelineno-0-3001">3001</a></span>
<span class="normal"><a href="#__codelineno-0-3002">3002</a></span>
<span class="normal"><a href="#__codelineno-0-3003">3003</a></span>
<span class="normal"><a href="#__codelineno-0-3004">3004</a></span>
<span class="normal"><a href="#__codelineno-0-3005">3005</a></span>
<span class="normal"><a href="#__codelineno-0-3006">3006</a></span>
<span class="normal"><a href="#__codelineno-0-3007">3007</a></span>
<span class="normal"><a href="#__codelineno-0-3008">3008</a></span>
<span class="normal"><a href="#__codelineno-0-3009">3009</a></span>
<span class="normal"><a href="#__codelineno-0-3010">3010</a></span>
<span class="normal"><a href="#__codelineno-0-3011">3011</a></span>
<span class="normal"><a href="#__codelineno-0-3012">3012</a></span>
<span class="normal"><a href="#__codelineno-0-3013">3013</a></span>
<span class="normal"><a href="#__codelineno-0-3014">3014</a></span>
<span class="normal"><a href="#__codelineno-0-3015">3015</a></span>
<span class="normal"><a href="#__codelineno-0-3016">3016</a></span>
<span class="normal"><a href="#__codelineno-0-3017">3017</a></span>
<span class="normal"><a href="#__codelineno-0-3018">3018</a></span>
<span class="normal"><a href="#__codelineno-0-3019">3019</a></span>
<span class="normal"><a href="#__codelineno-0-3020">3020</a></span>
<span class="normal"><a href="#__codelineno-0-3021">3021</a></span>
<span class="normal"><a href="#__codelineno-0-3022">3022</a></span>
<span class="normal"><a href="#__codelineno-0-3023">3023</a></span>
<span class="normal"><a href="#__codelineno-0-3024">3024</a></span>
<span class="normal"><a href="#__codelineno-0-3025">3025</a></span>
<span class="normal"><a href="#__codelineno-0-3026">3026</a></span>
<span class="normal"><a href="#__codelineno-0-3027">3027</a></span>
<span class="normal"><a href="#__codelineno-0-3028">3028</a></span>
<span class="normal"><a href="#__codelineno-0-3029">3029</a></span>
<span class="normal"><a href="#__codelineno-0-3030">3030</a></span>
<span class="normal"><a href="#__codelineno-0-3031">3031</a></span>
<span class="normal"><a href="#__codelineno-0-3032">3032</a></span>
<span class="normal"><a href="#__codelineno-0-3033">3033</a></span>
<span class="normal"><a href="#__codelineno-0-3034">3034</a></span>
<span class="normal"><a href="#__codelineno-0-3035">3035</a></span>
<span class="normal"><a href="#__codelineno-0-3036">3036</a></span>
<span class="normal"><a href="#__codelineno-0-3037">3037</a></span>
<span class="normal"><a href="#__codelineno-0-3038">3038</a></span>
<span class="normal"><a href="#__codelineno-0-3039">3039</a></span>
<span class="normal"><a href="#__codelineno-0-3040">3040</a></span>
<span class="normal"><a href="#__codelineno-0-3041">3041</a></span>
<span class="normal"><a href="#__codelineno-0-3042">3042</a></span>
<span class="normal"><a href="#__codelineno-0-3043">3043</a></span>
<span class="normal"><a href="#__codelineno-0-3044">3044</a></span>
<span class="normal"><a href="#__codelineno-0-3045">3045</a></span>
<span class="normal"><a href="#__codelineno-0-3046">3046</a></span>
<span class="normal"><a href="#__codelineno-0-3047">3047</a></span>
<span class="normal"><a href="#__codelineno-0-3048">3048</a></span>
<span class="normal"><a href="#__codelineno-0-3049">3049</a></span>
<span class="normal"><a href="#__codelineno-0-3050">3050</a></span>
<span class="normal"><a href="#__codelineno-0-3051">3051</a></span>
<span class="normal"><a href="#__codelineno-0-3052">3052</a></span>
<span class="normal"><a href="#__codelineno-0-3053">3053</a></span>
<span class="normal"><a href="#__codelineno-0-3054">3054</a></span>
<span class="normal"><a href="#__codelineno-0-3055">3055</a></span>
<span class="normal"><a href="#__codelineno-0-3056">3056</a></span>
<span class="normal"><a href="#__codelineno-0-3057">3057</a></span>
<span class="normal"><a href="#__codelineno-0-3058">3058</a></span>
<span class="normal"><a href="#__codelineno-0-3059">3059</a></span>
<span class="normal"><a href="#__codelineno-0-3060">3060</a></span>
<span class="normal"><a href="#__codelineno-0-3061">3061</a></span>
<span class="normal"><a href="#__codelineno-0-3062">3062</a></span>
<span class="normal"><a href="#__codelineno-0-3063">3063</a></span>
<span class="normal"><a href="#__codelineno-0-3064">3064</a></span>
<span class="normal"><a href="#__codelineno-0-3065">3065</a></span>
<span class="normal"><a href="#__codelineno-0-3066">3066</a></span>
<span class="normal"><a href="#__codelineno-0-3067">3067</a></span>
<span class="normal"><a href="#__codelineno-0-3068">3068</a></span>
<span class="normal"><a href="#__codelineno-0-3069">3069</a></span>
<span class="normal"><a href="#__codelineno-0-3070">3070</a></span>
<span class="normal"><a href="#__codelineno-0-3071">3071</a></span>
<span class="normal"><a href="#__codelineno-0-3072">3072</a></span>
<span class="normal"><a href="#__codelineno-0-3073">3073</a></span>
<span class="normal"><a href="#__codelineno-0-3074">3074</a></span>
<span class="normal"><a href="#__codelineno-0-3075">3075</a></span>
<span class="normal"><a href="#__codelineno-0-3076">3076</a></span>
<span class="normal"><a href="#__codelineno-0-3077">3077</a></span>
<span class="normal"><a href="#__codelineno-0-3078">3078</a></span>
<span class="normal"><a href="#__codelineno-0-3079">3079</a></span>
<span class="normal"><a href="#__codelineno-0-3080">3080</a></span>
<span class="normal"><a href="#__codelineno-0-3081">3081</a></span>
<span class="normal"><a href="#__codelineno-0-3082">3082</a></span>
<span class="normal"><a href="#__codelineno-0-3083">3083</a></span>
<span class="normal"><a href="#__codelineno-0-3084">3084</a></span>
<span class="normal"><a href="#__codelineno-0-3085">3085</a></span>
<span class="normal"><a href="#__codelineno-0-3086">3086</a></span>
<span class="normal"><a href="#__codelineno-0-3087">3087</a></span>
<span class="normal"><a href="#__codelineno-0-3088">3088</a></span>
<span class="normal"><a href="#__codelineno-0-3089">3089</a></span>
<span class="normal"><a href="#__codelineno-0-3090">3090</a></span>
<span class="normal"><a href="#__codelineno-0-3091">3091</a></span>
<span class="normal"><a href="#__codelineno-0-3092">3092</a></span>
<span class="normal"><a href="#__codelineno-0-3093">3093</a></span>
<span class="normal"><a href="#__codelineno-0-3094">3094</a></span>
<span class="normal"><a href="#__codelineno-0-3095">3095</a></span>
<span class="normal"><a href="#__codelineno-0-3096">3096</a></span>
<span class="normal"><a href="#__codelineno-0-3097">3097</a></span>
<span class="normal"><a href="#__codelineno-0-3098">3098</a></span>
<span class="normal"><a href="#__codelineno-0-3099">3099</a></span>
<span class="normal"><a href="#__codelineno-0-3100">3100</a></span>
<span class="normal"><a href="#__codelineno-0-3101">3101</a></span>
<span class="normal"><a href="#__codelineno-0-3102">3102</a></span>
<span class="normal"><a href="#__codelineno-0-3103">3103</a></span>
<span class="normal"><a href="#__codelineno-0-3104">3104</a></span>
<span class="normal"><a href="#__codelineno-0-3105">3105</a></span>
<span class="normal"><a href="#__codelineno-0-3106">3106</a></span>
<span class="normal"><a href="#__codelineno-0-3107">3107</a></span>
<span class="normal"><a href="#__codelineno-0-3108">3108</a></span>
<span class="normal"><a href="#__codelineno-0-3109">3109</a></span>
<span class="normal"><a href="#__codelineno-0-3110">3110</a></span>
<span class="normal"><a href="#__codelineno-0-3111">3111</a></span>
<span class="normal"><a href="#__codelineno-0-3112">3112</a></span>
<span class="normal"><a href="#__codelineno-0-3113">3113</a></span>
<span class="normal"><a href="#__codelineno-0-3114">3114</a></span>
<span class="normal"><a href="#__codelineno-0-3115">3115</a></span>
<span class="normal"><a href="#__codelineno-0-3116">3116</a></span>
<span class="normal"><a href="#__codelineno-0-3117">3117</a></span>
<span class="normal"><a href="#__codelineno-0-3118">3118</a></span>
<span class="normal"><a href="#__codelineno-0-3119">3119</a></span>
<span class="normal"><a href="#__codelineno-0-3120">3120</a></span>
<span class="normal"><a href="#__codelineno-0-3121">3121</a></span>
<span class="normal"><a href="#__codelineno-0-3122">3122</a></span>
<span class="normal"><a href="#__codelineno-0-3123">3123</a></span>
<span class="normal"><a href="#__codelineno-0-3124">3124</a></span>
<span class="normal"><a href="#__codelineno-0-3125">3125</a></span>
<span class="normal"><a href="#__codelineno-0-3126">3126</a></span>
<span class="normal"><a href="#__codelineno-0-3127">3127</a></span>
<span class="normal"><a href="#__codelineno-0-3128">3128</a></span>
<span class="normal"><a href="#__codelineno-0-3129">3129</a></span>
<span class="normal"><a href="#__codelineno-0-3130">3130</a></span>
<span class="normal"><a href="#__codelineno-0-3131">3131</a></span>
<span class="normal"><a href="#__codelineno-0-3132">3132</a></span>
<span class="normal"><a href="#__codelineno-0-3133">3133</a></span>
<span class="normal"><a href="#__codelineno-0-3134">3134</a></span>
<span class="normal"><a href="#__codelineno-0-3135">3135</a></span>
<span class="normal"><a href="#__codelineno-0-3136">3136</a></span>
<span class="normal"><a href="#__codelineno-0-3137">3137</a></span>
<span class="normal"><a href="#__codelineno-0-3138">3138</a></span>
<span class="normal"><a href="#__codelineno-0-3139">3139</a></span>
<span class="normal"><a href="#__codelineno-0-3140">3140</a></span>
<span class="normal"><a href="#__codelineno-0-3141">3141</a></span>
<span class="normal"><a href="#__codelineno-0-3142">3142</a></span>
<span class="normal"><a href="#__codelineno-0-3143">3143</a></span>
<span class="normal"><a href="#__codelineno-0-3144">3144</a></span>
<span class="normal"><a href="#__codelineno-0-3145">3145</a></span>
<span class="normal"><a href="#__codelineno-0-3146">3146</a></span>
<span class="normal"><a href="#__codelineno-0-3147">3147</a></span>
<span class="normal"><a href="#__codelineno-0-3148">3148</a></span>
<span class="normal"><a href="#__codelineno-0-3149">3149</a></span>
<span class="normal"><a href="#__codelineno-0-3150">3150</a></span>
<span class="normal"><a href="#__codelineno-0-3151">3151</a></span>
<span class="normal"><a href="#__codelineno-0-3152">3152</a></span>
<span class="normal"><a href="#__codelineno-0-3153">3153</a></span>
<span class="normal"><a href="#__codelineno-0-3154">3154</a></span>
<span class="normal"><a href="#__codelineno-0-3155">3155</a></span>
<span class="normal"><a href="#__codelineno-0-3156">3156</a></span>
<span class="normal"><a href="#__codelineno-0-3157">3157</a></span>
<span class="normal"><a href="#__codelineno-0-3158">3158</a></span>
<span class="normal"><a href="#__codelineno-0-3159">3159</a></span>
<span class="normal"><a href="#__codelineno-0-3160">3160</a></span>
<span class="normal"><a href="#__codelineno-0-3161">3161</a></span>
<span class="normal"><a href="#__codelineno-0-3162">3162</a></span>
<span class="normal"><a href="#__codelineno-0-3163">3163</a></span>
<span class="normal"><a href="#__codelineno-0-3164">3164</a></span>
<span class="normal"><a href="#__codelineno-0-3165">3165</a></span>
<span class="normal"><a href="#__codelineno-0-3166">3166</a></span>
<span class="normal"><a href="#__codelineno-0-3167">3167</a></span>
<span class="normal"><a href="#__codelineno-0-3168">3168</a></span>
<span class="normal"><a href="#__codelineno-0-3169">3169</a></span>
<span class="normal"><a href="#__codelineno-0-3170">3170</a></span>
<span class="normal"><a href="#__codelineno-0-3171">3171</a></span>
<span class="normal"><a href="#__codelineno-0-3172">3172</a></span>
<span class="normal"><a href="#__codelineno-0-3173">3173</a></span>
<span class="normal"><a href="#__codelineno-0-3174">3174</a></span>
<span class="normal"><a href="#__codelineno-0-3175">3175</a></span>
<span class="normal"><a href="#__codelineno-0-3176">3176</a></span>
<span class="normal"><a href="#__codelineno-0-3177">3177</a></span>
<span class="normal"><a href="#__codelineno-0-3178">3178</a></span>
<span class="normal"><a href="#__codelineno-0-3179">3179</a></span>
<span class="normal"><a href="#__codelineno-0-3180">3180</a></span>
<span class="normal"><a href="#__codelineno-0-3181">3181</a></span>
<span class="normal"><a href="#__codelineno-0-3182">3182</a></span>
<span class="normal"><a href="#__codelineno-0-3183">3183</a></span>
<span class="normal"><a href="#__codelineno-0-3184">3184</a></span>
<span class="normal"><a href="#__codelineno-0-3185">3185</a></span>
<span class="normal"><a href="#__codelineno-0-3186">3186</a></span>
<span class="normal"><a href="#__codelineno-0-3187">3187</a></span>
<span class="normal"><a href="#__codelineno-0-3188">3188</a></span>
<span class="normal"><a href="#__codelineno-0-3189">3189</a></span>
<span class="normal"><a href="#__codelineno-0-3190">3190</a></span>
<span class="normal"><a href="#__codelineno-0-3191">3191</a></span>
<span class="normal"><a href="#__codelineno-0-3192">3192</a></span>
<span class="normal"><a href="#__codelineno-0-3193">3193</a></span>
<span class="normal"><a href="#__codelineno-0-3194">3194</a></span>
<span class="normal"><a href="#__codelineno-0-3195">3195</a></span>
<span class="normal"><a href="#__codelineno-0-3196">3196</a></span>
<span class="normal"><a href="#__codelineno-0-3197">3197</a></span>
<span class="normal"><a href="#__codelineno-0-3198">3198</a></span>
<span class="normal"><a href="#__codelineno-0-3199">3199</a></span>
<span class="normal"><a href="#__codelineno-0-3200">3200</a></span>
<span class="normal"><a href="#__codelineno-0-3201">3201</a></span>
<span class="normal"><a href="#__codelineno-0-3202">3202</a></span>
<span class="normal"><a href="#__codelineno-0-3203">3203</a></span>
<span class="normal"><a href="#__codelineno-0-3204">3204</a></span>
<span class="normal"><a href="#__codelineno-0-3205">3205</a></span>
<span class="normal"><a href="#__codelineno-0-3206">3206</a></span>
<span class="normal"><a href="#__codelineno-0-3207">3207</a></span>
<span class="normal"><a href="#__codelineno-0-3208">3208</a></span>
<span class="normal"><a href="#__codelineno-0-3209">3209</a></span>
<span class="normal"><a href="#__codelineno-0-3210">3210</a></span>
<span class="normal"><a href="#__codelineno-0-3211">3211</a></span>
<span class="normal"><a href="#__codelineno-0-3212">3212</a></span>
<span class="normal"><a href="#__codelineno-0-3213">3213</a></span>
<span class="normal"><a href="#__codelineno-0-3214">3214</a></span>
<span class="normal"><a href="#__codelineno-0-3215">3215</a></span>
<span class="normal"><a href="#__codelineno-0-3216">3216</a></span>
<span class="normal"><a href="#__codelineno-0-3217">3217</a></span>
<span class="normal"><a href="#__codelineno-0-3218">3218</a></span>
<span class="normal"><a href="#__codelineno-0-3219">3219</a></span>
<span class="normal"><a href="#__codelineno-0-3220">3220</a></span>
<span class="normal"><a href="#__codelineno-0-3221">3221</a></span>
<span class="normal"><a href="#__codelineno-0-3222">3222</a></span>
<span class="normal"><a href="#__codelineno-0-3223">3223</a></span>
<span class="normal"><a href="#__codelineno-0-3224">3224</a></span>
<span class="normal"><a href="#__codelineno-0-3225">3225</a></span>
<span class="normal"><a href="#__codelineno-0-3226">3226</a></span>
<span class="normal"><a href="#__codelineno-0-3227">3227</a></span>
<span class="normal"><a href="#__codelineno-0-3228">3228</a></span>
<span class="normal"><a href="#__codelineno-0-3229">3229</a></span>
<span class="normal"><a href="#__codelineno-0-3230">3230</a></span>
<span class="normal"><a href="#__codelineno-0-3231">3231</a></span>
<span class="normal"><a href="#__codelineno-0-3232">3232</a></span>
<span class="normal"><a href="#__codelineno-0-3233">3233</a></span>
<span class="normal"><a href="#__codelineno-0-3234">3234</a></span>
<span class="normal"><a href="#__codelineno-0-3235">3235</a></span>
<span class="normal"><a href="#__codelineno-0-3236">3236</a></span>
<span class="normal"><a href="#__codelineno-0-3237">3237</a></span>
<span class="normal"><a href="#__codelineno-0-3238">3238</a></span>
<span class="normal"><a href="#__codelineno-0-3239">3239</a></span>
<span class="normal"><a href="#__codelineno-0-3240">3240</a></span>
<span class="normal"><a href="#__codelineno-0-3241">3241</a></span>
<span class="normal"><a href="#__codelineno-0-3242">3242</a></span>
<span class="normal"><a href="#__codelineno-0-3243">3243</a></span>
<span class="normal"><a href="#__codelineno-0-3244">3244</a></span>
<span class="normal"><a href="#__codelineno-0-3245">3245</a></span>
<span class="normal"><a href="#__codelineno-0-3246">3246</a></span>
<span class="normal"><a href="#__codelineno-0-3247">3247</a></span>
<span class="normal"><a href="#__codelineno-0-3248">3248</a></span>
<span class="normal"><a href="#__codelineno-0-3249">3249</a></span>
<span class="normal"><a href="#__codelineno-0-3250">3250</a></span>
<span class="normal"><a href="#__codelineno-0-3251">3251</a></span>
<span class="normal"><a href="#__codelineno-0-3252">3252</a></span>
<span class="normal"><a href="#__codelineno-0-3253">3253</a></span>
<span class="normal"><a href="#__codelineno-0-3254">3254</a></span>
<span class="normal"><a href="#__codelineno-0-3255">3255</a></span>
<span class="normal"><a href="#__codelineno-0-3256">3256</a></span>
<span class="normal"><a href="#__codelineno-0-3257">3257</a></span>
<span class="normal"><a href="#__codelineno-0-3258">3258</a></span>
<span class="normal"><a href="#__codelineno-0-3259">3259</a></span>
<span class="normal"><a href="#__codelineno-0-3260">3260</a></span>
<span class="normal"><a href="#__codelineno-0-3261">3261</a></span>
<span class="normal"><a href="#__codelineno-0-3262">3262</a></span>
<span class="normal"><a href="#__codelineno-0-3263">3263</a></span>
<span class="normal"><a href="#__codelineno-0-3264">3264</a></span>
<span class="normal"><a href="#__codelineno-0-3265">3265</a></span>
<span class="normal"><a href="#__codelineno-0-3266">3266</a></span>
<span class="normal"><a href="#__codelineno-0-3267">3267</a></span>
<span class="normal"><a href="#__codelineno-0-3268">3268</a></span>
<span class="normal"><a href="#__codelineno-0-3269">3269</a></span>
<span class="normal"><a href="#__codelineno-0-3270">3270</a></span>
<span class="normal"><a href="#__codelineno-0-3271">3271</a></span>
<span class="normal"><a href="#__codelineno-0-3272">3272</a></span>
<span class="normal"><a href="#__codelineno-0-3273">3273</a></span>
<span class="normal"><a href="#__codelineno-0-3274">3274</a></span>
<span class="normal"><a href="#__codelineno-0-3275">3275</a></span>
<span class="normal"><a href="#__codelineno-0-3276">3276</a></span>
<span class="normal"><a href="#__codelineno-0-3277">3277</a></span>
<span class="normal"><a href="#__codelineno-0-3278">3278</a></span>
<span class="normal"><a href="#__codelineno-0-3279">3279</a></span>
<span class="normal"><a href="#__codelineno-0-3280">3280</a></span>
<span class="normal"><a href="#__codelineno-0-3281">3281</a></span>
<span class="normal"><a href="#__codelineno-0-3282">3282</a></span>
<span class="normal"><a href="#__codelineno-0-3283">3283</a></span>
<span class="normal"><a href="#__codelineno-0-3284">3284</a></span>
<span class="normal"><a href="#__codelineno-0-3285">3285</a></span>
<span class="normal"><a href="#__codelineno-0-3286">3286</a></span>
<span class="normal"><a href="#__codelineno-0-3287">3287</a></span>
<span class="normal"><a href="#__codelineno-0-3288">3288</a></span>
<span class="normal"><a href="#__codelineno-0-3289">3289</a></span>
<span class="normal"><a href="#__codelineno-0-3290">3290</a></span>
<span class="normal"><a href="#__codelineno-0-3291">3291</a></span>
<span class="normal"><a href="#__codelineno-0-3292">3292</a></span>
<span class="normal"><a href="#__codelineno-0-3293">3293</a></span>
<span class="normal"><a href="#__codelineno-0-3294">3294</a></span>
<span class="normal"><a href="#__codelineno-0-3295">3295</a></span>
<span class="normal"><a href="#__codelineno-0-3296">3296</a></span>
<span class="normal"><a href="#__codelineno-0-3297">3297</a></span>
<span class="normal"><a href="#__codelineno-0-3298">3298</a></span>
<span class="normal"><a href="#__codelineno-0-3299">3299</a></span>
<span class="normal"><a href="#__codelineno-0-3300">3300</a></span>
<span class="normal"><a href="#__codelineno-0-3301">3301</a></span>
<span class="normal"><a href="#__codelineno-0-3302">3302</a></span>
<span class="normal"><a href="#__codelineno-0-3303">3303</a></span>
<span class="normal"><a href="#__codelineno-0-3304">3304</a></span>
<span class="normal"><a href="#__codelineno-0-3305">3305</a></span>
<span class="normal"><a href="#__codelineno-0-3306">3306</a></span>
<span class="normal"><a href="#__codelineno-0-3307">3307</a></span>
<span class="normal"><a href="#__codelineno-0-3308">3308</a></span>
<span class="normal"><a href="#__codelineno-0-3309">3309</a></span>
<span class="normal"><a href="#__codelineno-0-3310">3310</a></span>
<span class="normal"><a href="#__codelineno-0-3311">3311</a></span>
<span class="normal"><a href="#__codelineno-0-3312">3312</a></span>
<span class="normal"><a href="#__codelineno-0-3313">3313</a></span>
<span class="normal"><a href="#__codelineno-0-3314">3314</a></span>
<span class="normal"><a href="#__codelineno-0-3315">3315</a></span>
<span class="normal"><a href="#__codelineno-0-3316">3316</a></span>
<span class="normal"><a href="#__codelineno-0-3317">3317</a></span>
<span class="normal"><a href="#__codelineno-0-3318">3318</a></span>
<span class="normal"><a href="#__codelineno-0-3319">3319</a></span>
<span class="normal"><a href="#__codelineno-0-3320">3320</a></span>
<span class="normal"><a href="#__codelineno-0-3321">3321</a></span>
<span class="normal"><a href="#__codelineno-0-3322">3322</a></span>
<span class="normal"><a href="#__codelineno-0-3323">3323</a></span>
<span class="normal"><a href="#__codelineno-0-3324">3324</a></span>
<span class="normal"><a href="#__codelineno-0-3325">3325</a></span>
<span class="normal"><a href="#__codelineno-0-3326">3326</a></span>
<span class="normal"><a href="#__codelineno-0-3327">3327</a></span>
<span class="normal"><a href="#__codelineno-0-3328">3328</a></span>
<span class="normal"><a href="#__codelineno-0-3329">3329</a></span>
<span class="normal"><a href="#__codelineno-0-3330">3330</a></span>
<span class="normal"><a href="#__codelineno-0-3331">3331</a></span>
<span class="normal"><a href="#__codelineno-0-3332">3332</a></span>
<span class="normal"><a href="#__codelineno-0-3333">3333</a></span>
<span class="normal"><a href="#__codelineno-0-3334">3334</a></span>
<span class="normal"><a href="#__codelineno-0-3335">3335</a></span>
<span class="normal"><a href="#__codelineno-0-3336">3336</a></span>
<span class="normal"><a href="#__codelineno-0-3337">3337</a></span>
<span class="normal"><a href="#__codelineno-0-3338">3338</a></span>
<span class="normal"><a href="#__codelineno-0-3339">3339</a></span>
<span class="normal"><a href="#__codelineno-0-3340">3340</a></span>
<span class="normal"><a href="#__codelineno-0-3341">3341</a></span>
<span class="normal"><a href="#__codelineno-0-3342">3342</a></span>
<span class="normal"><a href="#__codelineno-0-3343">3343</a></span>
<span class="normal"><a href="#__codelineno-0-3344">3344</a></span>
<span class="normal"><a href="#__codelineno-0-3345">3345</a></span>
<span class="normal"><a href="#__codelineno-0-3346">3346</a></span>
<span class="normal"><a href="#__codelineno-0-3347">3347</a></span>
<span class="normal"><a href="#__codelineno-0-3348">3348</a></span>
<span class="normal"><a href="#__codelineno-0-3349">3349</a></span>
<span class="normal"><a href="#__codelineno-0-3350">3350</a></span>
<span class="normal"><a href="#__codelineno-0-3351">3351</a></span>
<span class="normal"><a href="#__codelineno-0-3352">3352</a></span>
<span class="normal"><a href="#__codelineno-0-3353">3353</a></span>
<span class="normal"><a href="#__codelineno-0-3354">3354</a></span>
<span class="normal"><a href="#__codelineno-0-3355">3355</a></span>
<span class="normal"><a href="#__codelineno-0-3356">3356</a></span>
<span class="normal"><a href="#__codelineno-0-3357">3357</a></span>
<span class="normal"><a href="#__codelineno-0-3358">3358</a></span>
<span class="normal"><a href="#__codelineno-0-3359">3359</a></span>
<span class="normal"><a href="#__codelineno-0-3360">3360</a></span>
<span class="normal"><a href="#__codelineno-0-3361">3361</a></span>
<span class="normal"><a href="#__codelineno-0-3362">3362</a></span>
<span class="normal"><a href="#__codelineno-0-3363">3363</a></span>
<span class="normal"><a href="#__codelineno-0-3364">3364</a></span>
<span class="normal"><a href="#__codelineno-0-3365">3365</a></span>
<span class="normal"><a href="#__codelineno-0-3366">3366</a></span>
<span class="normal"><a href="#__codelineno-0-3367">3367</a></span>
<span class="normal"><a href="#__codelineno-0-3368">3368</a></span>
<span class="normal"><a href="#__codelineno-0-3369">3369</a></span>
<span class="normal"><a href="#__codelineno-0-3370">3370</a></span>
<span class="normal"><a href="#__codelineno-0-3371">3371</a></span>
<span class="normal"><a href="#__codelineno-0-3372">3372</a></span>
<span class="normal"><a href="#__codelineno-0-3373">3373</a></span>
<span class="normal"><a href="#__codelineno-0-3374">3374</a></span>
<span class="normal"><a href="#__codelineno-0-3375">3375</a></span>
<span class="normal"><a href="#__codelineno-0-3376">3376</a></span>
<span class="normal"><a href="#__codelineno-0-3377">3377</a></span>
<span class="normal"><a href="#__codelineno-0-3378">3378</a></span>
<span class="normal"><a href="#__codelineno-0-3379">3379</a></span>
<span class="normal"><a href="#__codelineno-0-3380">3380</a></span>
<span class="normal"><a href="#__codelineno-0-3381">3381</a></span>
<span class="normal"><a href="#__codelineno-0-3382">3382</a></span>
<span class="normal"><a href="#__codelineno-0-3383">3383</a></span>
<span class="normal"><a href="#__codelineno-0-3384">3384</a></span>
<span class="normal"><a href="#__codelineno-0-3385">3385</a></span>
<span class="normal"><a href="#__codelineno-0-3386">3386</a></span>
<span class="normal"><a href="#__codelineno-0-3387">3387</a></span>
<span class="normal"><a href="#__codelineno-0-3388">3388</a></span>
<span class="normal"><a href="#__codelineno-0-3389">3389</a></span>
<span class="normal"><a href="#__codelineno-0-3390">3390</a></span>
<span class="normal"><a href="#__codelineno-0-3391">3391</a></span>
<span class="normal"><a href="#__codelineno-0-3392">3392</a></span>
<span class="normal"><a href="#__codelineno-0-3393">3393</a></span>
<span class="normal"><a href="#__codelineno-0-3394">3394</a></span>
<span class="normal"><a href="#__codelineno-0-3395">3395</a></span>
<span class="normal"><a href="#__codelineno-0-3396">3396</a></span>
<span class="normal"><a href="#__codelineno-0-3397">3397</a></span>
<span class="normal"><a href="#__codelineno-0-3398">3398</a></span>
<span class="normal"><a href="#__codelineno-0-3399">3399</a></span>
<span class="normal"><a href="#__codelineno-0-3400">3400</a></span>
<span class="normal"><a href="#__codelineno-0-3401">3401</a></span>
<span class="normal"><a href="#__codelineno-0-3402">3402</a></span>
<span class="normal"><a href="#__codelineno-0-3403">3403</a></span>
<span class="normal"><a href="#__codelineno-0-3404">3404</a></span>
<span class="normal"><a href="#__codelineno-0-3405">3405</a></span>
<span class="normal"><a href="#__codelineno-0-3406">3406</a></span>
<span class="normal"><a href="#__codelineno-0-3407">3407</a></span>
<span class="normal"><a href="#__codelineno-0-3408">3408</a></span>
<span class="normal"><a href="#__codelineno-0-3409">3409</a></span>
<span class="normal"><a href="#__codelineno-0-3410">3410</a></span>
<span class="normal"><a href="#__codelineno-0-3411">3411</a></span>
<span class="normal"><a href="#__codelineno-0-3412">3412</a></span>
<span class="normal"><a href="#__codelineno-0-3413">3413</a></span>
<span class="normal"><a href="#__codelineno-0-3414">3414</a></span>
<span class="normal"><a href="#__codelineno-0-3415">3415</a></span>
<span class="normal"><a href="#__codelineno-0-3416">3416</a></span>
<span class="normal"><a href="#__codelineno-0-3417">3417</a></span>
<span class="normal"><a href="#__codelineno-0-3418">3418</a></span>
<span class="normal"><a href="#__codelineno-0-3419">3419</a></span>
<span class="normal"><a href="#__codelineno-0-3420">3420</a></span>
<span class="normal"><a href="#__codelineno-0-3421">3421</a></span>
<span class="normal"><a href="#__codelineno-0-3422">3422</a></span>
<span class="normal"><a href="#__codelineno-0-3423">3423</a></span>
<span class="normal"><a href="#__codelineno-0-3424">3424</a></span>
<span class="normal"><a href="#__codelineno-0-3425">3425</a></span>
<span class="normal"><a href="#__codelineno-0-3426">3426</a></span>
<span class="normal"><a href="#__codelineno-0-3427">3427</a></span>
<span class="normal"><a href="#__codelineno-0-3428">3428</a></span>
<span class="normal"><a href="#__codelineno-0-3429">3429</a></span>
<span class="normal"><a href="#__codelineno-0-3430">3430</a></span>
<span class="normal"><a href="#__codelineno-0-3431">3431</a></span>
<span class="normal"><a href="#__codelineno-0-3432">3432</a></span>
<span class="normal"><a href="#__codelineno-0-3433">3433</a></span>
<span class="normal"><a href="#__codelineno-0-3434">3434</a></span>
<span class="normal"><a href="#__codelineno-0-3435">3435</a></span>
<span class="normal"><a href="#__codelineno-0-3436">3436</a></span>
<span class="normal"><a href="#__codelineno-0-3437">3437</a></span>
<span class="normal"><a href="#__codelineno-0-3438">3438</a></span>
<span class="normal"><a href="#__codelineno-0-3439">3439</a></span>
<span class="normal"><a href="#__codelineno-0-3440">3440</a></span>
<span class="normal"><a href="#__codelineno-0-3441">3441</a></span>
<span class="normal"><a href="#__codelineno-0-3442">3442</a></span>
<span class="normal"><a href="#__codelineno-0-3443">3443</a></span>
<span class="normal"><a href="#__codelineno-0-3444">3444</a></span>
<span class="normal"><a href="#__codelineno-0-3445">3445</a></span>
<span class="normal"><a href="#__codelineno-0-3446">3446</a></span>
<span class="normal"><a href="#__codelineno-0-3447">3447</a></span>
<span class="normal"><a href="#__codelineno-0-3448">3448</a></span>
<span class="normal"><a href="#__codelineno-0-3449">3449</a></span>
<span class="normal"><a href="#__codelineno-0-3450">3450</a></span>
<span class="normal"><a href="#__codelineno-0-3451">3451</a></span>
<span class="normal"><a href="#__codelineno-0-3452">3452</a></span>
<span class="normal"><a href="#__codelineno-0-3453">3453</a></span>
<span class="normal"><a href="#__codelineno-0-3454">3454</a></span>
<span class="normal"><a href="#__codelineno-0-3455">3455</a></span>
<span class="normal"><a href="#__codelineno-0-3456">3456</a></span>
<span class="normal"><a href="#__codelineno-0-3457">3457</a></span>
<span class="normal"><a href="#__codelineno-0-3458">3458</a></span>
<span class="normal"><a href="#__codelineno-0-3459">3459</a></span>
<span class="normal"><a href="#__codelineno-0-3460">3460</a></span>
<span class="normal"><a href="#__codelineno-0-3461">3461</a></span>
<span class="normal"><a href="#__codelineno-0-3462">3462</a></span>
<span class="normal"><a href="#__codelineno-0-3463">3463</a></span>
<span class="normal"><a href="#__codelineno-0-3464">3464</a></span>
<span class="normal"><a href="#__codelineno-0-3465">3465</a></span>
<span class="normal"><a href="#__codelineno-0-3466">3466</a></span>
<span class="normal"><a href="#__codelineno-0-3467">3467</a></span>
<span class="normal"><a href="#__codelineno-0-3468">3468</a></span>
<span class="normal"><a href="#__codelineno-0-3469">3469</a></span>
<span class="normal"><a href="#__codelineno-0-3470">3470</a></span>
<span class="normal"><a href="#__codelineno-0-3471">3471</a></span>
<span class="normal"><a href="#__codelineno-0-3472">3472</a></span>
<span class="normal"><a href="#__codelineno-0-3473">3473</a></span>
<span class="normal"><a href="#__codelineno-0-3474">3474</a></span>
<span class="normal"><a href="#__codelineno-0-3475">3475</a></span>
<span class="normal"><a href="#__codelineno-0-3476">3476</a></span>
<span class="normal"><a href="#__codelineno-0-3477">3477</a></span>
<span class="normal"><a href="#__codelineno-0-3478">3478</a></span>
<span class="normal"><a href="#__codelineno-0-3479">3479</a></span>
<span class="normal"><a href="#__codelineno-0-3480">3480</a></span>
<span class="normal"><a href="#__codelineno-0-3481">3481</a></span>
<span class="normal"><a href="#__codelineno-0-3482">3482</a></span>
<span class="normal"><a href="#__codelineno-0-3483">3483</a></span>
<span class="normal"><a href="#__codelineno-0-3484">3484</a></span>
<span class="normal"><a href="#__codelineno-0-3485">3485</a></span>
<span class="normal"><a href="#__codelineno-0-3486">3486</a></span>
<span class="normal"><a href="#__codelineno-0-3487">3487</a></span>
<span class="normal"><a href="#__codelineno-0-3488">3488</a></span>
<span class="normal"><a href="#__codelineno-0-3489">3489</a></span>
<span class="normal"><a href="#__codelineno-0-3490">3490</a></span>
<span class="normal"><a href="#__codelineno-0-3491">3491</a></span>
<span class="normal"><a href="#__codelineno-0-3492">3492</a></span>
<span class="normal"><a href="#__codelineno-0-3493">3493</a></span>
<span class="normal"><a href="#__codelineno-0-3494">3494</a></span>
<span class="normal"><a href="#__codelineno-0-3495">3495</a></span>
<span class="normal"><a href="#__codelineno-0-3496">3496</a></span>
<span class="normal"><a href="#__codelineno-0-3497">3497</a></span>
<span class="normal"><a href="#__codelineno-0-3498">3498</a></span>
<span class="normal"><a href="#__codelineno-0-3499">3499</a></span>
<span class="normal"><a href="#__codelineno-0-3500">3500</a></span>
<span class="normal"><a href="#__codelineno-0-3501">3501</a></span>
<span class="normal"><a href="#__codelineno-0-3502">3502</a></span>
<span class="normal"><a href="#__codelineno-0-3503">3503</a></span>
<span class="normal"><a href="#__codelineno-0-3504">3504</a></span>
<span class="normal"><a href="#__codelineno-0-3505">3505</a></span>
<span class="normal"><a href="#__codelineno-0-3506">3506</a></span>
<span class="normal"><a href="#__codelineno-0-3507">3507</a></span>
<span class="normal"><a href="#__codelineno-0-3508">3508</a></span>
<span class="normal"><a href="#__codelineno-0-3509">3509</a></span>
<span class="normal"><a href="#__codelineno-0-3510">3510</a></span>
<span class="normal"><a href="#__codelineno-0-3511">3511</a></span>
<span class="normal"><a href="#__codelineno-0-3512">3512</a></span>
<span class="normal"><a href="#__codelineno-0-3513">3513</a></span>
<span class="normal"><a href="#__codelineno-0-3514">3514</a></span>
<span class="normal"><a href="#__codelineno-0-3515">3515</a></span>
<span class="normal"><a href="#__codelineno-0-3516">3516</a></span>
<span class="normal"><a href="#__codelineno-0-3517">3517</a></span>
<span class="normal"><a href="#__codelineno-0-3518">3518</a></span>
<span class="normal"><a href="#__codelineno-0-3519">3519</a></span>
<span class="normal"><a href="#__codelineno-0-3520">3520</a></span>
<span class="normal"><a href="#__codelineno-0-3521">3521</a></span>
<span class="normal"><a href="#__codelineno-0-3522">3522</a></span>
<span class="normal"><a href="#__codelineno-0-3523">3523</a></span>
<span class="normal"><a href="#__codelineno-0-3524">3524</a></span>
<span class="normal"><a href="#__codelineno-0-3525">3525</a></span>
<span class="normal"><a href="#__codelineno-0-3526">3526</a></span>
<span class="normal"><a href="#__codelineno-0-3527">3527</a></span>
<span class="normal"><a href="#__codelineno-0-3528">3528</a></span>
<span class="normal"><a href="#__codelineno-0-3529">3529</a></span>
<span class="normal"><a href="#__codelineno-0-3530">3530</a></span>
<span class="normal"><a href="#__codelineno-0-3531">3531</a></span>
<span class="normal"><a href="#__codelineno-0-3532">3532</a></span>
<span class="normal"><a href="#__codelineno-0-3533">3533</a></span>
<span class="normal"><a href="#__codelineno-0-3534">3534</a></span>
<span class="normal"><a href="#__codelineno-0-3535">3535</a></span>
<span class="normal"><a href="#__codelineno-0-3536">3536</a></span>
<span class="normal"><a href="#__codelineno-0-3537">3537</a></span>
<span class="normal"><a href="#__codelineno-0-3538">3538</a></span>
<span class="normal"><a href="#__codelineno-0-3539">3539</a></span>
<span class="normal"><a href="#__codelineno-0-3540">3540</a></span>
<span class="normal"><a href="#__codelineno-0-3541">3541</a></span>
<span class="normal"><a href="#__codelineno-0-3542">3542</a></span>
<span class="normal"><a href="#__codelineno-0-3543">3543</a></span>
<span class="normal"><a href="#__codelineno-0-3544">3544</a></span>
<span class="normal"><a href="#__codelineno-0-3545">3545</a></span>
<span class="normal"><a href="#__codelineno-0-3546">3546</a></span>
<span class="normal"><a href="#__codelineno-0-3547">3547</a></span>
<span class="normal"><a href="#__codelineno-0-3548">3548</a></span>
<span class="normal"><a href="#__codelineno-0-3549">3549</a></span>
<span class="normal"><a href="#__codelineno-0-3550">3550</a></span>
<span class="normal"><a href="#__codelineno-0-3551">3551</a></span>
<span class="normal"><a href="#__codelineno-0-3552">3552</a></span>
<span class="normal"><a href="#__codelineno-0-3553">3553</a></span>
<span class="normal"><a href="#__codelineno-0-3554">3554</a></span>
<span class="normal"><a href="#__codelineno-0-3555">3555</a></span>
<span class="normal"><a href="#__codelineno-0-3556">3556</a></span>
<span class="normal"><a href="#__codelineno-0-3557">3557</a></span>
<span class="normal"><a href="#__codelineno-0-3558">3558</a></span>
<span class="normal"><a href="#__codelineno-0-3559">3559</a></span>
<span class="normal"><a href="#__codelineno-0-3560">3560</a></span>
<span class="normal"><a href="#__codelineno-0-3561">3561</a></span>
<span class="normal"><a href="#__codelineno-0-3562">3562</a></span>
<span class="normal"><a href="#__codelineno-0-3563">3563</a></span>
<span class="normal"><a href="#__codelineno-0-3564">3564</a></span>
<span class="normal"><a href="#__codelineno-0-3565">3565</a></span>
<span class="normal"><a href="#__codelineno-0-3566">3566</a></span>
<span class="normal"><a href="#__codelineno-0-3567">3567</a></span>
<span class="normal"><a href="#__codelineno-0-3568">3568</a></span>
<span class="normal"><a href="#__codelineno-0-3569">3569</a></span>
<span class="normal"><a href="#__codelineno-0-3570">3570</a></span>
<span class="normal"><a href="#__codelineno-0-3571">3571</a></span>
<span class="normal"><a href="#__codelineno-0-3572">3572</a></span>
<span class="normal"><a href="#__codelineno-0-3573">3573</a></span>
<span class="normal"><a href="#__codelineno-0-3574">3574</a></span>
<span class="normal"><a href="#__codelineno-0-3575">3575</a></span>
<span class="normal"><a href="#__codelineno-0-3576">3576</a></span>
<span class="normal"><a href="#__codelineno-0-3577">3577</a></span>
<span class="normal"><a href="#__codelineno-0-3578">3578</a></span>
<span class="normal"><a href="#__codelineno-0-3579">3579</a></span>
<span class="normal"><a href="#__codelineno-0-3580">3580</a></span>
<span class="normal"><a href="#__codelineno-0-3581">3581</a></span>
<span class="normal"><a href="#__codelineno-0-3582">3582</a></span>
<span class="normal"><a href="#__codelineno-0-3583">3583</a></span>
<span class="normal"><a href="#__codelineno-0-3584">3584</a></span>
<span class="normal"><a href="#__codelineno-0-3585">3585</a></span>
<span class="normal"><a href="#__codelineno-0-3586">3586</a></span>
<span class="normal"><a href="#__codelineno-0-3587">3587</a></span>
<span class="normal"><a href="#__codelineno-0-3588">3588</a></span>
<span class="normal"><a href="#__codelineno-0-3589">3589</a></span>
<span class="normal"><a href="#__codelineno-0-3590">3590</a></span>
<span class="normal"><a href="#__codelineno-0-3591">3591</a></span>
<span class="normal"><a href="#__codelineno-0-3592">3592</a></span>
<span class="normal"><a href="#__codelineno-0-3593">3593</a></span>
<span class="normal"><a href="#__codelineno-0-3594">3594</a></span>
<span class="normal"><a href="#__codelineno-0-3595">3595</a></span>
<span class="normal"><a href="#__codelineno-0-3596">3596</a></span>
<span class="normal"><a href="#__codelineno-0-3597">3597</a></span>
<span class="normal"><a href="#__codelineno-0-3598">3598</a></span>
<span class="normal"><a href="#__codelineno-0-3599">3599</a></span>
<span class="normal"><a href="#__codelineno-0-3600">3600</a></span>
<span class="normal"><a href="#__codelineno-0-3601">3601</a></span>
<span class="normal"><a href="#__codelineno-0-3602">3602</a></span>
<span class="normal"><a href="#__codelineno-0-3603">3603</a></span>
<span class="normal"><a href="#__codelineno-0-3604">3604</a></span>
<span class="normal"><a href="#__codelineno-0-3605">3605</a></span>
<span class="normal"><a href="#__codelineno-0-3606">3606</a></span>
<span class="normal"><a href="#__codelineno-0-3607">3607</a></span>
<span class="normal"><a href="#__codelineno-0-3608">3608</a></span>
<span class="normal"><a href="#__codelineno-0-3609">3609</a></span>
<span class="normal"><a href="#__codelineno-0-3610">3610</a></span>
<span class="normal"><a href="#__codelineno-0-3611">3611</a></span>
<span class="normal"><a href="#__codelineno-0-3612">3612</a></span>
<span class="normal"><a href="#__codelineno-0-3613">3613</a></span>
<span class="normal"><a href="#__codelineno-0-3614">3614</a></span>
<span class="normal"><a href="#__codelineno-0-3615">3615</a></span>
<span class="normal"><a href="#__codelineno-0-3616">3616</a></span>
<span class="normal"><a href="#__codelineno-0-3617">3617</a></span>
<span class="normal"><a href="#__codelineno-0-3618">3618</a></span>
<span class="normal"><a href="#__codelineno-0-3619">3619</a></span>
<span class="normal"><a href="#__codelineno-0-3620">3620</a></span>
<span class="normal"><a href="#__codelineno-0-3621">3621</a></span>
<span class="normal"><a href="#__codelineno-0-3622">3622</a></span>
<span class="normal"><a href="#__codelineno-0-3623">3623</a></span>
<span class="normal"><a href="#__codelineno-0-3624">3624</a></span>
<span class="normal"><a href="#__codelineno-0-3625">3625</a></span>
<span class="normal"><a href="#__codelineno-0-3626">3626</a></span>
<span class="normal"><a href="#__codelineno-0-3627">3627</a></span>
<span class="normal"><a href="#__codelineno-0-3628">3628</a></span>
<span class="normal"><a href="#__codelineno-0-3629">3629</a></span>
<span class="normal"><a href="#__codelineno-0-3630">3630</a></span>
<span class="normal"><a href="#__codelineno-0-3631">3631</a></span>
<span class="normal"><a href="#__codelineno-0-3632">3632</a></span>
<span class="normal"><a href="#__codelineno-0-3633">3633</a></span>
<span class="normal"><a href="#__codelineno-0-3634">3634</a></span>
<span class="normal"><a href="#__codelineno-0-3635">3635</a></span>
<span class="normal"><a href="#__codelineno-0-3636">3636</a></span>
<span class="normal"><a href="#__codelineno-0-3637">3637</a></span>
<span class="normal"><a href="#__codelineno-0-3638">3638</a></span>
<span class="normal"><a href="#__codelineno-0-3639">3639</a></span>
<span class="normal"><a href="#__codelineno-0-3640">3640</a></span>
<span class="normal"><a href="#__codelineno-0-3641">3641</a></span>
<span class="normal"><a href="#__codelineno-0-3642">3642</a></span>
<span class="normal"><a href="#__codelineno-0-3643">3643</a></span>
<span class="normal"><a href="#__codelineno-0-3644">3644</a></span>
<span class="normal"><a href="#__codelineno-0-3645">3645</a></span>
<span class="normal"><a href="#__codelineno-0-3646">3646</a></span>
<span class="normal"><a href="#__codelineno-0-3647">3647</a></span>
<span class="normal"><a href="#__codelineno-0-3648">3648</a></span>
<span class="normal"><a href="#__codelineno-0-3649">3649</a></span>
<span class="normal"><a href="#__codelineno-0-3650">3650</a></span>
<span class="normal"><a href="#__codelineno-0-3651">3651</a></span>
<span class="normal"><a href="#__codelineno-0-3652">3652</a></span>
<span class="normal"><a href="#__codelineno-0-3653">3653</a></span>
<span class="normal"><a href="#__codelineno-0-3654">3654</a></span>
<span class="normal"><a href="#__codelineno-0-3655">3655</a></span>
<span class="normal"><a href="#__codelineno-0-3656">3656</a></span>
<span class="normal"><a href="#__codelineno-0-3657">3657</a></span>
<span class="normal"><a href="#__codelineno-0-3658">3658</a></span>
<span class="normal"><a href="#__codelineno-0-3659">3659</a></span>
<span class="normal"><a href="#__codelineno-0-3660">3660</a></span>
<span class="normal"><a href="#__codelineno-0-3661">3661</a></span>
<span class="normal"><a href="#__codelineno-0-3662">3662</a></span>
<span class="normal"><a href="#__codelineno-0-3663">3663</a></span>
<span class="normal"><a href="#__codelineno-0-3664">3664</a></span>
<span class="normal"><a href="#__codelineno-0-3665">3665</a></span>
<span class="normal"><a href="#__codelineno-0-3666">3666</a></span>
<span class="normal"><a href="#__codelineno-0-3667">3667</a></span>
<span class="normal"><a href="#__codelineno-0-3668">3668</a></span>
<span class="normal"><a href="#__codelineno-0-3669">3669</a></span>
<span class="normal"><a href="#__codelineno-0-3670">3670</a></span>
<span class="normal"><a href="#__codelineno-0-3671">3671</a></span>
<span class="normal"><a href="#__codelineno-0-3672">3672</a></span>
<span class="normal"><a href="#__codelineno-0-3673">3673</a></span>
<span class="normal"><a href="#__codelineno-0-3674">3674</a></span>
<span class="normal"><a href="#__codelineno-0-3675">3675</a></span>
<span class="normal"><a href="#__codelineno-0-3676">3676</a></span>
<span class="normal"><a href="#__codelineno-0-3677">3677</a></span>
<span class="normal"><a href="#__codelineno-0-3678">3678</a></span>
<span class="normal"><a href="#__codelineno-0-3679">3679</a></span>
<span class="normal"><a href="#__codelineno-0-3680">3680</a></span>
<span class="normal"><a href="#__codelineno-0-3681">3681</a></span>
<span class="normal"><a href="#__codelineno-0-3682">3682</a></span>
<span class="normal"><a href="#__codelineno-0-3683">3683</a></span>
<span class="normal"><a href="#__codelineno-0-3684">3684</a></span>
<span class="normal"><a href="#__codelineno-0-3685">3685</a></span>
<span class="normal"><a href="#__codelineno-0-3686">3686</a></span>
<span class="normal"><a href="#__codelineno-0-3687">3687</a></span>
<span class="normal"><a href="#__codelineno-0-3688">3688</a></span>
<span class="normal"><a href="#__codelineno-0-3689">3689</a></span>
<span class="normal"><a href="#__codelineno-0-3690">3690</a></span>
<span class="normal"><a href="#__codelineno-0-3691">3691</a></span>
<span class="normal"><a href="#__codelineno-0-3692">3692</a></span>
<span class="normal"><a href="#__codelineno-0-3693">3693</a></span>
<span class="normal"><a href="#__codelineno-0-3694">3694</a></span>
<span class="normal"><a href="#__codelineno-0-3695">3695</a></span>
<span class="normal"><a href="#__codelineno-0-3696">3696</a></span>
<span class="normal"><a href="#__codelineno-0-3697">3697</a></span>
<span class="normal"><a href="#__codelineno-0-3698">3698</a></span>
<span class="normal"><a href="#__codelineno-0-3699">3699</a></span>
<span class="normal"><a href="#__codelineno-0-3700">3700</a></span>
<span class="normal"><a href="#__codelineno-0-3701">3701</a></span>
<span class="normal"><a href="#__codelineno-0-3702">3702</a></span>
<span class="normal"><a href="#__codelineno-0-3703">3703</a></span>
<span class="normal"><a href="#__codelineno-0-3704">3704</a></span>
<span class="normal"><a href="#__codelineno-0-3705">3705</a></span>
<span class="normal"><a href="#__codelineno-0-3706">3706</a></span>
<span class="normal"><a href="#__codelineno-0-3707">3707</a></span>
<span class="normal"><a href="#__codelineno-0-3708">3708</a></span>
<span class="normal"><a href="#__codelineno-0-3709">3709</a></span>
<span class="normal"><a href="#__codelineno-0-3710">3710</a></span>
<span class="normal"><a href="#__codelineno-0-3711">3711</a></span>
<span class="normal"><a href="#__codelineno-0-3712">3712</a></span>
<span class="normal"><a href="#__codelineno-0-3713">3713</a></span>
<span class="normal"><a href="#__codelineno-0-3714">3714</a></span>
<span class="normal"><a href="#__codelineno-0-3715">3715</a></span>
<span class="normal"><a href="#__codelineno-0-3716">3716</a></span>
<span class="normal"><a href="#__codelineno-0-3717">3717</a></span>
<span class="normal"><a href="#__codelineno-0-3718">3718</a></span>
<span class="normal"><a href="#__codelineno-0-3719">3719</a></span>
<span class="normal"><a href="#__codelineno-0-3720">3720</a></span>
<span class="normal"><a href="#__codelineno-0-3721">3721</a></span>
<span class="normal"><a href="#__codelineno-0-3722">3722</a></span>
<span class="normal"><a href="#__codelineno-0-3723">3723</a></span>
<span class="normal"><a href="#__codelineno-0-3724">3724</a></span>
<span class="normal"><a href="#__codelineno-0-3725">3725</a></span>
<span class="normal"><a href="#__codelineno-0-3726">3726</a></span>
<span class="normal"><a href="#__codelineno-0-3727">3727</a></span>
<span class="normal"><a href="#__codelineno-0-3728">3728</a></span>
<span class="normal"><a href="#__codelineno-0-3729">3729</a></span>
<span class="normal"><a href="#__codelineno-0-3730">3730</a></span>
<span class="normal"><a href="#__codelineno-0-3731">3731</a></span>
<span class="normal"><a href="#__codelineno-0-3732">3732</a></span>
<span class="normal"><a href="#__codelineno-0-3733">3733</a></span>
<span class="normal"><a href="#__codelineno-0-3734">3734</a></span>
<span class="normal"><a href="#__codelineno-0-3735">3735</a></span>
<span class="normal"><a href="#__codelineno-0-3736">3736</a></span>
<span class="normal"><a href="#__codelineno-0-3737">3737</a></span>
<span class="normal"><a href="#__codelineno-0-3738">3738</a></span>
<span class="normal"><a href="#__codelineno-0-3739">3739</a></span>
<span class="normal"><a href="#__codelineno-0-3740">3740</a></span>
<span class="normal"><a href="#__codelineno-0-3741">3741</a></span>
<span class="normal"><a href="#__codelineno-0-3742">3742</a></span>
<span class="normal"><a href="#__codelineno-0-3743">3743</a></span>
<span class="normal"><a href="#__codelineno-0-3744">3744</a></span>
<span class="normal"><a href="#__codelineno-0-3745">3745</a></span>
<span class="normal"><a href="#__codelineno-0-3746">3746</a></span>
<span class="normal"><a href="#__codelineno-0-3747">3747</a></span>
<span class="normal"><a href="#__codelineno-0-3748">3748</a></span>
<span class="normal"><a href="#__codelineno-0-3749">3749</a></span>
<span class="normal"><a href="#__codelineno-0-3750">3750</a></span>
<span class="normal"><a href="#__codelineno-0-3751">3751</a></span>
<span class="normal"><a href="#__codelineno-0-3752">3752</a></span>
<span class="normal"><a href="#__codelineno-0-3753">3753</a></span>
<span class="normal"><a href="#__codelineno-0-3754">3754</a></span>
<span class="normal"><a href="#__codelineno-0-3755">3755</a></span>
<span class="normal"><a href="#__codelineno-0-3756">3756</a></span>
<span class="normal"><a href="#__codelineno-0-3757">3757</a></span>
<span class="normal"><a href="#__codelineno-0-3758">3758</a></span>
<span class="normal"><a href="#__codelineno-0-3759">3759</a></span>
<span class="normal"><a href="#__codelineno-0-3760">3760</a></span>
<span class="normal"><a href="#__codelineno-0-3761">3761</a></span>
<span class="normal"><a href="#__codelineno-0-3762">3762</a></span>
<span class="normal"><a href="#__codelineno-0-3763">3763</a></span>
<span class="normal"><a href="#__codelineno-0-3764">3764</a></span>
<span class="normal"><a href="#__codelineno-0-3765">3765</a></span>
<span class="normal"><a href="#__codelineno-0-3766">3766</a></span>
<span class="normal"><a href="#__codelineno-0-3767">3767</a></span>
<span class="normal"><a href="#__codelineno-0-3768">3768</a></span>
<span class="normal"><a href="#__codelineno-0-3769">3769</a></span>
<span class="normal"><a href="#__codelineno-0-3770">3770</a></span>
<span class="normal"><a href="#__codelineno-0-3771">3771</a></span>
<span class="normal"><a href="#__codelineno-0-3772">3772</a></span>
<span class="normal"><a href="#__codelineno-0-3773">3773</a></span>
<span class="normal"><a href="#__codelineno-0-3774">3774</a></span>
<span class="normal"><a href="#__codelineno-0-3775">3775</a></span>
<span class="normal"><a href="#__codelineno-0-3776">3776</a></span>
<span class="normal"><a href="#__codelineno-0-3777">3777</a></span>
<span class="normal"><a href="#__codelineno-0-3778">3778</a></span>
<span class="normal"><a href="#__codelineno-0-3779">3779</a></span>
<span class="normal"><a href="#__codelineno-0-3780">3780</a></span>
<span class="normal"><a href="#__codelineno-0-3781">3781</a></span>
<span class="normal"><a href="#__codelineno-0-3782">3782</a></span>
<span class="normal"><a href="#__codelineno-0-3783">3783</a></span>
<span class="normal"><a href="#__codelineno-0-3784">3784</a></span>
<span class="normal"><a href="#__codelineno-0-3785">3785</a></span>
<span class="normal"><a href="#__codelineno-0-3786">3786</a></span>
<span class="normal"><a href="#__codelineno-0-3787">3787</a></span>
<span class="normal"><a href="#__codelineno-0-3788">3788</a></span>
<span class="normal"><a href="#__codelineno-0-3789">3789</a></span>
<span class="normal"><a href="#__codelineno-0-3790">3790</a></span>
<span class="normal"><a href="#__codelineno-0-3791">3791</a></span>
<span class="normal"><a href="#__codelineno-0-3792">3792</a></span>
<span class="normal"><a href="#__codelineno-0-3793">3793</a></span>
<span class="normal"><a href="#__codelineno-0-3794">3794</a></span>
<span class="normal"><a href="#__codelineno-0-3795">3795</a></span>
<span class="normal"><a href="#__codelineno-0-3796">3796</a></span>
<span class="normal"><a href="#__codelineno-0-3797">3797</a></span>
<span class="normal"><a href="#__codelineno-0-3798">3798</a></span>
<span class="normal"><a href="#__codelineno-0-3799">3799</a></span>
<span class="normal"><a href="#__codelineno-0-3800">3800</a></span>
<span class="normal"><a href="#__codelineno-0-3801">3801</a></span>
<span class="normal"><a href="#__codelineno-0-3802">3802</a></span>
<span class="normal"><a href="#__codelineno-0-3803">3803</a></span>
<span class="normal"><a href="#__codelineno-0-3804">3804</a></span>
<span class="normal"><a href="#__codelineno-0-3805">3805</a></span>
<span class="normal"><a href="#__codelineno-0-3806">3806</a></span>
<span class="normal"><a href="#__codelineno-0-3807">3807</a></span>
<span class="normal"><a href="#__codelineno-0-3808">3808</a></span>
<span class="normal"><a href="#__codelineno-0-3809">3809</a></span>
<span class="normal"><a href="#__codelineno-0-3810">3810</a></span>
<span class="normal"><a href="#__codelineno-0-3811">3811</a></span>
<span class="normal"><a href="#__codelineno-0-3812">3812</a></span>
<span class="normal"><a href="#__codelineno-0-3813">3813</a></span>
<span class="normal"><a href="#__codelineno-0-3814">3814</a></span>
<span class="normal"><a href="#__codelineno-0-3815">3815</a></span>
<span class="normal"><a href="#__codelineno-0-3816">3816</a></span>
<span class="normal"><a href="#__codelineno-0-3817">3817</a></span>
<span class="normal"><a href="#__codelineno-0-3818">3818</a></span>
<span class="normal"><a href="#__codelineno-0-3819">3819</a></span>
<span class="normal"><a href="#__codelineno-0-3820">3820</a></span>
<span class="normal"><a href="#__codelineno-0-3821">3821</a></span>
<span class="normal"><a href="#__codelineno-0-3822">3822</a></span>
<span class="normal"><a href="#__codelineno-0-3823">3823</a></span>
<span class="normal"><a href="#__codelineno-0-3824">3824</a></span>
<span class="normal"><a href="#__codelineno-0-3825">3825</a></span>
<span class="normal"><a href="#__codelineno-0-3826">3826</a></span>
<span class="normal"><a href="#__codelineno-0-3827">3827</a></span>
<span class="normal"><a href="#__codelineno-0-3828">3828</a></span>
<span class="normal"><a href="#__codelineno-0-3829">3829</a></span>
<span class="normal"><a href="#__codelineno-0-3830">3830</a></span>
<span class="normal"><a href="#__codelineno-0-3831">3831</a></span>
<span class="normal"><a href="#__codelineno-0-3832">3832</a></span>
<span class="normal"><a href="#__codelineno-0-3833">3833</a></span>
<span class="normal"><a href="#__codelineno-0-3834">3834</a></span>
<span class="normal"><a href="#__codelineno-0-3835">3835</a></span>
<span class="normal"><a href="#__codelineno-0-3836">3836</a></span>
<span class="normal"><a href="#__codelineno-0-3837">3837</a></span>
<span class="normal"><a href="#__codelineno-0-3838">3838</a></span>
<span class="normal"><a href="#__codelineno-0-3839">3839</a></span>
<span class="normal"><a href="#__codelineno-0-3840">3840</a></span>
<span class="normal"><a href="#__codelineno-0-3841">3841</a></span>
<span class="normal"><a href="#__codelineno-0-3842">3842</a></span>
<span class="normal"><a href="#__codelineno-0-3843">3843</a></span>
<span class="normal"><a href="#__codelineno-0-3844">3844</a></span>
<span class="normal"><a href="#__codelineno-0-3845">3845</a></span>
<span class="normal"><a href="#__codelineno-0-3846">3846</a></span>
<span class="normal"><a href="#__codelineno-0-3847">3847</a></span>
<span class="normal"><a href="#__codelineno-0-3848">3848</a></span>
<span class="normal"><a href="#__codelineno-0-3849">3849</a></span>
<span class="normal"><a href="#__codelineno-0-3850">3850</a></span>
<span class="normal"><a href="#__codelineno-0-3851">3851</a></span>
<span class="normal"><a href="#__codelineno-0-3852">3852</a></span>
<span class="normal"><a href="#__codelineno-0-3853">3853</a></span>
<span class="normal"><a href="#__codelineno-0-3854">3854</a></span>
<span class="normal"><a href="#__codelineno-0-3855">3855</a></span>
<span class="normal"><a href="#__codelineno-0-3856">3856</a></span>
<span class="normal"><a href="#__codelineno-0-3857">3857</a></span>
<span class="normal"><a href="#__codelineno-0-3858">3858</a></span>
<span class="normal"><a href="#__codelineno-0-3859">3859</a></span>
<span class="normal"><a href="#__codelineno-0-3860">3860</a></span>
<span class="normal"><a href="#__codelineno-0-3861">3861</a></span>
<span class="normal"><a href="#__codelineno-0-3862">3862</a></span>
<span class="normal"><a href="#__codelineno-0-3863">3863</a></span>
<span class="normal"><a href="#__codelineno-0-3864">3864</a></span>
<span class="normal"><a href="#__codelineno-0-3865">3865</a></span>
<span class="normal"><a href="#__codelineno-0-3866">3866</a></span>
<span class="normal"><a href="#__codelineno-0-3867">3867</a></span>
<span class="normal"><a href="#__codelineno-0-3868">3868</a></span>
<span class="normal"><a href="#__codelineno-0-3869">3869</a></span>
<span class="normal"><a href="#__codelineno-0-3870">3870</a></span>
<span class="normal"><a href="#__codelineno-0-3871">3871</a></span>
<span class="normal"><a href="#__codelineno-0-3872">3872</a></span>
<span class="normal"><a href="#__codelineno-0-3873">3873</a></span>
<span class="normal"><a href="#__codelineno-0-3874">3874</a></span>
<span class="normal"><a href="#__codelineno-0-3875">3875</a></span>
<span class="normal"><a href="#__codelineno-0-3876">3876</a></span>
<span class="normal"><a href="#__codelineno-0-3877">3877</a></span>
<span class="normal"><a href="#__codelineno-0-3878">3878</a></span>
<span class="normal"><a href="#__codelineno-0-3879">3879</a></span>
<span class="normal"><a href="#__codelineno-0-3880">3880</a></span>
<span class="normal"><a href="#__codelineno-0-3881">3881</a></span>
<span class="normal"><a href="#__codelineno-0-3882">3882</a></span>
<span class="normal"><a href="#__codelineno-0-3883">3883</a></span>
<span class="normal"><a href="#__codelineno-0-3884">3884</a></span>
<span class="normal"><a href="#__codelineno-0-3885">3885</a></span>
<span class="normal"><a href="#__codelineno-0-3886">3886</a></span>
<span class="normal"><a href="#__codelineno-0-3887">3887</a></span>
<span class="normal"><a href="#__codelineno-0-3888">3888</a></span>
<span class="normal"><a href="#__codelineno-0-3889">3889</a></span>
<span class="normal"><a href="#__codelineno-0-3890">3890</a></span>
<span class="normal"><a href="#__codelineno-0-3891">3891</a></span>
<span class="normal"><a href="#__codelineno-0-3892">3892</a></span>
<span class="normal"><a href="#__codelineno-0-3893">3893</a></span>
<span class="normal"><a href="#__codelineno-0-3894">3894</a></span>
<span class="normal"><a href="#__codelineno-0-3895">3895</a></span>
<span class="normal"><a href="#__codelineno-0-3896">3896</a></span>
<span class="normal"><a href="#__codelineno-0-3897">3897</a></span>
<span class="normal"><a href="#__codelineno-0-3898">3898</a></span>
<span class="normal"><a href="#__codelineno-0-3899">3899</a></span>
<span class="normal"><a href="#__codelineno-0-3900">3900</a></span>
<span class="normal"><a href="#__codelineno-0-3901">3901</a></span>
<span class="normal"><a href="#__codelineno-0-3902">3902</a></span>
<span class="normal"><a href="#__codelineno-0-3903">3903</a></span>
<span class="normal"><a href="#__codelineno-0-3904">3904</a></span>
<span class="normal"><a href="#__codelineno-0-3905">3905</a></span>
<span class="normal"><a href="#__codelineno-0-3906">3906</a></span>
<span class="normal"><a href="#__codelineno-0-3907">3907</a></span>
<span class="normal"><a href="#__codelineno-0-3908">3908</a></span>
<span class="normal"><a href="#__codelineno-0-3909">3909</a></span>
<span class="normal"><a href="#__codelineno-0-3910">3910</a></span>
<span class="normal"><a href="#__codelineno-0-3911">3911</a></span>
<span class="normal"><a href="#__codelineno-0-3912">3912</a></span>
<span class="normal"><a href="#__codelineno-0-3913">3913</a></span>
<span class="normal"><a href="#__codelineno-0-3914">3914</a></span>
<span class="normal"><a href="#__codelineno-0-3915">3915</a></span>
<span class="normal"><a href="#__codelineno-0-3916">3916</a></span>
<span class="normal"><a href="#__codelineno-0-3917">3917</a></span>
<span class="normal"><a href="#__codelineno-0-3918">3918</a></span>
<span class="normal"><a href="#__codelineno-0-3919">3919</a></span>
<span class="normal"><a href="#__codelineno-0-3920">3920</a></span>
<span class="normal"><a href="#__codelineno-0-3921">3921</a></span>
<span class="normal"><a href="#__codelineno-0-3922">3922</a></span>
<span class="normal"><a href="#__codelineno-0-3923">3923</a></span>
<span class="normal"><a href="#__codelineno-0-3924">3924</a></span>
<span class="normal"><a href="#__codelineno-0-3925">3925</a></span>
<span class="normal"><a href="#__codelineno-0-3926">3926</a></span>
<span class="normal"><a href="#__codelineno-0-3927">3927</a></span>
<span class="normal"><a href="#__codelineno-0-3928">3928</a></span>
<span class="normal"><a href="#__codelineno-0-3929">3929</a></span>
<span class="normal"><a href="#__codelineno-0-3930">3930</a></span>
<span class="normal"><a href="#__codelineno-0-3931">3931</a></span>
<span class="normal"><a href="#__codelineno-0-3932">3932</a></span>
<span class="normal"><a href="#__codelineno-0-3933">3933</a></span>
<span class="normal"><a href="#__codelineno-0-3934">3934</a></span>
<span class="normal"><a href="#__codelineno-0-3935">3935</a></span>
<span class="normal"><a href="#__codelineno-0-3936">3936</a></span>
<span class="normal"><a href="#__codelineno-0-3937">3937</a></span>
<span class="normal"><a href="#__codelineno-0-3938">3938</a></span>
<span class="normal"><a href="#__codelineno-0-3939">3939</a></span>
<span class="normal"><a href="#__codelineno-0-3940">3940</a></span>
<span class="normal"><a href="#__codelineno-0-3941">3941</a></span>
<span class="normal"><a href="#__codelineno-0-3942">3942</a></span>
<span class="normal"><a href="#__codelineno-0-3943">3943</a></span>
<span class="normal"><a href="#__codelineno-0-3944">3944</a></span>
<span class="normal"><a href="#__codelineno-0-3945">3945</a></span>
<span class="normal"><a href="#__codelineno-0-3946">3946</a></span>
<span class="normal"><a href="#__codelineno-0-3947">3947</a></span>
<span class="normal"><a href="#__codelineno-0-3948">3948</a></span>
<span class="normal"><a href="#__codelineno-0-3949">3949</a></span>
<span class="normal"><a href="#__codelineno-0-3950">3950</a></span>
<span class="normal"><a href="#__codelineno-0-3951">3951</a></span>
<span class="normal"><a href="#__codelineno-0-3952">3952</a></span>
<span class="normal"><a href="#__codelineno-0-3953">3953</a></span>
<span class="normal"><a href="#__codelineno-0-3954">3954</a></span>
<span class="normal"><a href="#__codelineno-0-3955">3955</a></span>
<span class="normal"><a href="#__codelineno-0-3956">3956</a></span>
<span class="normal"><a href="#__codelineno-0-3957">3957</a></span>
<span class="normal"><a href="#__codelineno-0-3958">3958</a></span>
<span class="normal"><a href="#__codelineno-0-3959">3959</a></span>
<span class="normal"><a href="#__codelineno-0-3960">3960</a></span>
<span class="normal"><a href="#__codelineno-0-3961">3961</a></span>
<span class="normal"><a href="#__codelineno-0-3962">3962</a></span>
<span class="normal"><a href="#__codelineno-0-3963">3963</a></span>
<span class="normal"><a href="#__codelineno-0-3964">3964</a></span>
<span class="normal"><a href="#__codelineno-0-3965">3965</a></span>
<span class="normal"><a href="#__codelineno-0-3966">3966</a></span>
<span class="normal"><a href="#__codelineno-0-3967">3967</a></span>
<span class="normal"><a href="#__codelineno-0-3968">3968</a></span>
<span class="normal"><a href="#__codelineno-0-3969">3969</a></span>
<span class="normal"><a href="#__codelineno-0-3970">3970</a></span>
<span class="normal"><a href="#__codelineno-0-3971">3971</a></span>
<span class="normal"><a href="#__codelineno-0-3972">3972</a></span>
<span class="normal"><a href="#__codelineno-0-3973">3973</a></span>
<span class="normal"><a href="#__codelineno-0-3974">3974</a></span>
<span class="normal"><a href="#__codelineno-0-3975">3975</a></span>
<span class="normal"><a href="#__codelineno-0-3976">3976</a></span>
<span class="normal"><a href="#__codelineno-0-3977">3977</a></span>
<span class="normal"><a href="#__codelineno-0-3978">3978</a></span>
<span class="normal"><a href="#__codelineno-0-3979">3979</a></span>
<span class="normal"><a href="#__codelineno-0-3980">3980</a></span>
<span class="normal"><a href="#__codelineno-0-3981">3981</a></span>
<span class="normal"><a href="#__codelineno-0-3982">3982</a></span>
<span class="normal"><a href="#__codelineno-0-3983">3983</a></span>
<span class="normal"><a href="#__codelineno-0-3984">3984</a></span>
<span class="normal"><a href="#__codelineno-0-3985">3985</a></span>
<span class="normal"><a href="#__codelineno-0-3986">3986</a></span>
<span class="normal"><a href="#__codelineno-0-3987">3987</a></span>
<span class="normal"><a href="#__codelineno-0-3988">3988</a></span>
<span class="normal"><a href="#__codelineno-0-3989">3989</a></span>
<span class="normal"><a href="#__codelineno-0-3990">3990</a></span>
<span class="normal"><a href="#__codelineno-0-3991">3991</a></span>
<span class="normal"><a href="#__codelineno-0-3992">3992</a></span>
<span class="normal"><a href="#__codelineno-0-3993">3993</a></span>
<span class="normal"><a href="#__codelineno-0-3994">3994</a></span>
<span class="normal"><a href="#__codelineno-0-3995">3995</a></span>
<span class="normal"><a href="#__codelineno-0-3996">3996</a></span>
<span class="normal"><a href="#__codelineno-0-3997">3997</a></span>
<span class="normal"><a href="#__codelineno-0-3998">3998</a></span>
<span class="normal"><a href="#__codelineno-0-3999">3999</a></span>
<span class="normal"><a href="#__codelineno-0-4000">4000</a></span>
<span class="normal"><a href="#__codelineno-0-4001">4001</a></span>
<span class="normal"><a href="#__codelineno-0-4002">4002</a></span>
<span class="normal"><a href="#__codelineno-0-4003">4003</a></span>
<span class="normal"><a href="#__codelineno-0-4004">4004</a></span>
<span class="normal"><a href="#__codelineno-0-4005">4005</a></span>
<span class="normal"><a href="#__codelineno-0-4006">4006</a></span>
<span class="normal"><a href="#__codelineno-0-4007">4007</a></span>
<span class="normal"><a href="#__codelineno-0-4008">4008</a></span>
<span class="normal"><a href="#__codelineno-0-4009">4009</a></span>
<span class="normal"><a href="#__codelineno-0-4010">4010</a></span>
<span class="normal"><a href="#__codelineno-0-4011">4011</a></span>
<span class="normal"><a href="#__codelineno-0-4012">4012</a></span>
<span class="normal"><a href="#__codelineno-0-4013">4013</a></span>
<span class="normal"><a href="#__codelineno-0-4014">4014</a></span>
<span class="normal"><a href="#__codelineno-0-4015">4015</a></span>
<span class="normal"><a href="#__codelineno-0-4016">4016</a></span>
<span class="normal"><a href="#__codelineno-0-4017">4017</a></span>
<span class="normal"><a href="#__codelineno-0-4018">4018</a></span>
<span class="normal"><a href="#__codelineno-0-4019">4019</a></span>
<span class="normal"><a href="#__codelineno-0-4020">4020</a></span>
<span class="normal"><a href="#__codelineno-0-4021">4021</a></span>
<span class="normal"><a href="#__codelineno-0-4022">4022</a></span>
<span class="normal"><a href="#__codelineno-0-4023">4023</a></span>
<span class="normal"><a href="#__codelineno-0-4024">4024</a></span>
<span class="normal"><a href="#__codelineno-0-4025">4025</a></span>
<span class="normal"><a href="#__codelineno-0-4026">4026</a></span>
<span class="normal"><a href="#__codelineno-0-4027">4027</a></span>
<span class="normal"><a href="#__codelineno-0-4028">4028</a></span>
<span class="normal"><a href="#__codelineno-0-4029">4029</a></span>
<span class="normal"><a href="#__codelineno-0-4030">4030</a></span>
<span class="normal"><a href="#__codelineno-0-4031">4031</a></span>
<span class="normal"><a href="#__codelineno-0-4032">4032</a></span>
<span class="normal"><a href="#__codelineno-0-4033">4033</a></span>
<span class="normal"><a href="#__codelineno-0-4034">4034</a></span>
<span class="normal"><a href="#__codelineno-0-4035">4035</a></span>
<span class="normal"><a href="#__codelineno-0-4036">4036</a></span>
<span class="normal"><a href="#__codelineno-0-4037">4037</a></span>
<span class="normal"><a href="#__codelineno-0-4038">4038</a></span>
<span class="normal"><a href="#__codelineno-0-4039">4039</a></span>
<span class="normal"><a href="#__codelineno-0-4040">4040</a></span>
<span class="normal"><a href="#__codelineno-0-4041">4041</a></span>
<span class="normal"><a href="#__codelineno-0-4042">4042</a></span>
<span class="normal"><a href="#__codelineno-0-4043">4043</a></span>
<span class="normal"><a href="#__codelineno-0-4044">4044</a></span>
<span class="normal"><a href="#__codelineno-0-4045">4045</a></span>
<span class="normal"><a href="#__codelineno-0-4046">4046</a></span>
<span class="normal"><a href="#__codelineno-0-4047">4047</a></span>
<span class="normal"><a href="#__codelineno-0-4048">4048</a></span>
<span class="normal"><a href="#__codelineno-0-4049">4049</a></span>
<span class="normal"><a href="#__codelineno-0-4050">4050</a></span>
<span class="normal"><a href="#__codelineno-0-4051">4051</a></span>
<span class="normal"><a href="#__codelineno-0-4052">4052</a></span>
<span class="normal"><a href="#__codelineno-0-4053">4053</a></span>
<span class="normal"><a href="#__codelineno-0-4054">4054</a></span>
<span class="normal"><a href="#__codelineno-0-4055">4055</a></span>
<span class="normal"><a href="#__codelineno-0-4056">4056</a></span>
<span class="normal"><a href="#__codelineno-0-4057">4057</a></span>
<span class="normal"><a href="#__codelineno-0-4058">4058</a></span>
<span class="normal"><a href="#__codelineno-0-4059">4059</a></span>
<span class="normal"><a href="#__codelineno-0-4060">4060</a></span>
<span class="normal"><a href="#__codelineno-0-4061">4061</a></span>
<span class="normal"><a href="#__codelineno-0-4062">4062</a></span>
<span class="normal"><a href="#__codelineno-0-4063">4063</a></span>
<span class="normal"><a href="#__codelineno-0-4064">4064</a></span>
<span class="normal"><a href="#__codelineno-0-4065">4065</a></span>
<span class="normal"><a href="#__codelineno-0-4066">4066</a></span>
<span class="normal"><a href="#__codelineno-0-4067">4067</a></span>
<span class="normal"><a href="#__codelineno-0-4068">4068</a></span>
<span class="normal"><a href="#__codelineno-0-4069">4069</a></span>
<span class="normal"><a href="#__codelineno-0-4070">4070</a></span>
<span class="normal"><a href="#__codelineno-0-4071">4071</a></span>
<span class="normal"><a href="#__codelineno-0-4072">4072</a></span>
<span class="normal"><a href="#__codelineno-0-4073">4073</a></span>
<span class="normal"><a href="#__codelineno-0-4074">4074</a></span>
<span class="normal"><a href="#__codelineno-0-4075">4075</a></span>
<span class="normal"><a href="#__codelineno-0-4076">4076</a></span>
<span class="normal"><a href="#__codelineno-0-4077">4077</a></span>
<span class="normal"><a href="#__codelineno-0-4078">4078</a></span>
<span class="normal"><a href="#__codelineno-0-4079">4079</a></span>
<span class="normal"><a href="#__codelineno-0-4080">4080</a></span>
<span class="normal"><a href="#__codelineno-0-4081">4081</a></span>
<span class="normal"><a href="#__codelineno-0-4082">4082</a></span>
<span class="normal"><a href="#__codelineno-0-4083">4083</a></span>
<span class="normal"><a href="#__codelineno-0-4084">4084</a></span>
<span class="normal"><a href="#__codelineno-0-4085">4085</a></span>
<span class="normal"><a href="#__codelineno-0-4086">4086</a></span>
<span class="normal"><a href="#__codelineno-0-4087">4087</a></span>
<span class="normal"><a href="#__codelineno-0-4088">4088</a></span>
<span class="normal"><a href="#__codelineno-0-4089">4089</a></span>
<span class="normal"><a href="#__codelineno-0-4090">4090</a></span>
<span class="normal"><a href="#__codelineno-0-4091">4091</a></span>
<span class="normal"><a href="#__codelineno-0-4092">4092</a></span>
<span class="normal"><a href="#__codelineno-0-4093">4093</a></span>
<span class="normal"><a href="#__codelineno-0-4094">4094</a></span>
<span class="normal"><a href="#__codelineno-0-4095">4095</a></span>
<span class="normal"><a href="#__codelineno-0-4096">4096</a></span>
<span class="normal"><a href="#__codelineno-0-4097">4097</a></span>
<span class="normal"><a href="#__codelineno-0-4098">4098</a></span>
<span class="normal"><a href="#__codelineno-0-4099">4099</a></span>
<span class="normal"><a href="#__codelineno-0-4100">4100</a></span>
<span class="normal"><a href="#__codelineno-0-4101">4101</a></span>
<span class="normal"><a href="#__codelineno-0-4102">4102</a></span>
<span class="normal"><a href="#__codelineno-0-4103">4103</a></span>
<span class="normal"><a href="#__codelineno-0-4104">4104</a></span>
<span class="normal"><a href="#__codelineno-0-4105">4105</a></span>
<span class="normal"><a href="#__codelineno-0-4106">4106</a></span>
<span class="normal"><a href="#__codelineno-0-4107">4107</a></span>
<span class="normal"><a href="#__codelineno-0-4108">4108</a></span>
<span class="normal"><a href="#__codelineno-0-4109">4109</a></span>
<span class="normal"><a href="#__codelineno-0-4110">4110</a></span>
<span class="normal"><a href="#__codelineno-0-4111">4111</a></span>
<span class="normal"><a href="#__codelineno-0-4112">4112</a></span>
<span class="normal"><a href="#__codelineno-0-4113">4113</a></span>
<span class="normal"><a href="#__codelineno-0-4114">4114</a></span>
<span class="normal"><a href="#__codelineno-0-4115">4115</a></span>
<span class="normal"><a href="#__codelineno-0-4116">4116</a></span>
<span class="normal"><a href="#__codelineno-0-4117">4117</a></span>
<span class="normal"><a href="#__codelineno-0-4118">4118</a></span>
<span class="normal"><a href="#__codelineno-0-4119">4119</a></span>
<span class="normal"><a href="#__codelineno-0-4120">4120</a></span>
<span class="normal"><a href="#__codelineno-0-4121">4121</a></span>
<span class="normal"><a href="#__codelineno-0-4122">4122</a></span>
<span class="normal"><a href="#__codelineno-0-4123">4123</a></span>
<span class="normal"><a href="#__codelineno-0-4124">4124</a></span>
<span class="normal"><a href="#__codelineno-0-4125">4125</a></span>
<span class="normal"><a href="#__codelineno-0-4126">4126</a></span>
<span class="normal"><a href="#__codelineno-0-4127">4127</a></span>
<span class="normal"><a href="#__codelineno-0-4128">4128</a></span>
<span class="normal"><a href="#__codelineno-0-4129">4129</a></span>
<span class="normal"><a href="#__codelineno-0-4130">4130</a></span>
<span class="normal"><a href="#__codelineno-0-4131">4131</a></span>
<span class="normal"><a href="#__codelineno-0-4132">4132</a></span>
<span class="normal"><a href="#__codelineno-0-4133">4133</a></span>
<span class="normal"><a href="#__codelineno-0-4134">4134</a></span>
<span class="normal"><a href="#__codelineno-0-4135">4135</a></span>
<span class="normal"><a href="#__codelineno-0-4136">4136</a></span>
<span class="normal"><a href="#__codelineno-0-4137">4137</a></span>
<span class="normal"><a href="#__codelineno-0-4138">4138</a></span>
<span class="normal"><a href="#__codelineno-0-4139">4139</a></span>
<span class="normal"><a href="#__codelineno-0-4140">4140</a></span>
<span class="normal"><a href="#__codelineno-0-4141">4141</a></span>
<span class="normal"><a href="#__codelineno-0-4142">4142</a></span>
<span class="normal"><a href="#__codelineno-0-4143">4143</a></span>
<span class="normal"><a href="#__codelineno-0-4144">4144</a></span>
<span class="normal"><a href="#__codelineno-0-4145">4145</a></span>
<span class="normal"><a href="#__codelineno-0-4146">4146</a></span>
<span class="normal"><a href="#__codelineno-0-4147">4147</a></span>
<span class="normal"><a href="#__codelineno-0-4148">4148</a></span>
<span class="normal"><a href="#__codelineno-0-4149">4149</a></span>
<span class="normal"><a href="#__codelineno-0-4150">4150</a></span>
<span class="normal"><a href="#__codelineno-0-4151">4151</a></span>
<span class="normal"><a href="#__codelineno-0-4152">4152</a></span>
<span class="normal"><a href="#__codelineno-0-4153">4153</a></span>
<span class="normal"><a href="#__codelineno-0-4154">4154</a></span>
<span class="normal"><a href="#__codelineno-0-4155">4155</a></span>
<span class="normal"><a href="#__codelineno-0-4156">4156</a></span>
<span class="normal"><a href="#__codelineno-0-4157">4157</a></span>
<span class="normal"><a href="#__codelineno-0-4158">4158</a></span>
<span class="normal"><a href="#__codelineno-0-4159">4159</a></span>
<span class="normal"><a href="#__codelineno-0-4160">4160</a></span>
<span class="normal"><a href="#__codelineno-0-4161">4161</a></span>
<span class="normal"><a href="#__codelineno-0-4162">4162</a></span>
<span class="normal"><a href="#__codelineno-0-4163">4163</a></span>
<span class="normal"><a href="#__codelineno-0-4164">4164</a></span>
<span class="normal"><a href="#__codelineno-0-4165">4165</a></span>
<span class="normal"><a href="#__codelineno-0-4166">4166</a></span>
<span class="normal"><a href="#__codelineno-0-4167">4167</a></span>
<span class="normal"><a href="#__codelineno-0-4168">4168</a></span>
<span class="normal"><a href="#__codelineno-0-4169">4169</a></span>
<span class="normal"><a href="#__codelineno-0-4170">4170</a></span>
<span class="normal"><a href="#__codelineno-0-4171">4171</a></span>
<span class="normal"><a href="#__codelineno-0-4172">4172</a></span>
<span class="normal"><a href="#__codelineno-0-4173">4173</a></span>
<span class="normal"><a href="#__codelineno-0-4174">4174</a></span>
<span class="normal"><a href="#__codelineno-0-4175">4175</a></span>
<span class="normal"><a href="#__codelineno-0-4176">4176</a></span>
<span class="normal"><a href="#__codelineno-0-4177">4177</a></span>
<span class="normal"><a href="#__codelineno-0-4178">4178</a></span>
<span class="normal"><a href="#__codelineno-0-4179">4179</a></span>
<span class="normal"><a href="#__codelineno-0-4180">4180</a></span>
<span class="normal"><a href="#__codelineno-0-4181">4181</a></span>
<span class="normal"><a href="#__codelineno-0-4182">4182</a></span>
<span class="normal"><a href="#__codelineno-0-4183">4183</a></span>
<span class="normal"><a href="#__codelineno-0-4184">4184</a></span>
<span class="normal"><a href="#__codelineno-0-4185">4185</a></span>
<span class="normal"><a href="#__codelineno-0-4186">4186</a></span>
<span class="normal"><a href="#__codelineno-0-4187">4187</a></span>
<span class="normal"><a href="#__codelineno-0-4188">4188</a></span>
<span class="normal"><a href="#__codelineno-0-4189">4189</a></span>
<span class="normal"><a href="#__codelineno-0-4190">4190</a></span>
<span class="normal"><a href="#__codelineno-0-4191">4191</a></span>
<span class="normal"><a href="#__codelineno-0-4192">4192</a></span>
<span class="normal"><a href="#__codelineno-0-4193">4193</a></span>
<span class="normal"><a href="#__codelineno-0-4194">4194</a></span>
<span class="normal"><a href="#__codelineno-0-4195">4195</a></span>
<span class="normal"><a href="#__codelineno-0-4196">4196</a></span>
<span class="normal"><a href="#__codelineno-0-4197">4197</a></span>
<span class="normal"><a href="#__codelineno-0-4198">4198</a></span>
<span class="normal"><a href="#__codelineno-0-4199">4199</a></span>
<span class="normal"><a href="#__codelineno-0-4200">4200</a></span>
<span class="normal"><a href="#__codelineno-0-4201">4201</a></span>
<span class="normal"><a href="#__codelineno-0-4202">4202</a></span>
<span class="normal"><a href="#__codelineno-0-4203">4203</a></span>
<span class="normal"><a href="#__codelineno-0-4204">4204</a></span>
<span class="normal"><a href="#__codelineno-0-4205">4205</a></span>
<span class="normal"><a href="#__codelineno-0-4206">4206</a></span>
<span class="normal"><a href="#__codelineno-0-4207">4207</a></span>
<span class="normal"><a href="#__codelineno-0-4208">4208</a></span>
<span class="normal"><a href="#__codelineno-0-4209">4209</a></span>
<span class="normal"><a href="#__codelineno-0-4210">4210</a></span>
<span class="normal"><a href="#__codelineno-0-4211">4211</a></span>
<span class="normal"><a href="#__codelineno-0-4212">4212</a></span>
<span class="normal"><a href="#__codelineno-0-4213">4213</a></span>
<span class="normal"><a href="#__codelineno-0-4214">4214</a></span>
<span class="normal"><a href="#__codelineno-0-4215">4215</a></span>
<span class="normal"><a href="#__codelineno-0-4216">4216</a></span>
<span class="normal"><a href="#__codelineno-0-4217">4217</a></span>
<span class="normal"><a href="#__codelineno-0-4218">4218</a></span>
<span class="normal"><a href="#__codelineno-0-4219">4219</a></span>
<span class="normal"><a href="#__codelineno-0-4220">4220</a></span>
<span class="normal"><a href="#__codelineno-0-4221">4221</a></span>
<span class="normal"><a href="#__codelineno-0-4222">4222</a></span>
<span class="normal"><a href="#__codelineno-0-4223">4223</a></span>
<span class="normal"><a href="#__codelineno-0-4224">4224</a></span>
<span class="normal"><a href="#__codelineno-0-4225">4225</a></span>
<span class="normal"><a href="#__codelineno-0-4226">4226</a></span>
<span class="normal"><a href="#__codelineno-0-4227">4227</a></span>
<span class="normal"><a href="#__codelineno-0-4228">4228</a></span>
<span class="normal"><a href="#__codelineno-0-4229">4229</a></span>
<span class="normal"><a href="#__codelineno-0-4230">4230</a></span>
<span class="normal"><a href="#__codelineno-0-4231">4231</a></span>
<span class="normal"><a href="#__codelineno-0-4232">4232</a></span>
<span class="normal"><a href="#__codelineno-0-4233">4233</a></span>
<span class="normal"><a href="#__codelineno-0-4234">4234</a></span>
<span class="normal"><a href="#__codelineno-0-4235">4235</a></span>
<span class="normal"><a href="#__codelineno-0-4236">4236</a></span>
<span class="normal"><a href="#__codelineno-0-4237">4237</a></span>
<span class="normal"><a href="#__codelineno-0-4238">4238</a></span>
<span class="normal"><a href="#__codelineno-0-4239">4239</a></span>
<span class="normal"><a href="#__codelineno-0-4240">4240</a></span>
<span class="normal"><a href="#__codelineno-0-4241">4241</a></span>
<span class="normal"><a href="#__codelineno-0-4242">4242</a></span>
<span class="normal"><a href="#__codelineno-0-4243">4243</a></span>
<span class="normal"><a href="#__codelineno-0-4244">4244</a></span>
<span class="normal"><a href="#__codelineno-0-4245">4245</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="k">class</span><span class="w"> </span><span class="nc">qi2labDataStore</span><span class="p">:</span>
</span><span id="__span-0-34"><a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="w">    </span><span class="sd">"""API to qi2lab MERFISH store.</span>
</span><span id="__span-0-35"><a id="__codelineno-0-35" name="__codelineno-0-35"></a>
</span><span id="__span-0-36"><a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-37"><a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    ----------</span>
</span><span id="__span-0-38"><a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">    datastore_path : Union[str, Path]</span>
</span><span id="__span-0-39"><a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">        Path to qi2lab MERFISH store</span>
</span><span id="__span-0-40"><a id="__codelineno-0-40" name="__codelineno-0-40"></a>
</span><span id="__span-0-41"><a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    """</span>
</span><span id="__span-0-42"><a id="__codelineno-0-42" name="__codelineno-0-42"></a>
</span><span id="__span-0-43"><a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">datastore_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Path</span><span class="p">]):</span>
</span><span id="__span-0-44"><a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="n">compressor</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-45"><a id="__codelineno-0-45" name="__codelineno-0-45"></a>            <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"blosc"</span><span class="p">,</span>
</span><span id="__span-0-46"><a id="__codelineno-0-46" name="__codelineno-0-46"></a>            <span class="s2">"cname"</span><span class="p">:</span> <span class="s2">"zstd"</span><span class="p">,</span>
</span><span id="__span-0-47"><a id="__codelineno-0-47" name="__codelineno-0-47"></a>            <span class="s2">"clevel"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="__span-0-48"><a id="__codelineno-0-48" name="__codelineno-0-48"></a>            <span class="s2">"shuffle"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="__span-0-49"><a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="p">}</span>
</span><span id="__span-0-50"><a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-51"><a id="__codelineno-0-51" name="__codelineno-0-51"></a>            <span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"zarr"</span><span class="p">,</span>
</span><span id="__span-0-52"><a id="__codelineno-0-52" name="__codelineno-0-52"></a>            <span class="s2">"kvstore"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-53"><a id="__codelineno-0-53" name="__codelineno-0-53"></a>            <span class="s2">"metadata"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"compressor"</span><span class="p">:</span> <span class="n">compressor</span><span class="p">},</span>
</span><span id="__span-0-54"><a id="__codelineno-0-54" name="__codelineno-0-54"></a>            <span class="s2">"open"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-55"><a id="__codelineno-0-55" name="__codelineno-0-55"></a>            <span class="s2">"assume_metadata"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-56"><a id="__codelineno-0-56" name="__codelineno-0-56"></a>            <span class="s2">"create"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-57"><a id="__codelineno-0-57" name="__codelineno-0-57"></a>            <span class="s2">"delete_existing"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-58"><a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="p">}</span>
</span><span id="__span-0-59"><a id="__codelineno-0-59" name="__codelineno-0-59"></a>
</span><span id="__span-0-60"><a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">datastore_path</span><span class="p">)</span>
</span><span id="__span-0-61"><a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-62"><a id="__codelineno-0-62" name="__codelineno-0-62"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_parse_datastore</span><span class="p">()</span>
</span><span id="__span-0-63"><a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-64"><a id="__codelineno-0-64" name="__codelineno-0-64"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_init_datastore</span><span class="p">()</span>
</span><span id="__span-0-65"><a id="__codelineno-0-65" name="__codelineno-0-65"></a>
</span><span id="__span-0-66"><a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="nd">@property</span>
</span><span id="__span-0-67"><a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">datastore_state</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="__span-0-68"><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="w">        </span><span class="sd">"""Datastore state.</span>
</span><span id="__span-0-69"><a id="__codelineno-0-69" name="__codelineno-0-69"></a>
</span><span id="__span-0-70"><a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="sd">        Returns</span>
</span><span id="__span-0-71"><a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">        -------</span>
</span><span id="__span-0-72"><a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">        datastore_state : Optional[dict]</span>
</span><span id="__span-0-73"><a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">            Datastore state.</span>
</span><span id="__span-0-74"><a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        """</span>
</span><span id="__span-0-75"><a id="__codelineno-0-75" name="__codelineno-0-75"></a>
</span><span id="__span-0-76"><a id="__codelineno-0-76" name="__codelineno-0-76"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_datastore_state"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-77"><a id="__codelineno-0-77" name="__codelineno-0-77"></a>
</span><span id="__span-0-78"><a id="__codelineno-0-78" name="__codelineno-0-78"></a>    <span class="nd">@datastore_state</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-79"><a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">datastore_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="__span-0-80"><a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="w">        </span><span class="sd">"""Set the datastore state.</span>
</span><span id="__span-0-81"><a id="__codelineno-0-81" name="__codelineno-0-81"></a>
</span><span id="__span-0-82"><a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-83"><a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        ----------</span>
</span><span id="__span-0-84"><a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        value : dict</span>
</span><span id="__span-0-85"><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            New datastore state.</span>
</span><span id="__span-0-86"><a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        """</span>
</span><span id="__span-0-87"><a id="__codelineno-0-87" name="__codelineno-0-87"></a>
</span><span id="__span-0-88"><a id="__codelineno-0-88" name="__codelineno-0-88"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_datastore_state"</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-89"><a id="__codelineno-0-89" name="__codelineno-0-89"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-90"><a id="__codelineno-0-90" name="__codelineno-0-90"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-91"><a id="__codelineno-0-91" name="__codelineno-0-91"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="__span-0-92"><a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state_json_path</span><span class="p">)</span>
</span><span id="__span-0-93"><a id="__codelineno-0-93" name="__codelineno-0-93"></a>
</span><span id="__span-0-94"><a id="__codelineno-0-94" name="__codelineno-0-94"></a>    <span class="nd">@property</span>
</span><span id="__span-0-95"><a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">microscope_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-0-96"><a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="w">        </span><span class="sd">"""Microscope type.</span>
</span><span id="__span-0-97"><a id="__codelineno-0-97" name="__codelineno-0-97"></a>
</span><span id="__span-0-98"><a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">        Returns</span>
</span><span id="__span-0-99"><a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        -------</span>
</span><span id="__span-0-100"><a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">        microscope_type : Optional[str]</span>
</span><span id="__span-0-101"><a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">            Microscope type.</span>
</span><span id="__span-0-102"><a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        """</span>
</span><span id="__span-0-103"><a id="__codelineno-0-103" name="__codelineno-0-103"></a>
</span><span id="__span-0-104"><a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_microscope_type"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-105"><a id="__codelineno-0-105" name="__codelineno-0-105"></a>
</span><span id="__span-0-106"><a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="nd">@microscope_type</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-107"><a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">microscope_type</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-108"><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="w">        </span><span class="sd">"""Set the microscope type.</span>
</span><span id="__span-0-109"><a id="__codelineno-0-109" name="__codelineno-0-109"></a>
</span><span id="__span-0-110"><a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-111"><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">        ----------</span>
</span><span id="__span-0-112"><a id="__codelineno-0-112" name="__codelineno-0-112"></a><span class="sd">        value : str</span>
</span><span id="__span-0-113"><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">            New microscope type.</span>
</span><span id="__span-0-114"><a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        """</span>
</span><span id="__span-0-115"><a id="__codelineno-0-115" name="__codelineno-0-115"></a>
</span><span id="__span-0-116"><a id="__codelineno-0-116" name="__codelineno-0-116"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_microscope_type</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-117"><a id="__codelineno-0-117" name="__codelineno-0-117"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-118"><a id="__codelineno-0-118" name="__codelineno-0-118"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-119"><a id="__codelineno-0-119" name="__codelineno-0-119"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"microscope_type"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-120"><a id="__codelineno-0-120" name="__codelineno-0-120"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-121"><a id="__codelineno-0-121" name="__codelineno-0-121"></a>
</span><span id="__span-0-122"><a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="nd">@property</span>
</span><span id="__span-0-123"><a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">camera_model</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-0-124"><a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="w">        </span><span class="sd">"""Camera model.</span>
</span><span id="__span-0-125"><a id="__codelineno-0-125" name="__codelineno-0-125"></a>
</span><span id="__span-0-126"><a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">        Returns</span>
</span><span id="__span-0-127"><a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">        -------</span>
</span><span id="__span-0-128"><a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">        camera_model : Optional[str]</span>
</span><span id="__span-0-129"><a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">            Camera model.</span>
</span><span id="__span-0-130"><a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        """</span>
</span><span id="__span-0-131"><a id="__codelineno-0-131" name="__codelineno-0-131"></a>
</span><span id="__span-0-132"><a id="__codelineno-0-132" name="__codelineno-0-132"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_camera_model"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-133"><a id="__codelineno-0-133" name="__codelineno-0-133"></a>
</span><span id="__span-0-134"><a id="__codelineno-0-134" name="__codelineno-0-134"></a>    <span class="nd">@camera_model</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-135"><a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">camera_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-136"><a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="w">        </span><span class="sd">"""Set the camera model.</span>
</span><span id="__span-0-137"><a id="__codelineno-0-137" name="__codelineno-0-137"></a>
</span><span id="__span-0-138"><a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-139"><a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">        ----------</span>
</span><span id="__span-0-140"><a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        value : str</span>
</span><span id="__span-0-141"><a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">            New camera model.</span>
</span><span id="__span-0-142"><a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">        """</span>
</span><span id="__span-0-143"><a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_camera_model</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-144"><a id="__codelineno-0-144" name="__codelineno-0-144"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-145"><a id="__codelineno-0-145" name="__codelineno-0-145"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-146"><a id="__codelineno-0-146" name="__codelineno-0-146"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"camera_model"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-147"><a id="__codelineno-0-147" name="__codelineno-0-147"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-148"><a id="__codelineno-0-148" name="__codelineno-0-148"></a>
</span><span id="__span-0-149"><a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="nd">@property</span>
</span><span id="__span-0-150"><a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">num_rounds</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="__span-0-151"><a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="w">        </span><span class="sd">"""Number of rounds.</span>
</span><span id="__span-0-152"><a id="__codelineno-0-152" name="__codelineno-0-152"></a>
</span><span id="__span-0-153"><a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        Returns</span>
</span><span id="__span-0-154"><a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        -------</span>
</span><span id="__span-0-155"><a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        num_rounds : int</span>
</span><span id="__span-0-156"><a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">            Number of rounds.</span>
</span><span id="__span-0-157"><a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        """</span>
</span><span id="__span-0-158"><a id="__codelineno-0-158" name="__codelineno-0-158"></a>
</span><span id="__span-0-159"><a id="__codelineno-0-159" name="__codelineno-0-159"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_num_rounds"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-160"><a id="__codelineno-0-160" name="__codelineno-0-160"></a>
</span><span id="__span-0-161"><a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="nd">@num_rounds</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-162"><a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">num_rounds</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-163"><a id="__codelineno-0-163" name="__codelineno-0-163"></a><span class="w">        </span><span class="sd">"""Set the number of rounds.</span>
</span><span id="__span-0-164"><a id="__codelineno-0-164" name="__codelineno-0-164"></a>
</span><span id="__span-0-165"><a id="__codelineno-0-165" name="__codelineno-0-165"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-166"><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="sd">        ----------</span>
</span><span id="__span-0-167"><a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="sd">        value : int</span>
</span><span id="__span-0-168"><a id="__codelineno-0-168" name="__codelineno-0-168"></a><span class="sd">            New number of rounds.</span>
</span><span id="__span-0-169"><a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">        """</span>
</span><span id="__span-0-170"><a id="__codelineno-0-170" name="__codelineno-0-170"></a>
</span><span id="__span-0-171"><a id="__codelineno-0-171" name="__codelineno-0-171"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-172"><a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-173"><a id="__codelineno-0-173" name="__codelineno-0-173"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-174"><a id="__codelineno-0-174" name="__codelineno-0-174"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"num_rounds"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-175"><a id="__codelineno-0-175" name="__codelineno-0-175"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-176"><a id="__codelineno-0-176" name="__codelineno-0-176"></a>
</span><span id="__span-0-177"><a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="nd">@property</span>
</span><span id="__span-0-178"><a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">num_bits</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-179"><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="w">        </span><span class="sd">"""Number of bits.</span>
</span><span id="__span-0-180"><a id="__codelineno-0-180" name="__codelineno-0-180"></a>
</span><span id="__span-0-181"><a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        Returns</span>
</span><span id="__span-0-182"><a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        -------</span>
</span><span id="__span-0-183"><a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        num_bits : int</span>
</span><span id="__span-0-184"><a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">            Number of bits.</span>
</span><span id="__span-0-185"><a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        """</span>
</span><span id="__span-0-186"><a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_num_bits"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-187"><a id="__codelineno-0-187" name="__codelineno-0-187"></a>
</span><span id="__span-0-188"><a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="nd">@num_bits</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-189"><a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">num_bits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-190"><a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="w">        </span><span class="sd">"""Set the number of bits.</span>
</span><span id="__span-0-191"><a id="__codelineno-0-191" name="__codelineno-0-191"></a>
</span><span id="__span-0-192"><a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-193"><a id="__codelineno-0-193" name="__codelineno-0-193"></a><span class="sd">        -------</span>
</span><span id="__span-0-194"><a id="__codelineno-0-194" name="__codelineno-0-194"></a><span class="sd">        num_bits : int</span>
</span><span id="__span-0-195"><a id="__codelineno-0-195" name="__codelineno-0-195"></a><span class="sd">            Number of bits.</span>
</span><span id="__span-0-196"><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="sd">        """</span>
</span><span id="__span-0-197"><a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_bits</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-198"><a id="__codelineno-0-198" name="__codelineno-0-198"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-199"><a id="__codelineno-0-199" name="__codelineno-0-199"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-200"><a id="__codelineno-0-200" name="__codelineno-0-200"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"num_bits"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-201"><a id="__codelineno-0-201" name="__codelineno-0-201"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-202"><a id="__codelineno-0-202" name="__codelineno-0-202"></a>
</span><span id="__span-0-203"><a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="nd">@property</span>
</span><span id="__span-0-204"><a id="__codelineno-0-204" name="__codelineno-0-204"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">num_tiles</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="__span-0-205"><a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="w">        </span><span class="sd">"""Number of tiles.</span>
</span><span id="__span-0-206"><a id="__codelineno-0-206" name="__codelineno-0-206"></a>
</span><span id="__span-0-207"><a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="sd">        Returns</span>
</span><span id="__span-0-208"><a id="__codelineno-0-208" name="__codelineno-0-208"></a><span class="sd">        -------</span>
</span><span id="__span-0-209"><a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="sd">        num_tiles : int</span>
</span><span id="__span-0-210"><a id="__codelineno-0-210" name="__codelineno-0-210"></a><span class="sd">            Number of tiles.</span>
</span><span id="__span-0-211"><a id="__codelineno-0-211" name="__codelineno-0-211"></a><span class="sd">        """</span>
</span><span id="__span-0-212"><a id="__codelineno-0-212" name="__codelineno-0-212"></a>
</span><span id="__span-0-213"><a id="__codelineno-0-213" name="__codelineno-0-213"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_num_tiles"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-214"><a id="__codelineno-0-214" name="__codelineno-0-214"></a>
</span><span id="__span-0-215"><a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="nd">@num_tiles</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-216"><a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">num_tiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-217"><a id="__codelineno-0-217" name="__codelineno-0-217"></a><span class="w">        </span><span class="sd">"""Set the number of tiles.</span>
</span><span id="__span-0-218"><a id="__codelineno-0-218" name="__codelineno-0-218"></a>
</span><span id="__span-0-219"><a id="__codelineno-0-219" name="__codelineno-0-219"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-220"><a id="__codelineno-0-220" name="__codelineno-0-220"></a><span class="sd">        ----------</span>
</span><span id="__span-0-221"><a id="__codelineno-0-221" name="__codelineno-0-221"></a><span class="sd">        value : int</span>
</span><span id="__span-0-222"><a id="__codelineno-0-222" name="__codelineno-0-222"></a><span class="sd">            New number of tiles.</span>
</span><span id="__span-0-223"><a id="__codelineno-0-223" name="__codelineno-0-223"></a><span class="sd">        """</span>
</span><span id="__span-0-224"><a id="__codelineno-0-224" name="__codelineno-0-224"></a>
</span><span id="__span-0-225"><a id="__codelineno-0-225" name="__codelineno-0-225"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-226"><a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-227"><a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-228"><a id="__codelineno-0-228" name="__codelineno-0-228"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"num_tiles"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-229"><a id="__codelineno-0-229" name="__codelineno-0-229"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-230"><a id="__codelineno-0-230" name="__codelineno-0-230"></a>
</span><span id="__span-0-231"><a id="__codelineno-0-231" name="__codelineno-0-231"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-232"><a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="k">for</span> <span class="n">tile_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
</span><span id="__span-0-233"><a id="__codelineno-0-233" name="__codelineno-0-233"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"tile"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">tile_idx</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">4</span><span class="p">))</span>
</span><span id="__span-0-234"><a id="__codelineno-0-234" name="__codelineno-0-234"></a>
</span><span id="__span-0-235"><a id="__codelineno-0-235" name="__codelineno-0-235"></a>    <span class="nd">@property</span>
</span><span id="__span-0-236"><a id="__codelineno-0-236" name="__codelineno-0-236"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">channels_in_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
</span><span id="__span-0-237"><a id="__codelineno-0-237" name="__codelineno-0-237"></a><span class="w">        </span><span class="sd">"""Channel indices.</span>
</span><span id="__span-0-238"><a id="__codelineno-0-238" name="__codelineno-0-238"></a>
</span><span id="__span-0-239"><a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        Returns</span>
</span><span id="__span-0-240"><a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">        -------</span>
</span><span id="__span-0-241"><a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">        channels_in_data : Collection[int]</span>
</span><span id="__span-0-242"><a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="sd">            Channel indices.</span>
</span><span id="__span-0-243"><a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">        """</span>
</span><span id="__span-0-244"><a id="__codelineno-0-244" name="__codelineno-0-244"></a>
</span><span id="__span-0-245"><a id="__codelineno-0-245" name="__codelineno-0-245"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_channels_in_data"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-246"><a id="__codelineno-0-246" name="__codelineno-0-246"></a>
</span><span id="__span-0-247"><a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="nd">@channels_in_data</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-248"><a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">channels_in_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Collection</span><span class="p">[</span><span class="nb">int</span><span class="p">]):</span>
</span><span id="__span-0-249"><a id="__codelineno-0-249" name="__codelineno-0-249"></a><span class="w">        </span><span class="sd">"""Set the channels in the data.</span>
</span><span id="__span-0-250"><a id="__codelineno-0-250" name="__codelineno-0-250"></a>
</span><span id="__span-0-251"><a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-252"><a id="__codelineno-0-252" name="__codelineno-0-252"></a><span class="sd">        ----------</span>
</span><span id="__span-0-253"><a id="__codelineno-0-253" name="__codelineno-0-253"></a><span class="sd">        value : Collection[int]</span>
</span><span id="__span-0-254"><a id="__codelineno-0-254" name="__codelineno-0-254"></a><span class="sd">            New channels in data (int values starting from zero).</span>
</span><span id="__span-0-255"><a id="__codelineno-0-255" name="__codelineno-0-255"></a><span class="sd">        """</span>
</span><span id="__span-0-256"><a id="__codelineno-0-256" name="__codelineno-0-256"></a>
</span><span id="__span-0-257"><a id="__codelineno-0-257" name="__codelineno-0-257"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_channels_in_data</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-258"><a id="__codelineno-0-258" name="__codelineno-0-258"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-259"><a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-260"><a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"channels_in_data"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-261"><a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-262"><a id="__codelineno-0-262" name="__codelineno-0-262"></a>
</span><span id="__span-0-263"><a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="nd">@property</span>
</span><span id="__span-0-264"><a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tile_overlap</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="__span-0-265"><a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="w">        </span><span class="sd">"""XY tile overlap.</span>
</span><span id="__span-0-266"><a id="__codelineno-0-266" name="__codelineno-0-266"></a>
</span><span id="__span-0-267"><a id="__codelineno-0-267" name="__codelineno-0-267"></a><span class="sd">        Returns</span>
</span><span id="__span-0-268"><a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">        -------</span>
</span><span id="__span-0-269"><a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">        tile_overlap : float</span>
</span><span id="__span-0-270"><a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">            XY tile overlap.</span>
</span><span id="__span-0-271"><a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">        """</span>
</span><span id="__span-0-272"><a id="__codelineno-0-272" name="__codelineno-0-272"></a>
</span><span id="__span-0-273"><a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_tile_overlap"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-274"><a id="__codelineno-0-274" name="__codelineno-0-274"></a>
</span><span id="__span-0-275"><a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="nd">@tile_overlap</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-276"><a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tile_overlap</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="__span-0-277"><a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="w">        </span><span class="sd">"""Set the tile overlap.</span>
</span><span id="__span-0-278"><a id="__codelineno-0-278" name="__codelineno-0-278"></a>
</span><span id="__span-0-279"><a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-280"><a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">        ----------</span>
</span><span id="__span-0-281"><a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        value : float</span>
</span><span id="__span-0-282"><a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">            New tile overlap.</span>
</span><span id="__span-0-283"><a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">        """</span>
</span><span id="__span-0-284"><a id="__codelineno-0-284" name="__codelineno-0-284"></a>
</span><span id="__span-0-285"><a id="__codelineno-0-285" name="__codelineno-0-285"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tile_overlap</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-286"><a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-287"><a id="__codelineno-0-287" name="__codelineno-0-287"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-288"><a id="__codelineno-0-288" name="__codelineno-0-288"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"tile_overlap"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-289"><a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-290"><a id="__codelineno-0-290" name="__codelineno-0-290"></a>
</span><span id="__span-0-291"><a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="nd">@property</span>
</span><span id="__span-0-292"><a id="__codelineno-0-292" name="__codelineno-0-292"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">binning</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]:</span>
</span><span id="__span-0-293"><a id="__codelineno-0-293" name="__codelineno-0-293"></a><span class="w">        </span><span class="sd">"""Camera binning.</span>
</span><span id="__span-0-294"><a id="__codelineno-0-294" name="__codelineno-0-294"></a>
</span><span id="__span-0-295"><a id="__codelineno-0-295" name="__codelineno-0-295"></a><span class="sd">        Returns</span>
</span><span id="__span-0-296"><a id="__codelineno-0-296" name="__codelineno-0-296"></a><span class="sd">        -------</span>
</span><span id="__span-0-297"><a id="__codelineno-0-297" name="__codelineno-0-297"></a><span class="sd">        binning : int</span>
</span><span id="__span-0-298"><a id="__codelineno-0-298" name="__codelineno-0-298"></a><span class="sd">            Camera binning.</span>
</span><span id="__span-0-299"><a id="__codelineno-0-299" name="__codelineno-0-299"></a><span class="sd">        """</span>
</span><span id="__span-0-300"><a id="__codelineno-0-300" name="__codelineno-0-300"></a>
</span><span id="__span-0-301"><a id="__codelineno-0-301" name="__codelineno-0-301"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_binning"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-302"><a id="__codelineno-0-302" name="__codelineno-0-302"></a>
</span><span id="__span-0-303"><a id="__codelineno-0-303" name="__codelineno-0-303"></a>    <span class="nd">@binning</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-304"><a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">binning</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-305"><a id="__codelineno-0-305" name="__codelineno-0-305"></a><span class="w">        </span><span class="sd">"""Set the camera binning.</span>
</span><span id="__span-0-306"><a id="__codelineno-0-306" name="__codelineno-0-306"></a>
</span><span id="__span-0-307"><a id="__codelineno-0-307" name="__codelineno-0-307"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-308"><a id="__codelineno-0-308" name="__codelineno-0-308"></a><span class="sd">        ----------</span>
</span><span id="__span-0-309"><a id="__codelineno-0-309" name="__codelineno-0-309"></a><span class="sd">        value : int</span>
</span><span id="__span-0-310"><a id="__codelineno-0-310" name="__codelineno-0-310"></a><span class="sd">            New camera binning.</span>
</span><span id="__span-0-311"><a id="__codelineno-0-311" name="__codelineno-0-311"></a><span class="sd">        """</span>
</span><span id="__span-0-312"><a id="__codelineno-0-312" name="__codelineno-0-312"></a>
</span><span id="__span-0-313"><a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_binning</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-314"><a id="__codelineno-0-314" name="__codelineno-0-314"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-315"><a id="__codelineno-0-315" name="__codelineno-0-315"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-316"><a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"binning"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-317"><a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-318"><a id="__codelineno-0-318" name="__codelineno-0-318"></a>
</span><span id="__span-0-319"><a id="__codelineno-0-319" name="__codelineno-0-319"></a>    <span class="nd">@property</span>
</span><span id="__span-0-320"><a id="__codelineno-0-320" name="__codelineno-0-320"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">e_per_ADU</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="__span-0-321"><a id="__codelineno-0-321" name="__codelineno-0-321"></a><span class="w">        </span><span class="sd">"""Electrons per camera ADU.</span>
</span><span id="__span-0-322"><a id="__codelineno-0-322" name="__codelineno-0-322"></a>
</span><span id="__span-0-323"><a id="__codelineno-0-323" name="__codelineno-0-323"></a><span class="sd">        Returns</span>
</span><span id="__span-0-324"><a id="__codelineno-0-324" name="__codelineno-0-324"></a><span class="sd">        -------</span>
</span><span id="__span-0-325"><a id="__codelineno-0-325" name="__codelineno-0-325"></a><span class="sd">        e_per_ADU : float</span>
</span><span id="__span-0-326"><a id="__codelineno-0-326" name="__codelineno-0-326"></a><span class="sd">            Electrons per camera ADU."""</span>
</span><span id="__span-0-327"><a id="__codelineno-0-327" name="__codelineno-0-327"></a>
</span><span id="__span-0-328"><a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_e_per_ADU"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-329"><a id="__codelineno-0-329" name="__codelineno-0-329"></a>
</span><span id="__span-0-330"><a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="nd">@e_per_ADU</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-331"><a id="__codelineno-0-331" name="__codelineno-0-331"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">e_per_ADU</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="__span-0-332"><a id="__codelineno-0-332" name="__codelineno-0-332"></a><span class="w">        </span><span class="sd">"""Set the camera conversion (e- per ADU).</span>
</span><span id="__span-0-333"><a id="__codelineno-0-333" name="__codelineno-0-333"></a>
</span><span id="__span-0-334"><a id="__codelineno-0-334" name="__codelineno-0-334"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-335"><a id="__codelineno-0-335" name="__codelineno-0-335"></a><span class="sd">        ----------</span>
</span><span id="__span-0-336"><a id="__codelineno-0-336" name="__codelineno-0-336"></a><span class="sd">        value : float</span>
</span><span id="__span-0-337"><a id="__codelineno-0-337" name="__codelineno-0-337"></a><span class="sd">            New camera conversion (e- per ADU).</span>
</span><span id="__span-0-338"><a id="__codelineno-0-338" name="__codelineno-0-338"></a><span class="sd">        """</span>
</span><span id="__span-0-339"><a id="__codelineno-0-339" name="__codelineno-0-339"></a>
</span><span id="__span-0-340"><a id="__codelineno-0-340" name="__codelineno-0-340"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_e_per_ADU</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-341"><a id="__codelineno-0-341" name="__codelineno-0-341"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-342"><a id="__codelineno-0-342" name="__codelineno-0-342"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-343"><a id="__codelineno-0-343" name="__codelineno-0-343"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"e_per_ADU"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-344"><a id="__codelineno-0-344" name="__codelineno-0-344"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-345"><a id="__codelineno-0-345" name="__codelineno-0-345"></a>
</span><span id="__span-0-346"><a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="nd">@property</span>
</span><span id="__span-0-347"><a id="__codelineno-0-347" name="__codelineno-0-347"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">na</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="__span-0-348"><a id="__codelineno-0-348" name="__codelineno-0-348"></a><span class="w">        </span><span class="sd">"""Detection objective numerical aperture (NA).</span>
</span><span id="__span-0-349"><a id="__codelineno-0-349" name="__codelineno-0-349"></a>
</span><span id="__span-0-350"><a id="__codelineno-0-350" name="__codelineno-0-350"></a><span class="sd">        Returns</span>
</span><span id="__span-0-351"><a id="__codelineno-0-351" name="__codelineno-0-351"></a><span class="sd">        -------</span>
</span><span id="__span-0-352"><a id="__codelineno-0-352" name="__codelineno-0-352"></a><span class="sd">        na : float</span>
</span><span id="__span-0-353"><a id="__codelineno-0-353" name="__codelineno-0-353"></a><span class="sd">            Detection objective numerical aperture (NA).</span>
</span><span id="__span-0-354"><a id="__codelineno-0-354" name="__codelineno-0-354"></a><span class="sd">        """</span>
</span><span id="__span-0-355"><a id="__codelineno-0-355" name="__codelineno-0-355"></a>
</span><span id="__span-0-356"><a id="__codelineno-0-356" name="__codelineno-0-356"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_na"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-357"><a id="__codelineno-0-357" name="__codelineno-0-357"></a>
</span><span id="__span-0-358"><a id="__codelineno-0-358" name="__codelineno-0-358"></a>    <span class="nd">@na</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-359"><a id="__codelineno-0-359" name="__codelineno-0-359"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">na</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="__span-0-360"><a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="w">        </span><span class="sd">"""Set detection objective numerical aperture (NA).</span>
</span><span id="__span-0-361"><a id="__codelineno-0-361" name="__codelineno-0-361"></a>
</span><span id="__span-0-362"><a id="__codelineno-0-362" name="__codelineno-0-362"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-363"><a id="__codelineno-0-363" name="__codelineno-0-363"></a><span class="sd">        ----------</span>
</span><span id="__span-0-364"><a id="__codelineno-0-364" name="__codelineno-0-364"></a><span class="sd">        value: float</span>
</span><span id="__span-0-365"><a id="__codelineno-0-365" name="__codelineno-0-365"></a><span class="sd">            New detection objective numerical aperture (NA)</span>
</span><span id="__span-0-366"><a id="__codelineno-0-366" name="__codelineno-0-366"></a><span class="sd">        """</span>
</span><span id="__span-0-367"><a id="__codelineno-0-367" name="__codelineno-0-367"></a>
</span><span id="__span-0-368"><a id="__codelineno-0-368" name="__codelineno-0-368"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_na</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-369"><a id="__codelineno-0-369" name="__codelineno-0-369"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-370"><a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-371"><a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"na"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-372"><a id="__codelineno-0-372" name="__codelineno-0-372"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-373"><a id="__codelineno-0-373" name="__codelineno-0-373"></a>
</span><span id="__span-0-374"><a id="__codelineno-0-374" name="__codelineno-0-374"></a>    <span class="nd">@property</span>
</span><span id="__span-0-375"><a id="__codelineno-0-375" name="__codelineno-0-375"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ri</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]:</span>
</span><span id="__span-0-376"><a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="w">        </span><span class="sd">"""Detection objective refractive index (RI).</span>
</span><span id="__span-0-377"><a id="__codelineno-0-377" name="__codelineno-0-377"></a>
</span><span id="__span-0-378"><a id="__codelineno-0-378" name="__codelineno-0-378"></a><span class="sd">        Returns</span>
</span><span id="__span-0-379"><a id="__codelineno-0-379" name="__codelineno-0-379"></a><span class="sd">        -------</span>
</span><span id="__span-0-380"><a id="__codelineno-0-380" name="__codelineno-0-380"></a><span class="sd">        ri : float</span>
</span><span id="__span-0-381"><a id="__codelineno-0-381" name="__codelineno-0-381"></a><span class="sd">            Detection objective refractive index (RI).</span>
</span><span id="__span-0-382"><a id="__codelineno-0-382" name="__codelineno-0-382"></a><span class="sd">        """</span>
</span><span id="__span-0-383"><a id="__codelineno-0-383" name="__codelineno-0-383"></a>
</span><span id="__span-0-384"><a id="__codelineno-0-384" name="__codelineno-0-384"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_ri"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-385"><a id="__codelineno-0-385" name="__codelineno-0-385"></a>
</span><span id="__span-0-386"><a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="nd">@ri</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-387"><a id="__codelineno-0-387" name="__codelineno-0-387"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">ri</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">float</span><span class="p">):</span>
</span><span id="__span-0-388"><a id="__codelineno-0-388" name="__codelineno-0-388"></a><span class="w">        </span><span class="sd">"""Set detection objective refractive index (RI).</span>
</span><span id="__span-0-389"><a id="__codelineno-0-389" name="__codelineno-0-389"></a>
</span><span id="__span-0-390"><a id="__codelineno-0-390" name="__codelineno-0-390"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-391"><a id="__codelineno-0-391" name="__codelineno-0-391"></a><span class="sd">        ----------</span>
</span><span id="__span-0-392"><a id="__codelineno-0-392" name="__codelineno-0-392"></a><span class="sd">        value: float</span>
</span><span id="__span-0-393"><a id="__codelineno-0-393" name="__codelineno-0-393"></a><span class="sd">            New detection objective refractive index (RI)</span>
</span><span id="__span-0-394"><a id="__codelineno-0-394" name="__codelineno-0-394"></a><span class="sd">        """</span>
</span><span id="__span-0-395"><a id="__codelineno-0-395" name="__codelineno-0-395"></a>
</span><span id="__span-0-396"><a id="__codelineno-0-396" name="__codelineno-0-396"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ri</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-397"><a id="__codelineno-0-397" name="__codelineno-0-397"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-398"><a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-399"><a id="__codelineno-0-399" name="__codelineno-0-399"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"ri"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-400"><a id="__codelineno-0-400" name="__codelineno-0-400"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-401"><a id="__codelineno-0-401" name="__codelineno-0-401"></a>
</span><span id="__span-0-402"><a id="__codelineno-0-402" name="__codelineno-0-402"></a>    <span class="nd">@property</span>
</span><span id="__span-0-403"><a id="__codelineno-0-403" name="__codelineno-0-403"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">noise_map</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-404"><a id="__codelineno-0-404" name="__codelineno-0-404"></a><span class="w">        </span><span class="sd">"""Camera noise image.</span>
</span><span id="__span-0-405"><a id="__codelineno-0-405" name="__codelineno-0-405"></a>
</span><span id="__span-0-406"><a id="__codelineno-0-406" name="__codelineno-0-406"></a><span class="sd">        Returns</span>
</span><span id="__span-0-407"><a id="__codelineno-0-407" name="__codelineno-0-407"></a><span class="sd">        -------</span>
</span><span id="__span-0-408"><a id="__codelineno-0-408" name="__codelineno-0-408"></a><span class="sd">        noise_map : ArrayLike</span>
</span><span id="__span-0-409"><a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="sd">            Camera noise image.</span>
</span><span id="__span-0-410"><a id="__codelineno-0-410" name="__codelineno-0-410"></a><span class="sd">        """</span>
</span><span id="__span-0-411"><a id="__codelineno-0-411" name="__codelineno-0-411"></a>
</span><span id="__span-0-412"><a id="__codelineno-0-412" name="__codelineno-0-412"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_noise_map"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-413"><a id="__codelineno-0-413" name="__codelineno-0-413"></a>
</span><span id="__span-0-414"><a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="nd">@noise_map</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-415"><a id="__codelineno-0-415" name="__codelineno-0-415"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">noise_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">):</span>
</span><span id="__span-0-416"><a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="w">        </span><span class="sd">"""Set the camera noise image.</span>
</span><span id="__span-0-417"><a id="__codelineno-0-417" name="__codelineno-0-417"></a>
</span><span id="__span-0-418"><a id="__codelineno-0-418" name="__codelineno-0-418"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-419"><a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">        ----------</span>
</span><span id="__span-0-420"><a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">        value : ArrayLike</span>
</span><span id="__span-0-421"><a id="__codelineno-0-421" name="__codelineno-0-421"></a><span class="sd">            New camera noise image.</span>
</span><span id="__span-0-422"><a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">        """</span>
</span><span id="__span-0-423"><a id="__codelineno-0-423" name="__codelineno-0-423"></a>
</span><span id="__span-0-424"><a id="__codelineno-0-424" name="__codelineno-0-424"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_noise_map</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-425"><a id="__codelineno-0-425" name="__codelineno-0-425"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"noise_map"</span><span class="p">))</span>
</span><span id="__span-0-426"><a id="__codelineno-0-426" name="__codelineno-0-426"></a>
</span><span id="__span-0-427"><a id="__codelineno-0-427" name="__codelineno-0-427"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-428"><a id="__codelineno-0-428" name="__codelineno-0-428"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-429"><a id="__codelineno-0-429" name="__codelineno-0-429"></a>                <span class="n">value</span><span class="p">,</span>
</span><span id="__span-0-430"><a id="__codelineno-0-430" name="__codelineno-0-430"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-431"><a id="__codelineno-0-431" name="__codelineno-0-431"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="p">,</span>
</span><span id="__span-0-432"><a id="__codelineno-0-432" name="__codelineno-0-432"></a>                <span class="n">return_future</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-433"><a id="__codelineno-0-433" name="__codelineno-0-433"></a>            <span class="p">)</span>
</span><span id="__span-0-434"><a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-435"><a id="__codelineno-0-435" name="__codelineno-0-435"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Could not access calibrations.zarr/noise_map"</span><span class="p">)</span>
</span><span id="__span-0-436"><a id="__codelineno-0-436" name="__codelineno-0-436"></a>
</span><span id="__span-0-437"><a id="__codelineno-0-437" name="__codelineno-0-437"></a>    <span class="nd">@property</span>
</span><span id="__span-0-438"><a id="__codelineno-0-438" name="__codelineno-0-438"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">channel_shading_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-439"><a id="__codelineno-0-439" name="__codelineno-0-439"></a><span class="w">        </span><span class="sd">"""Channel shaiding images.</span>
</span><span id="__span-0-440"><a id="__codelineno-0-440" name="__codelineno-0-440"></a>
</span><span id="__span-0-441"><a id="__codelineno-0-441" name="__codelineno-0-441"></a><span class="sd">        Returns</span>
</span><span id="__span-0-442"><a id="__codelineno-0-442" name="__codelineno-0-442"></a><span class="sd">        -------</span>
</span><span id="__span-0-443"><a id="__codelineno-0-443" name="__codelineno-0-443"></a><span class="sd">        channel_shading_maps : ArrayLike</span>
</span><span id="__span-0-444"><a id="__codelineno-0-444" name="__codelineno-0-444"></a><span class="sd">            Channel shading images.</span>
</span><span id="__span-0-445"><a id="__codelineno-0-445" name="__codelineno-0-445"></a><span class="sd">        """</span>
</span><span id="__span-0-446"><a id="__codelineno-0-446" name="__codelineno-0-446"></a>
</span><span id="__span-0-447"><a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_shading_maps"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-448"><a id="__codelineno-0-448" name="__codelineno-0-448"></a>
</span><span id="__span-0-449"><a id="__codelineno-0-449" name="__codelineno-0-449"></a>    <span class="nd">@channel_shading_maps</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-450"><a id="__codelineno-0-450" name="__codelineno-0-450"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">channel_shading_maps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">):</span>
</span><span id="__span-0-451"><a id="__codelineno-0-451" name="__codelineno-0-451"></a><span class="w">        </span><span class="sd">"""Set the channel shading images.</span>
</span><span id="__span-0-452"><a id="__codelineno-0-452" name="__codelineno-0-452"></a>
</span><span id="__span-0-453"><a id="__codelineno-0-453" name="__codelineno-0-453"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-454"><a id="__codelineno-0-454" name="__codelineno-0-454"></a><span class="sd">        ----------</span>
</span><span id="__span-0-455"><a id="__codelineno-0-455" name="__codelineno-0-455"></a><span class="sd">        value : ArrayLike</span>
</span><span id="__span-0-456"><a id="__codelineno-0-456" name="__codelineno-0-456"></a><span class="sd">            New channel shading images.</span>
</span><span id="__span-0-457"><a id="__codelineno-0-457" name="__codelineno-0-457"></a><span class="sd">        """</span>
</span><span id="__span-0-458"><a id="__codelineno-0-458" name="__codelineno-0-458"></a>
</span><span id="__span-0-459"><a id="__codelineno-0-459" name="__codelineno-0-459"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_shading_maps</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-460"><a id="__codelineno-0-460" name="__codelineno-0-460"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-461"><a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"shading_maps"</span><span class="p">)</span>
</span><span id="__span-0-462"><a id="__codelineno-0-462" name="__codelineno-0-462"></a>        <span class="p">)</span>
</span><span id="__span-0-463"><a id="__codelineno-0-463" name="__codelineno-0-463"></a>
</span><span id="__span-0-464"><a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-465"><a id="__codelineno-0-465" name="__codelineno-0-465"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-466"><a id="__codelineno-0-466" name="__codelineno-0-466"></a>                <span class="n">value</span><span class="p">,</span>
</span><span id="__span-0-467"><a id="__codelineno-0-467" name="__codelineno-0-467"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-468"><a id="__codelineno-0-468" name="__codelineno-0-468"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="p">,</span>
</span><span id="__span-0-469"><a id="__codelineno-0-469" name="__codelineno-0-469"></a>                <span class="n">return_future</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-470"><a id="__codelineno-0-470" name="__codelineno-0-470"></a>            <span class="p">)</span>
</span><span id="__span-0-471"><a id="__codelineno-0-471" name="__codelineno-0-471"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-472"><a id="__codelineno-0-472" name="__codelineno-0-472"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Could not access calibrations.zarr/shading_maps"</span><span class="p">)</span>
</span><span id="__span-0-473"><a id="__codelineno-0-473" name="__codelineno-0-473"></a>
</span><span id="__span-0-474"><a id="__codelineno-0-474" name="__codelineno-0-474"></a>    <span class="nd">@property</span>
</span><span id="__span-0-475"><a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">channel_psfs</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-476"><a id="__codelineno-0-476" name="__codelineno-0-476"></a><span class="w">        </span><span class="sd">"""Channel point spread functions (PSF).</span>
</span><span id="__span-0-477"><a id="__codelineno-0-477" name="__codelineno-0-477"></a>
</span><span id="__span-0-478"><a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="sd">        Return</span>
</span><span id="__span-0-479"><a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">        ------</span>
</span><span id="__span-0-480"><a id="__codelineno-0-480" name="__codelineno-0-480"></a><span class="sd">        channel_psfs : ArrayLike</span>
</span><span id="__span-0-481"><a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">            Channel point spread functions (PSF).</span>
</span><span id="__span-0-482"><a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">        """</span>
</span><span id="__span-0-483"><a id="__codelineno-0-483" name="__codelineno-0-483"></a>
</span><span id="__span-0-484"><a id="__codelineno-0-484" name="__codelineno-0-484"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_psfs"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-485"><a id="__codelineno-0-485" name="__codelineno-0-485"></a>
</span><span id="__span-0-486"><a id="__codelineno-0-486" name="__codelineno-0-486"></a>    <span class="nd">@channel_psfs</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-487"><a id="__codelineno-0-487" name="__codelineno-0-487"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">channel_psfs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">):</span>
</span><span id="__span-0-488"><a id="__codelineno-0-488" name="__codelineno-0-488"></a><span class="w">        </span><span class="sd">"""Set the channel point spread functions (PSF).</span>
</span><span id="__span-0-489"><a id="__codelineno-0-489" name="__codelineno-0-489"></a>
</span><span id="__span-0-490"><a id="__codelineno-0-490" name="__codelineno-0-490"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-491"><a id="__codelineno-0-491" name="__codelineno-0-491"></a><span class="sd">        ----------</span>
</span><span id="__span-0-492"><a id="__codelineno-0-492" name="__codelineno-0-492"></a><span class="sd">        value : ArrayLike</span>
</span><span id="__span-0-493"><a id="__codelineno-0-493" name="__codelineno-0-493"></a><span class="sd">            New channel point spread functions (PSF).</span>
</span><span id="__span-0-494"><a id="__codelineno-0-494" name="__codelineno-0-494"></a><span class="sd">        """</span>
</span><span id="__span-0-495"><a id="__codelineno-0-495" name="__codelineno-0-495"></a>
</span><span id="__span-0-496"><a id="__codelineno-0-496" name="__codelineno-0-496"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_psfs</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-497"><a id="__codelineno-0-497" name="__codelineno-0-497"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"psf_data"</span><span class="p">))</span>
</span><span id="__span-0-498"><a id="__codelineno-0-498" name="__codelineno-0-498"></a>
</span><span id="__span-0-499"><a id="__codelineno-0-499" name="__codelineno-0-499"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-500"><a id="__codelineno-0-500" name="__codelineno-0-500"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-501"><a id="__codelineno-0-501" name="__codelineno-0-501"></a>                <span class="n">value</span><span class="p">,</span>
</span><span id="__span-0-502"><a id="__codelineno-0-502" name="__codelineno-0-502"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-503"><a id="__codelineno-0-503" name="__codelineno-0-503"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-504"><a id="__codelineno-0-504" name="__codelineno-0-504"></a>                <span class="n">return_future</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-505"><a id="__codelineno-0-505" name="__codelineno-0-505"></a>            <span class="p">)</span>
</span><span id="__span-0-506"><a id="__codelineno-0-506" name="__codelineno-0-506"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
</span><span id="__span-0-507"><a id="__codelineno-0-507" name="__codelineno-0-507"></a>            <span class="nb">print</span><span class="p">(</span><span class="sa">r</span><span class="s2">"Could not access calibrations.zarr/psf_data"</span><span class="p">)</span>
</span><span id="__span-0-508"><a id="__codelineno-0-508" name="__codelineno-0-508"></a>
</span><span id="__span-0-509"><a id="__codelineno-0-509" name="__codelineno-0-509"></a>    <span class="nd">@property</span>
</span><span id="__span-0-510"><a id="__codelineno-0-510" name="__codelineno-0-510"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">experiment_order</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="__span-0-511"><a id="__codelineno-0-511" name="__codelineno-0-511"></a><span class="w">        </span><span class="sd">"""Round and bit order.</span>
</span><span id="__span-0-512"><a id="__codelineno-0-512" name="__codelineno-0-512"></a>
</span><span id="__span-0-513"><a id="__codelineno-0-513" name="__codelineno-0-513"></a><span class="sd">        Returns</span>
</span><span id="__span-0-514"><a id="__codelineno-0-514" name="__codelineno-0-514"></a><span class="sd">        -------</span>
</span><span id="__span-0-515"><a id="__codelineno-0-515" name="__codelineno-0-515"></a><span class="sd">        experiment_order : pd.DataFrame</span>
</span><span id="__span-0-516"><a id="__codelineno-0-516" name="__codelineno-0-516"></a><span class="sd">            Round and bit order.</span>
</span><span id="__span-0-517"><a id="__codelineno-0-517" name="__codelineno-0-517"></a><span class="sd">        """</span>
</span><span id="__span-0-518"><a id="__codelineno-0-518" name="__codelineno-0-518"></a>
</span><span id="__span-0-519"><a id="__codelineno-0-519" name="__codelineno-0-519"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_experiment_order"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-520"><a id="__codelineno-0-520" name="__codelineno-0-520"></a>
</span><span id="__span-0-521"><a id="__codelineno-0-521" name="__codelineno-0-521"></a>    <span class="nd">@experiment_order</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-522"><a id="__codelineno-0-522" name="__codelineno-0-522"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">experiment_order</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]):</span>
</span><span id="__span-0-523"><a id="__codelineno-0-523" name="__codelineno-0-523"></a><span class="w">        </span><span class="sd">"""Set the round and bit order.</span>
</span><span id="__span-0-524"><a id="__codelineno-0-524" name="__codelineno-0-524"></a>
</span><span id="__span-0-525"><a id="__codelineno-0-525" name="__codelineno-0-525"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-526"><a id="__codelineno-0-526" name="__codelineno-0-526"></a><span class="sd">        ----------</span>
</span><span id="__span-0-527"><a id="__codelineno-0-527" name="__codelineno-0-527"></a><span class="sd">        value : Union[ArrayLike, pd.DataFrame]</span>
</span><span id="__span-0-528"><a id="__codelineno-0-528" name="__codelineno-0-528"></a><span class="sd">            New round and bit order.</span>
</span><span id="__span-0-529"><a id="__codelineno-0-529" name="__codelineno-0-529"></a><span class="sd">        """</span>
</span><span id="__span-0-530"><a id="__codelineno-0-530" name="__codelineno-0-530"></a>
</span><span id="__span-0-531"><a id="__codelineno-0-531" name="__codelineno-0-531"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="__span-0-532"><a id="__codelineno-0-532" name="__codelineno-0-532"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_order</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-533"><a id="__codelineno-0-533" name="__codelineno-0-533"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-534"><a id="__codelineno-0-534" name="__codelineno-0-534"></a>            <span class="n">channel_list</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-535"><a id="__codelineno-0-535" name="__codelineno-0-535"></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channels_in_data</span><span class="p">)):</span>
</span><span id="__span-0-536"><a id="__codelineno-0-536" name="__codelineno-0-536"></a>                <span class="n">channel_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channels_in_data</span><span class="p">[</span><span class="n">idx</span><span class="p">]))</span>
</span><span id="__span-0-537"><a id="__codelineno-0-537" name="__codelineno-0-537"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_order</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
</span><span id="__span-0-538"><a id="__codelineno-0-538" name="__codelineno-0-538"></a>                <span class="n">value</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">channel_list</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="s2">"int64"</span>
</span><span id="__span-0-539"><a id="__codelineno-0-539" name="__codelineno-0-539"></a>            <span class="p">)</span>
</span><span id="__span-0-540"><a id="__codelineno-0-540" name="__codelineno-0-540"></a>
</span><span id="__span-0-541"><a id="__codelineno-0-541" name="__codelineno-0-541"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-542"><a id="__codelineno-0-542" name="__codelineno-0-542"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-543"><a id="__codelineno-0-543" name="__codelineno-0-543"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"exp_order"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_order</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-544"><a id="__codelineno-0-544" name="__codelineno-0-544"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-545"><a id="__codelineno-0-545" name="__codelineno-0-545"></a>
</span><span id="__span-0-546"><a id="__codelineno-0-546" name="__codelineno-0-546"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rounds</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span> 
</span><span id="__span-0-547"><a id="__codelineno-0-547" name="__codelineno-0-547"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">num_rounds</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-548"><a id="__codelineno-0-548" name="__codelineno-0-548"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-549"><a id="__codelineno-0-549" name="__codelineno-0-549"></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_rounds</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]),</span> <span class="s2">"Number of rounds does not match experiment order file."</span>
</span><span id="__span-0-550"><a id="__codelineno-0-550" name="__codelineno-0-550"></a>
</span><span id="__span-0-551"><a id="__codelineno-0-551" name="__codelineno-0-551"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-552"><a id="__codelineno-0-552" name="__codelineno-0-552"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">value</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]))</span>
</span><span id="__span-0-553"><a id="__codelineno-0-553" name="__codelineno-0-553"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-554"><a id="__codelineno-0-554" name="__codelineno-0-554"></a>            <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span> <span class="o">==</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">value</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:])),</span> <span class="s2">"Number of bits does not match experiment order file."</span>
</span><span id="__span-0-555"><a id="__codelineno-0-555" name="__codelineno-0-555"></a>
</span><span id="__span-0-556"><a id="__codelineno-0-556" name="__codelineno-0-556"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-557"><a id="__codelineno-0-557" name="__codelineno-0-557"></a>        <span class="k">for</span> <span class="n">round_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_rounds</span><span class="p">):</span>
</span><span id="__span-0-558"><a id="__codelineno-0-558" name="__codelineno-0-558"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"round"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">round_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span><span id="__span-0-559"><a id="__codelineno-0-559" name="__codelineno-0-559"></a>
</span><span id="__span-0-560"><a id="__codelineno-0-560" name="__codelineno-0-560"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-561"><a id="__codelineno-0-561" name="__codelineno-0-561"></a>        <span class="k">for</span> <span class="n">bit_idx</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num_bits</span><span class="p">):</span>
</span><span id="__span-0-562"><a id="__codelineno-0-562" name="__codelineno-0-562"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"bit"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">bit_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">))</span>
</span><span id="__span-0-563"><a id="__codelineno-0-563" name="__codelineno-0-563"></a>
</span><span id="__span-0-564"><a id="__codelineno-0-564" name="__codelineno-0-564"></a>    <span class="nd">@property</span>
</span><span id="__span-0-565"><a id="__codelineno-0-565" name="__codelineno-0-565"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">codebook</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="__span-0-566"><a id="__codelineno-0-566" name="__codelineno-0-566"></a><span class="w">        </span><span class="sd">"""Codebook.</span>
</span><span id="__span-0-567"><a id="__codelineno-0-567" name="__codelineno-0-567"></a>
</span><span id="__span-0-568"><a id="__codelineno-0-568" name="__codelineno-0-568"></a><span class="sd">        Returns</span>
</span><span id="__span-0-569"><a id="__codelineno-0-569" name="__codelineno-0-569"></a><span class="sd">        -------</span>
</span><span id="__span-0-570"><a id="__codelineno-0-570" name="__codelineno-0-570"></a><span class="sd">        codebook : pd.DataFrame</span>
</span><span id="__span-0-571"><a id="__codelineno-0-571" name="__codelineno-0-571"></a><span class="sd">            Codebook.</span>
</span><span id="__span-0-572"><a id="__codelineno-0-572" name="__codelineno-0-572"></a><span class="sd">        """</span>
</span><span id="__span-0-573"><a id="__codelineno-0-573" name="__codelineno-0-573"></a>
</span><span id="__span-0-574"><a id="__codelineno-0-574" name="__codelineno-0-574"></a>        <span class="n">data</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_codebook"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-575"><a id="__codelineno-0-575" name="__codelineno-0-575"></a>
</span><span id="__span-0-576"><a id="__codelineno-0-576" name="__codelineno-0-576"></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-577"><a id="__codelineno-0-577" name="__codelineno-0-577"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-578"><a id="__codelineno-0-578" name="__codelineno-0-578"></a>        <span class="n">num_columns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">data</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="__span-0-579"><a id="__codelineno-0-579" name="__codelineno-0-579"></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"gene_id"</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"bit</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_columns</span><span class="p">)]</span>
</span><span id="__span-0-580"><a id="__codelineno-0-580" name="__codelineno-0-580"></a>
</span><span id="__span-0-581"><a id="__codelineno-0-581" name="__codelineno-0-581"></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</span><span id="__span-0-582"><a id="__codelineno-0-582" name="__codelineno-0-582"></a>
</span><span id="__span-0-583"><a id="__codelineno-0-583" name="__codelineno-0-583"></a>    <span class="nd">@codebook</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-584"><a id="__codelineno-0-584" name="__codelineno-0-584"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">codebook</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="__span-0-585"><a id="__codelineno-0-585" name="__codelineno-0-585"></a><span class="w">        </span><span class="sd">"""Set the codebook.</span>
</span><span id="__span-0-586"><a id="__codelineno-0-586" name="__codelineno-0-586"></a>
</span><span id="__span-0-587"><a id="__codelineno-0-587" name="__codelineno-0-587"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-588"><a id="__codelineno-0-588" name="__codelineno-0-588"></a><span class="sd">        ----------</span>
</span><span id="__span-0-589"><a id="__codelineno-0-589" name="__codelineno-0-589"></a><span class="sd">        value : pd.DataFrame</span>
</span><span id="__span-0-590"><a id="__codelineno-0-590" name="__codelineno-0-590"></a><span class="sd">            New codebook.</span>
</span><span id="__span-0-591"><a id="__codelineno-0-591" name="__codelineno-0-591"></a><span class="sd">        """</span>
</span><span id="__span-0-592"><a id="__codelineno-0-592" name="__codelineno-0-592"></a>
</span><span id="__span-0-593"><a id="__codelineno-0-593" name="__codelineno-0-593"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_codebook</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-594"><a id="__codelineno-0-594" name="__codelineno-0-594"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-595"><a id="__codelineno-0-595" name="__codelineno-0-595"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-596"><a id="__codelineno-0-596" name="__codelineno-0-596"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"codebook"</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_codebook</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-597"><a id="__codelineno-0-597" name="__codelineno-0-597"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-598"><a id="__codelineno-0-598" name="__codelineno-0-598"></a>
</span><span id="__span-0-599"><a id="__codelineno-0-599" name="__codelineno-0-599"></a>    <span class="nd">@property</span>
</span><span id="__span-0-600"><a id="__codelineno-0-600" name="__codelineno-0-600"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">voxel_size_zyx_um</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-601"><a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="w">        </span><span class="sd">"""Voxel size, zyx order (microns).</span>
</span><span id="__span-0-602"><a id="__codelineno-0-602" name="__codelineno-0-602"></a>
</span><span id="__span-0-603"><a id="__codelineno-0-603" name="__codelineno-0-603"></a><span class="sd">        Returns</span>
</span><span id="__span-0-604"><a id="__codelineno-0-604" name="__codelineno-0-604"></a><span class="sd">        -------</span>
</span><span id="__span-0-605"><a id="__codelineno-0-605" name="__codelineno-0-605"></a><span class="sd">        voxel_size_zyx_um : ArrayLike</span>
</span><span id="__span-0-606"><a id="__codelineno-0-606" name="__codelineno-0-606"></a><span class="sd">            Voxel size, zyx order (microns).</span>
</span><span id="__span-0-607"><a id="__codelineno-0-607" name="__codelineno-0-607"></a><span class="sd">        """</span>
</span><span id="__span-0-608"><a id="__codelineno-0-608" name="__codelineno-0-608"></a>
</span><span id="__span-0-609"><a id="__codelineno-0-609" name="__codelineno-0-609"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_voxel_size_zyx_um"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-610"><a id="__codelineno-0-610" name="__codelineno-0-610"></a>
</span><span id="__span-0-611"><a id="__codelineno-0-611" name="__codelineno-0-611"></a>    <span class="nd">@voxel_size_zyx_um</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-612"><a id="__codelineno-0-612" name="__codelineno-0-612"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">voxel_size_zyx_um</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">):</span>
</span><span id="__span-0-613"><a id="__codelineno-0-613" name="__codelineno-0-613"></a><span class="w">        </span><span class="sd">"""Set the voxel size, zyx order (microns).</span>
</span><span id="__span-0-614"><a id="__codelineno-0-614" name="__codelineno-0-614"></a>
</span><span id="__span-0-615"><a id="__codelineno-0-615" name="__codelineno-0-615"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-616"><a id="__codelineno-0-616" name="__codelineno-0-616"></a><span class="sd">        ----------</span>
</span><span id="__span-0-617"><a id="__codelineno-0-617" name="__codelineno-0-617"></a><span class="sd">        value : ArrayLike</span>
</span><span id="__span-0-618"><a id="__codelineno-0-618" name="__codelineno-0-618"></a><span class="sd">            New voxel size, zyx order (microns).</span>
</span><span id="__span-0-619"><a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="sd">        """</span>
</span><span id="__span-0-620"><a id="__codelineno-0-620" name="__codelineno-0-620"></a>
</span><span id="__span-0-621"><a id="__codelineno-0-621" name="__codelineno-0-621"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_voxel_size_zyx_um</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-622"><a id="__codelineno-0-622" name="__codelineno-0-622"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-623"><a id="__codelineno-0-623" name="__codelineno-0-623"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-624"><a id="__codelineno-0-624" name="__codelineno-0-624"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"voxel_size_zyx_um"</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-625"><a id="__codelineno-0-625" name="__codelineno-0-625"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-626"><a id="__codelineno-0-626" name="__codelineno-0-626"></a>
</span><span id="__span-0-627"><a id="__codelineno-0-627" name="__codelineno-0-627"></a>    <span class="nd">@property</span>
</span><span id="__span-0-628"><a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">baysor_path</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-0-629"><a id="__codelineno-0-629" name="__codelineno-0-629"></a><span class="w">        </span><span class="sd">"""Baysor path</span>
</span><span id="__span-0-630"><a id="__codelineno-0-630" name="__codelineno-0-630"></a>
</span><span id="__span-0-631"><a id="__codelineno-0-631" name="__codelineno-0-631"></a><span class="sd">        Returns</span>
</span><span id="__span-0-632"><a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="sd">        -------</span>
</span><span id="__span-0-633"><a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="sd">        baysor_path : Union[Path,str]</span>
</span><span id="__span-0-634"><a id="__codelineno-0-634" name="__codelineno-0-634"></a><span class="sd">            Baysor path.</span>
</span><span id="__span-0-635"><a id="__codelineno-0-635" name="__codelineno-0-635"></a><span class="sd">        """</span>
</span><span id="__span-0-636"><a id="__codelineno-0-636" name="__codelineno-0-636"></a>
</span><span id="__span-0-637"><a id="__codelineno-0-637" name="__codelineno-0-637"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">"_baysor_path"</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-638"><a id="__codelineno-0-638" name="__codelineno-0-638"></a>
</span><span id="__span-0-639"><a id="__codelineno-0-639" name="__codelineno-0-639"></a>    <span class="nd">@baysor_path</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-640"><a id="__codelineno-0-640" name="__codelineno-0-640"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">baysor_path</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="__span-0-641"><a id="__codelineno-0-641" name="__codelineno-0-641"></a><span class="w">        </span><span class="sd">"""Set the baysor path.</span>
</span><span id="__span-0-642"><a id="__codelineno-0-642" name="__codelineno-0-642"></a>
</span><span id="__span-0-643"><a id="__codelineno-0-643" name="__codelineno-0-643"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-644"><a id="__codelineno-0-644" name="__codelineno-0-644"></a><span class="sd">        ----------</span>
</span><span id="__span-0-645"><a id="__codelineno-0-645" name="__codelineno-0-645"></a><span class="sd">        value : Union[Path,str]</span>
</span><span id="__span-0-646"><a id="__codelineno-0-646" name="__codelineno-0-646"></a><span class="sd">            New baysor path.</span>
</span><span id="__span-0-647"><a id="__codelineno-0-647" name="__codelineno-0-647"></a><span class="sd">        """</span>
</span><span id="__span-0-648"><a id="__codelineno-0-648" name="__codelineno-0-648"></a>
</span><span id="__span-0-649"><a id="__codelineno-0-649" name="__codelineno-0-649"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-650"><a id="__codelineno-0-650" name="__codelineno-0-650"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-651"><a id="__codelineno-0-651" name="__codelineno-0-651"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"BaysorPath"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-652"><a id="__codelineno-0-652" name="__codelineno-0-652"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-653"><a id="__codelineno-0-653" name="__codelineno-0-653"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="__span-0-654"><a id="__codelineno-0-654" name="__codelineno-0-654"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"BaysorPath"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span><span class="p">)</span>
</span><span id="__span-0-655"><a id="__codelineno-0-655" name="__codelineno-0-655"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state_json_path</span><span class="p">)</span>
</span><span id="__span-0-656"><a id="__codelineno-0-656" name="__codelineno-0-656"></a>
</span><span id="__span-0-657"><a id="__codelineno-0-657" name="__codelineno-0-657"></a>    <span class="nd">@property</span>
</span><span id="__span-0-658"><a id="__codelineno-0-658" name="__codelineno-0-658"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">baysor_options</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span><span class="nb">str</span><span class="p">]:</span>
</span><span id="__span-0-659"><a id="__codelineno-0-659" name="__codelineno-0-659"></a><span class="w">        </span><span class="sd">"""Baysor options</span>
</span><span id="__span-0-660"><a id="__codelineno-0-660" name="__codelineno-0-660"></a>
</span><span id="__span-0-661"><a id="__codelineno-0-661" name="__codelineno-0-661"></a><span class="sd">        Returns</span>
</span><span id="__span-0-662"><a id="__codelineno-0-662" name="__codelineno-0-662"></a><span class="sd">        -------</span>
</span><span id="__span-0-663"><a id="__codelineno-0-663" name="__codelineno-0-663"></a><span class="sd">        baysor_options : Union[Path,str]</span>
</span><span id="__span-0-664"><a id="__codelineno-0-664" name="__codelineno-0-664"></a><span class="sd">            Baysor options.</span>
</span><span id="__span-0-665"><a id="__codelineno-0-665" name="__codelineno-0-665"></a><span class="sd">        """</span>
</span><span id="__span-0-666"><a id="__codelineno-0-666" name="__codelineno-0-666"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">"_baysor_options"</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-667"><a id="__codelineno-0-667" name="__codelineno-0-667"></a>
</span><span id="__span-0-668"><a id="__codelineno-0-668" name="__codelineno-0-668"></a>    <span class="nd">@baysor_options</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-669"><a id="__codelineno-0-669" name="__codelineno-0-669"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">baysor_options</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span><span class="nb">str</span><span class="p">]):</span>
</span><span id="__span-0-670"><a id="__codelineno-0-670" name="__codelineno-0-670"></a><span class="w">        </span><span class="sd">"""Set the baysor options.</span>
</span><span id="__span-0-671"><a id="__codelineno-0-671" name="__codelineno-0-671"></a>
</span><span id="__span-0-672"><a id="__codelineno-0-672" name="__codelineno-0-672"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-673"><a id="__codelineno-0-673" name="__codelineno-0-673"></a><span class="sd">        ----------</span>
</span><span id="__span-0-674"><a id="__codelineno-0-674" name="__codelineno-0-674"></a><span class="sd">        value : Union[Path,str]</span>
</span><span id="__span-0-675"><a id="__codelineno-0-675" name="__codelineno-0-675"></a><span class="sd">            New baysor options.</span>
</span><span id="__span-0-676"><a id="__codelineno-0-676" name="__codelineno-0-676"></a><span class="sd">        """</span>
</span><span id="__span-0-677"><a id="__codelineno-0-677" name="__codelineno-0-677"></a>
</span><span id="__span-0-678"><a id="__codelineno-0-678" name="__codelineno-0-678"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-679"><a id="__codelineno-0-679" name="__codelineno-0-679"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-680"><a id="__codelineno-0-680" name="__codelineno-0-680"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"BaysorPath"</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-681"><a id="__codelineno-0-681" name="__codelineno-0-681"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-682"><a id="__codelineno-0-682" name="__codelineno-0-682"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</span><span id="__span-0-683"><a id="__codelineno-0-683" name="__codelineno-0-683"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"BaysorOptions"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span><span class="p">)</span>
</span><span id="__span-0-684"><a id="__codelineno-0-684" name="__codelineno-0-684"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state_json_path</span><span class="p">)</span>
</span><span id="__span-0-685"><a id="__codelineno-0-685" name="__codelineno-0-685"></a>
</span><span id="__span-0-686"><a id="__codelineno-0-686" name="__codelineno-0-686"></a>    <span class="nd">@property</span>
</span><span id="__span-0-687"><a id="__codelineno-0-687" name="__codelineno-0-687"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">julia_threads</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span id="__span-0-688"><a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="w">        </span><span class="sd">"""Julia thread number</span>
</span><span id="__span-0-689"><a id="__codelineno-0-689" name="__codelineno-0-689"></a>
</span><span id="__span-0-690"><a id="__codelineno-0-690" name="__codelineno-0-690"></a><span class="sd">        Returns</span>
</span><span id="__span-0-691"><a id="__codelineno-0-691" name="__codelineno-0-691"></a><span class="sd">        -------</span>
</span><span id="__span-0-692"><a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="sd">        julia_threads : int</span>
</span><span id="__span-0-693"><a id="__codelineno-0-693" name="__codelineno-0-693"></a><span class="sd">            Julia thread number.</span>
</span><span id="__span-0-694"><a id="__codelineno-0-694" name="__codelineno-0-694"></a><span class="sd">        """</span>
</span><span id="__span-0-695"><a id="__codelineno-0-695" name="__codelineno-0-695"></a>
</span><span id="__span-0-696"><a id="__codelineno-0-696" name="__codelineno-0-696"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">"_julia_threads"</span><span class="p">,</span><span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-697"><a id="__codelineno-0-697" name="__codelineno-0-697"></a>
</span><span id="__span-0-698"><a id="__codelineno-0-698" name="__codelineno-0-698"></a>    <span class="nd">@julia_threads</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-699"><a id="__codelineno-0-699" name="__codelineno-0-699"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">julia_threads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-700"><a id="__codelineno-0-700" name="__codelineno-0-700"></a><span class="w">        </span><span class="sd">"""Set the julia thread number.</span>
</span><span id="__span-0-701"><a id="__codelineno-0-701" name="__codelineno-0-701"></a>
</span><span id="__span-0-702"><a id="__codelineno-0-702" name="__codelineno-0-702"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-703"><a id="__codelineno-0-703" name="__codelineno-0-703"></a><span class="sd">        ----------</span>
</span><span id="__span-0-704"><a id="__codelineno-0-704" name="__codelineno-0-704"></a><span class="sd">        value : int</span>
</span><span id="__span-0-705"><a id="__codelineno-0-705" name="__codelineno-0-705"></a><span class="sd">            New julia thread number.</span>
</span><span id="__span-0-706"><a id="__codelineno-0-706" name="__codelineno-0-706"></a><span class="sd">        """</span>
</span><span id="__span-0-707"><a id="__codelineno-0-707" name="__codelineno-0-707"></a>
</span><span id="__span-0-708"><a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_julia_threads</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-709"><a id="__codelineno-0-709" name="__codelineno-0-709"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"JuliaThreads"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_julia_threads</span><span class="p">)</span>
</span><span id="__span-0-710"><a id="__codelineno-0-710" name="__codelineno-0-710"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state_json_path</span><span class="p">)</span>
</span><span id="__span-0-711"><a id="__codelineno-0-711" name="__codelineno-0-711"></a>
</span><span id="__span-0-712"><a id="__codelineno-0-712" name="__codelineno-0-712"></a>    <span class="nd">@property</span>
</span><span id="__span-0-713"><a id="__codelineno-0-713" name="__codelineno-0-713"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">global_normalization_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-714"><a id="__codelineno-0-714" name="__codelineno-0-714"></a><span class="w">        </span><span class="sd">"""Global normalization vector.</span>
</span><span id="__span-0-715"><a id="__codelineno-0-715" name="__codelineno-0-715"></a>
</span><span id="__span-0-716"><a id="__codelineno-0-716" name="__codelineno-0-716"></a><span class="sd">        Returns</span>
</span><span id="__span-0-717"><a id="__codelineno-0-717" name="__codelineno-0-717"></a><span class="sd">        -------</span>
</span><span id="__span-0-718"><a id="__codelineno-0-718" name="__codelineno-0-718"></a><span class="sd">        global_normalization_vector : ArrayLike</span>
</span><span id="__span-0-719"><a id="__codelineno-0-719" name="__codelineno-0-719"></a><span class="sd">            Global normalization vector.</span>
</span><span id="__span-0-720"><a id="__codelineno-0-720" name="__codelineno-0-720"></a><span class="sd">        """</span>
</span><span id="__span-0-721"><a id="__codelineno-0-721" name="__codelineno-0-721"></a>
</span><span id="__span-0-722"><a id="__codelineno-0-722" name="__codelineno-0-722"></a>        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_global_normalization_vector"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-723"><a id="__codelineno-0-723" name="__codelineno-0-723"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-724"><a id="__codelineno-0-724" name="__codelineno-0-724"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-725"><a id="__codelineno-0-725" name="__codelineno-0-725"></a>            <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-726"><a id="__codelineno-0-726" name="__codelineno-0-726"></a>
</span><span id="__span-0-727"><a id="__codelineno-0-727" name="__codelineno-0-727"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-728"><a id="__codelineno-0-728" name="__codelineno-0-728"></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
</span><span id="__span-0-729"><a id="__codelineno-0-729" name="__codelineno-0-729"></a>                    <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"global_normalization_vector"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span><span id="__span-0-730"><a id="__codelineno-0-730" name="__codelineno-0-730"></a>                <span class="p">)</span>
</span><span id="__span-0-731"><a id="__codelineno-0-731" name="__codelineno-0-731"></a>                <span class="k">return</span> <span class="n">value</span>
</span><span id="__span-0-732"><a id="__codelineno-0-732" name="__codelineno-0-732"></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="__span-0-733"><a id="__codelineno-0-733" name="__codelineno-0-733"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Global normalization vector not calculated."</span><span class="p">)</span>
</span><span id="__span-0-734"><a id="__codelineno-0-734" name="__codelineno-0-734"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-735"><a id="__codelineno-0-735" name="__codelineno-0-735"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-736"><a id="__codelineno-0-736" name="__codelineno-0-736"></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="__span-0-737"><a id="__codelineno-0-737" name="__codelineno-0-737"></a>
</span><span id="__span-0-738"><a id="__codelineno-0-738" name="__codelineno-0-738"></a>    <span class="nd">@global_normalization_vector</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-739"><a id="__codelineno-0-739" name="__codelineno-0-739"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">global_normalization_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">):</span>
</span><span id="__span-0-740"><a id="__codelineno-0-740" name="__codelineno-0-740"></a><span class="w">        </span><span class="sd">"""Set the global normalization vector.</span>
</span><span id="__span-0-741"><a id="__codelineno-0-741" name="__codelineno-0-741"></a>
</span><span id="__span-0-742"><a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-743"><a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="sd">        ----------</span>
</span><span id="__span-0-744"><a id="__codelineno-0-744" name="__codelineno-0-744"></a><span class="sd">        value : ArrayLike</span>
</span><span id="__span-0-745"><a id="__codelineno-0-745" name="__codelineno-0-745"></a><span class="sd">            New global normalization vector.</span>
</span><span id="__span-0-746"><a id="__codelineno-0-746" name="__codelineno-0-746"></a><span class="sd">        """</span>
</span><span id="__span-0-747"><a id="__codelineno-0-747" name="__codelineno-0-747"></a>
</span><span id="__span-0-748"><a id="__codelineno-0-748" name="__codelineno-0-748"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_global_normalization_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-749"><a id="__codelineno-0-749" name="__codelineno-0-749"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-750"><a id="__codelineno-0-750" name="__codelineno-0-750"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-751"><a id="__codelineno-0-751" name="__codelineno-0-751"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"global_normalization_vector"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-752"><a id="__codelineno-0-752" name="__codelineno-0-752"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_global_normalization_vector</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-753"><a id="__codelineno-0-753" name="__codelineno-0-753"></a>        <span class="p">)</span>
</span><span id="__span-0-754"><a id="__codelineno-0-754" name="__codelineno-0-754"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-755"><a id="__codelineno-0-755" name="__codelineno-0-755"></a>
</span><span id="__span-0-756"><a id="__codelineno-0-756" name="__codelineno-0-756"></a>    <span class="nd">@property</span>
</span><span id="__span-0-757"><a id="__codelineno-0-757" name="__codelineno-0-757"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">global_background_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-758"><a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="w">        </span><span class="sd">"""Global background vector.</span>
</span><span id="__span-0-759"><a id="__codelineno-0-759" name="__codelineno-0-759"></a>
</span><span id="__span-0-760"><a id="__codelineno-0-760" name="__codelineno-0-760"></a><span class="sd">        Returns</span>
</span><span id="__span-0-761"><a id="__codelineno-0-761" name="__codelineno-0-761"></a><span class="sd">        -------</span>
</span><span id="__span-0-762"><a id="__codelineno-0-762" name="__codelineno-0-762"></a><span class="sd">        global_background_vector : ArrayLike</span>
</span><span id="__span-0-763"><a id="__codelineno-0-763" name="__codelineno-0-763"></a><span class="sd">            Global background vector.</span>
</span><span id="__span-0-764"><a id="__codelineno-0-764" name="__codelineno-0-764"></a><span class="sd">        """</span>
</span><span id="__span-0-765"><a id="__codelineno-0-765" name="__codelineno-0-765"></a>
</span><span id="__span-0-766"><a id="__codelineno-0-766" name="__codelineno-0-766"></a>        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_global_background_vector"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-767"><a id="__codelineno-0-767" name="__codelineno-0-767"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-768"><a id="__codelineno-0-768" name="__codelineno-0-768"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-769"><a id="__codelineno-0-769" name="__codelineno-0-769"></a>            <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-770"><a id="__codelineno-0-770" name="__codelineno-0-770"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-771"><a id="__codelineno-0-771" name="__codelineno-0-771"></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
</span><span id="__span-0-772"><a id="__codelineno-0-772" name="__codelineno-0-772"></a>                    <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"global_background_vector"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span><span id="__span-0-773"><a id="__codelineno-0-773" name="__codelineno-0-773"></a>                <span class="p">)</span>
</span><span id="__span-0-774"><a id="__codelineno-0-774" name="__codelineno-0-774"></a>                <span class="k">return</span> <span class="n">value</span>
</span><span id="__span-0-775"><a id="__codelineno-0-775" name="__codelineno-0-775"></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="__span-0-776"><a id="__codelineno-0-776" name="__codelineno-0-776"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Global background vector not calculated."</span><span class="p">)</span>
</span><span id="__span-0-777"><a id="__codelineno-0-777" name="__codelineno-0-777"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-778"><a id="__codelineno-0-778" name="__codelineno-0-778"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-779"><a id="__codelineno-0-779" name="__codelineno-0-779"></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="__span-0-780"><a id="__codelineno-0-780" name="__codelineno-0-780"></a>
</span><span id="__span-0-781"><a id="__codelineno-0-781" name="__codelineno-0-781"></a>    <span class="nd">@global_background_vector</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-782"><a id="__codelineno-0-782" name="__codelineno-0-782"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">global_background_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">):</span>
</span><span id="__span-0-783"><a id="__codelineno-0-783" name="__codelineno-0-783"></a><span class="w">        </span><span class="sd">"""Set the global background vector.</span>
</span><span id="__span-0-784"><a id="__codelineno-0-784" name="__codelineno-0-784"></a>
</span><span id="__span-0-785"><a id="__codelineno-0-785" name="__codelineno-0-785"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-786"><a id="__codelineno-0-786" name="__codelineno-0-786"></a><span class="sd">        ----------</span>
</span><span id="__span-0-787"><a id="__codelineno-0-787" name="__codelineno-0-787"></a><span class="sd">        value : ArrayLike</span>
</span><span id="__span-0-788"><a id="__codelineno-0-788" name="__codelineno-0-788"></a><span class="sd">            New global background vector.</span>
</span><span id="__span-0-789"><a id="__codelineno-0-789" name="__codelineno-0-789"></a><span class="sd">        """</span>
</span><span id="__span-0-790"><a id="__codelineno-0-790" name="__codelineno-0-790"></a>
</span><span id="__span-0-791"><a id="__codelineno-0-791" name="__codelineno-0-791"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_global_background_vector</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-792"><a id="__codelineno-0-792" name="__codelineno-0-792"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-793"><a id="__codelineno-0-793" name="__codelineno-0-793"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-794"><a id="__codelineno-0-794" name="__codelineno-0-794"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"global_background_vector"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-795"><a id="__codelineno-0-795" name="__codelineno-0-795"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_global_background_vector</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-796"><a id="__codelineno-0-796" name="__codelineno-0-796"></a>        <span class="p">)</span>
</span><span id="__span-0-797"><a id="__codelineno-0-797" name="__codelineno-0-797"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-798"><a id="__codelineno-0-798" name="__codelineno-0-798"></a>
</span><span id="__span-0-799"><a id="__codelineno-0-799" name="__codelineno-0-799"></a>    <span class="nd">@property</span>
</span><span id="__span-0-800"><a id="__codelineno-0-800" name="__codelineno-0-800"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">iterative_normalization_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-801"><a id="__codelineno-0-801" name="__codelineno-0-801"></a><span class="w">        </span><span class="sd">"""Iterative normalization vector.</span>
</span><span id="__span-0-802"><a id="__codelineno-0-802" name="__codelineno-0-802"></a>
</span><span id="__span-0-803"><a id="__codelineno-0-803" name="__codelineno-0-803"></a><span class="sd">        Returns</span>
</span><span id="__span-0-804"><a id="__codelineno-0-804" name="__codelineno-0-804"></a><span class="sd">        -------</span>
</span><span id="__span-0-805"><a id="__codelineno-0-805" name="__codelineno-0-805"></a><span class="sd">        iterative_normalization_vector : ArrayLike</span>
</span><span id="__span-0-806"><a id="__codelineno-0-806" name="__codelineno-0-806"></a><span class="sd">            Iterative normalization vector.</span>
</span><span id="__span-0-807"><a id="__codelineno-0-807" name="__codelineno-0-807"></a><span class="sd">        """</span>
</span><span id="__span-0-808"><a id="__codelineno-0-808" name="__codelineno-0-808"></a>
</span><span id="__span-0-809"><a id="__codelineno-0-809" name="__codelineno-0-809"></a>        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_iterative_normalization_vector"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-810"><a id="__codelineno-0-810" name="__codelineno-0-810"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-811"><a id="__codelineno-0-811" name="__codelineno-0-811"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-812"><a id="__codelineno-0-812" name="__codelineno-0-812"></a>            <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-813"><a id="__codelineno-0-813" name="__codelineno-0-813"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-814"><a id="__codelineno-0-814" name="__codelineno-0-814"></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
</span><span id="__span-0-815"><a id="__codelineno-0-815" name="__codelineno-0-815"></a>                    <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"iterative_normalization_vector"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span><span id="__span-0-816"><a id="__codelineno-0-816" name="__codelineno-0-816"></a>                <span class="p">)</span>
</span><span id="__span-0-817"><a id="__codelineno-0-817" name="__codelineno-0-817"></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="__span-0-818"><a id="__codelineno-0-818" name="__codelineno-0-818"></a>                <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-819"><a id="__codelineno-0-819" name="__codelineno-0-819"></a>
</span><span id="__span-0-820"><a id="__codelineno-0-820" name="__codelineno-0-820"></a>            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-821"><a id="__codelineno-0-821" name="__codelineno-0-821"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Iterative normalization vector not calculated."</span><span class="p">)</span>
</span><span id="__span-0-822"><a id="__codelineno-0-822" name="__codelineno-0-822"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-823"><a id="__codelineno-0-823" name="__codelineno-0-823"></a>
</span><span id="__span-0-824"><a id="__codelineno-0-824" name="__codelineno-0-824"></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="__span-0-825"><a id="__codelineno-0-825" name="__codelineno-0-825"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-826"><a id="__codelineno-0-826" name="__codelineno-0-826"></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="__span-0-827"><a id="__codelineno-0-827" name="__codelineno-0-827"></a>
</span><span id="__span-0-828"><a id="__codelineno-0-828" name="__codelineno-0-828"></a>    <span class="nd">@iterative_normalization_vector</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-829"><a id="__codelineno-0-829" name="__codelineno-0-829"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">iterative_normalization_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">):</span>
</span><span id="__span-0-830"><a id="__codelineno-0-830" name="__codelineno-0-830"></a><span class="w">        </span><span class="sd">"""Set the iterative normalization vector.</span>
</span><span id="__span-0-831"><a id="__codelineno-0-831" name="__codelineno-0-831"></a>
</span><span id="__span-0-832"><a id="__codelineno-0-832" name="__codelineno-0-832"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-833"><a id="__codelineno-0-833" name="__codelineno-0-833"></a><span class="sd">        ----------</span>
</span><span id="__span-0-834"><a id="__codelineno-0-834" name="__codelineno-0-834"></a><span class="sd">        value : ArrayLike</span>
</span><span id="__span-0-835"><a id="__codelineno-0-835" name="__codelineno-0-835"></a><span class="sd">            New iterative normalization vector.</span>
</span><span id="__span-0-836"><a id="__codelineno-0-836" name="__codelineno-0-836"></a><span class="sd">        """</span>
</span><span id="__span-0-837"><a id="__codelineno-0-837" name="__codelineno-0-837"></a>
</span><span id="__span-0-838"><a id="__codelineno-0-838" name="__codelineno-0-838"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_iterative_normalization_vector</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-839"><a id="__codelineno-0-839" name="__codelineno-0-839"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-840"><a id="__codelineno-0-840" name="__codelineno-0-840"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-841"><a id="__codelineno-0-841" name="__codelineno-0-841"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"iterative_normalization_vector"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-842"><a id="__codelineno-0-842" name="__codelineno-0-842"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_iterative_normalization_vector</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-843"><a id="__codelineno-0-843" name="__codelineno-0-843"></a>        <span class="p">)</span>
</span><span id="__span-0-844"><a id="__codelineno-0-844" name="__codelineno-0-844"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-845"><a id="__codelineno-0-845" name="__codelineno-0-845"></a>
</span><span id="__span-0-846"><a id="__codelineno-0-846" name="__codelineno-0-846"></a>    <span class="nd">@property</span>
</span><span id="__span-0-847"><a id="__codelineno-0-847" name="__codelineno-0-847"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">iterative_background_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-848"><a id="__codelineno-0-848" name="__codelineno-0-848"></a><span class="w">        </span><span class="sd">"""Iterative background vector.</span>
</span><span id="__span-0-849"><a id="__codelineno-0-849" name="__codelineno-0-849"></a>
</span><span id="__span-0-850"><a id="__codelineno-0-850" name="__codelineno-0-850"></a><span class="sd">        Returns</span>
</span><span id="__span-0-851"><a id="__codelineno-0-851" name="__codelineno-0-851"></a><span class="sd">        -------</span>
</span><span id="__span-0-852"><a id="__codelineno-0-852" name="__codelineno-0-852"></a><span class="sd">        iterative_background_vector : ArrayLike</span>
</span><span id="__span-0-853"><a id="__codelineno-0-853" name="__codelineno-0-853"></a><span class="sd">            Iterative background vector.</span>
</span><span id="__span-0-854"><a id="__codelineno-0-854" name="__codelineno-0-854"></a><span class="sd">        """</span>
</span><span id="__span-0-855"><a id="__codelineno-0-855" name="__codelineno-0-855"></a>
</span><span id="__span-0-856"><a id="__codelineno-0-856" name="__codelineno-0-856"></a>        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_iterative_background_vector"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-857"><a id="__codelineno-0-857" name="__codelineno-0-857"></a>        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-858"><a id="__codelineno-0-858" name="__codelineno-0-858"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-859"><a id="__codelineno-0-859" name="__codelineno-0-859"></a>            <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-860"><a id="__codelineno-0-860" name="__codelineno-0-860"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-861"><a id="__codelineno-0-861" name="__codelineno-0-861"></a>                <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
</span><span id="__span-0-862"><a id="__codelineno-0-862" name="__codelineno-0-862"></a>                    <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"iterative_background_vector"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span><span id="__span-0-863"><a id="__codelineno-0-863" name="__codelineno-0-863"></a>                <span class="p">)</span>
</span><span id="__span-0-864"><a id="__codelineno-0-864" name="__codelineno-0-864"></a>            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="__span-0-865"><a id="__codelineno-0-865" name="__codelineno-0-865"></a>                <span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="__span-0-866"><a id="__codelineno-0-866" name="__codelineno-0-866"></a>            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-867"><a id="__codelineno-0-867" name="__codelineno-0-867"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Iterative background vector not calculated."</span><span class="p">)</span>
</span><span id="__span-0-868"><a id="__codelineno-0-868" name="__codelineno-0-868"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-869"><a id="__codelineno-0-869" name="__codelineno-0-869"></a>
</span><span id="__span-0-870"><a id="__codelineno-0-870" name="__codelineno-0-870"></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="__span-0-871"><a id="__codelineno-0-871" name="__codelineno-0-871"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-872"><a id="__codelineno-0-872" name="__codelineno-0-872"></a>            <span class="k">return</span> <span class="n">value</span>
</span><span id="__span-0-873"><a id="__codelineno-0-873" name="__codelineno-0-873"></a>
</span><span id="__span-0-874"><a id="__codelineno-0-874" name="__codelineno-0-874"></a>    <span class="nd">@iterative_background_vector</span><span class="o">.</span><span class="n">setter</span>
</span><span id="__span-0-875"><a id="__codelineno-0-875" name="__codelineno-0-875"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">iterative_background_vector</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">):</span>
</span><span id="__span-0-876"><a id="__codelineno-0-876" name="__codelineno-0-876"></a><span class="w">        </span><span class="sd">"""Set the iterative background vector.</span>
</span><span id="__span-0-877"><a id="__codelineno-0-877" name="__codelineno-0-877"></a>
</span><span id="__span-0-878"><a id="__codelineno-0-878" name="__codelineno-0-878"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-879"><a id="__codelineno-0-879" name="__codelineno-0-879"></a><span class="sd">        ----------</span>
</span><span id="__span-0-880"><a id="__codelineno-0-880" name="__codelineno-0-880"></a><span class="sd">        value : ArrayLike</span>
</span><span id="__span-0-881"><a id="__codelineno-0-881" name="__codelineno-0-881"></a><span class="sd">            New iterative background vector.</span>
</span><span id="__span-0-882"><a id="__codelineno-0-882" name="__codelineno-0-882"></a><span class="sd">        """</span>
</span><span id="__span-0-883"><a id="__codelineno-0-883" name="__codelineno-0-883"></a>
</span><span id="__span-0-884"><a id="__codelineno-0-884" name="__codelineno-0-884"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_iterative_background_vector</span> <span class="o">=</span> <span class="n">value</span>
</span><span id="__span-0-885"><a id="__codelineno-0-885" name="__codelineno-0-885"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-886"><a id="__codelineno-0-886" name="__codelineno-0-886"></a>        <span class="n">calib_zattrs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-887"><a id="__codelineno-0-887" name="__codelineno-0-887"></a>        <span class="n">calib_zattrs</span><span class="p">[</span><span class="s2">"iterative_background_vector"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-888"><a id="__codelineno-0-888" name="__codelineno-0-888"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_iterative_background_vector</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-889"><a id="__codelineno-0-889" name="__codelineno-0-889"></a>        <span class="p">)</span>
</span><span id="__span-0-890"><a id="__codelineno-0-890" name="__codelineno-0-890"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">calib_zattrs</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-891"><a id="__codelineno-0-891" name="__codelineno-0-891"></a>
</span><span id="__span-0-892"><a id="__codelineno-0-892" name="__codelineno-0-892"></a>    <span class="nd">@property</span>
</span><span id="__span-0-893"><a id="__codelineno-0-893" name="__codelineno-0-893"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">tile_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="__span-0-894"><a id="__codelineno-0-894" name="__codelineno-0-894"></a><span class="w">        </span><span class="sd">"""Tile IDs.</span>
</span><span id="__span-0-895"><a id="__codelineno-0-895" name="__codelineno-0-895"></a>
</span><span id="__span-0-896"><a id="__codelineno-0-896" name="__codelineno-0-896"></a><span class="sd">        Returns</span>
</span><span id="__span-0-897"><a id="__codelineno-0-897" name="__codelineno-0-897"></a><span class="sd">        -------</span>
</span><span id="__span-0-898"><a id="__codelineno-0-898" name="__codelineno-0-898"></a><span class="sd">        tile_ids : Collection[str]</span>
</span><span id="__span-0-899"><a id="__codelineno-0-899" name="__codelineno-0-899"></a><span class="sd">            Tile IDs.</span>
</span><span id="__span-0-900"><a id="__codelineno-0-900" name="__codelineno-0-900"></a><span class="sd">        """</span>
</span><span id="__span-0-901"><a id="__codelineno-0-901" name="__codelineno-0-901"></a>
</span><span id="__span-0-902"><a id="__codelineno-0-902" name="__codelineno-0-902"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_tile_ids"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-903"><a id="__codelineno-0-903" name="__codelineno-0-903"></a>
</span><span id="__span-0-904"><a id="__codelineno-0-904" name="__codelineno-0-904"></a>    <span class="nd">@property</span>
</span><span id="__span-0-905"><a id="__codelineno-0-905" name="__codelineno-0-905"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">round_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="__span-0-906"><a id="__codelineno-0-906" name="__codelineno-0-906"></a><span class="w">        </span><span class="sd">"""Round IDs.</span>
</span><span id="__span-0-907"><a id="__codelineno-0-907" name="__codelineno-0-907"></a>
</span><span id="__span-0-908"><a id="__codelineno-0-908" name="__codelineno-0-908"></a><span class="sd">        Returns</span>
</span><span id="__span-0-909"><a id="__codelineno-0-909" name="__codelineno-0-909"></a><span class="sd">        -------</span>
</span><span id="__span-0-910"><a id="__codelineno-0-910" name="__codelineno-0-910"></a><span class="sd">        round_ids : Collection[str]</span>
</span><span id="__span-0-911"><a id="__codelineno-0-911" name="__codelineno-0-911"></a><span class="sd">            Round IDs.</span>
</span><span id="__span-0-912"><a id="__codelineno-0-912" name="__codelineno-0-912"></a><span class="sd">        """</span>
</span><span id="__span-0-913"><a id="__codelineno-0-913" name="__codelineno-0-913"></a>
</span><span id="__span-0-914"><a id="__codelineno-0-914" name="__codelineno-0-914"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_round_ids"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-915"><a id="__codelineno-0-915" name="__codelineno-0-915"></a>
</span><span id="__span-0-916"><a id="__codelineno-0-916" name="__codelineno-0-916"></a>    <span class="nd">@property</span>
</span><span id="__span-0-917"><a id="__codelineno-0-917" name="__codelineno-0-917"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">bit_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
</span><span id="__span-0-918"><a id="__codelineno-0-918" name="__codelineno-0-918"></a><span class="w">        </span><span class="sd">"""Bit IDs.</span>
</span><span id="__span-0-919"><a id="__codelineno-0-919" name="__codelineno-0-919"></a>
</span><span id="__span-0-920"><a id="__codelineno-0-920" name="__codelineno-0-920"></a><span class="sd">        Returns</span>
</span><span id="__span-0-921"><a id="__codelineno-0-921" name="__codelineno-0-921"></a><span class="sd">        -------</span>
</span><span id="__span-0-922"><a id="__codelineno-0-922" name="__codelineno-0-922"></a><span class="sd">        bit_ids : Collection[str]</span>
</span><span id="__span-0-923"><a id="__codelineno-0-923" name="__codelineno-0-923"></a><span class="sd">            Bit IDs.</span>
</span><span id="__span-0-924"><a id="__codelineno-0-924" name="__codelineno-0-924"></a><span class="sd">        """</span>
</span><span id="__span-0-925"><a id="__codelineno-0-925" name="__codelineno-0-925"></a>
</span><span id="__span-0-926"><a id="__codelineno-0-926" name="__codelineno-0-926"></a>        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_bit_ids"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-927"><a id="__codelineno-0-927" name="__codelineno-0-927"></a>
</span><span id="__span-0-928"><a id="__codelineno-0-928" name="__codelineno-0-928"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_init_datastore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-929"><a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="w">        </span><span class="sd">"""Initialize datastore.</span>
</span><span id="__span-0-930"><a id="__codelineno-0-930" name="__codelineno-0-930"></a>
</span><span id="__span-0-931"><a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="sd">        Create directory structure and initialize datastore state.</span>
</span><span id="__span-0-932"><a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="sd">        """</span>
</span><span id="__span-0-933"><a id="__codelineno-0-933" name="__codelineno-0-933"></a>
</span><span id="__span-0-934"><a id="__codelineno-0-934" name="__codelineno-0-934"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-935"><a id="__codelineno-0-935" name="__codelineno-0-935"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"calibrations.zarr"</span><span class="p">)</span>
</span><span id="__span-0-936"><a id="__codelineno-0-936" name="__codelineno-0-936"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-937"><a id="__codelineno-0-937" name="__codelineno-0-937"></a>        <span class="n">calibrations_zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-938"><a id="__codelineno-0-938" name="__codelineno-0-938"></a>        <span class="n">empty_zattrs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-939"><a id="__codelineno-0-939" name="__codelineno-0-939"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">empty_zattrs</span><span class="p">,</span> <span class="n">calibrations_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-940"><a id="__codelineno-0-940" name="__codelineno-0-940"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"polyDT"</span><span class="p">)</span>
</span><span id="__span-0-941"><a id="__codelineno-0-941" name="__codelineno-0-941"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-942"><a id="__codelineno-0-942" name="__codelineno-0-942"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"readouts"</span><span class="p">)</span>
</span><span id="__span-0-943"><a id="__codelineno-0-943" name="__codelineno-0-943"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-944"><a id="__codelineno-0-944" name="__codelineno-0-944"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-945"><a id="__codelineno-0-945" name="__codelineno-0-945"></a>            <span class="sa">r</span><span class="s2">"ufish_localizations"</span>
</span><span id="__span-0-946"><a id="__codelineno-0-946" name="__codelineno-0-946"></a>        <span class="p">)</span>
</span><span id="__span-0-947"><a id="__codelineno-0-947" name="__codelineno-0-947"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-948"><a id="__codelineno-0-948" name="__codelineno-0-948"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"decoded"</span><span class="p">)</span>
</span><span id="__span-0-949"><a id="__codelineno-0-949" name="__codelineno-0-949"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-950"><a id="__codelineno-0-950" name="__codelineno-0-950"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"fused"</span><span class="p">)</span>
</span><span id="__span-0-951"><a id="__codelineno-0-951" name="__codelineno-0-951"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-952"><a id="__codelineno-0-952" name="__codelineno-0-952"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"segmentation"</span><span class="p">)</span>
</span><span id="__span-0-953"><a id="__codelineno-0-953" name="__codelineno-0-953"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-954"><a id="__codelineno-0-954" name="__codelineno-0-954"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mtx_output_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"mtx_output"</span><span class="p">)</span>
</span><span id="__span-0-955"><a id="__codelineno-0-955" name="__codelineno-0-955"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mtx_output_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-956"><a id="__codelineno-0-956" name="__codelineno-0-956"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">""</span>
</span><span id="__span-0-957"><a id="__codelineno-0-957" name="__codelineno-0-957"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">""</span>
</span><span id="__span-0-958"><a id="__codelineno-0-958" name="__codelineno-0-958"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_julia_threads</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-959"><a id="__codelineno-0-959" name="__codelineno-0-959"></a>
</span><span id="__span-0-960"><a id="__codelineno-0-960" name="__codelineno-0-960"></a>        <span class="c1"># initialize datastore state</span>
</span><span id="__span-0-961"><a id="__codelineno-0-961" name="__codelineno-0-961"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state_json_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-962"><a id="__codelineno-0-962" name="__codelineno-0-962"></a>            <span class="sa">r</span><span class="s2">"datastore_state.json"</span>
</span><span id="__span-0-963"><a id="__codelineno-0-963" name="__codelineno-0-963"></a>        <span class="p">)</span>
</span><span id="__span-0-964"><a id="__codelineno-0-964" name="__codelineno-0-964"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-965"><a id="__codelineno-0-965" name="__codelineno-0-965"></a>            <span class="s2">"Version"</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="__span-0-966"><a id="__codelineno-0-966" name="__codelineno-0-966"></a>            <span class="s2">"Initialized"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-967"><a id="__codelineno-0-967" name="__codelineno-0-967"></a>            <span class="s2">"Calibrations"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-968"><a id="__codelineno-0-968" name="__codelineno-0-968"></a>            <span class="s2">"Corrected"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-969"><a id="__codelineno-0-969" name="__codelineno-0-969"></a>            <span class="s2">"LocalRegistered"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-970"><a id="__codelineno-0-970" name="__codelineno-0-970"></a>            <span class="s2">"GlobalRegistered"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-971"><a id="__codelineno-0-971" name="__codelineno-0-971"></a>            <span class="s2">"Fused"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-972"><a id="__codelineno-0-972" name="__codelineno-0-972"></a>            <span class="s2">"SegmentedCells"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-973"><a id="__codelineno-0-973" name="__codelineno-0-973"></a>            <span class="s2">"DecodedSpots"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-974"><a id="__codelineno-0-974" name="__codelineno-0-974"></a>            <span class="s2">"FilteredSpots"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-975"><a id="__codelineno-0-975" name="__codelineno-0-975"></a>            <span class="s2">"RefinedSpots"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-976"><a id="__codelineno-0-976" name="__codelineno-0-976"></a>            <span class="s2">"mtxOutput"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-977"><a id="__codelineno-0-977" name="__codelineno-0-977"></a>            <span class="s2">"BaysorPath"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span><span class="p">),</span>
</span><span id="__span-0-978"><a id="__codelineno-0-978" name="__codelineno-0-978"></a>            <span class="s2">"BaysorOptions"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span><span class="p">),</span>
</span><span id="__span-0-979"><a id="__codelineno-0-979" name="__codelineno-0-979"></a>            <span class="s2">"JuliaThreads"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_julia_threads</span><span class="p">)</span>
</span><span id="__span-0-980"><a id="__codelineno-0-980" name="__codelineno-0-980"></a>        <span class="p">}</span>
</span><span id="__span-0-981"><a id="__codelineno-0-981" name="__codelineno-0-981"></a>
</span><span id="__span-0-982"><a id="__codelineno-0-982" name="__codelineno-0-982"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state_json_path</span><span class="p">)</span>
</span><span id="__span-0-983"><a id="__codelineno-0-983" name="__codelineno-0-983"></a>
</span><span id="__span-0-984"><a id="__codelineno-0-984" name="__codelineno-0-984"></a>    <span class="nd">@staticmethod</span>
</span><span id="__span-0-985"><a id="__codelineno-0-985" name="__codelineno-0-985"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_get_kvstore_key</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-0-986"><a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="w">        </span><span class="sd">"""Convert datastore location to tensorstore kvstore key.</span>
</span><span id="__span-0-987"><a id="__codelineno-0-987" name="__codelineno-0-987"></a>
</span><span id="__span-0-988"><a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-989"><a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="sd">        ----------</span>
</span><span id="__span-0-990"><a id="__codelineno-0-990" name="__codelineno-0-990"></a><span class="sd">        path : Union[Path, str]</span>
</span><span id="__span-0-991"><a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="sd">            Datastore location.</span>
</span><span id="__span-0-992"><a id="__codelineno-0-992" name="__codelineno-0-992"></a>
</span><span id="__span-0-993"><a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">        Returns</span>
</span><span id="__span-0-994"><a id="__codelineno-0-994" name="__codelineno-0-994"></a><span class="sd">        -------</span>
</span><span id="__span-0-995"><a id="__codelineno-0-995" name="__codelineno-0-995"></a><span class="sd">        kvstore_key : dict</span>
</span><span id="__span-0-996"><a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">            Tensorstore kvstore key.</span>
</span><span id="__span-0-997"><a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">        """</span>
</span><span id="__span-0-998"><a id="__codelineno-0-998" name="__codelineno-0-998"></a>
</span><span id="__span-0-999"><a id="__codelineno-0-999" name="__codelineno-0-999"></a>        <span class="n">path_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-0-1000"><a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>        <span class="k">if</span> <span class="n">path_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"s3://"</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">"s3.amazonaws.com"</span> <span class="ow">in</span> <span class="n">path_str</span><span class="p">:</span>
</span><span id="__span-0-1001"><a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"s3"</span><span class="p">,</span> <span class="s2">"path"</span><span class="p">:</span> <span class="n">path_str</span><span class="p">}</span>
</span><span id="__span-0-1002"><a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>        <span class="k">elif</span> <span class="n">path_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"gs://"</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">"storage.googleapis.com"</span> <span class="ow">in</span> <span class="n">path_str</span><span class="p">:</span>
</span><span id="__span-0-1003"><a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"gcs"</span><span class="p">,</span> <span class="s2">"path"</span><span class="p">:</span> <span class="n">path_str</span><span class="p">}</span>
</span><span id="__span-0-1004"><a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>        <span class="k">elif</span> <span class="n">path_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"azure://"</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">"blob.core.windows.net"</span> <span class="ow">in</span> <span class="n">path_str</span><span class="p">:</span>
</span><span id="__span-0-1005"><a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"azure"</span><span class="p">,</span> <span class="s2">"path"</span><span class="p">:</span> <span class="n">path_str</span><span class="p">}</span>
</span><span id="__span-0-1006"><a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>        <span class="k">elif</span> <span class="n">path_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"http://"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">path_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"https://"</span><span class="p">):</span>
</span><span id="__span-0-1007"><a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unsupported cloud storage provider in URL"</span><span class="p">)</span>
</span><span id="__span-0-1008"><a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1009"><a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>            <span class="k">return</span> <span class="p">{</span><span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"file"</span><span class="p">,</span> <span class="s2">"path"</span><span class="p">:</span> <span class="n">path_str</span><span class="p">}</span>
</span><span id="__span-0-1010"><a id="__codelineno-0-1010" name="__codelineno-0-1010"></a>
</span><span id="__span-0-1011"><a id="__codelineno-0-1011" name="__codelineno-0-1011"></a>    <span class="nd">@staticmethod</span>
</span><span id="__span-0-1012"><a id="__codelineno-0-1012" name="__codelineno-0-1012"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load_from_json</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-0-1013"><a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><span class="w">        </span><span class="sd">"""Load json as dictionary.</span>
</span><span id="__span-0-1014"><a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>
</span><span id="__span-0-1015"><a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-1016"><a id="__codelineno-0-1016" name="__codelineno-0-1016"></a><span class="sd">        ----------</span>
</span><span id="__span-0-1017"><a id="__codelineno-0-1017" name="__codelineno-0-1017"></a><span class="sd">        dictionary_path : Union[Path, str]</span>
</span><span id="__span-0-1018"><a id="__codelineno-0-1018" name="__codelineno-0-1018"></a><span class="sd">            Path to json file.</span>
</span><span id="__span-0-1019"><a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>
</span><span id="__span-0-1020"><a id="__codelineno-0-1020" name="__codelineno-0-1020"></a><span class="sd">        Returns</span>
</span><span id="__span-0-1021"><a id="__codelineno-0-1021" name="__codelineno-0-1021"></a><span class="sd">        -------</span>
</span><span id="__span-0-1022"><a id="__codelineno-0-1022" name="__codelineno-0-1022"></a><span class="sd">        dictionary : dict</span>
</span><span id="__span-0-1023"><a id="__codelineno-0-1023" name="__codelineno-0-1023"></a><span class="sd">            Dictionary from json file.</span>
</span><span id="__span-0-1024"><a id="__codelineno-0-1024" name="__codelineno-0-1024"></a><span class="sd">        """</span>
</span><span id="__span-0-1025"><a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>
</span><span id="__span-0-1026"><a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1027"><a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-1028"><a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>                <span class="n">dictionary</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-0-1029"><a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1030"><a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>            <span class="n">dictionary</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-1031"><a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>        <span class="k">return</span> <span class="n">dictionary</span>
</span><span id="__span-0-1032"><a id="__codelineno-0-1032" name="__codelineno-0-1032"></a>
</span><span id="__span-0-1033"><a id="__codelineno-0-1033" name="__codelineno-0-1033"></a>    <span class="nd">@staticmethod</span>
</span><span id="__span-0-1034"><a id="__codelineno-0-1034" name="__codelineno-0-1034"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_save_to_json</span><span class="p">(</span><span class="n">dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">dictionary_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
</span><span id="__span-0-1035"><a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><span class="w">        </span><span class="sd">"""Save dictionary to json.</span>
</span><span id="__span-0-1036"><a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>
</span><span id="__span-0-1037"><a id="__codelineno-0-1037" name="__codelineno-0-1037"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-1038"><a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="sd">        ----------</span>
</span><span id="__span-0-1039"><a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="sd">        dictionary : dict</span>
</span><span id="__span-0-1040"><a id="__codelineno-0-1040" name="__codelineno-0-1040"></a><span class="sd">            The data to be saved.</span>
</span><span id="__span-0-1041"><a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="sd">        dictionary_path : Union[Path,str]</span>
</span><span id="__span-0-1042"><a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">            The path to the JSON file where the data will be saved.</span>
</span><span id="__span-0-1043"><a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">        """</span>
</span><span id="__span-0-1044"><a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>
</span><span id="__span-0-1045"><a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="__span-0-1046"><a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span><span id="__span-0-1047"><a id="__codelineno-0-1047" name="__codelineno-0-1047"></a>
</span><span id="__span-0-1048"><a id="__codelineno-0-1048" name="__codelineno-0-1048"></a>    <span class="nd">@staticmethod</span>
</span><span id="__span-0-1049"><a id="__codelineno-0-1049" name="__codelineno-0-1049"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load_from_microjson</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-0-1050"><a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="w">        </span><span class="sd">"""Load cell outlines outlines microjson as dictionary.</span>
</span><span id="__span-0-1051"><a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>
</span><span id="__span-0-1052"><a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-1053"><a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">        ----------</span>
</span><span id="__span-0-1054"><a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">        dictionary_path : Union[Path, str]</span>
</span><span id="__span-0-1055"><a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="sd">            Path to microjson file.</span>
</span><span id="__span-0-1056"><a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>
</span><span id="__span-0-1057"><a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">        Returns</span>
</span><span id="__span-0-1058"><a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="sd">        -------</span>
</span><span id="__span-0-1059"><a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">        outlines : dict</span>
</span><span id="__span-0-1060"><a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">            Cell outlines dictionary.</span>
</span><span id="__span-0-1061"><a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">        """</span>
</span><span id="__span-0-1062"><a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>
</span><span id="__span-0-1063"><a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1064"><a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-1065"><a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>                <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-0-1066"><a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>                <span class="n">outlines</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-1067"><a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>                <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">"features"</span><span class="p">]:</span>
</span><span id="__span-0-1068"><a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>                    <span class="n">cell_id</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s2">"properties"</span><span class="p">][</span><span class="s2">"cell_id"</span><span class="p">]</span>
</span><span id="__span-0-1069"><a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>                    <span class="n">coordinates</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s2">"geometry"</span><span class="p">][</span><span class="s2">"coordinates"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-1070"><a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>                    <span class="n">outlines</span><span class="p">[</span><span class="n">cell_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
</span><span id="__span-0-1071"><a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
</span><span id="__span-0-1072"><a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>            <span class="n">outlines</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-1073"><a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>        <span class="k">return</span> <span class="n">outlines</span>
</span><span id="__span-0-1074"><a id="__codelineno-0-1074" name="__codelineno-0-1074"></a>
</span><span id="__span-0-1075"><a id="__codelineno-0-1075" name="__codelineno-0-1075"></a>    <span class="nd">@staticmethod</span>
</span><span id="__span-0-1076"><a id="__codelineno-0-1076" name="__codelineno-0-1076"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_check_for_zarr_array</span><span class="p">(</span><span class="n">kvstore</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="__span-0-1077"><a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="w">        </span><span class="sd">"""Check if zarr array exists using Tensortore.</span>
</span><span id="__span-0-1078"><a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>
</span><span id="__span-0-1079"><a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-1080"><a id="__codelineno-0-1080" name="__codelineno-0-1080"></a><span class="sd">        ----------</span>
</span><span id="__span-0-1081"><a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><span class="sd">        kvstore : Union[Path, str]</span>
</span><span id="__span-0-1082"><a id="__codelineno-0-1082" name="__codelineno-0-1082"></a><span class="sd">            Datastore location.</span>
</span><span id="__span-0-1083"><a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><span class="sd">        spec : dict</span>
</span><span id="__span-0-1084"><a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><span class="sd">            Zarr specification.</span>
</span><span id="__span-0-1085"><a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">        """</span>
</span><span id="__span-0-1086"><a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>
</span><span id="__span-0-1087"><a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>        <span class="n">current_zarr</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
</span><span id="__span-0-1088"><a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>            <span class="p">{</span>
</span><span id="__span-0-1089"><a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>                <span class="o">**</span><span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-1090"><a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>                <span class="s2">"kvstore"</span><span class="p">:</span> <span class="n">kvstore</span><span class="p">,</span>
</span><span id="__span-0-1091"><a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>            <span class="p">}</span>
</span><span id="__span-0-1092"><a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>        <span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-0-1093"><a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>
</span><span id="__span-0-1094"><a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>        <span class="k">del</span> <span class="n">current_zarr</span>
</span><span id="__span-0-1095"><a id="__codelineno-0-1095" name="__codelineno-0-1095"></a>
</span><span id="__span-0-1096"><a id="__codelineno-0-1096" name="__codelineno-0-1096"></a>    <span class="nd">@staticmethod</span>
</span><span id="__span-0-1097"><a id="__codelineno-0-1097" name="__codelineno-0-1097"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1098"><a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>        <span class="n">kvstore</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-0-1099"><a id="__codelineno-0-1099" name="__codelineno-0-1099"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayLike</span><span class="p">:</span>
</span><span id="__span-0-1100"><a id="__codelineno-0-1100" name="__codelineno-0-1100"></a><span class="w">        </span><span class="sd">"""Return tensorstore array from zarr</span>
</span><span id="__span-0-1101"><a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>
</span><span id="__span-0-1102"><a id="__codelineno-0-1102" name="__codelineno-0-1102"></a><span class="sd">        Defaults to returning future result.</span>
</span><span id="__span-0-1103"><a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>
</span><span id="__span-0-1104"><a id="__codelineno-0-1104" name="__codelineno-0-1104"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-1105"><a id="__codelineno-0-1105" name="__codelineno-0-1105"></a><span class="sd">        ----------</span>
</span><span id="__span-0-1106"><a id="__codelineno-0-1106" name="__codelineno-0-1106"></a><span class="sd">        kvstore : dict</span>
</span><span id="__span-0-1107"><a id="__codelineno-0-1107" name="__codelineno-0-1107"></a><span class="sd">            Tensorstore kvstore specification.</span>
</span><span id="__span-0-1108"><a id="__codelineno-0-1108" name="__codelineno-0-1108"></a><span class="sd">        spec : dict</span>
</span><span id="__span-0-1109"><a id="__codelineno-0-1109" name="__codelineno-0-1109"></a><span class="sd">            Tensorstore zarr specification.</span>
</span><span id="__span-0-1110"><a id="__codelineno-0-1110" name="__codelineno-0-1110"></a><span class="sd">        return_future : bool</span>
</span><span id="__span-0-1111"><a id="__codelineno-0-1111" name="__codelineno-0-1111"></a><span class="sd">            Return future (True) or immediately read (False).</span>
</span><span id="__span-0-1112"><a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>
</span><span id="__span-0-1113"><a id="__codelineno-0-1113" name="__codelineno-0-1113"></a><span class="sd">        Returns</span>
</span><span id="__span-0-1114"><a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><span class="sd">        -------</span>
</span><span id="__span-0-1115"><a id="__codelineno-0-1115" name="__codelineno-0-1115"></a><span class="sd">        array : ArrayLike</span>
</span><span id="__span-0-1116"><a id="__codelineno-0-1116" name="__codelineno-0-1116"></a><span class="sd">            Delayed (future) or immediate array.</span>
</span><span id="__span-0-1117"><a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="sd">        """</span>
</span><span id="__span-0-1118"><a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>
</span><span id="__span-0-1119"><a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>        <span class="n">current_zarr</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
</span><span id="__span-0-1120"><a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>            <span class="p">{</span>
</span><span id="__span-0-1121"><a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>                <span class="o">**</span><span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-1122"><a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>                <span class="s2">"kvstore"</span><span class="p">:</span> <span class="n">kvstore</span><span class="p">,</span>
</span><span id="__span-0-1123"><a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>            <span class="p">}</span>
</span><span id="__span-0-1124"><a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>        <span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-0-1125"><a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>
</span><span id="__span-0-1126"><a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>        <span class="n">read_future</span> <span class="o">=</span> <span class="n">current_zarr</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="__span-0-1127"><a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>
</span><span id="__span-0-1128"><a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>        <span class="k">if</span> <span class="n">return_future</span><span class="p">:</span>
</span><span id="__span-0-1129"><a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>            <span class="k">return</span> <span class="n">read_future</span>
</span><span id="__span-0-1130"><a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1131"><a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>            <span class="k">return</span> <span class="n">read_future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-0-1132"><a id="__codelineno-0-1132" name="__codelineno-0-1132"></a>
</span><span id="__span-0-1133"><a id="__codelineno-0-1133" name="__codelineno-0-1133"></a>    <span class="nd">@staticmethod</span>
</span><span id="__span-0-1134"><a id="__codelineno-0-1134" name="__codelineno-0-1134"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1135"><a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>        <span class="n">array</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-1136"><a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>        <span class="n">kvstore</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="__span-0-1137"><a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>        <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="__span-0-1138"><a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>        <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-1139"><a id="__codelineno-0-1139" name="__codelineno-0-1139"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-1140"><a id="__codelineno-0-1140" name="__codelineno-0-1140"></a><span class="w">        </span><span class="sd">"""Save array to zarr using tensorstore.</span>
</span><span id="__span-0-1141"><a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>
</span><span id="__span-0-1142"><a id="__codelineno-0-1142" name="__codelineno-0-1142"></a><span class="sd">        Defaults to returning future result.</span>
</span><span id="__span-0-1143"><a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>
</span><span id="__span-0-1144"><a id="__codelineno-0-1144" name="__codelineno-0-1144"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-1145"><a id="__codelineno-0-1145" name="__codelineno-0-1145"></a><span class="sd">        ----------</span>
</span><span id="__span-0-1146"><a id="__codelineno-0-1146" name="__codelineno-0-1146"></a><span class="sd">        array : ArrayLike</span>
</span><span id="__span-0-1147"><a id="__codelineno-0-1147" name="__codelineno-0-1147"></a><span class="sd">            Array to save.</span>
</span><span id="__span-0-1148"><a id="__codelineno-0-1148" name="__codelineno-0-1148"></a><span class="sd">        kvstore : dict</span>
</span><span id="__span-0-1149"><a id="__codelineno-0-1149" name="__codelineno-0-1149"></a><span class="sd">            Tensorstore kvstore specification.</span>
</span><span id="__span-0-1150"><a id="__codelineno-0-1150" name="__codelineno-0-1150"></a><span class="sd">        spec : dict</span>
</span><span id="__span-0-1151"><a id="__codelineno-0-1151" name="__codelineno-0-1151"></a><span class="sd">            Tensorstore zarr specification.</span>
</span><span id="__span-0-1152"><a id="__codelineno-0-1152" name="__codelineno-0-1152"></a><span class="sd">        return_future : Optional[bool]</span>
</span><span id="__span-0-1153"><a id="__codelineno-0-1153" name="__codelineno-0-1153"></a><span class="sd">            Return future (True) or immediately write (False).</span>
</span><span id="__span-0-1154"><a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>
</span><span id="__span-0-1155"><a id="__codelineno-0-1155" name="__codelineno-0-1155"></a><span class="sd">        Returns</span>
</span><span id="__span-0-1156"><a id="__codelineno-0-1156" name="__codelineno-0-1156"></a><span class="sd">        -------</span>
</span><span id="__span-0-1157"><a id="__codelineno-0-1157" name="__codelineno-0-1157"></a><span class="sd">        write_future : Optional[ArrayLike]</span>
</span><span id="__span-0-1158"><a id="__codelineno-0-1158" name="__codelineno-0-1158"></a><span class="sd">            Delayed (future) if return_future is True.</span>
</span><span id="__span-0-1159"><a id="__codelineno-0-1159" name="__codelineno-0-1159"></a><span class="sd">        """</span>
</span><span id="__span-0-1160"><a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>
</span><span id="__span-0-1161"><a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>        <span class="c1"># check datatype</span>
</span><span id="__span-0-1162"><a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>        <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"uint8"</span><span class="p">:</span>
</span><span id="__span-0-1163"><a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>            <span class="n">array_dtype</span> <span class="o">=</span> <span class="s2">"&lt;u1"</span>
</span><span id="__span-0-1164"><a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"uint16"</span><span class="p">:</span>
</span><span id="__span-0-1165"><a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>            <span class="n">array_dtype</span> <span class="o">=</span> <span class="s2">"&lt;u2"</span>
</span><span id="__span-0-1166"><a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"float16"</span><span class="p">:</span>
</span><span id="__span-0-1167"><a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>            <span class="n">array_dtype</span> <span class="o">=</span> <span class="s2">"&lt;f2"</span>
</span><span id="__span-0-1168"><a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>        <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"float32"</span><span class="p">:</span>
</span><span id="__span-0-1169"><a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>            <span class="n">array_dtype</span> <span class="o">=</span> <span class="s2">"&lt;f4"</span>
</span><span id="__span-0-1170"><a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1171"><a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Unsupported data type: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
</span><span id="__span-0-1172"><a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1173"><a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>
</span><span id="__span-0-1174"><a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>        <span class="c1"># check array dimension</span>
</span><span id="__span-0-1175"><a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>        <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"shape"</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
</span><span id="__span-0-1176"><a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-1177"><a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>            <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"chunks"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="__span-0-1178"><a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-1179"><a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>            <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"chunks"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span><span id="__span-0-1180"><a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="__span-0-1181"><a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>            <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"chunks"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span><span id="__span-0-1182"><a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>        <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_dtype</span>
</span><span id="__span-0-1183"><a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>
</span><span id="__span-0-1184"><a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1185"><a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>            <span class="n">current_zarr</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
</span><span id="__span-0-1186"><a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>                <span class="p">{</span>
</span><span id="__span-0-1187"><a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>                    <span class="o">**</span><span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-1188"><a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>                    <span class="s2">"kvstore"</span><span class="p">:</span> <span class="n">kvstore</span><span class="p">,</span>
</span><span id="__span-0-1189"><a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>                <span class="p">}</span>
</span><span id="__span-0-1190"><a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>            <span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-0-1191"><a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>
</span><span id="__span-0-1192"><a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>            <span class="n">write_future</span> <span class="o">=</span> <span class="n">current_zarr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="__span-0-1193"><a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>
</span><span id="__span-0-1194"><a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>            <span class="k">if</span> <span class="n">return_future</span><span class="p">:</span>
</span><span id="__span-0-1195"><a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>                <span class="k">return</span> <span class="n">write_future</span>
</span><span id="__span-0-1196"><a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1197"><a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>                <span class="n">write_future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-0-1198"><a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1199"><a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">):</span>
</span><span id="__span-0-1200"><a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error writing zarr array."</span><span class="p">)</span>
</span><span id="__span-0-1201"><a id="__codelineno-0-1201" name="__codelineno-0-1201"></a>
</span><span id="__span-0-1202"><a id="__codelineno-0-1202" name="__codelineno-0-1202"></a>    <span class="nd">@staticmethod</span>
</span><span id="__span-0-1203"><a id="__codelineno-0-1203" name="__codelineno-0-1203"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_load_from_parquet</span><span class="p">(</span><span class="n">parquet_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-1204"><a id="__codelineno-0-1204" name="__codelineno-0-1204"></a><span class="w">        </span><span class="sd">"""Load dataframe from parquet.</span>
</span><span id="__span-0-1205"><a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>
</span><span id="__span-0-1206"><a id="__codelineno-0-1206" name="__codelineno-0-1206"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-1207"><a id="__codelineno-0-1207" name="__codelineno-0-1207"></a><span class="sd">        ----------</span>
</span><span id="__span-0-1208"><a id="__codelineno-0-1208" name="__codelineno-0-1208"></a><span class="sd">        parquet_path : Union[Path, str]</span>
</span><span id="__span-0-1209"><a id="__codelineno-0-1209" name="__codelineno-0-1209"></a><span class="sd">            Path to parquet file.</span>
</span><span id="__span-0-1210"><a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>
</span><span id="__span-0-1211"><a id="__codelineno-0-1211" name="__codelineno-0-1211"></a><span class="sd">        Returns</span>
</span><span id="__span-0-1212"><a id="__codelineno-0-1212" name="__codelineno-0-1212"></a><span class="sd">        -------</span>
</span><span id="__span-0-1213"><a id="__codelineno-0-1213" name="__codelineno-0-1213"></a><span class="sd">        df : pd.DataFrame</span>
</span><span id="__span-0-1214"><a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><span class="sd">            Dataframe from parquet file.</span>
</span><span id="__span-0-1215"><a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><span class="sd">        """</span>
</span><span id="__span-0-1216"><a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>
</span><span id="__span-0-1217"><a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">parquet_path</span><span class="p">)</span>
</span><span id="__span-0-1218"><a id="__codelineno-0-1218" name="__codelineno-0-1218"></a>
</span><span id="__span-0-1219"><a id="__codelineno-0-1219" name="__codelineno-0-1219"></a>    <span class="nd">@staticmethod</span>
</span><span id="__span-0-1220"><a id="__codelineno-0-1220" name="__codelineno-0-1220"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_save_to_parquet</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">parquet_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
</span><span id="__span-0-1221"><a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="w">        </span><span class="sd">"""Save dataframe to parquet.</span>
</span><span id="__span-0-1222"><a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>
</span><span id="__span-0-1223"><a id="__codelineno-0-1223" name="__codelineno-0-1223"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-1224"><a id="__codelineno-0-1224" name="__codelineno-0-1224"></a><span class="sd">        ----------</span>
</span><span id="__span-0-1225"><a id="__codelineno-0-1225" name="__codelineno-0-1225"></a><span class="sd">        df : pd.DataFrame</span>
</span><span id="__span-0-1226"><a id="__codelineno-0-1226" name="__codelineno-0-1226"></a><span class="sd">            Dataframe to save.</span>
</span><span id="__span-0-1227"><a id="__codelineno-0-1227" name="__codelineno-0-1227"></a><span class="sd">        parquet_path : Union[Path, str]</span>
</span><span id="__span-0-1228"><a id="__codelineno-0-1228" name="__codelineno-0-1228"></a><span class="sd">            Path to parquet file.</span>
</span><span id="__span-0-1229"><a id="__codelineno-0-1229" name="__codelineno-0-1229"></a><span class="sd">        """</span>
</span><span id="__span-0-1230"><a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>
</span><span id="__span-0-1231"><a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>        <span class="c1"># df.to_parquet(</span>
</span><span id="__span-0-1232"><a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>        <span class="c1">#     parquet_path,</span>
</span><span id="__span-0-1233"><a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>        <span class="c1">#     engine="pyarrow",</span>
</span><span id="__span-0-1234"><a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>        <span class="c1">#     version="1.0",</span>
</span><span id="__span-0-1235"><a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>        <span class="c1">#     write_statistics=False</span>
</span><span id="__span-0-1236"><a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>        <span class="c1"># )</span>
</span><span id="__span-0-1237"><a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>
</span><span id="__span-0-1238"><a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>        <span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span>
</span><span id="__span-0-1239"><a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>            <span class="n">parquet_path</span><span class="p">,</span>
</span><span id="__span-0-1240"><a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>            <span class="n">engine</span><span class="o">=</span><span class="s2">"fastparquet"</span><span class="p">,</span> 
</span><span id="__span-0-1241"><a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>            <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
</span><span id="__span-0-1242"><a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>        <span class="p">)</span>
</span><span id="__span-0-1243"><a id="__codelineno-0-1243" name="__codelineno-0-1243"></a>
</span><span id="__span-0-1244"><a id="__codelineno-0-1244" name="__codelineno-0-1244"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_parse_datastore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-1245"><a id="__codelineno-0-1245" name="__codelineno-0-1245"></a><span class="w">        </span><span class="sd">"""Parse datastore to discover available components."""</span>
</span><span id="__span-0-1246"><a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>
</span><span id="__span-0-1247"><a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>        <span class="c1"># directory structure as defined by qi2lab spec</span>
</span><span id="__span-0-1248"><a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"calibrations.zarr"</span><span class="p">)</span>
</span><span id="__span-0-1249"><a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"polyDT"</span><span class="p">)</span>
</span><span id="__span-0-1250"><a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"readouts"</span><span class="p">)</span>
</span><span id="__span-0-1251"><a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-1252"><a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>            <span class="sa">r</span><span class="s2">"ufish_localizations"</span>
</span><span id="__span-0-1253"><a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>        <span class="p">)</span>
</span><span id="__span-0-1254"><a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"decoded"</span><span class="p">)</span>
</span><span id="__span-0-1255"><a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"fused"</span><span class="p">)</span>
</span><span id="__span-0-1256"><a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"segmentation"</span><span class="p">)</span>
</span><span id="__span-0-1257"><a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_mtx_output_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"mtx_output"</span><span class="p">)</span>
</span><span id="__span-0-1258"><a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state_json_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-1259"><a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>            <span class="sa">r</span><span class="s2">"datastore_state.json"</span>
</span><span id="__span-0-1260"><a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>        <span class="p">)</span>
</span><span id="__span-0-1261"><a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>
</span><span id="__span-0-1262"><a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>        <span class="c1"># read in .json in root directory that indicates what steps have been run</span>
</span><span id="__span-0-1263"><a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state_json_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
</span><span id="__span-0-1264"><a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
</span><span id="__span-0-1265"><a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>
</span><span id="__span-0-1266"><a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>        <span class="c1"># validate calibrations.zarr</span>
</span><span id="__span-0-1267"><a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"Calibrations"</span><span class="p">]:</span>
</span><span id="__span-0-1268"><a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1269"><a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Calibration data error."</span><span class="p">)</span>
</span><span id="__span-0-1270"><a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1271"><a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>                <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1272"><a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>                <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1273"><a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1274"><a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Calibration attributes not found"</span><span class="p">)</span>
</span><span id="__span-0-1275"><a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>
</span><span id="__span-0-1276"><a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>            <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-1277"><a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>                <span class="s2">"num_rounds"</span><span class="p">,</span>
</span><span id="__span-0-1278"><a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>                <span class="s2">"num_tiles"</span><span class="p">,</span>
</span><span id="__span-0-1279"><a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>                <span class="s2">"channels_in_data"</span><span class="p">,</span>
</span><span id="__span-0-1280"><a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>                <span class="s2">"tile_overlap"</span><span class="p">,</span>
</span><span id="__span-0-1281"><a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>                <span class="s2">"binning"</span><span class="p">,</span>
</span><span id="__span-0-1282"><a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>                <span class="s2">"e_per_ADU"</span><span class="p">,</span>
</span><span id="__span-0-1283"><a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>                <span class="s2">"na"</span><span class="p">,</span>
</span><span id="__span-0-1284"><a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>                <span class="s2">"ri"</span><span class="p">,</span>
</span><span id="__span-0-1285"><a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>                <span class="s2">"exp_order"</span><span class="p">,</span>
</span><span id="__span-0-1286"><a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>                <span class="s2">"codebook"</span><span class="p">,</span>
</span><span id="__span-0-1287"><a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>                <span class="s2">"num_bits"</span>
</span><span id="__span-0-1288"><a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>            <span class="p">]</span>
</span><span id="__span-0-1289"><a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"Version"</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.3</span><span class="p">:</span>
</span><span id="__span-0-1290"><a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>                <span class="n">keys_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"microscope_type"</span><span class="p">)</span>
</span><span id="__span-0-1291"><a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>                <span class="n">keys_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"camera_model"</span><span class="p">)</span>
</span><span id="__span-0-1292"><a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>                <span class="n">keys_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"voxel_size_zyx_um"</span><span class="p">)</span>
</span><span id="__span-0-1293"><a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">:</span>
</span><span id="__span-0-1294"><a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-0-1295"><a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Calibration attributes incomplete"</span><span class="p">)</span>
</span><span id="__span-0-1296"><a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1297"><a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>                    <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_"</span> <span class="o">+</span> <span class="n">key</span><span class="p">,</span> <span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="__span-0-1298"><a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>
</span><span id="__span-0-1299"><a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1300"><a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"psf_data"</span><span class="p">)</span>
</span><span id="__span-0-1301"><a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>            <span class="p">)</span>
</span><span id="__span-0-1302"><a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>
</span><span id="__span-0-1303"><a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1304"><a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_psfs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-1305"><a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1306"><a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>                        <span class="n">kvstore</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1307"><a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>                        <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1308"><a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>                    <span class="p">)</span>
</span><span id="__span-0-1309"><a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>                <span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-0-1310"><a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1311"><a id="__codelineno-0-1311" name="__codelineno-0-1311"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Calibration psfs missing."</span><span class="p">)</span>
</span><span id="__span-0-1312"><a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>
</span><span id="__span-0-1313"><a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>            <span class="k">del</span> <span class="n">current_local_zarr_path</span>
</span><span id="__span-0-1314"><a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>
</span><span id="__span-0-1315"><a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>            <span class="c1"># current_local_zarr_path = str(</span>
</span><span id="__span-0-1316"><a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>            <span class="c1">#     self._calibrations_zarr_path / Path("noise_map")</span>
</span><span id="__span-0-1317"><a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>            <span class="c1"># )</span>
</span><span id="__span-0-1318"><a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>
</span><span id="__span-0-1319"><a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>            <span class="c1"># try:</span>
</span><span id="__span-0-1320"><a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>            <span class="c1">#     self._noise_map = (</span>
</span><span id="__span-0-1321"><a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>            <span class="c1">#         self._load_from_zarr_array(</span>
</span><span id="__span-0-1322"><a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>            <span class="c1">#             kvstore=self._get_kvstore_key(current_local_zarr_path),</span>
</span><span id="__span-0-1323"><a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>            <span class="c1">#             spec=self._zarrv2_spec,</span>
</span><span id="__span-0-1324"><a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>            <span class="c1">#         )</span>
</span><span id="__span-0-1325"><a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>            <span class="c1">#     ).result()</span>
</span><span id="__span-0-1326"><a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>            <span class="c1"># except Exception:</span>
</span><span id="__span-0-1327"><a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>            <span class="c1">#     print("Calibration noise map missing.")</span>
</span><span id="__span-0-1328"><a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>
</span><span id="__span-0-1329"><a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>        <span class="c1"># validate polyDT and readout bits data</span>
</span><span id="__span-0-1330"><a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"Corrected"</span><span class="p">]:</span>
</span><span id="__span-0-1331"><a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1332"><a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">"PolyDT directory not initialized"</span><span class="p">)</span>
</span><span id="__span-0-1333"><a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1334"><a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>                <span class="n">polyDT_tile_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="__span-0-1335"><a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>                    <span class="p">[</span>
</span><span id="__span-0-1336"><a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>                        <span class="n">entry</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-0-1337"><a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>                        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
</span><span id="__span-0-1338"><a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>                        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
</span><span id="__span-0-1339"><a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>                    <span class="p">],</span>
</span><span id="__span-0-1340"><a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"tile"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">".zarr"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="__span-0-1341"><a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>                <span class="p">)</span>
</span><span id="__span-0-1342"><a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>                <span class="n">current_tile_dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-1343"><a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>                    <span class="n">polyDT_tile_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-1344"><a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>                <span class="p">)</span>
</span><span id="__span-0-1345"><a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="__span-0-1346"><a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>                    <span class="p">[</span>
</span><span id="__span-0-1347"><a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>                        <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"."</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-1348"><a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>                        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">current_tile_dir_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
</span><span id="__span-0-1349"><a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>                        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
</span><span id="__span-0-1350"><a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>                    <span class="p">],</span>
</span><span id="__span-0-1351"><a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"round"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">".zarr"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="__span-0-1352"><a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>                <span class="p">)</span>
</span><span id="__span-0-1353"><a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1354"><a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">"Readout directory not initialized"</span><span class="p">)</span>
</span><span id="__span-0-1355"><a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1356"><a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>                <span class="n">readout_tile_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="__span-0-1357"><a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>                    <span class="p">[</span>
</span><span id="__span-0-1358"><a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>                        <span class="n">entry</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-0-1359"><a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>                        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
</span><span id="__span-0-1360"><a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>                        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
</span><span id="__span-0-1361"><a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>                    <span class="p">],</span>
</span><span id="__span-0-1362"><a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"tile"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">".zarr"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="__span-0-1363"><a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>                <span class="p">)</span>
</span><span id="__span-0-1364"><a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>                <span class="n">current_tile_dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-1365"><a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>                    <span class="n">readout_tile_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-1366"><a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>                <span class="p">)</span>
</span><span id="__span-0-1367"><a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="__span-0-1368"><a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>                    <span class="p">[</span>
</span><span id="__span-0-1369"><a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>                        <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"."</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-1370"><a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>                        <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">current_tile_dir_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
</span><span id="__span-0-1371"><a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>                        <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
</span><span id="__span-0-1372"><a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>                    <span class="p">],</span>
</span><span id="__span-0-1373"><a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>                    <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"bit"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">".zarr"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="__span-0-1374"><a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>                <span class="p">)</span>
</span><span id="__span-0-1375"><a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>            <span class="k">assert</span> <span class="p">(</span>
</span><span id="__span-0-1376"><a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>                <span class="n">polyDT_tile_ids</span> <span class="o">==</span> <span class="n">readout_tile_ids</span>
</span><span id="__span-0-1377"><a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>            <span class="p">),</span> <span class="s2">"polyDT and readout tile ids do not match. Conversion error."</span>
</span><span id="__span-0-1378"><a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span> <span class="o">=</span> <span class="n">polyDT_tile_ids</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-0-1379"><a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>            <span class="k">del</span> <span class="n">polyDT_tile_ids</span><span class="p">,</span> <span class="n">readout_tile_ids</span>
</span><span id="__span-0-1380"><a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>
</span><span id="__span-0-1381"><a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>            <span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">):</span>
</span><span id="__span-0-1382"><a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1383"><a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>                    <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1384"><a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1385"><a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1386"><a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1387"><a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1388"><a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>                    <span class="p">)</span>
</span><span id="__span-0-1389"><a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>                    <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1390"><a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1391"><a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"polyDT tile attributes not found"</span><span class="p">)</span>
</span><span id="__span-0-1392"><a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>
</span><span id="__span-0-1393"><a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>                <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-1394"><a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>                    <span class="s2">"stage_zyx_um"</span><span class="p">,</span>
</span><span id="__span-0-1395"><a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>                    <span class="s2">"excitation_um"</span><span class="p">,</span>
</span><span id="__span-0-1396"><a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>                    <span class="s2">"emission_um"</span><span class="p">,</span>
</span><span id="__span-0-1397"><a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>                    <span class="s2">"bit_linker"</span><span class="p">,</span>
</span><span id="__span-0-1398"><a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>                    <span class="c1"># "exposure_ms",</span>
</span><span id="__span-0-1399"><a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>                    <span class="s2">"psf_idx"</span><span class="p">,</span>
</span><span id="__span-0-1400"><a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>                <span class="p">]</span>
</span><span id="__span-0-1401"><a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>
</span><span id="__span-0-1402"><a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">:</span>
</span><span id="__span-0-1403"><a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-0-1404"><a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>                        <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-0-1405"><a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Corrected polyDT attributes incomplete"</span><span class="p">)</span>
</span><span id="__span-0-1406"><a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>
</span><span id="__span-0-1407"><a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>                <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1408"><a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1409"><a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1410"><a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1411"><a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"corrected_data"</span><span class="p">)</span>
</span><span id="__span-0-1412"><a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>                <span class="p">)</span>
</span><span id="__span-0-1413"><a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>
</span><span id="__span-0-1414"><a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1415"><a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1416"><a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1417"><a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1418"><a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>                    <span class="p">)</span>
</span><span id="__span-0-1419"><a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1420"><a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-1421"><a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Corrected polyDT data missing."</span><span class="p">)</span>
</span><span id="__span-0-1422"><a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>
</span><span id="__span-0-1423"><a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>            <span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">bit_id</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-1424"><a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1425"><a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>                    <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1426"><a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-1427"><a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1428"><a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1429"><a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1430"><a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>                    <span class="p">)</span>
</span><span id="__span-0-1431"><a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>                    <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1432"><a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1433"><a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Readout tile attributes not found"</span><span class="p">)</span>
</span><span id="__span-0-1434"><a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>
</span><span id="__span-0-1435"><a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>                <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-1436"><a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>                    <span class="s2">"excitation_um"</span><span class="p">,</span>
</span><span id="__span-0-1437"><a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>                    <span class="s2">"emission_um"</span><span class="p">,</span>
</span><span id="__span-0-1438"><a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>                    <span class="s2">"round_linker"</span><span class="p">,</span>
</span><span id="__span-0-1439"><a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>                    <span class="c1"># "exposure_ms",</span>
</span><span id="__span-0-1440"><a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>                    <span class="s2">"psf_idx"</span><span class="p">,</span>
</span><span id="__span-0-1441"><a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>                <span class="p">]</span>
</span><span id="__span-0-1442"><a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">:</span>
</span><span id="__span-0-1443"><a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-0-1444"><a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Corrected readout attributes incomplete"</span><span class="p">)</span>
</span><span id="__span-0-1445"><a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>
</span><span id="__span-0-1446"><a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>                <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1447"><a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-1448"><a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1449"><a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1450"><a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"corrected_data"</span><span class="p">)</span>
</span><span id="__span-0-1451"><a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>                <span class="p">)</span>
</span><span id="__span-0-1452"><a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>
</span><span id="__span-0-1453"><a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1454"><a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1455"><a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1456"><a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1457"><a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>                    <span class="p">)</span>
</span><span id="__span-0-1458"><a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1459"><a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">bit_id</span><span class="p">)</span>
</span><span id="__span-0-1460"><a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Corrected readout data missing."</span><span class="p">)</span>
</span><span id="__span-0-1461"><a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>
</span><span id="__span-0-1462"><a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>        <span class="c1"># check and validate local registered data</span>
</span><span id="__span-0-1463"><a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"LocalRegistered"</span><span class="p">]:</span>
</span><span id="__span-0-1464"><a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>            <span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">):</span>
</span><span id="__span-0-1465"><a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>                <span class="k">if</span> <span class="n">round_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="__span-0-1466"><a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1467"><a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>                        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1468"><a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1469"><a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>                            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1470"><a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>                            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1471"><a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>                            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1472"><a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>                        <span class="p">)</span>
</span><span id="__span-0-1473"><a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>                        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-1474"><a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>                            <span class="n">attributes</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-0-1475"><a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>                    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1476"><a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">"polyDT tile attributes not found"</span><span class="p">)</span>
</span><span id="__span-0-1477"><a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>
</span><span id="__span-0-1478"><a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>                    <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"rigid_xform_xyz_px"</span><span class="p">]</span>
</span><span id="__span-0-1479"><a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>
</span><span id="__span-0-1480"><a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>                    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">:</span>
</span><span id="__span-0-1481"><a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>                        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-0-1482"><a id="__codelineno-0-1482" name="__codelineno-0-1482"></a>                            <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">round_id</span><span class="p">,</span><span class="n">tile_id</span><span class="si">}</span><span class="s2"> Rigid registration missing"</span><span class="p">)</span>
</span><span id="__span-0-1483"><a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>
</span><span id="__span-0-1484"><a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>                    <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1485"><a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1486"><a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1487"><a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1488"><a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"opticalflow_xform_px"</span><span class="p">)</span>
</span><span id="__span-0-1489"><a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>                    <span class="p">)</span>
</span><span id="__span-0-1490"><a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>
</span><span id="__span-0-1491"><a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1492"><a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1493"><a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1494"><a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1495"><a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>                        <span class="p">)</span>
</span><span id="__span-0-1496"><a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>                    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1497"><a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>                        <span class="c1">#print(tile_id, round_id)</span>
</span><span id="__span-0-1498"><a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>                        <span class="c1">#print("Optical flow registration data missing.")</span>
</span><span id="__span-0-1499"><a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>                        <span class="k">pass</span>
</span><span id="__span-0-1500"><a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>
</span><span id="__span-0-1501"><a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>                <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1502"><a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1503"><a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1504"><a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1505"><a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_decon_data"</span><span class="p">)</span>
</span><span id="__span-0-1506"><a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>                <span class="p">)</span>
</span><span id="__span-0-1507"><a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>                <span class="k">if</span> <span class="n">round_id</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="__span-0-1508"><a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>                    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1509"><a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1510"><a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1511"><a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1512"><a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>                        <span class="p">)</span>
</span><span id="__span-0-1513"><a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>                    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1514"><a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>                        <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-1515"><a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>                        <span class="nb">print</span><span class="p">(</span><span class="s2">"Registered polyDT data missing."</span><span class="p">)</span>
</span><span id="__span-0-1516"><a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>
</span><span id="__span-0-1517"><a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>            <span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">bit_id</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-1518"><a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>                <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1519"><a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-1520"><a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1521"><a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1522"><a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_decon_data"</span><span class="p">)</span>
</span><span id="__span-0-1523"><a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>                <span class="p">)</span>
</span><span id="__span-0-1524"><a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>
</span><span id="__span-0-1525"><a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1526"><a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1527"><a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1528"><a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1529"><a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>                    <span class="p">)</span>
</span><span id="__span-0-1530"><a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1531"><a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-1532"><a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Registered readout data missing."</span><span class="p">)</span>
</span><span id="__span-0-1533"><a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>
</span><span id="__span-0-1534"><a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>                <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1535"><a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-1536"><a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1537"><a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1538"><a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_ufish_data"</span><span class="p">)</span>
</span><span id="__span-0-1539"><a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>                <span class="p">)</span>
</span><span id="__span-0-1540"><a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>
</span><span id="__span-0-1541"><a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1542"><a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1543"><a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1544"><a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1545"><a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>                    <span class="p">)</span>
</span><span id="__span-0-1546"><a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1547"><a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-1548"><a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Registered ufish prediction missing."</span><span class="p">)</span>
</span><span id="__span-0-1549"><a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>
</span><span id="__span-0-1550"><a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>            <span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">bit_id</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-1551"><a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>                <span class="n">current_ufish_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-1552"><a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span>
</span><span id="__span-0-1553"><a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1554"><a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".parquet"</span><span class="p">)</span>
</span><span id="__span-0-1555"><a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>                <span class="p">)</span>
</span><span id="__span-0-1556"><a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">current_ufish_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1557"><a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>                    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
</span><span id="__span-0-1558"><a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>                        <span class="n">tile_id</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="n">bit_id</span> <span class="o">+</span> <span class="s2">" ufish localization missing"</span>
</span><span id="__span-0-1559"><a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>                    <span class="p">)</span>
</span><span id="__span-0-1560"><a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>
</span><span id="__span-0-1561"><a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>        <span class="c1"># check and validate global registered data</span>
</span><span id="__span-0-1562"><a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"GlobalRegistered"</span><span class="p">]:</span>
</span><span id="__span-0-1563"><a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>            <span class="k">for</span> <span class="n">tile_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-1564"><a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1565"><a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>                    <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1566"><a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1567"><a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1568"><a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1569"><a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1570"><a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>                    <span class="p">)</span>
</span><span id="__span-0-1571"><a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-1572"><a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>                        <span class="n">attributes</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-0-1573"><a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1574"><a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"polyDT tile attributes not found"</span><span class="p">)</span>
</span><span id="__span-0-1575"><a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>
</span><span id="__span-0-1576"><a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>                <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"affine_zyx_um"</span><span class="p">,</span> <span class="s2">"origin_zyx_um"</span><span class="p">,</span> <span class="s2">"spacing_zyx_um"</span><span class="p">]</span>
</span><span id="__span-0-1577"><a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>
</span><span id="__span-0-1578"><a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">:</span>
</span><span id="__span-0-1579"><a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-0-1580"><a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Global registration missing"</span><span class="p">)</span>
</span><span id="__span-0-1581"><a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>
</span><span id="__span-0-1582"><a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>        <span class="c1"># check and validate fused</span>
</span><span id="__span-0-1583"><a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"Fused"</span><span class="p">]:</span>
</span><span id="__span-0-1584"><a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1585"><a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>                <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1586"><a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span>
</span><span id="__span-0-1587"><a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused.zarr"</span><span class="p">)</span>
</span><span id="__span-0-1588"><a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-1589"><a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1590"><a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>                <span class="p">)</span>
</span><span id="__span-0-1591"><a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-1592"><a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>                    <span class="n">attributes</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-0-1593"><a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1594"><a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Fused image attributes not found"</span><span class="p">)</span>
</span><span id="__span-0-1595"><a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>
</span><span id="__span-0-1596"><a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>            <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"affine_zyx_um"</span><span class="p">,</span> <span class="s2">"origin_zyx_um"</span><span class="p">,</span> <span class="s2">"spacing_zyx_um"</span><span class="p">]</span>
</span><span id="__span-0-1597"><a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>
</span><span id="__span-0-1598"><a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">:</span>
</span><span id="__span-0-1599"><a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-0-1600"><a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Fused image metadata missing"</span><span class="p">)</span>
</span><span id="__span-0-1601"><a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>
</span><span id="__span-0-1602"><a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1603"><a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span>
</span><span id="__span-0-1604"><a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused.zarr"</span><span class="p">)</span>
</span><span id="__span-0-1605"><a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-1606"><a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>            <span class="p">)</span>
</span><span id="__span-0-1607"><a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>
</span><span id="__span-0-1608"><a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1609"><a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1610"><a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1611"><a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1612"><a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>                <span class="p">)</span>
</span><span id="__span-0-1613"><a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1614"><a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Fused data missing."</span><span class="p">)</span>
</span><span id="__span-0-1615"><a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>
</span><span id="__span-0-1616"><a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>        <span class="c1"># check and validate cellpose segmentation</span>
</span><span id="__span-0-1617"><a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"SegmentedCells"</span><span class="p">]:</span>
</span><span id="__span-0-1618"><a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1619"><a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-1620"><a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose"</span><span class="p">)</span>
</span><span id="__span-0-1621"><a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose.zarr"</span><span class="p">)</span>
</span><span id="__span-0-1622"><a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"masks_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-1623"><a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>            <span class="p">)</span>
</span><span id="__span-0-1624"><a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>
</span><span id="__span-0-1625"><a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1626"><a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1627"><a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1628"><a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1629"><a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>                <span class="p">)</span>
</span><span id="__span-0-1630"><a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1631"><a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Cellpose data missing."</span><span class="p">)</span>
</span><span id="__span-0-1632"><a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>
</span><span id="__span-0-1633"><a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>            <span class="n">cell_outlines_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-1634"><a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-1635"><a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose"</span><span class="p">)</span>
</span><span id="__span-0-1636"><a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"imagej_rois"</span><span class="p">)</span>
</span><span id="__span-0-1637"><a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"global_coords_rois.zip"</span><span class="p">)</span>
</span><span id="__span-0-1638"><a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>            <span class="p">)</span>
</span><span id="__span-0-1639"><a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cell_outlines_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1640"><a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">"Cellpose cell outlines missing."</span><span class="p">)</span>
</span><span id="__span-0-1641"><a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>
</span><span id="__span-0-1642"><a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>        <span class="c1"># check and validate decoded spots</span>
</span><span id="__span-0-1643"><a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"DecodedSpots"</span><span class="p">]:</span>
</span><span id="__span-0-1644"><a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>            <span class="k">for</span> <span class="n">tile_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-1645"><a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>                <span class="n">decoded_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-1646"><a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>                    <span class="n">tile_id</span> <span class="o">+</span> <span class="s2">"_decoded_features.parquet"</span>
</span><span id="__span-0-1647"><a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>                <span class="p">)</span>
</span><span id="__span-0-1648"><a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>
</span><span id="__span-0-1649"><a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">decoded_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1650"><a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>                    <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">tile_id</span> <span class="o">+</span> <span class="s2">" decoded spots missing."</span><span class="p">)</span>
</span><span id="__span-0-1651"><a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>
</span><span id="__span-0-1652"><a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>        <span class="c1"># check and validate filtered decoded spots</span>
</span><span id="__span-0-1653"><a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"FilteredSpots"</span><span class="p">]:</span>
</span><span id="__span-0-1654"><a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>            <span class="n">filtered_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-1655"><a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>                <span class="s2">"all_tiles_filtered_decoded_features.parquet"</span>
</span><span id="__span-0-1656"><a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>            <span class="p">)</span>
</span><span id="__span-0-1657"><a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>
</span><span id="__span-0-1658"><a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">filtered_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1659"><a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">"filtered decoded spots missing."</span><span class="p">)</span>
</span><span id="__span-0-1660"><a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>
</span><span id="__span-0-1661"><a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"RefinedSpots"</span><span class="p">]:</span>
</span><span id="__span-0-1662"><a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>            <span class="n">baysor_spots_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-1663"><a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-1664"><a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"baysor"</span><span class="p">)</span>
</span><span id="__span-0-1665"><a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"segmentation.csv"</span><span class="p">)</span>
</span><span id="__span-0-1666"><a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>            <span class="p">)</span>
</span><span id="__span-0-1667"><a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>
</span><span id="__span-0-1668"><a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">baysor_spots_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1669"><a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">"Baysor filtered decoded spots missing."</span><span class="p">)</span>
</span><span id="__span-0-1670"><a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>
</span><span id="__span-0-1671"><a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>        <span class="c1"># check and validate mtx</span>
</span><span id="__span-0-1672"><a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"mtxOutput"</span><span class="p">]:</span>
</span><span id="__span-0-1673"><a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>            <span class="n">mtx_barcodes_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mtx_output_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"barcodes.tsv.gz"</span><span class="p">)</span>
</span><span id="__span-0-1674"><a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>            <span class="n">mtx_features_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mtx_output_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"features.tsv.gz"</span><span class="p">)</span>
</span><span id="__span-0-1675"><a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>            <span class="n">mtx_matrix_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mtx_output_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"matrix.tsv.gz"</span><span class="p">)</span>
</span><span id="__span-0-1676"><a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>
</span><span id="__span-0-1677"><a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>            <span class="k">if</span> <span class="p">(</span>
</span><span id="__span-0-1678"><a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>                <span class="ow">not</span> <span class="p">(</span><span class="n">mtx_barcodes_path</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span>
</span><span id="__span-0-1679"><a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>                <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mtx_features_path</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span>
</span><span id="__span-0-1680"><a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>                <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mtx_matrix_path</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span>
</span><span id="__span-0-1681"><a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>            <span class="p">):</span>
</span><span id="__span-0-1682"><a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">"mtx output missing."</span><span class="p">)</span>
</span><span id="__span-0-1683"><a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>
</span><span id="__span-0-1684"><a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1685"><a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"BaysorPath"</span><span class="p">]))</span>
</span><span id="__span-0-1686"><a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"BaysorOptions"</span><span class="p">]))</span>
</span><span id="__span-0-1687"><a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_julia_threads</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"JuliaThreads"</span><span class="p">])</span>
</span><span id="__span-0-1688"><a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="__span-0-1689"><a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">""</span>
</span><span id="__span-0-1690"><a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">""</span>
</span><span id="__span-0-1691"><a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_julia_threads</span> <span class="o">=</span> <span class="mi">1</span>
</span><span id="__span-0-1692"><a id="__codelineno-0-1692" name="__codelineno-0-1692"></a>
</span><span id="__span-0-1693"><a id="__codelineno-0-1693" name="__codelineno-0-1693"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_codebook_parsed</span><span class="p">(</span>
</span><span id="__span-0-1694"><a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1695"><a id="__codelineno-0-1695" name="__codelineno-0-1695"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">ArrayLike</span><span class="p">]]:</span>
</span><span id="__span-0-1696"><a id="__codelineno-0-1696" name="__codelineno-0-1696"></a><span class="w">        </span><span class="sd">"""Load and split codebook into gene_ids and codebook matrix.</span>
</span><span id="__span-0-1697"><a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>
</span><span id="__span-0-1698"><a id="__codelineno-0-1698" name="__codelineno-0-1698"></a><span class="sd">        Returns</span>
</span><span id="__span-0-1699"><a id="__codelineno-0-1699" name="__codelineno-0-1699"></a><span class="sd">        -------</span>
</span><span id="__span-0-1700"><a id="__codelineno-0-1700" name="__codelineno-0-1700"></a><span class="sd">        gene_ids : Collection[str]</span>
</span><span id="__span-0-1701"><a id="__codelineno-0-1701" name="__codelineno-0-1701"></a><span class="sd">            Gene IDs.</span>
</span><span id="__span-0-1702"><a id="__codelineno-0-1702" name="__codelineno-0-1702"></a><span class="sd">        codebook_matrix : ArrayLike</span>
</span><span id="__span-0-1703"><a id="__codelineno-0-1703" name="__codelineno-0-1703"></a><span class="sd">            Codebook matrix.</span>
</span><span id="__span-0-1704"><a id="__codelineno-0-1704" name="__codelineno-0-1704"></a><span class="sd">        """</span>
</span><span id="__span-0-1705"><a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>
</span><span id="__span-0-1706"><a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1707"><a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>            <span class="n">data</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_codebook"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-1708"><a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>
</span><span id="__span-0-1709"><a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>            <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1710"><a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1711"><a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>            <span class="n">num_columns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">data</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="__span-0-1712"><a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"gene_id"</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"bit</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_columns</span><span class="p">)]</span>
</span><span id="__span-0-1713"><a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>            <span class="n">codebook_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</span><span id="__span-0-1714"><a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>
</span><span id="__span-0-1715"><a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>            <span class="n">gene_ids</span> <span class="o">=</span> <span class="n">codebook_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-1716"><a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>            <span class="n">codebook_matrix</span> <span class="o">=</span> <span class="n">codebook_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-0-1717"><a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>            <span class="k">del</span> <span class="n">data</span><span class="p">,</span> <span class="n">codebook_df</span>
</span><span id="__span-0-1718"><a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>            <span class="k">return</span> <span class="n">gene_ids</span><span class="p">,</span> <span class="n">codebook_matrix</span>
</span><span id="__span-0-1719"><a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
</span><span id="__span-0-1720"><a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error parsing codebook."</span><span class="p">)</span>
</span><span id="__span-0-1721"><a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1722"><a id="__codelineno-0-1722" name="__codelineno-0-1722"></a>
</span><span id="__span-0-1723"><a id="__codelineno-0-1723" name="__codelineno-0-1723"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">initialize_tile</span><span class="p">(</span>
</span><span id="__span-0-1724"><a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1725"><a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1726"><a id="__codelineno-0-1726" name="__codelineno-0-1726"></a>    <span class="p">):</span>
</span><span id="__span-0-1727"><a id="__codelineno-0-1727" name="__codelineno-0-1727"></a><span class="w">        </span><span class="sd">"""Initialize directory structure for a tile.</span>
</span><span id="__span-0-1728"><a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>
</span><span id="__span-0-1729"><a id="__codelineno-0-1729" name="__codelineno-0-1729"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-1730"><a id="__codelineno-0-1730" name="__codelineno-0-1730"></a><span class="sd">        ----------</span>
</span><span id="__span-0-1731"><a id="__codelineno-0-1731" name="__codelineno-0-1731"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-1732"><a id="__codelineno-0-1732" name="__codelineno-0-1732"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-1733"><a id="__codelineno-0-1733" name="__codelineno-0-1733"></a><span class="sd">        """</span>
</span><span id="__span-0-1734"><a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>
</span><span id="__span-0-1735"><a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_experiment_order"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1736"><a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Assign experimental order before creating tiles."</span><span class="p">)</span>
</span><span id="__span-0-1737"><a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1738"><a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>
</span><span id="__span-0-1739"><a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_num_tiles"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1740"><a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Assign number of tiles before creating tiles."</span><span class="p">)</span>
</span><span id="__span-0-1741"><a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1742"><a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>
</span><span id="__span-0-1743"><a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1744"><a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-1745"><a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-1746"><a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1747"><a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1748"><a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-1749"><a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1750"><a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-1751"><a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tile id."</span><span class="p">)</span>
</span><span id="__span-0-1752"><a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1753"><a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1754"><a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-1755"><a id="__codelineno-0-1755" name="__codelineno-0-1755"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1756"><a id="__codelineno-0-1756" name="__codelineno-0-1756"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1757"><a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1758"><a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>
</span><span id="__span-0-1759"><a id="__codelineno-0-1759" name="__codelineno-0-1759"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1760"><a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>            <span class="n">polyDT_tile_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1761"><a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>            <span class="n">polyDT_tile_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-1762"><a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>            <span class="k">for</span> <span class="n">round_idx</span><span class="p">,</span> <span class="n">round_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">):</span>
</span><span id="__span-0-1763"><a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>                <span class="n">polyDT_round_path</span> <span class="o">=</span> <span class="n">polyDT_tile_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1764"><a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>                <span class="n">polyDT_round_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-1765"><a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>                <span class="n">polydt_round_attrs_path</span> <span class="o">=</span> <span class="n">polyDT_round_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1766"><a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>                <span class="n">round_attrs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-1767"><a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>                    <span class="s2">"bit_linker"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_order</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="n">round_idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-0-1768"><a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>                    <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-0-1769"><a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>                    <span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="__span-0-1770"><a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>                <span class="p">}</span>
</span><span id="__span-0-1771"><a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">round_attrs</span><span class="p">,</span> <span class="n">polydt_round_attrs_path</span><span class="p">)</span>
</span><span id="__span-0-1772"><a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="__span-0-1773"><a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error creating polyDT tile. Does it exist already?"</span><span class="p">)</span>
</span><span id="__span-0-1774"><a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>
</span><span id="__span-0-1775"><a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1776"><a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>            <span class="n">readout_tile_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1777"><a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>            <span class="n">readout_tile_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-1778"><a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>            <span class="k">for</span> <span class="n">bit_idx</span><span class="p">,</span> <span class="n">bit_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-1779"><a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>                <span class="n">readout_bit_path</span> <span class="o">=</span> <span class="n">readout_tile_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1780"><a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>                <span class="n">readout_bit_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-1781"><a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>                <span class="n">readout_bit_attrs_path</span> <span class="o">=</span> <span class="n">readout_bit_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1782"><a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>                <span class="n">fiducial_channel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channels_in_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-1783"><a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>                <span class="n">readout_one_channel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channels_in_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-1784"><a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>
</span><span id="__span-0-1785"><a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channels_in_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-1786"><a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>                    <span class="n">readout_two_channel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channels_in_data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="__span-0-1787"><a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>                    <span class="n">condition_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_order</span><span class="p">[</span><span class="n">readout_one_channel</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span>
</span><span id="__span-0-1788"><a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>                        <span class="n">bit_idx</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-0-1789"><a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>                    <span class="p">)</span>
</span><span id="__span-0-1790"><a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>                    <span class="n">condition_two</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_order</span><span class="p">[</span><span class="n">readout_two_channel</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span>
</span><span id="__span-0-1791"><a id="__codelineno-0-1791" name="__codelineno-0-1791"></a>                        <span class="n">bit_idx</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-0-1792"><a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>                    <span class="p">)</span>
</span><span id="__span-0-1793"><a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>                    <span class="n">combined_condition</span> <span class="o">=</span> <span class="n">condition_one</span> <span class="o">|</span> <span class="n">condition_two</span>
</span><span id="__span-0-1794"><a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>
</span><span id="__span-0-1795"><a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1796"><a id="__codelineno-0-1796" name="__codelineno-0-1796"></a>                    <span class="n">combined_condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_order</span><span class="p">[</span>
</span><span id="__span-0-1797"><a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>                        <span class="n">readout_one_channel</span>
</span><span id="__span-0-1798"><a id="__codelineno-0-1798" name="__codelineno-0-1798"></a>                    <span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">bit_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-1799"><a id="__codelineno-0-1799" name="__codelineno-0-1799"></a>                <span class="n">matching_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_order</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">combined_condition</span><span class="p">]</span>
</span><span id="__span-0-1800"><a id="__codelineno-0-1800" name="__codelineno-0-1800"></a>
</span><span id="__span-0-1801"><a id="__codelineno-0-1801" name="__codelineno-0-1801"></a>                <span class="n">bit_attrs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-1802"><a id="__codelineno-0-1802" name="__codelineno-0-1802"></a>                    <span class="s2">"round_linker"</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">matching_rows</span><span class="p">[</span><span class="n">fiducial_channel</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-1803"><a id="__codelineno-0-1803" name="__codelineno-0-1803"></a>                <span class="p">}</span>
</span><span id="__span-0-1804"><a id="__codelineno-0-1804" name="__codelineno-0-1804"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">bit_attrs</span><span class="p">,</span> <span class="n">readout_bit_attrs_path</span><span class="p">)</span>
</span><span id="__span-0-1805"><a id="__codelineno-0-1805" name="__codelineno-0-1805"></a>        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="__span-0-1806"><a id="__codelineno-0-1806" name="__codelineno-0-1806"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error creating readout tile. Does it exist already?"</span><span class="p">)</span>
</span><span id="__span-0-1807"><a id="__codelineno-0-1807" name="__codelineno-0-1807"></a>
</span><span id="__span-0-1808"><a id="__codelineno-0-1808" name="__codelineno-0-1808"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_local_bit_linker</span><span class="p">(</span>
</span><span id="__span-0-1809"><a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1810"><a id="__codelineno-0-1810" name="__codelineno-0-1810"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1811"><a id="__codelineno-0-1811" name="__codelineno-0-1811"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1812"><a id="__codelineno-0-1812" name="__codelineno-0-1812"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
</span><span id="__span-0-1813"><a id="__codelineno-0-1813" name="__codelineno-0-1813"></a><span class="w">        </span><span class="sd">"""Load readout bits linked to fidicual round for one tile.</span>
</span><span id="__span-0-1814"><a id="__codelineno-0-1814" name="__codelineno-0-1814"></a>
</span><span id="__span-0-1815"><a id="__codelineno-0-1815" name="__codelineno-0-1815"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-1816"><a id="__codelineno-0-1816" name="__codelineno-0-1816"></a><span class="sd">        ----------</span>
</span><span id="__span-0-1817"><a id="__codelineno-0-1817" name="__codelineno-0-1817"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-1818"><a id="__codelineno-0-1818" name="__codelineno-0-1818"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-1819"><a id="__codelineno-0-1819" name="__codelineno-0-1819"></a><span class="sd">        round : Union[int, str]</span>
</span><span id="__span-0-1820"><a id="__codelineno-0-1820" name="__codelineno-0-1820"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-1821"><a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>
</span><span id="__span-0-1822"><a id="__codelineno-0-1822" name="__codelineno-0-1822"></a><span class="sd">        Returns</span>
</span><span id="__span-0-1823"><a id="__codelineno-0-1823" name="__codelineno-0-1823"></a><span class="sd">        -------</span>
</span><span id="__span-0-1824"><a id="__codelineno-0-1824" name="__codelineno-0-1824"></a><span class="sd">        bit_linker : Optional[Sequence[int]]</span>
</span><span id="__span-0-1825"><a id="__codelineno-0-1825" name="__codelineno-0-1825"></a><span class="sd">            Readout bits linked to fidicual round for one tile.</span>
</span><span id="__span-0-1826"><a id="__codelineno-0-1826" name="__codelineno-0-1826"></a><span class="sd">        """</span>
</span><span id="__span-0-1827"><a id="__codelineno-0-1827" name="__codelineno-0-1827"></a>
</span><span id="__span-0-1828"><a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1829"><a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-1830"><a id="__codelineno-0-1830" name="__codelineno-0-1830"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-1831"><a id="__codelineno-0-1831" name="__codelineno-0-1831"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1832"><a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1833"><a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-1834"><a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1835"><a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-1836"><a id="__codelineno-0-1836" name="__codelineno-0-1836"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id."</span><span class="p">)</span>
</span><span id="__span-0-1837"><a id="__codelineno-0-1837" name="__codelineno-0-1837"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1838"><a id="__codelineno-0-1838" name="__codelineno-0-1838"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1839"><a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-1840"><a id="__codelineno-0-1840" name="__codelineno-0-1840"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1841"><a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1842"><a id="__codelineno-0-1842" name="__codelineno-0-1842"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1843"><a id="__codelineno-0-1843" name="__codelineno-0-1843"></a>
</span><span id="__span-0-1844"><a id="__codelineno-0-1844" name="__codelineno-0-1844"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1845"><a id="__codelineno-0-1845" name="__codelineno-0-1845"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1846"><a id="__codelineno-0-1846" name="__codelineno-0-1846"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-1847"><a id="__codelineno-0-1847" name="__codelineno-0-1847"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1848"><a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1849"><a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-1850"><a id="__codelineno-0-1850" name="__codelineno-0-1850"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1851"><a id="__codelineno-0-1851" name="__codelineno-0-1851"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-1852"><a id="__codelineno-0-1852" name="__codelineno-0-1852"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id."</span><span class="p">)</span>
</span><span id="__span-0-1853"><a id="__codelineno-0-1853" name="__codelineno-0-1853"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1854"><a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1855"><a id="__codelineno-0-1855" name="__codelineno-0-1855"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-1856"><a id="__codelineno-0-1856" name="__codelineno-0-1856"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1857"><a id="__codelineno-0-1857" name="__codelineno-0-1857"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1858"><a id="__codelineno-0-1858" name="__codelineno-0-1858"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1859"><a id="__codelineno-0-1859" name="__codelineno-0-1859"></a>
</span><span id="__span-0-1860"><a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1861"><a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1862"><a id="__codelineno-0-1862" name="__codelineno-0-1862"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1863"><a id="__codelineno-0-1863" name="__codelineno-0-1863"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1864"><a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1865"><a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1866"><a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>            <span class="p">)</span>
</span><span id="__span-0-1867"><a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1868"><a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>            <span class="k">return</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">"bits"</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-0-1869"><a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1870"><a id="__codelineno-0-1870" name="__codelineno-0-1870"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-1871"><a id="__codelineno-0-1871" name="__codelineno-0-1871"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Bit linker attribute not found."</span><span class="p">)</span>
</span><span id="__span-0-1872"><a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1873"><a id="__codelineno-0-1873" name="__codelineno-0-1873"></a>
</span><span id="__span-0-1874"><a id="__codelineno-0-1874" name="__codelineno-0-1874"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_local_bit_linker</span><span class="p">(</span>
</span><span id="__span-0-1875"><a id="__codelineno-0-1875" name="__codelineno-0-1875"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1876"><a id="__codelineno-0-1876" name="__codelineno-0-1876"></a>        <span class="n">bit_linker</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="__span-0-1877"><a id="__codelineno-0-1877" name="__codelineno-0-1877"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1878"><a id="__codelineno-0-1878" name="__codelineno-0-1878"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1879"><a id="__codelineno-0-1879" name="__codelineno-0-1879"></a>    <span class="p">):</span>
</span><span id="__span-0-1880"><a id="__codelineno-0-1880" name="__codelineno-0-1880"></a><span class="w">        </span><span class="sd">"""Save readout bits linked to fidicual round for one tile.</span>
</span><span id="__span-0-1881"><a id="__codelineno-0-1881" name="__codelineno-0-1881"></a>
</span><span id="__span-0-1882"><a id="__codelineno-0-1882" name="__codelineno-0-1882"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-1883"><a id="__codelineno-0-1883" name="__codelineno-0-1883"></a><span class="sd">        ----------</span>
</span><span id="__span-0-1884"><a id="__codelineno-0-1884" name="__codelineno-0-1884"></a><span class="sd">        bit_linker : Sequence[int]</span>
</span><span id="__span-0-1885"><a id="__codelineno-0-1885" name="__codelineno-0-1885"></a><span class="sd">            Readout bits linked to fidicual round for one tile.</span>
</span><span id="__span-0-1886"><a id="__codelineno-0-1886" name="__codelineno-0-1886"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-1887"><a id="__codelineno-0-1887" name="__codelineno-0-1887"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-1888"><a id="__codelineno-0-1888" name="__codelineno-0-1888"></a><span class="sd">        round : Union[int, str]</span>
</span><span id="__span-0-1889"><a id="__codelineno-0-1889" name="__codelineno-0-1889"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-1890"><a id="__codelineno-0-1890" name="__codelineno-0-1890"></a><span class="sd">        """</span>
</span><span id="__span-0-1891"><a id="__codelineno-0-1891" name="__codelineno-0-1891"></a>
</span><span id="__span-0-1892"><a id="__codelineno-0-1892" name="__codelineno-0-1892"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1893"><a id="__codelineno-0-1893" name="__codelineno-0-1893"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-1894"><a id="__codelineno-0-1894" name="__codelineno-0-1894"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-1895"><a id="__codelineno-0-1895" name="__codelineno-0-1895"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1896"><a id="__codelineno-0-1896" name="__codelineno-0-1896"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1897"><a id="__codelineno-0-1897" name="__codelineno-0-1897"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-1898"><a id="__codelineno-0-1898" name="__codelineno-0-1898"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1899"><a id="__codelineno-0-1899" name="__codelineno-0-1899"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-1900"><a id="__codelineno-0-1900" name="__codelineno-0-1900"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id."</span><span class="p">)</span>
</span><span id="__span-0-1901"><a id="__codelineno-0-1901" name="__codelineno-0-1901"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1902"><a id="__codelineno-0-1902" name="__codelineno-0-1902"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1903"><a id="__codelineno-0-1903" name="__codelineno-0-1903"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-1904"><a id="__codelineno-0-1904" name="__codelineno-0-1904"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1905"><a id="__codelineno-0-1905" name="__codelineno-0-1905"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1906"><a id="__codelineno-0-1906" name="__codelineno-0-1906"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1907"><a id="__codelineno-0-1907" name="__codelineno-0-1907"></a>
</span><span id="__span-0-1908"><a id="__codelineno-0-1908" name="__codelineno-0-1908"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1909"><a id="__codelineno-0-1909" name="__codelineno-0-1909"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1910"><a id="__codelineno-0-1910" name="__codelineno-0-1910"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-1911"><a id="__codelineno-0-1911" name="__codelineno-0-1911"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1912"><a id="__codelineno-0-1912" name="__codelineno-0-1912"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1913"><a id="__codelineno-0-1913" name="__codelineno-0-1913"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-1914"><a id="__codelineno-0-1914" name="__codelineno-0-1914"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1915"><a id="__codelineno-0-1915" name="__codelineno-0-1915"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-1916"><a id="__codelineno-0-1916" name="__codelineno-0-1916"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id."</span><span class="p">)</span>
</span><span id="__span-0-1917"><a id="__codelineno-0-1917" name="__codelineno-0-1917"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1918"><a id="__codelineno-0-1918" name="__codelineno-0-1918"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1919"><a id="__codelineno-0-1919" name="__codelineno-0-1919"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-1920"><a id="__codelineno-0-1920" name="__codelineno-0-1920"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1921"><a id="__codelineno-0-1921" name="__codelineno-0-1921"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1922"><a id="__codelineno-0-1922" name="__codelineno-0-1922"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1923"><a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>
</span><span id="__span-0-1924"><a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1925"><a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1926"><a id="__codelineno-0-1926" name="__codelineno-0-1926"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1927"><a id="__codelineno-0-1927" name="__codelineno-0-1927"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1928"><a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1929"><a id="__codelineno-0-1929" name="__codelineno-0-1929"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1930"><a id="__codelineno-0-1930" name="__codelineno-0-1930"></a>            <span class="p">)</span>
</span><span id="__span-0-1931"><a id="__codelineno-0-1931" name="__codelineno-0-1931"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1932"><a id="__codelineno-0-1932" name="__codelineno-0-1932"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"bits"</span><span class="p">]</span> <span class="o">=</span> <span class="n">bit_linker</span>
</span><span id="__span-0-1933"><a id="__codelineno-0-1933" name="__codelineno-0-1933"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1934"><a id="__codelineno-0-1934" name="__codelineno-0-1934"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1935"><a id="__codelineno-0-1935" name="__codelineno-0-1935"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-1936"><a id="__codelineno-0-1936" name="__codelineno-0-1936"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error writing bit linker attribute."</span><span class="p">)</span>
</span><span id="__span-0-1937"><a id="__codelineno-0-1937" name="__codelineno-0-1937"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1938"><a id="__codelineno-0-1938" name="__codelineno-0-1938"></a>
</span><span id="__span-0-1939"><a id="__codelineno-0-1939" name="__codelineno-0-1939"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_local_round_linker</span><span class="p">(</span>
</span><span id="__span-0-1940"><a id="__codelineno-0-1940" name="__codelineno-0-1940"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1941"><a id="__codelineno-0-1941" name="__codelineno-0-1941"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1942"><a id="__codelineno-0-1942" name="__codelineno-0-1942"></a>        <span class="n">bit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1943"><a id="__codelineno-0-1943" name="__codelineno-0-1943"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
</span><span id="__span-0-1944"><a id="__codelineno-0-1944" name="__codelineno-0-1944"></a><span class="w">        </span><span class="sd">"""Load fidicual round linked to readout bit for one tile.</span>
</span><span id="__span-0-1945"><a id="__codelineno-0-1945" name="__codelineno-0-1945"></a>
</span><span id="__span-0-1946"><a id="__codelineno-0-1946" name="__codelineno-0-1946"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-1947"><a id="__codelineno-0-1947" name="__codelineno-0-1947"></a><span class="sd">        ----------</span>
</span><span id="__span-0-1948"><a id="__codelineno-0-1948" name="__codelineno-0-1948"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-1949"><a id="__codelineno-0-1949" name="__codelineno-0-1949"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-1950"><a id="__codelineno-0-1950" name="__codelineno-0-1950"></a><span class="sd">        bit : Union[int, str]</span>
</span><span id="__span-0-1951"><a id="__codelineno-0-1951" name="__codelineno-0-1951"></a><span class="sd">            Bit index or bit id.</span>
</span><span id="__span-0-1952"><a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>
</span><span id="__span-0-1953"><a id="__codelineno-0-1953" name="__codelineno-0-1953"></a><span class="sd">        Returns</span>
</span><span id="__span-0-1954"><a id="__codelineno-0-1954" name="__codelineno-0-1954"></a><span class="sd">        -------</span>
</span><span id="__span-0-1955"><a id="__codelineno-0-1955" name="__codelineno-0-1955"></a><span class="sd">        round_linker : Optional[Sequence[int]]</span>
</span><span id="__span-0-1956"><a id="__codelineno-0-1956" name="__codelineno-0-1956"></a><span class="sd">            Fidicual round linked to readout bit for one tile.</span>
</span><span id="__span-0-1957"><a id="__codelineno-0-1957" name="__codelineno-0-1957"></a><span class="sd">        """</span>
</span><span id="__span-0-1958"><a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>
</span><span id="__span-0-1959"><a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1960"><a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-1961"><a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-1962"><a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1963"><a id="__codelineno-0-1963" name="__codelineno-0-1963"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1964"><a id="__codelineno-0-1964" name="__codelineno-0-1964"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-1965"><a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1966"><a id="__codelineno-0-1966" name="__codelineno-0-1966"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-1967"><a id="__codelineno-0-1967" name="__codelineno-0-1967"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id."</span><span class="p">)</span>
</span><span id="__span-0-1968"><a id="__codelineno-0-1968" name="__codelineno-0-1968"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1969"><a id="__codelineno-0-1969" name="__codelineno-0-1969"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1970"><a id="__codelineno-0-1970" name="__codelineno-0-1970"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-1971"><a id="__codelineno-0-1971" name="__codelineno-0-1971"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1972"><a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1973"><a id="__codelineno-0-1973" name="__codelineno-0-1973"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1974"><a id="__codelineno-0-1974" name="__codelineno-0-1974"></a>
</span><span id="__span-0-1975"><a id="__codelineno-0-1975" name="__codelineno-0-1975"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1976"><a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-1977"><a id="__codelineno-0-1977" name="__codelineno-0-1977"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-1978"><a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1979"><a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1980"><a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>                <span class="n">bit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-1981"><a id="__codelineno-0-1981" name="__codelineno-0-1981"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1982"><a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-1983"><a id="__codelineno-0-1983" name="__codelineno-0-1983"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id."</span><span class="p">)</span>
</span><span id="__span-0-1984"><a id="__codelineno-0-1984" name="__codelineno-0-1984"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1985"><a id="__codelineno-0-1985" name="__codelineno-0-1985"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1986"><a id="__codelineno-0-1986" name="__codelineno-0-1986"></a>                <span class="n">bit_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-1987"><a id="__codelineno-0-1987" name="__codelineno-0-1987"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1988"><a id="__codelineno-0-1988" name="__codelineno-0-1988"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1989"><a id="__codelineno-0-1989" name="__codelineno-0-1989"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1990"><a id="__codelineno-0-1990" name="__codelineno-0-1990"></a>
</span><span id="__span-0-1991"><a id="__codelineno-0-1991" name="__codelineno-0-1991"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1992"><a id="__codelineno-0-1992" name="__codelineno-0-1992"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1993"><a id="__codelineno-0-1993" name="__codelineno-0-1993"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-1994"><a id="__codelineno-0-1994" name="__codelineno-0-1994"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1995"><a id="__codelineno-0-1995" name="__codelineno-0-1995"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1996"><a id="__codelineno-0-1996" name="__codelineno-0-1996"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1997"><a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>            <span class="p">)</span>
</span><span id="__span-0-1998"><a id="__codelineno-0-1998" name="__codelineno-0-1998"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1999"><a id="__codelineno-0-1999" name="__codelineno-0-1999"></a>            <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"round_linker"</span><span class="p">])</span>
</span><span id="__span-0-2000"><a id="__codelineno-0-2000" name="__codelineno-0-2000"></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="__span-0-2001"><a id="__codelineno-0-2001" name="__codelineno-0-2001"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">bit_id</span><span class="p">)</span>
</span><span id="__span-0-2002"><a id="__codelineno-0-2002" name="__codelineno-0-2002"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Round linker attribute not found."</span><span class="p">)</span>
</span><span id="__span-0-2003"><a id="__codelineno-0-2003" name="__codelineno-0-2003"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2004"><a id="__codelineno-0-2004" name="__codelineno-0-2004"></a>
</span><span id="__span-0-2005"><a id="__codelineno-0-2005" name="__codelineno-0-2005"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_local_round_linker</span><span class="p">(</span>
</span><span id="__span-0-2006"><a id="__codelineno-0-2006" name="__codelineno-0-2006"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2007"><a id="__codelineno-0-2007" name="__codelineno-0-2007"></a>        <span class="n">round_linker</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-2008"><a id="__codelineno-0-2008" name="__codelineno-0-2008"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2009"><a id="__codelineno-0-2009" name="__codelineno-0-2009"></a>        <span class="n">bit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2010"><a id="__codelineno-0-2010" name="__codelineno-0-2010"></a>    <span class="p">):</span>
</span><span id="__span-0-2011"><a id="__codelineno-0-2011" name="__codelineno-0-2011"></a><span class="w">        </span><span class="sd">"""Save fidicual round linker attribute to readout bit for one tile.</span>
</span><span id="__span-0-2012"><a id="__codelineno-0-2012" name="__codelineno-0-2012"></a>
</span><span id="__span-0-2013"><a id="__codelineno-0-2013" name="__codelineno-0-2013"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-2014"><a id="__codelineno-0-2014" name="__codelineno-0-2014"></a><span class="sd">        ----------</span>
</span><span id="__span-0-2015"><a id="__codelineno-0-2015" name="__codelineno-0-2015"></a><span class="sd">        round_linker : int</span>
</span><span id="__span-0-2016"><a id="__codelineno-0-2016" name="__codelineno-0-2016"></a><span class="sd">            Fidicual round linked to readout bit for one tile.</span>
</span><span id="__span-0-2017"><a id="__codelineno-0-2017" name="__codelineno-0-2017"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-2018"><a id="__codelineno-0-2018" name="__codelineno-0-2018"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-2019"><a id="__codelineno-0-2019" name="__codelineno-0-2019"></a><span class="sd">        bit : Union[int, str]</span>
</span><span id="__span-0-2020"><a id="__codelineno-0-2020" name="__codelineno-0-2020"></a><span class="sd">            Bit index or bit id.</span>
</span><span id="__span-0-2021"><a id="__codelineno-0-2021" name="__codelineno-0-2021"></a><span class="sd">        """</span>
</span><span id="__span-0-2022"><a id="__codelineno-0-2022" name="__codelineno-0-2022"></a>
</span><span id="__span-0-2023"><a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2024"><a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2025"><a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2026"><a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2027"><a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2028"><a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2029"><a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2030"><a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2031"><a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id."</span><span class="p">)</span>
</span><span id="__span-0-2032"><a id="__codelineno-0-2032" name="__codelineno-0-2032"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2033"><a id="__codelineno-0-2033" name="__codelineno-0-2033"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2034"><a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2035"><a id="__codelineno-0-2035" name="__codelineno-0-2035"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2036"><a id="__codelineno-0-2036" name="__codelineno-0-2036"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2037"><a id="__codelineno-0-2037" name="__codelineno-0-2037"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2038"><a id="__codelineno-0-2038" name="__codelineno-0-2038"></a>
</span><span id="__span-0-2039"><a id="__codelineno-0-2039" name="__codelineno-0-2039"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2040"><a id="__codelineno-0-2040" name="__codelineno-0-2040"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-2041"><a id="__codelineno-0-2041" name="__codelineno-0-2041"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-2042"><a id="__codelineno-0-2042" name="__codelineno-0-2042"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2043"><a id="__codelineno-0-2043" name="__codelineno-0-2043"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2044"><a id="__codelineno-0-2044" name="__codelineno-0-2044"></a>                <span class="n">bit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-2045"><a id="__codelineno-0-2045" name="__codelineno-0-2045"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2046"><a id="__codelineno-0-2046" name="__codelineno-0-2046"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-2047"><a id="__codelineno-0-2047" name="__codelineno-0-2047"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id."</span><span class="p">)</span>
</span><span id="__span-0-2048"><a id="__codelineno-0-2048" name="__codelineno-0-2048"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2049"><a id="__codelineno-0-2049" name="__codelineno-0-2049"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2050"><a id="__codelineno-0-2050" name="__codelineno-0-2050"></a>                <span class="n">bit_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-2051"><a id="__codelineno-0-2051" name="__codelineno-0-2051"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2052"><a id="__codelineno-0-2052" name="__codelineno-0-2052"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2053"><a id="__codelineno-0-2053" name="__codelineno-0-2053"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2054"><a id="__codelineno-0-2054" name="__codelineno-0-2054"></a>
</span><span id="__span-0-2055"><a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2056"><a id="__codelineno-0-2056" name="__codelineno-0-2056"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2057"><a id="__codelineno-0-2057" name="__codelineno-0-2057"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-2058"><a id="__codelineno-0-2058" name="__codelineno-0-2058"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2059"><a id="__codelineno-0-2059" name="__codelineno-0-2059"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2060"><a id="__codelineno-0-2060" name="__codelineno-0-2060"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2061"><a id="__codelineno-0-2061" name="__codelineno-0-2061"></a>            <span class="p">)</span>
</span><span id="__span-0-2062"><a id="__codelineno-0-2062" name="__codelineno-0-2062"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2063"><a id="__codelineno-0-2063" name="__codelineno-0-2063"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"round"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">round_linker</span><span class="p">)</span>
</span><span id="__span-0-2064"><a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2065"><a id="__codelineno-0-2065" name="__codelineno-0-2065"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-2066"><a id="__codelineno-0-2066" name="__codelineno-0-2066"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">bit_id</span><span class="p">)</span>
</span><span id="__span-0-2067"><a id="__codelineno-0-2067" name="__codelineno-0-2067"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error writing round linker attribute."</span><span class="p">)</span>
</span><span id="__span-0-2068"><a id="__codelineno-0-2068" name="__codelineno-0-2068"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2069"><a id="__codelineno-0-2069" name="__codelineno-0-2069"></a>
</span><span id="__span-0-2070"><a id="__codelineno-0-2070" name="__codelineno-0-2070"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_local_stage_position_zyx_um</span><span class="p">(</span>
</span><span id="__span-0-2071"><a id="__codelineno-0-2071" name="__codelineno-0-2071"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2072"><a id="__codelineno-0-2072" name="__codelineno-0-2072"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2073"><a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2074"><a id="__codelineno-0-2074" name="__codelineno-0-2074"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-2075"><a id="__codelineno-0-2075" name="__codelineno-0-2075"></a><span class="w">        </span><span class="sd">"""Load tile stage position for one tile.</span>
</span><span id="__span-0-2076"><a id="__codelineno-0-2076" name="__codelineno-0-2076"></a>
</span><span id="__span-0-2077"><a id="__codelineno-0-2077" name="__codelineno-0-2077"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-2078"><a id="__codelineno-0-2078" name="__codelineno-0-2078"></a><span class="sd">        ----------</span>
</span><span id="__span-0-2079"><a id="__codelineno-0-2079" name="__codelineno-0-2079"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-2080"><a id="__codelineno-0-2080" name="__codelineno-0-2080"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-2081"><a id="__codelineno-0-2081" name="__codelineno-0-2081"></a><span class="sd">        round : Union[int, str]</span>
</span><span id="__span-0-2082"><a id="__codelineno-0-2082" name="__codelineno-0-2082"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-2083"><a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>
</span><span id="__span-0-2084"><a id="__codelineno-0-2084" name="__codelineno-0-2084"></a><span class="sd">        Returns</span>
</span><span id="__span-0-2085"><a id="__codelineno-0-2085" name="__codelineno-0-2085"></a><span class="sd">        -------</span>
</span><span id="__span-0-2086"><a id="__codelineno-0-2086" name="__codelineno-0-2086"></a><span class="sd">        stage_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-2087"><a id="__codelineno-0-2087" name="__codelineno-0-2087"></a><span class="sd">            Tile stage position for one tile.</span>
</span><span id="__span-0-2088"><a id="__codelineno-0-2088" name="__codelineno-0-2088"></a><span class="sd">        affine_zyx_um: Optional[ArrayLike]</span>
</span><span id="__span-0-2089"><a id="__codelineno-0-2089" name="__codelineno-0-2089"></a><span class="sd">            Affine transformation between stage and camera</span>
</span><span id="__span-0-2090"><a id="__codelineno-0-2090" name="__codelineno-0-2090"></a><span class="sd">        """</span>
</span><span id="__span-0-2091"><a id="__codelineno-0-2091" name="__codelineno-0-2091"></a>
</span><span id="__span-0-2092"><a id="__codelineno-0-2092" name="__codelineno-0-2092"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2093"><a id="__codelineno-0-2093" name="__codelineno-0-2093"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2094"><a id="__codelineno-0-2094" name="__codelineno-0-2094"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2095"><a id="__codelineno-0-2095" name="__codelineno-0-2095"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2096"><a id="__codelineno-0-2096" name="__codelineno-0-2096"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2097"><a id="__codelineno-0-2097" name="__codelineno-0-2097"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2098"><a id="__codelineno-0-2098" name="__codelineno-0-2098"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2099"><a id="__codelineno-0-2099" name="__codelineno-0-2099"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2100"><a id="__codelineno-0-2100" name="__codelineno-0-2100"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id."</span><span class="p">)</span>
</span><span id="__span-0-2101"><a id="__codelineno-0-2101" name="__codelineno-0-2101"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2102"><a id="__codelineno-0-2102" name="__codelineno-0-2102"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2103"><a id="__codelineno-0-2103" name="__codelineno-0-2103"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2104"><a id="__codelineno-0-2104" name="__codelineno-0-2104"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2105"><a id="__codelineno-0-2105" name="__codelineno-0-2105"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2106"><a id="__codelineno-0-2106" name="__codelineno-0-2106"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2107"><a id="__codelineno-0-2107" name="__codelineno-0-2107"></a>
</span><span id="__span-0-2108"><a id="__codelineno-0-2108" name="__codelineno-0-2108"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2109"><a id="__codelineno-0-2109" name="__codelineno-0-2109"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2110"><a id="__codelineno-0-2110" name="__codelineno-0-2110"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2111"><a id="__codelineno-0-2111" name="__codelineno-0-2111"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2112"><a id="__codelineno-0-2112" name="__codelineno-0-2112"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2113"><a id="__codelineno-0-2113" name="__codelineno-0-2113"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2114"><a id="__codelineno-0-2114" name="__codelineno-0-2114"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2115"><a id="__codelineno-0-2115" name="__codelineno-0-2115"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2116"><a id="__codelineno-0-2116" name="__codelineno-0-2116"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id."</span><span class="p">)</span>
</span><span id="__span-0-2117"><a id="__codelineno-0-2117" name="__codelineno-0-2117"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2118"><a id="__codelineno-0-2118" name="__codelineno-0-2118"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2119"><a id="__codelineno-0-2119" name="__codelineno-0-2119"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2120"><a id="__codelineno-0-2120" name="__codelineno-0-2120"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2121"><a id="__codelineno-0-2121" name="__codelineno-0-2121"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2122"><a id="__codelineno-0-2122" name="__codelineno-0-2122"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2123"><a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>
</span><span id="__span-0-2124"><a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2125"><a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2126"><a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2127"><a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2128"><a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2129"><a id="__codelineno-0-2129" name="__codelineno-0-2129"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2130"><a id="__codelineno-0-2130" name="__codelineno-0-2130"></a>            <span class="p">)</span>
</span><span id="__span-0-2131"><a id="__codelineno-0-2131" name="__codelineno-0-2131"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2132"><a id="__codelineno-0-2132" name="__codelineno-0-2132"></a>            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"stage_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>\
</span><span id="__span-0-2133"><a id="__codelineno-0-2133" name="__codelineno-0-2133"></a>                <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"affine_zyx_px"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-2134"><a id="__codelineno-0-2134" name="__codelineno-0-2134"></a>        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="__span-0-2135"><a id="__codelineno-0-2135" name="__codelineno-0-2135"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-2136"><a id="__codelineno-0-2136" name="__codelineno-0-2136"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Stage position attribute not found."</span><span class="p">)</span>
</span><span id="__span-0-2137"><a id="__codelineno-0-2137" name="__codelineno-0-2137"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2138"><a id="__codelineno-0-2138" name="__codelineno-0-2138"></a>
</span><span id="__span-0-2139"><a id="__codelineno-0-2139" name="__codelineno-0-2139"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_local_stage_position_zyx_um</span><span class="p">(</span>
</span><span id="__span-0-2140"><a id="__codelineno-0-2140" name="__codelineno-0-2140"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2141"><a id="__codelineno-0-2141" name="__codelineno-0-2141"></a>        <span class="n">stage_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-2142"><a id="__codelineno-0-2142" name="__codelineno-0-2142"></a>        <span class="n">affine_zyx_px</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-2143"><a id="__codelineno-0-2143" name="__codelineno-0-2143"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2144"><a id="__codelineno-0-2144" name="__codelineno-0-2144"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2145"><a id="__codelineno-0-2145" name="__codelineno-0-2145"></a>    <span class="p">):</span>
</span><span id="__span-0-2146"><a id="__codelineno-0-2146" name="__codelineno-0-2146"></a><span class="w">        </span><span class="sd">"""Save tile stage position for one tile.</span>
</span><span id="__span-0-2147"><a id="__codelineno-0-2147" name="__codelineno-0-2147"></a>
</span><span id="__span-0-2148"><a id="__codelineno-0-2148" name="__codelineno-0-2148"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-2149"><a id="__codelineno-0-2149" name="__codelineno-0-2149"></a><span class="sd">        ----------</span>
</span><span id="__span-0-2150"><a id="__codelineno-0-2150" name="__codelineno-0-2150"></a><span class="sd">        stage_zyx_um : ArrayLike</span>
</span><span id="__span-0-2151"><a id="__codelineno-0-2151" name="__codelineno-0-2151"></a><span class="sd">            Tile stage position for one tile.</span>
</span><span id="__span-0-2152"><a id="__codelineno-0-2152" name="__codelineno-0-2152"></a><span class="sd">        affine_zyx_px; ArrayLike</span>
</span><span id="__span-0-2153"><a id="__codelineno-0-2153" name="__codelineno-0-2153"></a><span class="sd">            4x4 homogeneous affine matrix for stage transformation</span>
</span><span id="__span-0-2154"><a id="__codelineno-0-2154" name="__codelineno-0-2154"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-2155"><a id="__codelineno-0-2155" name="__codelineno-0-2155"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-2156"><a id="__codelineno-0-2156" name="__codelineno-0-2156"></a><span class="sd">        round : Union[int, str]</span>
</span><span id="__span-0-2157"><a id="__codelineno-0-2157" name="__codelineno-0-2157"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-2158"><a id="__codelineno-0-2158" name="__codelineno-0-2158"></a><span class="sd">        """</span>
</span><span id="__span-0-2159"><a id="__codelineno-0-2159" name="__codelineno-0-2159"></a>
</span><span id="__span-0-2160"><a id="__codelineno-0-2160" name="__codelineno-0-2160"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2161"><a id="__codelineno-0-2161" name="__codelineno-0-2161"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2162"><a id="__codelineno-0-2162" name="__codelineno-0-2162"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2163"><a id="__codelineno-0-2163" name="__codelineno-0-2163"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2164"><a id="__codelineno-0-2164" name="__codelineno-0-2164"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2165"><a id="__codelineno-0-2165" name="__codelineno-0-2165"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2166"><a id="__codelineno-0-2166" name="__codelineno-0-2166"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2167"><a id="__codelineno-0-2167" name="__codelineno-0-2167"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2168"><a id="__codelineno-0-2168" name="__codelineno-0-2168"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id."</span><span class="p">)</span>
</span><span id="__span-0-2169"><a id="__codelineno-0-2169" name="__codelineno-0-2169"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2170"><a id="__codelineno-0-2170" name="__codelineno-0-2170"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2171"><a id="__codelineno-0-2171" name="__codelineno-0-2171"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2172"><a id="__codelineno-0-2172" name="__codelineno-0-2172"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2173"><a id="__codelineno-0-2173" name="__codelineno-0-2173"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2174"><a id="__codelineno-0-2174" name="__codelineno-0-2174"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2175"><a id="__codelineno-0-2175" name="__codelineno-0-2175"></a>
</span><span id="__span-0-2176"><a id="__codelineno-0-2176" name="__codelineno-0-2176"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2177"><a id="__codelineno-0-2177" name="__codelineno-0-2177"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2178"><a id="__codelineno-0-2178" name="__codelineno-0-2178"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2179"><a id="__codelineno-0-2179" name="__codelineno-0-2179"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2180"><a id="__codelineno-0-2180" name="__codelineno-0-2180"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2181"><a id="__codelineno-0-2181" name="__codelineno-0-2181"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2182"><a id="__codelineno-0-2182" name="__codelineno-0-2182"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2183"><a id="__codelineno-0-2183" name="__codelineno-0-2183"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2184"><a id="__codelineno-0-2184" name="__codelineno-0-2184"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id."</span><span class="p">)</span>
</span><span id="__span-0-2185"><a id="__codelineno-0-2185" name="__codelineno-0-2185"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2186"><a id="__codelineno-0-2186" name="__codelineno-0-2186"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2187"><a id="__codelineno-0-2187" name="__codelineno-0-2187"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2188"><a id="__codelineno-0-2188" name="__codelineno-0-2188"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2189"><a id="__codelineno-0-2189" name="__codelineno-0-2189"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2190"><a id="__codelineno-0-2190" name="__codelineno-0-2190"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2191"><a id="__codelineno-0-2191" name="__codelineno-0-2191"></a>
</span><span id="__span-0-2192"><a id="__codelineno-0-2192" name="__codelineno-0-2192"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2193"><a id="__codelineno-0-2193" name="__codelineno-0-2193"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2194"><a id="__codelineno-0-2194" name="__codelineno-0-2194"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2195"><a id="__codelineno-0-2195" name="__codelineno-0-2195"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2196"><a id="__codelineno-0-2196" name="__codelineno-0-2196"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2197"><a id="__codelineno-0-2197" name="__codelineno-0-2197"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2198"><a id="__codelineno-0-2198" name="__codelineno-0-2198"></a>            <span class="p">)</span>
</span><span id="__span-0-2199"><a id="__codelineno-0-2199" name="__codelineno-0-2199"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2200"><a id="__codelineno-0-2200" name="__codelineno-0-2200"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"stage_zyx_um"</span><span class="p">]</span> <span class="o">=</span> <span class="n">stage_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-2201"><a id="__codelineno-0-2201" name="__codelineno-0-2201"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"affine_zyx_px"</span><span class="p">]</span> <span class="o">=</span> <span class="n">affine_zyx_px</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-2202"><a id="__codelineno-0-2202" name="__codelineno-0-2202"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2203"><a id="__codelineno-0-2203" name="__codelineno-0-2203"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-2204"><a id="__codelineno-0-2204" name="__codelineno-0-2204"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-2205"><a id="__codelineno-0-2205" name="__codelineno-0-2205"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error writing stage position attribute."</span><span class="p">)</span>
</span><span id="__span-0-2206"><a id="__codelineno-0-2206" name="__codelineno-0-2206"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2207"><a id="__codelineno-0-2207" name="__codelineno-0-2207"></a>
</span><span id="__span-0-2208"><a id="__codelineno-0-2208" name="__codelineno-0-2208"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_local_wavelengths_um</span><span class="p">(</span>
</span><span id="__span-0-2209"><a id="__codelineno-0-2209" name="__codelineno-0-2209"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2210"><a id="__codelineno-0-2210" name="__codelineno-0-2210"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2211"><a id="__codelineno-0-2211" name="__codelineno-0-2211"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2212"><a id="__codelineno-0-2212" name="__codelineno-0-2212"></a>        <span class="n">bit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2213"><a id="__codelineno-0-2213" name="__codelineno-0-2213"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
</span><span id="__span-0-2214"><a id="__codelineno-0-2214" name="__codelineno-0-2214"></a><span class="w">        </span><span class="sd">"""Load wavelengths for fidicual OR readout bit for one tile.</span>
</span><span id="__span-0-2215"><a id="__codelineno-0-2215" name="__codelineno-0-2215"></a>
</span><span id="__span-0-2216"><a id="__codelineno-0-2216" name="__codelineno-0-2216"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-2217"><a id="__codelineno-0-2217" name="__codelineno-0-2217"></a><span class="sd">        ----------</span>
</span><span id="__span-0-2218"><a id="__codelineno-0-2218" name="__codelineno-0-2218"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-2219"><a id="__codelineno-0-2219" name="__codelineno-0-2219"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-2220"><a id="__codelineno-0-2220" name="__codelineno-0-2220"></a><span class="sd">        round : Optional[Union[int, str]]   </span>
</span><span id="__span-0-2221"><a id="__codelineno-0-2221" name="__codelineno-0-2221"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-2222"><a id="__codelineno-0-2222" name="__codelineno-0-2222"></a><span class="sd">        bit : Optional[Union[int, str]]</span>
</span><span id="__span-0-2223"><a id="__codelineno-0-2223" name="__codelineno-0-2223"></a><span class="sd">            Bit index or bit id.</span>
</span><span id="__span-0-2224"><a id="__codelineno-0-2224" name="__codelineno-0-2224"></a>
</span><span id="__span-0-2225"><a id="__codelineno-0-2225" name="__codelineno-0-2225"></a><span class="sd">        Returns</span>
</span><span id="__span-0-2226"><a id="__codelineno-0-2226" name="__codelineno-0-2226"></a><span class="sd">        -------</span>
</span><span id="__span-0-2227"><a id="__codelineno-0-2227" name="__codelineno-0-2227"></a><span class="sd">        wavelengths_um : Optional[tuple[float, float]]</span>
</span><span id="__span-0-2228"><a id="__codelineno-0-2228" name="__codelineno-0-2228"></a><span class="sd">            Wavelengths for fidicual OR readout bit for one tile.</span>
</span><span id="__span-0-2229"><a id="__codelineno-0-2229" name="__codelineno-0-2229"></a><span class="sd">        """</span>
</span><span id="__span-0-2230"><a id="__codelineno-0-2230" name="__codelineno-0-2230"></a>
</span><span id="__span-0-2231"><a id="__codelineno-0-2231" name="__codelineno-0-2231"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2232"><a id="__codelineno-0-2232" name="__codelineno-0-2232"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Provide either 'round' or 'bit', but not both"</span><span class="p">)</span>
</span><span id="__span-0-2233"><a id="__codelineno-0-2233" name="__codelineno-0-2233"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2234"><a id="__codelineno-0-2234" name="__codelineno-0-2234"></a>
</span><span id="__span-0-2235"><a id="__codelineno-0-2235" name="__codelineno-0-2235"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2236"><a id="__codelineno-0-2236" name="__codelineno-0-2236"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2237"><a id="__codelineno-0-2237" name="__codelineno-0-2237"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2238"><a id="__codelineno-0-2238" name="__codelineno-0-2238"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2239"><a id="__codelineno-0-2239" name="__codelineno-0-2239"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2240"><a id="__codelineno-0-2240" name="__codelineno-0-2240"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2241"><a id="__codelineno-0-2241" name="__codelineno-0-2241"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2242"><a id="__codelineno-0-2242" name="__codelineno-0-2242"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2243"><a id="__codelineno-0-2243" name="__codelineno-0-2243"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2244"><a id="__codelineno-0-2244" name="__codelineno-0-2244"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2245"><a id="__codelineno-0-2245" name="__codelineno-0-2245"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2246"><a id="__codelineno-0-2246" name="__codelineno-0-2246"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2247"><a id="__codelineno-0-2247" name="__codelineno-0-2247"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2248"><a id="__codelineno-0-2248" name="__codelineno-0-2248"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2249"><a id="__codelineno-0-2249" name="__codelineno-0-2249"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2250"><a id="__codelineno-0-2250" name="__codelineno-0-2250"></a>
</span><span id="__span-0-2251"><a id="__codelineno-0-2251" name="__codelineno-0-2251"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-2252"><a id="__codelineno-0-2252" name="__codelineno-0-2252"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2253"><a id="__codelineno-0-2253" name="__codelineno-0-2253"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-2254"><a id="__codelineno-0-2254" name="__codelineno-0-2254"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-2255"><a id="__codelineno-0-2255" name="__codelineno-0-2255"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2256"><a id="__codelineno-0-2256" name="__codelineno-0-2256"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2257"><a id="__codelineno-0-2257" name="__codelineno-0-2257"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-2258"><a id="__codelineno-0-2258" name="__codelineno-0-2258"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2259"><a id="__codelineno-0-2259" name="__codelineno-0-2259"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-2260"><a id="__codelineno-0-2260" name="__codelineno-0-2260"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-2261"><a id="__codelineno-0-2261" name="__codelineno-0-2261"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2262"><a id="__codelineno-0-2262" name="__codelineno-0-2262"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2263"><a id="__codelineno-0-2263" name="__codelineno-0-2263"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-2264"><a id="__codelineno-0-2264" name="__codelineno-0-2264"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2265"><a id="__codelineno-0-2265" name="__codelineno-0-2265"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2266"><a id="__codelineno-0-2266" name="__codelineno-0-2266"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2267"><a id="__codelineno-0-2267" name="__codelineno-0-2267"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2268"><a id="__codelineno-0-2268" name="__codelineno-0-2268"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-2269"><a id="__codelineno-0-2269" name="__codelineno-0-2269"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2270"><a id="__codelineno-0-2270" name="__codelineno-0-2270"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2271"><a id="__codelineno-0-2271" name="__codelineno-0-2271"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2272"><a id="__codelineno-0-2272" name="__codelineno-0-2272"></a>            <span class="p">)</span>
</span><span id="__span-0-2273"><a id="__codelineno-0-2273" name="__codelineno-0-2273"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2274"><a id="__codelineno-0-2274" name="__codelineno-0-2274"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2275"><a id="__codelineno-0-2275" name="__codelineno-0-2275"></a>                <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2276"><a id="__codelineno-0-2276" name="__codelineno-0-2276"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2277"><a id="__codelineno-0-2277" name="__codelineno-0-2277"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2278"><a id="__codelineno-0-2278" name="__codelineno-0-2278"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2279"><a id="__codelineno-0-2279" name="__codelineno-0-2279"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2280"><a id="__codelineno-0-2280" name="__codelineno-0-2280"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2281"><a id="__codelineno-0-2281" name="__codelineno-0-2281"></a>                <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2282"><a id="__codelineno-0-2282" name="__codelineno-0-2282"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2283"><a id="__codelineno-0-2283" name="__codelineno-0-2283"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2284"><a id="__codelineno-0-2284" name="__codelineno-0-2284"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2285"><a id="__codelineno-0-2285" name="__codelineno-0-2285"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2286"><a id="__codelineno-0-2286" name="__codelineno-0-2286"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2287"><a id="__codelineno-0-2287" name="__codelineno-0-2287"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2288"><a id="__codelineno-0-2288" name="__codelineno-0-2288"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2289"><a id="__codelineno-0-2289" name="__codelineno-0-2289"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2290"><a id="__codelineno-0-2290" name="__codelineno-0-2290"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2291"><a id="__codelineno-0-2291" name="__codelineno-0-2291"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2292"><a id="__codelineno-0-2292" name="__codelineno-0-2292"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2293"><a id="__codelineno-0-2293" name="__codelineno-0-2293"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2294"><a id="__codelineno-0-2294" name="__codelineno-0-2294"></a>            <span class="p">)</span>
</span><span id="__span-0-2295"><a id="__codelineno-0-2295" name="__codelineno-0-2295"></a>
</span><span id="__span-0-2296"><a id="__codelineno-0-2296" name="__codelineno-0-2296"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2297"><a id="__codelineno-0-2297" name="__codelineno-0-2297"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2298"><a id="__codelineno-0-2298" name="__codelineno-0-2298"></a>            <span class="n">ex_wavelength_um</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">"excitation_um"</span><span class="p">]</span>
</span><span id="__span-0-2299"><a id="__codelineno-0-2299" name="__codelineno-0-2299"></a>            <span class="n">em_wavelength_um</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">"emission_um"</span><span class="p">]</span>
</span><span id="__span-0-2300"><a id="__codelineno-0-2300" name="__codelineno-0-2300"></a>            <span class="k">return</span> <span class="p">(</span><span class="n">ex_wavelength_um</span><span class="p">,</span> <span class="n">em_wavelength_um</span><span class="p">)</span>
</span><span id="__span-0-2301"><a id="__codelineno-0-2301" name="__codelineno-0-2301"></a>        <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="__span-0-2302"><a id="__codelineno-0-2302" name="__codelineno-0-2302"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Wavelength attributes not found."</span><span class="p">)</span>
</span><span id="__span-0-2303"><a id="__codelineno-0-2303" name="__codelineno-0-2303"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2304"><a id="__codelineno-0-2304" name="__codelineno-0-2304"></a>
</span><span id="__span-0-2305"><a id="__codelineno-0-2305" name="__codelineno-0-2305"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_local_wavelengths_um</span><span class="p">(</span>
</span><span id="__span-0-2306"><a id="__codelineno-0-2306" name="__codelineno-0-2306"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2307"><a id="__codelineno-0-2307" name="__codelineno-0-2307"></a>        <span class="n">wavelengths_um</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-2308"><a id="__codelineno-0-2308" name="__codelineno-0-2308"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2309"><a id="__codelineno-0-2309" name="__codelineno-0-2309"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2310"><a id="__codelineno-0-2310" name="__codelineno-0-2310"></a>        <span class="n">bit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2311"><a id="__codelineno-0-2311" name="__codelineno-0-2311"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
</span><span id="__span-0-2312"><a id="__codelineno-0-2312" name="__codelineno-0-2312"></a><span class="w">        </span><span class="sd">"""Save wavelengths for fidicual OR readout bit for one tile.</span>
</span><span id="__span-0-2313"><a id="__codelineno-0-2313" name="__codelineno-0-2313"></a>
</span><span id="__span-0-2314"><a id="__codelineno-0-2314" name="__codelineno-0-2314"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-2315"><a id="__codelineno-0-2315" name="__codelineno-0-2315"></a><span class="sd">        ----------</span>
</span><span id="__span-0-2316"><a id="__codelineno-0-2316" name="__codelineno-0-2316"></a><span class="sd">        wavelengths_um : tuple[float, float]</span>
</span><span id="__span-0-2317"><a id="__codelineno-0-2317" name="__codelineno-0-2317"></a><span class="sd">            Wavelengths for fidicual OR readout bit for one tile.</span>
</span><span id="__span-0-2318"><a id="__codelineno-0-2318" name="__codelineno-0-2318"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-2319"><a id="__codelineno-0-2319" name="__codelineno-0-2319"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-2320"><a id="__codelineno-0-2320" name="__codelineno-0-2320"></a><span class="sd">        round : Optional[Union[int, str]]</span>
</span><span id="__span-0-2321"><a id="__codelineno-0-2321" name="__codelineno-0-2321"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-2322"><a id="__codelineno-0-2322" name="__codelineno-0-2322"></a><span class="sd">        bit : Optional[Union[int, str]]</span>
</span><span id="__span-0-2323"><a id="__codelineno-0-2323" name="__codelineno-0-2323"></a><span class="sd">            Bit index or bit id.</span>
</span><span id="__span-0-2324"><a id="__codelineno-0-2324" name="__codelineno-0-2324"></a>
</span><span id="__span-0-2325"><a id="__codelineno-0-2325" name="__codelineno-0-2325"></a><span class="sd">        Returns</span>
</span><span id="__span-0-2326"><a id="__codelineno-0-2326" name="__codelineno-0-2326"></a><span class="sd">        -------</span>
</span><span id="__span-0-2327"><a id="__codelineno-0-2327" name="__codelineno-0-2327"></a><span class="sd">        wavelengths_um : Optional[tuple[float, float]]</span>
</span><span id="__span-0-2328"><a id="__codelineno-0-2328" name="__codelineno-0-2328"></a><span class="sd">            Wavelengths for fidicual OR readout bit for one tile.</span>
</span><span id="__span-0-2329"><a id="__codelineno-0-2329" name="__codelineno-0-2329"></a><span class="sd">        """</span>
</span><span id="__span-0-2330"><a id="__codelineno-0-2330" name="__codelineno-0-2330"></a>
</span><span id="__span-0-2331"><a id="__codelineno-0-2331" name="__codelineno-0-2331"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2332"><a id="__codelineno-0-2332" name="__codelineno-0-2332"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Provide either 'round' or 'bit', but not both"</span><span class="p">)</span>
</span><span id="__span-0-2333"><a id="__codelineno-0-2333" name="__codelineno-0-2333"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2334"><a id="__codelineno-0-2334" name="__codelineno-0-2334"></a>
</span><span id="__span-0-2335"><a id="__codelineno-0-2335" name="__codelineno-0-2335"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2336"><a id="__codelineno-0-2336" name="__codelineno-0-2336"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2337"><a id="__codelineno-0-2337" name="__codelineno-0-2337"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2338"><a id="__codelineno-0-2338" name="__codelineno-0-2338"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2339"><a id="__codelineno-0-2339" name="__codelineno-0-2339"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2340"><a id="__codelineno-0-2340" name="__codelineno-0-2340"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2341"><a id="__codelineno-0-2341" name="__codelineno-0-2341"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2342"><a id="__codelineno-0-2342" name="__codelineno-0-2342"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2343"><a id="__codelineno-0-2343" name="__codelineno-0-2343"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2344"><a id="__codelineno-0-2344" name="__codelineno-0-2344"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2345"><a id="__codelineno-0-2345" name="__codelineno-0-2345"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2346"><a id="__codelineno-0-2346" name="__codelineno-0-2346"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2347"><a id="__codelineno-0-2347" name="__codelineno-0-2347"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2348"><a id="__codelineno-0-2348" name="__codelineno-0-2348"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2349"><a id="__codelineno-0-2349" name="__codelineno-0-2349"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2350"><a id="__codelineno-0-2350" name="__codelineno-0-2350"></a>
</span><span id="__span-0-2351"><a id="__codelineno-0-2351" name="__codelineno-0-2351"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-2352"><a id="__codelineno-0-2352" name="__codelineno-0-2352"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2353"><a id="__codelineno-0-2353" name="__codelineno-0-2353"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-2354"><a id="__codelineno-0-2354" name="__codelineno-0-2354"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-2355"><a id="__codelineno-0-2355" name="__codelineno-0-2355"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2356"><a id="__codelineno-0-2356" name="__codelineno-0-2356"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2357"><a id="__codelineno-0-2357" name="__codelineno-0-2357"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-2358"><a id="__codelineno-0-2358" name="__codelineno-0-2358"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2359"><a id="__codelineno-0-2359" name="__codelineno-0-2359"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-2360"><a id="__codelineno-0-2360" name="__codelineno-0-2360"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-2361"><a id="__codelineno-0-2361" name="__codelineno-0-2361"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2362"><a id="__codelineno-0-2362" name="__codelineno-0-2362"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2363"><a id="__codelineno-0-2363" name="__codelineno-0-2363"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-2364"><a id="__codelineno-0-2364" name="__codelineno-0-2364"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2365"><a id="__codelineno-0-2365" name="__codelineno-0-2365"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2366"><a id="__codelineno-0-2366" name="__codelineno-0-2366"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2367"><a id="__codelineno-0-2367" name="__codelineno-0-2367"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2368"><a id="__codelineno-0-2368" name="__codelineno-0-2368"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-2369"><a id="__codelineno-0-2369" name="__codelineno-0-2369"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2370"><a id="__codelineno-0-2370" name="__codelineno-0-2370"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2371"><a id="__codelineno-0-2371" name="__codelineno-0-2371"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2372"><a id="__codelineno-0-2372" name="__codelineno-0-2372"></a>            <span class="p">)</span>
</span><span id="__span-0-2373"><a id="__codelineno-0-2373" name="__codelineno-0-2373"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2374"><a id="__codelineno-0-2374" name="__codelineno-0-2374"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2375"><a id="__codelineno-0-2375" name="__codelineno-0-2375"></a>                <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2376"><a id="__codelineno-0-2376" name="__codelineno-0-2376"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2377"><a id="__codelineno-0-2377" name="__codelineno-0-2377"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2378"><a id="__codelineno-0-2378" name="__codelineno-0-2378"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2379"><a id="__codelineno-0-2379" name="__codelineno-0-2379"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2380"><a id="__codelineno-0-2380" name="__codelineno-0-2380"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2381"><a id="__codelineno-0-2381" name="__codelineno-0-2381"></a>                <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2382"><a id="__codelineno-0-2382" name="__codelineno-0-2382"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2383"><a id="__codelineno-0-2383" name="__codelineno-0-2383"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2384"><a id="__codelineno-0-2384" name="__codelineno-0-2384"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2385"><a id="__codelineno-0-2385" name="__codelineno-0-2385"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2386"><a id="__codelineno-0-2386" name="__codelineno-0-2386"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2387"><a id="__codelineno-0-2387" name="__codelineno-0-2387"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2388"><a id="__codelineno-0-2388" name="__codelineno-0-2388"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2389"><a id="__codelineno-0-2389" name="__codelineno-0-2389"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2390"><a id="__codelineno-0-2390" name="__codelineno-0-2390"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2391"><a id="__codelineno-0-2391" name="__codelineno-0-2391"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2392"><a id="__codelineno-0-2392" name="__codelineno-0-2392"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2393"><a id="__codelineno-0-2393" name="__codelineno-0-2393"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2394"><a id="__codelineno-0-2394" name="__codelineno-0-2394"></a>            <span class="p">)</span>
</span><span id="__span-0-2395"><a id="__codelineno-0-2395" name="__codelineno-0-2395"></a>
</span><span id="__span-0-2396"><a id="__codelineno-0-2396" name="__codelineno-0-2396"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2397"><a id="__codelineno-0-2397" name="__codelineno-0-2397"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2398"><a id="__codelineno-0-2398" name="__codelineno-0-2398"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"excitation_um"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wavelengths_um</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-2399"><a id="__codelineno-0-2399" name="__codelineno-0-2399"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"emission_um"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wavelengths_um</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-2400"><a id="__codelineno-0-2400" name="__codelineno-0-2400"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2401"><a id="__codelineno-0-2401" name="__codelineno-0-2401"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-2402"><a id="__codelineno-0-2402" name="__codelineno-0-2402"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error writing wavelength attributes."</span><span class="p">)</span>
</span><span id="__span-0-2403"><a id="__codelineno-0-2403" name="__codelineno-0-2403"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2404"><a id="__codelineno-0-2404" name="__codelineno-0-2404"></a>
</span><span id="__span-0-2405"><a id="__codelineno-0-2405" name="__codelineno-0-2405"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_local_corrected_image</span><span class="p">(</span>
</span><span id="__span-0-2406"><a id="__codelineno-0-2406" name="__codelineno-0-2406"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2407"><a id="__codelineno-0-2407" name="__codelineno-0-2407"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2408"><a id="__codelineno-0-2408" name="__codelineno-0-2408"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2409"><a id="__codelineno-0-2409" name="__codelineno-0-2409"></a>        <span class="n">bit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2410"><a id="__codelineno-0-2410" name="__codelineno-0-2410"></a>        <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2411"><a id="__codelineno-0-2411" name="__codelineno-0-2411"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-2412"><a id="__codelineno-0-2412" name="__codelineno-0-2412"></a><span class="w">        </span><span class="sd">"""Load gain and offset corrected image for fiducial OR readout bit for one tile.</span>
</span><span id="__span-0-2413"><a id="__codelineno-0-2413" name="__codelineno-0-2413"></a>
</span><span id="__span-0-2414"><a id="__codelineno-0-2414" name="__codelineno-0-2414"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-2415"><a id="__codelineno-0-2415" name="__codelineno-0-2415"></a><span class="sd">        ----------</span>
</span><span id="__span-0-2416"><a id="__codelineno-0-2416" name="__codelineno-0-2416"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-2417"><a id="__codelineno-0-2417" name="__codelineno-0-2417"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-2418"><a id="__codelineno-0-2418" name="__codelineno-0-2418"></a><span class="sd">        round : Optional[Union[int, str]]</span>
</span><span id="__span-0-2419"><a id="__codelineno-0-2419" name="__codelineno-0-2419"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-2420"><a id="__codelineno-0-2420" name="__codelineno-0-2420"></a><span class="sd">        bit : Optional[Union[int, str]]</span>
</span><span id="__span-0-2421"><a id="__codelineno-0-2421" name="__codelineno-0-2421"></a><span class="sd">            Bit index or bit id.</span>
</span><span id="__span-0-2422"><a id="__codelineno-0-2422" name="__codelineno-0-2422"></a><span class="sd">        return_future : Optional[bool]</span>
</span><span id="__span-0-2423"><a id="__codelineno-0-2423" name="__codelineno-0-2423"></a><span class="sd">            Return future array.</span>
</span><span id="__span-0-2424"><a id="__codelineno-0-2424" name="__codelineno-0-2424"></a>
</span><span id="__span-0-2425"><a id="__codelineno-0-2425" name="__codelineno-0-2425"></a><span class="sd">        Returns</span>
</span><span id="__span-0-2426"><a id="__codelineno-0-2426" name="__codelineno-0-2426"></a><span class="sd">        -------</span>
</span><span id="__span-0-2427"><a id="__codelineno-0-2427" name="__codelineno-0-2427"></a><span class="sd">        corrected_image : Optional[ArrayLike]</span>
</span><span id="__span-0-2428"><a id="__codelineno-0-2428" name="__codelineno-0-2428"></a><span class="sd">            Gain and offset corrected image for fiducial OR readout bit for one tile.</span>
</span><span id="__span-0-2429"><a id="__codelineno-0-2429" name="__codelineno-0-2429"></a><span class="sd">        """</span>
</span><span id="__span-0-2430"><a id="__codelineno-0-2430" name="__codelineno-0-2430"></a>
</span><span id="__span-0-2431"><a id="__codelineno-0-2431" name="__codelineno-0-2431"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2432"><a id="__codelineno-0-2432" name="__codelineno-0-2432"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Provide either 'round' or 'bit', but not both"</span><span class="p">)</span>
</span><span id="__span-0-2433"><a id="__codelineno-0-2433" name="__codelineno-0-2433"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2434"><a id="__codelineno-0-2434" name="__codelineno-0-2434"></a>
</span><span id="__span-0-2435"><a id="__codelineno-0-2435" name="__codelineno-0-2435"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2436"><a id="__codelineno-0-2436" name="__codelineno-0-2436"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2437"><a id="__codelineno-0-2437" name="__codelineno-0-2437"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2438"><a id="__codelineno-0-2438" name="__codelineno-0-2438"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2439"><a id="__codelineno-0-2439" name="__codelineno-0-2439"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2440"><a id="__codelineno-0-2440" name="__codelineno-0-2440"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2441"><a id="__codelineno-0-2441" name="__codelineno-0-2441"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2442"><a id="__codelineno-0-2442" name="__codelineno-0-2442"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2443"><a id="__codelineno-0-2443" name="__codelineno-0-2443"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2444"><a id="__codelineno-0-2444" name="__codelineno-0-2444"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2445"><a id="__codelineno-0-2445" name="__codelineno-0-2445"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2446"><a id="__codelineno-0-2446" name="__codelineno-0-2446"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2447"><a id="__codelineno-0-2447" name="__codelineno-0-2447"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2448"><a id="__codelineno-0-2448" name="__codelineno-0-2448"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2449"><a id="__codelineno-0-2449" name="__codelineno-0-2449"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2450"><a id="__codelineno-0-2450" name="__codelineno-0-2450"></a>
</span><span id="__span-0-2451"><a id="__codelineno-0-2451" name="__codelineno-0-2451"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-2452"><a id="__codelineno-0-2452" name="__codelineno-0-2452"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2453"><a id="__codelineno-0-2453" name="__codelineno-0-2453"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-2454"><a id="__codelineno-0-2454" name="__codelineno-0-2454"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-2455"><a id="__codelineno-0-2455" name="__codelineno-0-2455"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2456"><a id="__codelineno-0-2456" name="__codelineno-0-2456"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2457"><a id="__codelineno-0-2457" name="__codelineno-0-2457"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-2458"><a id="__codelineno-0-2458" name="__codelineno-0-2458"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2459"><a id="__codelineno-0-2459" name="__codelineno-0-2459"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-2460"><a id="__codelineno-0-2460" name="__codelineno-0-2460"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-2461"><a id="__codelineno-0-2461" name="__codelineno-0-2461"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2462"><a id="__codelineno-0-2462" name="__codelineno-0-2462"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2463"><a id="__codelineno-0-2463" name="__codelineno-0-2463"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-2464"><a id="__codelineno-0-2464" name="__codelineno-0-2464"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2465"><a id="__codelineno-0-2465" name="__codelineno-0-2465"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2466"><a id="__codelineno-0-2466" name="__codelineno-0-2466"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2467"><a id="__codelineno-0-2467" name="__codelineno-0-2467"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2468"><a id="__codelineno-0-2468" name="__codelineno-0-2468"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-2469"><a id="__codelineno-0-2469" name="__codelineno-0-2469"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2470"><a id="__codelineno-0-2470" name="__codelineno-0-2470"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2471"><a id="__codelineno-0-2471" name="__codelineno-0-2471"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"corrected_data"</span><span class="p">)</span>
</span><span id="__span-0-2472"><a id="__codelineno-0-2472" name="__codelineno-0-2472"></a>            <span class="p">)</span>
</span><span id="__span-0-2473"><a id="__codelineno-0-2473" name="__codelineno-0-2473"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2474"><a id="__codelineno-0-2474" name="__codelineno-0-2474"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2475"><a id="__codelineno-0-2475" name="__codelineno-0-2475"></a>                <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2476"><a id="__codelineno-0-2476" name="__codelineno-0-2476"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2477"><a id="__codelineno-0-2477" name="__codelineno-0-2477"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2478"><a id="__codelineno-0-2478" name="__codelineno-0-2478"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2479"><a id="__codelineno-0-2479" name="__codelineno-0-2479"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2480"><a id="__codelineno-0-2480" name="__codelineno-0-2480"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2481"><a id="__codelineno-0-2481" name="__codelineno-0-2481"></a>                <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2482"><a id="__codelineno-0-2482" name="__codelineno-0-2482"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2483"><a id="__codelineno-0-2483" name="__codelineno-0-2483"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2484"><a id="__codelineno-0-2484" name="__codelineno-0-2484"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2485"><a id="__codelineno-0-2485" name="__codelineno-0-2485"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2486"><a id="__codelineno-0-2486" name="__codelineno-0-2486"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2487"><a id="__codelineno-0-2487" name="__codelineno-0-2487"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2488"><a id="__codelineno-0-2488" name="__codelineno-0-2488"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2489"><a id="__codelineno-0-2489" name="__codelineno-0-2489"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2490"><a id="__codelineno-0-2490" name="__codelineno-0-2490"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2491"><a id="__codelineno-0-2491" name="__codelineno-0-2491"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2492"><a id="__codelineno-0-2492" name="__codelineno-0-2492"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2493"><a id="__codelineno-0-2493" name="__codelineno-0-2493"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"corrected_data"</span><span class="p">)</span>
</span><span id="__span-0-2494"><a id="__codelineno-0-2494" name="__codelineno-0-2494"></a>            <span class="p">)</span>
</span><span id="__span-0-2495"><a id="__codelineno-0-2495" name="__codelineno-0-2495"></a>
</span><span id="__span-0-2496"><a id="__codelineno-0-2496" name="__codelineno-0-2496"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-2497"><a id="__codelineno-0-2497" name="__codelineno-0-2497"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Corrected image not found."</span><span class="p">)</span>
</span><span id="__span-0-2498"><a id="__codelineno-0-2498" name="__codelineno-0-2498"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2499"><a id="__codelineno-0-2499" name="__codelineno-0-2499"></a>
</span><span id="__span-0-2500"><a id="__codelineno-0-2500" name="__codelineno-0-2500"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2501"><a id="__codelineno-0-2501" name="__codelineno-0-2501"></a>            <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-0-2502"><a id="__codelineno-0-2502" name="__codelineno-0-2502"></a>            <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"&lt;u2"</span>
</span><span id="__span-0-2503"><a id="__codelineno-0-2503" name="__codelineno-0-2503"></a>            <span class="n">corrected_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-2504"><a id="__codelineno-0-2504" name="__codelineno-0-2504"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-2505"><a id="__codelineno-0-2505" name="__codelineno-0-2505"></a>                <span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-2506"><a id="__codelineno-0-2506" name="__codelineno-0-2506"></a>                <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-2507"><a id="__codelineno-0-2507" name="__codelineno-0-2507"></a>            <span class="p">)</span>
</span><span id="__span-0-2508"><a id="__codelineno-0-2508" name="__codelineno-0-2508"></a>            <span class="k">return</span> <span class="n">corrected_image</span>
</span><span id="__span-0-2509"><a id="__codelineno-0-2509" name="__codelineno-0-2509"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-2510"><a id="__codelineno-0-2510" name="__codelineno-0-2510"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error loading corrected image."</span><span class="p">)</span>
</span><span id="__span-0-2511"><a id="__codelineno-0-2511" name="__codelineno-0-2511"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2512"><a id="__codelineno-0-2512" name="__codelineno-0-2512"></a>
</span><span id="__span-0-2513"><a id="__codelineno-0-2513" name="__codelineno-0-2513"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_local_corrected_image</span><span class="p">(</span>
</span><span id="__span-0-2514"><a id="__codelineno-0-2514" name="__codelineno-0-2514"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2515"><a id="__codelineno-0-2515" name="__codelineno-0-2515"></a>        <span class="n">image</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-2516"><a id="__codelineno-0-2516" name="__codelineno-0-2516"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2517"><a id="__codelineno-0-2517" name="__codelineno-0-2517"></a>        <span class="n">gain_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2518"><a id="__codelineno-0-2518" name="__codelineno-0-2518"></a>        <span class="n">hotpixel_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2519"><a id="__codelineno-0-2519" name="__codelineno-0-2519"></a>        <span class="n">shading_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2520"><a id="__codelineno-0-2520" name="__codelineno-0-2520"></a>        <span class="n">psf_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-0-2521"><a id="__codelineno-0-2521" name="__codelineno-0-2521"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2522"><a id="__codelineno-0-2522" name="__codelineno-0-2522"></a>        <span class="n">bit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2523"><a id="__codelineno-0-2523" name="__codelineno-0-2523"></a>        <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2524"><a id="__codelineno-0-2524" name="__codelineno-0-2524"></a>    <span class="p">):</span>
</span><span id="__span-0-2525"><a id="__codelineno-0-2525" name="__codelineno-0-2525"></a><span class="w">        </span><span class="sd">"""Save gain and offset corrected image.</span>
</span><span id="__span-0-2526"><a id="__codelineno-0-2526" name="__codelineno-0-2526"></a>
</span><span id="__span-0-2527"><a id="__codelineno-0-2527" name="__codelineno-0-2527"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-2528"><a id="__codelineno-0-2528" name="__codelineno-0-2528"></a><span class="sd">        ----------</span>
</span><span id="__span-0-2529"><a id="__codelineno-0-2529" name="__codelineno-0-2529"></a><span class="sd">        image : ArrayLike</span>
</span><span id="__span-0-2530"><a id="__codelineno-0-2530" name="__codelineno-0-2530"></a><span class="sd">            Local corrected image.</span>
</span><span id="__span-0-2531"><a id="__codelineno-0-2531" name="__codelineno-0-2531"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-2532"><a id="__codelineno-0-2532" name="__codelineno-0-2532"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-2533"><a id="__codelineno-0-2533" name="__codelineno-0-2533"></a><span class="sd">        gain_correction : bool</span>
</span><span id="__span-0-2534"><a id="__codelineno-0-2534" name="__codelineno-0-2534"></a><span class="sd">            Gain correction applied (True) or not (False).</span>
</span><span id="__span-0-2535"><a id="__codelineno-0-2535" name="__codelineno-0-2535"></a><span class="sd">        hotpixel_correction : bool</span>
</span><span id="__span-0-2536"><a id="__codelineno-0-2536" name="__codelineno-0-2536"></a><span class="sd">            Hotpixel correction applied (True) or not (False).</span>
</span><span id="__span-0-2537"><a id="__codelineno-0-2537" name="__codelineno-0-2537"></a><span class="sd">        shading_correction : bool</span>
</span><span id="__span-0-2538"><a id="__codelineno-0-2538" name="__codelineno-0-2538"></a><span class="sd">            Shading correction applied (True) or not (False).</span>
</span><span id="__span-0-2539"><a id="__codelineno-0-2539" name="__codelineno-0-2539"></a><span class="sd">        psf_idx : int</span>
</span><span id="__span-0-2540"><a id="__codelineno-0-2540" name="__codelineno-0-2540"></a><span class="sd">            PSF index.</span>
</span><span id="__span-0-2541"><a id="__codelineno-0-2541" name="__codelineno-0-2541"></a><span class="sd">        round : Optional[Union[int, str]]</span>
</span><span id="__span-0-2542"><a id="__codelineno-0-2542" name="__codelineno-0-2542"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-2543"><a id="__codelineno-0-2543" name="__codelineno-0-2543"></a><span class="sd">        bit : Optional[Union[int, str]]</span>
</span><span id="__span-0-2544"><a id="__codelineno-0-2544" name="__codelineno-0-2544"></a><span class="sd">            Bit index or bit id.</span>
</span><span id="__span-0-2545"><a id="__codelineno-0-2545" name="__codelineno-0-2545"></a><span class="sd">        return_future : Optional[bool]</span>
</span><span id="__span-0-2546"><a id="__codelineno-0-2546" name="__codelineno-0-2546"></a><span class="sd">            Return future array.</span>
</span><span id="__span-0-2547"><a id="__codelineno-0-2547" name="__codelineno-0-2547"></a><span class="sd">   """</span>
</span><span id="__span-0-2548"><a id="__codelineno-0-2548" name="__codelineno-0-2548"></a>
</span><span id="__span-0-2549"><a id="__codelineno-0-2549" name="__codelineno-0-2549"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2550"><a id="__codelineno-0-2550" name="__codelineno-0-2550"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Provide either 'round' or 'bit', but not both"</span><span class="p">)</span>
</span><span id="__span-0-2551"><a id="__codelineno-0-2551" name="__codelineno-0-2551"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2552"><a id="__codelineno-0-2552" name="__codelineno-0-2552"></a>
</span><span id="__span-0-2553"><a id="__codelineno-0-2553" name="__codelineno-0-2553"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2554"><a id="__codelineno-0-2554" name="__codelineno-0-2554"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2555"><a id="__codelineno-0-2555" name="__codelineno-0-2555"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2556"><a id="__codelineno-0-2556" name="__codelineno-0-2556"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2557"><a id="__codelineno-0-2557" name="__codelineno-0-2557"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2558"><a id="__codelineno-0-2558" name="__codelineno-0-2558"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2559"><a id="__codelineno-0-2559" name="__codelineno-0-2559"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2560"><a id="__codelineno-0-2560" name="__codelineno-0-2560"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2561"><a id="__codelineno-0-2561" name="__codelineno-0-2561"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2562"><a id="__codelineno-0-2562" name="__codelineno-0-2562"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2563"><a id="__codelineno-0-2563" name="__codelineno-0-2563"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2564"><a id="__codelineno-0-2564" name="__codelineno-0-2564"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2565"><a id="__codelineno-0-2565" name="__codelineno-0-2565"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2566"><a id="__codelineno-0-2566" name="__codelineno-0-2566"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2567"><a id="__codelineno-0-2567" name="__codelineno-0-2567"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2568"><a id="__codelineno-0-2568" name="__codelineno-0-2568"></a>
</span><span id="__span-0-2569"><a id="__codelineno-0-2569" name="__codelineno-0-2569"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-2570"><a id="__codelineno-0-2570" name="__codelineno-0-2570"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2571"><a id="__codelineno-0-2571" name="__codelineno-0-2571"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-2572"><a id="__codelineno-0-2572" name="__codelineno-0-2572"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-2573"><a id="__codelineno-0-2573" name="__codelineno-0-2573"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2574"><a id="__codelineno-0-2574" name="__codelineno-0-2574"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2575"><a id="__codelineno-0-2575" name="__codelineno-0-2575"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-2576"><a id="__codelineno-0-2576" name="__codelineno-0-2576"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2577"><a id="__codelineno-0-2577" name="__codelineno-0-2577"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-2578"><a id="__codelineno-0-2578" name="__codelineno-0-2578"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-2579"><a id="__codelineno-0-2579" name="__codelineno-0-2579"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2580"><a id="__codelineno-0-2580" name="__codelineno-0-2580"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2581"><a id="__codelineno-0-2581" name="__codelineno-0-2581"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-2582"><a id="__codelineno-0-2582" name="__codelineno-0-2582"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2583"><a id="__codelineno-0-2583" name="__codelineno-0-2583"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2584"><a id="__codelineno-0-2584" name="__codelineno-0-2584"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2585"><a id="__codelineno-0-2585" name="__codelineno-0-2585"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2586"><a id="__codelineno-0-2586" name="__codelineno-0-2586"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-2587"><a id="__codelineno-0-2587" name="__codelineno-0-2587"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2588"><a id="__codelineno-0-2588" name="__codelineno-0-2588"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2589"><a id="__codelineno-0-2589" name="__codelineno-0-2589"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"corrected_data"</span><span class="p">)</span>
</span><span id="__span-0-2590"><a id="__codelineno-0-2590" name="__codelineno-0-2590"></a>            <span class="p">)</span>
</span><span id="__span-0-2591"><a id="__codelineno-0-2591" name="__codelineno-0-2591"></a>            <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2592"><a id="__codelineno-0-2592" name="__codelineno-0-2592"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-2593"><a id="__codelineno-0-2593" name="__codelineno-0-2593"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2594"><a id="__codelineno-0-2594" name="__codelineno-0-2594"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2595"><a id="__codelineno-0-2595" name="__codelineno-0-2595"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2596"><a id="__codelineno-0-2596" name="__codelineno-0-2596"></a>            <span class="p">)</span>
</span><span id="__span-0-2597"><a id="__codelineno-0-2597" name="__codelineno-0-2597"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2598"><a id="__codelineno-0-2598" name="__codelineno-0-2598"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2599"><a id="__codelineno-0-2599" name="__codelineno-0-2599"></a>                <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2600"><a id="__codelineno-0-2600" name="__codelineno-0-2600"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2601"><a id="__codelineno-0-2601" name="__codelineno-0-2601"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2602"><a id="__codelineno-0-2602" name="__codelineno-0-2602"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2603"><a id="__codelineno-0-2603" name="__codelineno-0-2603"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2604"><a id="__codelineno-0-2604" name="__codelineno-0-2604"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2605"><a id="__codelineno-0-2605" name="__codelineno-0-2605"></a>                <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2606"><a id="__codelineno-0-2606" name="__codelineno-0-2606"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2607"><a id="__codelineno-0-2607" name="__codelineno-0-2607"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2608"><a id="__codelineno-0-2608" name="__codelineno-0-2608"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2609"><a id="__codelineno-0-2609" name="__codelineno-0-2609"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2610"><a id="__codelineno-0-2610" name="__codelineno-0-2610"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2611"><a id="__codelineno-0-2611" name="__codelineno-0-2611"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2612"><a id="__codelineno-0-2612" name="__codelineno-0-2612"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2613"><a id="__codelineno-0-2613" name="__codelineno-0-2613"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2614"><a id="__codelineno-0-2614" name="__codelineno-0-2614"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2615"><a id="__codelineno-0-2615" name="__codelineno-0-2615"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2616"><a id="__codelineno-0-2616" name="__codelineno-0-2616"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2617"><a id="__codelineno-0-2617" name="__codelineno-0-2617"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"corrected_data"</span><span class="p">)</span>
</span><span id="__span-0-2618"><a id="__codelineno-0-2618" name="__codelineno-0-2618"></a>            <span class="p">)</span>
</span><span id="__span-0-2619"><a id="__codelineno-0-2619" name="__codelineno-0-2619"></a>            <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2620"><a id="__codelineno-0-2620" name="__codelineno-0-2620"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2621"><a id="__codelineno-0-2621" name="__codelineno-0-2621"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2622"><a id="__codelineno-0-2622" name="__codelineno-0-2622"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2623"><a id="__codelineno-0-2623" name="__codelineno-0-2623"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2624"><a id="__codelineno-0-2624" name="__codelineno-0-2624"></a>            <span class="p">)</span>
</span><span id="__span-0-2625"><a id="__codelineno-0-2625" name="__codelineno-0-2625"></a>
</span><span id="__span-0-2626"><a id="__codelineno-0-2626" name="__codelineno-0-2626"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2627"><a id="__codelineno-0-2627" name="__codelineno-0-2627"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-2628"><a id="__codelineno-0-2628" name="__codelineno-0-2628"></a>                <span class="n">image</span><span class="p">,</span>
</span><span id="__span-0-2629"><a id="__codelineno-0-2629" name="__codelineno-0-2629"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-2630"><a id="__codelineno-0-2630" name="__codelineno-0-2630"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="p">,</span>
</span><span id="__span-0-2631"><a id="__codelineno-0-2631" name="__codelineno-0-2631"></a>                <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-2632"><a id="__codelineno-0-2632" name="__codelineno-0-2632"></a>            <span class="p">)</span>
</span><span id="__span-0-2633"><a id="__codelineno-0-2633" name="__codelineno-0-2633"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2634"><a id="__codelineno-0-2634" name="__codelineno-0-2634"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"gain_correction"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gain_correction</span><span class="p">,)</span>
</span><span id="__span-0-2635"><a id="__codelineno-0-2635" name="__codelineno-0-2635"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"hotpixel_correction"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">hotpixel_correction</span><span class="p">,)</span>
</span><span id="__span-0-2636"><a id="__codelineno-0-2636" name="__codelineno-0-2636"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"shading_correction"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">shading_correction</span><span class="p">)</span>
</span><span id="__span-0-2637"><a id="__codelineno-0-2637" name="__codelineno-0-2637"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"psf_idx"</span><span class="p">]</span> <span class="o">=</span> <span class="n">psf_idx</span>
</span><span id="__span-0-2638"><a id="__codelineno-0-2638" name="__codelineno-0-2638"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2639"><a id="__codelineno-0-2639" name="__codelineno-0-2639"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-2640"><a id="__codelineno-0-2640" name="__codelineno-0-2640"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-2641"><a id="__codelineno-0-2641" name="__codelineno-0-2641"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving corrected image."</span><span class="p">)</span>
</span><span id="__span-0-2642"><a id="__codelineno-0-2642" name="__codelineno-0-2642"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2643"><a id="__codelineno-0-2643" name="__codelineno-0-2643"></a>
</span><span id="__span-0-2644"><a id="__codelineno-0-2644" name="__codelineno-0-2644"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_local_rigid_xform_xyz_px</span><span class="p">(</span>
</span><span id="__span-0-2645"><a id="__codelineno-0-2645" name="__codelineno-0-2645"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2646"><a id="__codelineno-0-2646" name="__codelineno-0-2646"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2647"><a id="__codelineno-0-2647" name="__codelineno-0-2647"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2648"><a id="__codelineno-0-2648" name="__codelineno-0-2648"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-2649"><a id="__codelineno-0-2649" name="__codelineno-0-2649"></a><span class="w">        </span><span class="sd">"""Load calculated rigid registration transform for one round and tile.</span>
</span><span id="__span-0-2650"><a id="__codelineno-0-2650" name="__codelineno-0-2650"></a>
</span><span id="__span-0-2651"><a id="__codelineno-0-2651" name="__codelineno-0-2651"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-2652"><a id="__codelineno-0-2652" name="__codelineno-0-2652"></a><span class="sd">        ----------</span>
</span><span id="__span-0-2653"><a id="__codelineno-0-2653" name="__codelineno-0-2653"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-2654"><a id="__codelineno-0-2654" name="__codelineno-0-2654"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-2655"><a id="__codelineno-0-2655" name="__codelineno-0-2655"></a><span class="sd">        round : Union[int, str]</span>
</span><span id="__span-0-2656"><a id="__codelineno-0-2656" name="__codelineno-0-2656"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-2657"><a id="__codelineno-0-2657" name="__codelineno-0-2657"></a>
</span><span id="__span-0-2658"><a id="__codelineno-0-2658" name="__codelineno-0-2658"></a><span class="sd">        Returns</span>
</span><span id="__span-0-2659"><a id="__codelineno-0-2659" name="__codelineno-0-2659"></a><span class="sd">        -------</span>
</span><span id="__span-0-2660"><a id="__codelineno-0-2660" name="__codelineno-0-2660"></a><span class="sd">        rigid_xform_xyz_px : Optional[ArrayLike]</span>
</span><span id="__span-0-2661"><a id="__codelineno-0-2661" name="__codelineno-0-2661"></a><span class="sd">            Local rigid registration transform for one round and tile.</span>
</span><span id="__span-0-2662"><a id="__codelineno-0-2662" name="__codelineno-0-2662"></a><span class="sd">        """</span>
</span><span id="__span-0-2663"><a id="__codelineno-0-2663" name="__codelineno-0-2663"></a>
</span><span id="__span-0-2664"><a id="__codelineno-0-2664" name="__codelineno-0-2664"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2665"><a id="__codelineno-0-2665" name="__codelineno-0-2665"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2666"><a id="__codelineno-0-2666" name="__codelineno-0-2666"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2667"><a id="__codelineno-0-2667" name="__codelineno-0-2667"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2668"><a id="__codelineno-0-2668" name="__codelineno-0-2668"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2669"><a id="__codelineno-0-2669" name="__codelineno-0-2669"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2670"><a id="__codelineno-0-2670" name="__codelineno-0-2670"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2671"><a id="__codelineno-0-2671" name="__codelineno-0-2671"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2672"><a id="__codelineno-0-2672" name="__codelineno-0-2672"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2673"><a id="__codelineno-0-2673" name="__codelineno-0-2673"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2674"><a id="__codelineno-0-2674" name="__codelineno-0-2674"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2675"><a id="__codelineno-0-2675" name="__codelineno-0-2675"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2676"><a id="__codelineno-0-2676" name="__codelineno-0-2676"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2677"><a id="__codelineno-0-2677" name="__codelineno-0-2677"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2678"><a id="__codelineno-0-2678" name="__codelineno-0-2678"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2679"><a id="__codelineno-0-2679" name="__codelineno-0-2679"></a>
</span><span id="__span-0-2680"><a id="__codelineno-0-2680" name="__codelineno-0-2680"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2681"><a id="__codelineno-0-2681" name="__codelineno-0-2681"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2682"><a id="__codelineno-0-2682" name="__codelineno-0-2682"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2683"><a id="__codelineno-0-2683" name="__codelineno-0-2683"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2684"><a id="__codelineno-0-2684" name="__codelineno-0-2684"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2685"><a id="__codelineno-0-2685" name="__codelineno-0-2685"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2686"><a id="__codelineno-0-2686" name="__codelineno-0-2686"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2687"><a id="__codelineno-0-2687" name="__codelineno-0-2687"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2688"><a id="__codelineno-0-2688" name="__codelineno-0-2688"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2689"><a id="__codelineno-0-2689" name="__codelineno-0-2689"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2690"><a id="__codelineno-0-2690" name="__codelineno-0-2690"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2691"><a id="__codelineno-0-2691" name="__codelineno-0-2691"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2692"><a id="__codelineno-0-2692" name="__codelineno-0-2692"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2693"><a id="__codelineno-0-2693" name="__codelineno-0-2693"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2694"><a id="__codelineno-0-2694" name="__codelineno-0-2694"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2695"><a id="__codelineno-0-2695" name="__codelineno-0-2695"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2696"><a id="__codelineno-0-2696" name="__codelineno-0-2696"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2697"><a id="__codelineno-0-2697" name="__codelineno-0-2697"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2698"><a id="__codelineno-0-2698" name="__codelineno-0-2698"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2699"><a id="__codelineno-0-2699" name="__codelineno-0-2699"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2700"><a id="__codelineno-0-2700" name="__codelineno-0-2700"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2701"><a id="__codelineno-0-2701" name="__codelineno-0-2701"></a>            <span class="p">)</span>
</span><span id="__span-0-2702"><a id="__codelineno-0-2702" name="__codelineno-0-2702"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2703"><a id="__codelineno-0-2703" name="__codelineno-0-2703"></a>            <span class="n">rigid_xform_xyz_px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
</span><span id="__span-0-2704"><a id="__codelineno-0-2704" name="__codelineno-0-2704"></a>                <span class="n">attributes</span><span class="p">[</span><span class="s2">"rigid_xform_xyz_px"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span><span id="__span-0-2705"><a id="__codelineno-0-2705" name="__codelineno-0-2705"></a>            <span class="p">)</span>
</span><span id="__span-0-2706"><a id="__codelineno-0-2706" name="__codelineno-0-2706"></a>            <span class="k">return</span> <span class="n">rigid_xform_xyz_px</span>
</span><span id="__span-0-2707"><a id="__codelineno-0-2707" name="__codelineno-0-2707"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-2708"><a id="__codelineno-0-2708" name="__codelineno-0-2708"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-2709"><a id="__codelineno-0-2709" name="__codelineno-0-2709"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Rigid transform mapping back to first round not found."</span><span class="p">)</span>
</span><span id="__span-0-2710"><a id="__codelineno-0-2710" name="__codelineno-0-2710"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2711"><a id="__codelineno-0-2711" name="__codelineno-0-2711"></a>
</span><span id="__span-0-2712"><a id="__codelineno-0-2712" name="__codelineno-0-2712"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_local_rigid_xform_xyz_px</span><span class="p">(</span>
</span><span id="__span-0-2713"><a id="__codelineno-0-2713" name="__codelineno-0-2713"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2714"><a id="__codelineno-0-2714" name="__codelineno-0-2714"></a>        <span class="n">rigid_xform_xyz_px</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-2715"><a id="__codelineno-0-2715" name="__codelineno-0-2715"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2716"><a id="__codelineno-0-2716" name="__codelineno-0-2716"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2717"><a id="__codelineno-0-2717" name="__codelineno-0-2717"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-2718"><a id="__codelineno-0-2718" name="__codelineno-0-2718"></a><span class="w">        </span><span class="sd">"""Save calculated rigid registration transform for one round and tile.</span>
</span><span id="__span-0-2719"><a id="__codelineno-0-2719" name="__codelineno-0-2719"></a>
</span><span id="__span-0-2720"><a id="__codelineno-0-2720" name="__codelineno-0-2720"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-2721"><a id="__codelineno-0-2721" name="__codelineno-0-2721"></a><span class="sd">        ----------</span>
</span><span id="__span-0-2722"><a id="__codelineno-0-2722" name="__codelineno-0-2722"></a><span class="sd">        rigid_xform_xyz_px : ArrayLike</span>
</span><span id="__span-0-2723"><a id="__codelineno-0-2723" name="__codelineno-0-2723"></a><span class="sd">            Local rigid registration transform for one round and tile.</span>
</span><span id="__span-0-2724"><a id="__codelineno-0-2724" name="__codelineno-0-2724"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-2725"><a id="__codelineno-0-2725" name="__codelineno-0-2725"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-2726"><a id="__codelineno-0-2726" name="__codelineno-0-2726"></a><span class="sd">        round : Union[int, str]</span>
</span><span id="__span-0-2727"><a id="__codelineno-0-2727" name="__codelineno-0-2727"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-2728"><a id="__codelineno-0-2728" name="__codelineno-0-2728"></a>
</span><span id="__span-0-2729"><a id="__codelineno-0-2729" name="__codelineno-0-2729"></a><span class="sd">        Returns</span>
</span><span id="__span-0-2730"><a id="__codelineno-0-2730" name="__codelineno-0-2730"></a><span class="sd">        -------</span>
</span><span id="__span-0-2731"><a id="__codelineno-0-2731" name="__codelineno-0-2731"></a><span class="sd">        rigid_xform_xyz_px : Optional[ArrayLike]</span>
</span><span id="__span-0-2732"><a id="__codelineno-0-2732" name="__codelineno-0-2732"></a><span class="sd">            Local rigid registration transform for one round and tile.</span>
</span><span id="__span-0-2733"><a id="__codelineno-0-2733" name="__codelineno-0-2733"></a><span class="sd">        """</span>
</span><span id="__span-0-2734"><a id="__codelineno-0-2734" name="__codelineno-0-2734"></a>
</span><span id="__span-0-2735"><a id="__codelineno-0-2735" name="__codelineno-0-2735"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2736"><a id="__codelineno-0-2736" name="__codelineno-0-2736"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2737"><a id="__codelineno-0-2737" name="__codelineno-0-2737"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2738"><a id="__codelineno-0-2738" name="__codelineno-0-2738"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2739"><a id="__codelineno-0-2739" name="__codelineno-0-2739"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2740"><a id="__codelineno-0-2740" name="__codelineno-0-2740"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2741"><a id="__codelineno-0-2741" name="__codelineno-0-2741"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2742"><a id="__codelineno-0-2742" name="__codelineno-0-2742"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2743"><a id="__codelineno-0-2743" name="__codelineno-0-2743"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2744"><a id="__codelineno-0-2744" name="__codelineno-0-2744"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2745"><a id="__codelineno-0-2745" name="__codelineno-0-2745"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2746"><a id="__codelineno-0-2746" name="__codelineno-0-2746"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2747"><a id="__codelineno-0-2747" name="__codelineno-0-2747"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2748"><a id="__codelineno-0-2748" name="__codelineno-0-2748"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2749"><a id="__codelineno-0-2749" name="__codelineno-0-2749"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2750"><a id="__codelineno-0-2750" name="__codelineno-0-2750"></a>
</span><span id="__span-0-2751"><a id="__codelineno-0-2751" name="__codelineno-0-2751"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2752"><a id="__codelineno-0-2752" name="__codelineno-0-2752"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2753"><a id="__codelineno-0-2753" name="__codelineno-0-2753"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2754"><a id="__codelineno-0-2754" name="__codelineno-0-2754"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2755"><a id="__codelineno-0-2755" name="__codelineno-0-2755"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2756"><a id="__codelineno-0-2756" name="__codelineno-0-2756"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2757"><a id="__codelineno-0-2757" name="__codelineno-0-2757"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2758"><a id="__codelineno-0-2758" name="__codelineno-0-2758"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2759"><a id="__codelineno-0-2759" name="__codelineno-0-2759"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2760"><a id="__codelineno-0-2760" name="__codelineno-0-2760"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2761"><a id="__codelineno-0-2761" name="__codelineno-0-2761"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2762"><a id="__codelineno-0-2762" name="__codelineno-0-2762"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2763"><a id="__codelineno-0-2763" name="__codelineno-0-2763"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2764"><a id="__codelineno-0-2764" name="__codelineno-0-2764"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2765"><a id="__codelineno-0-2765" name="__codelineno-0-2765"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2766"><a id="__codelineno-0-2766" name="__codelineno-0-2766"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2767"><a id="__codelineno-0-2767" name="__codelineno-0-2767"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2768"><a id="__codelineno-0-2768" name="__codelineno-0-2768"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2769"><a id="__codelineno-0-2769" name="__codelineno-0-2769"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2770"><a id="__codelineno-0-2770" name="__codelineno-0-2770"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2771"><a id="__codelineno-0-2771" name="__codelineno-0-2771"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2772"><a id="__codelineno-0-2772" name="__codelineno-0-2772"></a>            <span class="p">)</span>
</span><span id="__span-0-2773"><a id="__codelineno-0-2773" name="__codelineno-0-2773"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2774"><a id="__codelineno-0-2774" name="__codelineno-0-2774"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"rigid_xform_xyz_px"</span><span class="p">]</span> <span class="o">=</span> <span class="n">rigid_xform_xyz_px</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-2775"><a id="__codelineno-0-2775" name="__codelineno-0-2775"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2776"><a id="__codelineno-0-2776" name="__codelineno-0-2776"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-2777"><a id="__codelineno-0-2777" name="__codelineno-0-2777"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error writing rigid transform attribute."</span><span class="p">)</span>
</span><span id="__span-0-2778"><a id="__codelineno-0-2778" name="__codelineno-0-2778"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2779"><a id="__codelineno-0-2779" name="__codelineno-0-2779"></a>
</span><span id="__span-0-2780"><a id="__codelineno-0-2780" name="__codelineno-0-2780"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_coord_of_xform_px</span><span class="p">(</span>
</span><span id="__span-0-2781"><a id="__codelineno-0-2781" name="__codelineno-0-2781"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2782"><a id="__codelineno-0-2782" name="__codelineno-0-2782"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
</span><span id="__span-0-2783"><a id="__codelineno-0-2783" name="__codelineno-0-2783"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
</span><span id="__span-0-2784"><a id="__codelineno-0-2784" name="__codelineno-0-2784"></a>        <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2785"><a id="__codelineno-0-2785" name="__codelineno-0-2785"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">]]:</span>
</span><span id="__span-0-2786"><a id="__codelineno-0-2786" name="__codelineno-0-2786"></a><span class="w">        </span><span class="sd">"""Local fidicual optical flow matrix for one round and tile.</span>
</span><span id="__span-0-2787"><a id="__codelineno-0-2787" name="__codelineno-0-2787"></a>
</span><span id="__span-0-2788"><a id="__codelineno-0-2788" name="__codelineno-0-2788"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-2789"><a id="__codelineno-0-2789" name="__codelineno-0-2789"></a><span class="sd">        ----------</span>
</span><span id="__span-0-2790"><a id="__codelineno-0-2790" name="__codelineno-0-2790"></a><span class="sd">        tile : Optional[Union[int, str]]</span>
</span><span id="__span-0-2791"><a id="__codelineno-0-2791" name="__codelineno-0-2791"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-2792"><a id="__codelineno-0-2792" name="__codelineno-0-2792"></a><span class="sd">        round : Optional[Union[int, str]]</span>
</span><span id="__span-0-2793"><a id="__codelineno-0-2793" name="__codelineno-0-2793"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-2794"><a id="__codelineno-0-2794" name="__codelineno-0-2794"></a><span class="sd">        return_future : Optional[bool]</span>
</span><span id="__span-0-2795"><a id="__codelineno-0-2795" name="__codelineno-0-2795"></a><span class="sd">            Return future array.</span>
</span><span id="__span-0-2796"><a id="__codelineno-0-2796" name="__codelineno-0-2796"></a>
</span><span id="__span-0-2797"><a id="__codelineno-0-2797" name="__codelineno-0-2797"></a><span class="sd">        Returns</span>
</span><span id="__span-0-2798"><a id="__codelineno-0-2798" name="__codelineno-0-2798"></a><span class="sd">        -------</span>
</span><span id="__span-0-2799"><a id="__codelineno-0-2799" name="__codelineno-0-2799"></a><span class="sd">        of_xform_px : Optional[ArrayLike]</span>
</span><span id="__span-0-2800"><a id="__codelineno-0-2800" name="__codelineno-0-2800"></a><span class="sd">            Local fidicual optical flow matrix for one round and tile.</span>
</span><span id="__span-0-2801"><a id="__codelineno-0-2801" name="__codelineno-0-2801"></a><span class="sd">        downsampling : Optional[ArrayLike]</span>
</span><span id="__span-0-2802"><a id="__codelineno-0-2802" name="__codelineno-0-2802"></a><span class="sd">            Downsampling factor.</span>
</span><span id="__span-0-2803"><a id="__codelineno-0-2803" name="__codelineno-0-2803"></a><span class="sd">        """</span>
</span><span id="__span-0-2804"><a id="__codelineno-0-2804" name="__codelineno-0-2804"></a>
</span><span id="__span-0-2805"><a id="__codelineno-0-2805" name="__codelineno-0-2805"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2806"><a id="__codelineno-0-2806" name="__codelineno-0-2806"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2807"><a id="__codelineno-0-2807" name="__codelineno-0-2807"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2808"><a id="__codelineno-0-2808" name="__codelineno-0-2808"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2809"><a id="__codelineno-0-2809" name="__codelineno-0-2809"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2810"><a id="__codelineno-0-2810" name="__codelineno-0-2810"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2811"><a id="__codelineno-0-2811" name="__codelineno-0-2811"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2812"><a id="__codelineno-0-2812" name="__codelineno-0-2812"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2813"><a id="__codelineno-0-2813" name="__codelineno-0-2813"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2814"><a id="__codelineno-0-2814" name="__codelineno-0-2814"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2815"><a id="__codelineno-0-2815" name="__codelineno-0-2815"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2816"><a id="__codelineno-0-2816" name="__codelineno-0-2816"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2817"><a id="__codelineno-0-2817" name="__codelineno-0-2817"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2818"><a id="__codelineno-0-2818" name="__codelineno-0-2818"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2819"><a id="__codelineno-0-2819" name="__codelineno-0-2819"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2820"><a id="__codelineno-0-2820" name="__codelineno-0-2820"></a>
</span><span id="__span-0-2821"><a id="__codelineno-0-2821" name="__codelineno-0-2821"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2822"><a id="__codelineno-0-2822" name="__codelineno-0-2822"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2823"><a id="__codelineno-0-2823" name="__codelineno-0-2823"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2824"><a id="__codelineno-0-2824" name="__codelineno-0-2824"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2825"><a id="__codelineno-0-2825" name="__codelineno-0-2825"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2826"><a id="__codelineno-0-2826" name="__codelineno-0-2826"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2827"><a id="__codelineno-0-2827" name="__codelineno-0-2827"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2828"><a id="__codelineno-0-2828" name="__codelineno-0-2828"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2829"><a id="__codelineno-0-2829" name="__codelineno-0-2829"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2830"><a id="__codelineno-0-2830" name="__codelineno-0-2830"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2831"><a id="__codelineno-0-2831" name="__codelineno-0-2831"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2832"><a id="__codelineno-0-2832" name="__codelineno-0-2832"></a>                <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2833"><a id="__codelineno-0-2833" name="__codelineno-0-2833"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2834"><a id="__codelineno-0-2834" name="__codelineno-0-2834"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2835"><a id="__codelineno-0-2835" name="__codelineno-0-2835"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2836"><a id="__codelineno-0-2836" name="__codelineno-0-2836"></a>
</span><span id="__span-0-2837"><a id="__codelineno-0-2837" name="__codelineno-0-2837"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2838"><a id="__codelineno-0-2838" name="__codelineno-0-2838"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2839"><a id="__codelineno-0-2839" name="__codelineno-0-2839"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2840"><a id="__codelineno-0-2840" name="__codelineno-0-2840"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2841"><a id="__codelineno-0-2841" name="__codelineno-0-2841"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"opticalflow_xform_px"</span><span class="p">)</span>
</span><span id="__span-0-2842"><a id="__codelineno-0-2842" name="__codelineno-0-2842"></a>        <span class="p">)</span>
</span><span id="__span-0-2843"><a id="__codelineno-0-2843" name="__codelineno-0-2843"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2844"><a id="__codelineno-0-2844" name="__codelineno-0-2844"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2845"><a id="__codelineno-0-2845" name="__codelineno-0-2845"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2846"><a id="__codelineno-0-2846" name="__codelineno-0-2846"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2847"><a id="__codelineno-0-2847" name="__codelineno-0-2847"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2848"><a id="__codelineno-0-2848" name="__codelineno-0-2848"></a>        <span class="p">)</span>
</span><span id="__span-0-2849"><a id="__codelineno-0-2849" name="__codelineno-0-2849"></a>
</span><span id="__span-0-2850"><a id="__codelineno-0-2850" name="__codelineno-0-2850"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-2851"><a id="__codelineno-0-2851" name="__codelineno-0-2851"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Optical flow transform mapping back to first round not found."</span><span class="p">)</span>
</span><span id="__span-0-2852"><a id="__codelineno-0-2852" name="__codelineno-0-2852"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2853"><a id="__codelineno-0-2853" name="__codelineno-0-2853"></a>
</span><span id="__span-0-2854"><a id="__codelineno-0-2854" name="__codelineno-0-2854"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2855"><a id="__codelineno-0-2855" name="__codelineno-0-2855"></a>            <span class="n">compressor</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-2856"><a id="__codelineno-0-2856" name="__codelineno-0-2856"></a>                <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"blosc"</span><span class="p">,</span>
</span><span id="__span-0-2857"><a id="__codelineno-0-2857" name="__codelineno-0-2857"></a>                <span class="s2">"cname"</span><span class="p">:</span> <span class="s2">"zstd"</span><span class="p">,</span>
</span><span id="__span-0-2858"><a id="__codelineno-0-2858" name="__codelineno-0-2858"></a>                <span class="s2">"clevel"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="__span-0-2859"><a id="__codelineno-0-2859" name="__codelineno-0-2859"></a>                <span class="s2">"shuffle"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="__span-0-2860"><a id="__codelineno-0-2860" name="__codelineno-0-2860"></a>            <span class="p">}</span>
</span><span id="__span-0-2861"><a id="__codelineno-0-2861" name="__codelineno-0-2861"></a>            <span class="n">spec_of</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-2862"><a id="__codelineno-0-2862" name="__codelineno-0-2862"></a>                <span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"zarr"</span><span class="p">,</span>
</span><span id="__span-0-2863"><a id="__codelineno-0-2863" name="__codelineno-0-2863"></a>                <span class="s2">"kvstore"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2864"><a id="__codelineno-0-2864" name="__codelineno-0-2864"></a>                <span class="s2">"metadata"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"compressor"</span><span class="p">:</span> <span class="n">compressor</span><span class="p">},</span>
</span><span id="__span-0-2865"><a id="__codelineno-0-2865" name="__codelineno-0-2865"></a>                <span class="s2">"open"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2866"><a id="__codelineno-0-2866" name="__codelineno-0-2866"></a>                <span class="s2">"assume_metadata"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2867"><a id="__codelineno-0-2867" name="__codelineno-0-2867"></a>                <span class="s2">"create"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2868"><a id="__codelineno-0-2868" name="__codelineno-0-2868"></a>                <span class="s2">"delete_existing"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2869"><a id="__codelineno-0-2869" name="__codelineno-0-2869"></a>            <span class="p">}</span>
</span><span id="__span-0-2870"><a id="__codelineno-0-2870" name="__codelineno-0-2870"></a>            <span class="n">spec_of</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"&lt;f4"</span>
</span><span id="__span-0-2871"><a id="__codelineno-0-2871" name="__codelineno-0-2871"></a>            <span class="n">of_xform_px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-2872"><a id="__codelineno-0-2872" name="__codelineno-0-2872"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-2873"><a id="__codelineno-0-2873" name="__codelineno-0-2873"></a>                <span class="n">spec_of</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-2874"><a id="__codelineno-0-2874" name="__codelineno-0-2874"></a>                <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-2875"><a id="__codelineno-0-2875" name="__codelineno-0-2875"></a>            <span class="p">)</span>
</span><span id="__span-0-2876"><a id="__codelineno-0-2876" name="__codelineno-0-2876"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2877"><a id="__codelineno-0-2877" name="__codelineno-0-2877"></a>            <span class="n">block_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
</span><span id="__span-0-2878"><a id="__codelineno-0-2878" name="__codelineno-0-2878"></a>                <span class="n">attributes</span><span class="p">[</span><span class="s2">"block_size"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span><span id="__span-0-2879"><a id="__codelineno-0-2879" name="__codelineno-0-2879"></a>            <span class="p">)</span>
</span><span id="__span-0-2880"><a id="__codelineno-0-2880" name="__codelineno-0-2880"></a>            <span class="n">block_stride</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
</span><span id="__span-0-2881"><a id="__codelineno-0-2881" name="__codelineno-0-2881"></a>                <span class="n">attributes</span><span class="p">[</span><span class="s2">"block_stride"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span><span id="__span-0-2882"><a id="__codelineno-0-2882" name="__codelineno-0-2882"></a>            <span class="p">)</span>
</span><span id="__span-0-2883"><a id="__codelineno-0-2883" name="__codelineno-0-2883"></a>
</span><span id="__span-0-2884"><a id="__codelineno-0-2884" name="__codelineno-0-2884"></a>            <span class="k">return</span> <span class="p">(</span><span class="n">of_xform_px</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">block_stride</span><span class="p">)</span>
</span><span id="__span-0-2885"><a id="__codelineno-0-2885" name="__codelineno-0-2885"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-2886"><a id="__codelineno-0-2886" name="__codelineno-0-2886"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-2887"><a id="__codelineno-0-2887" name="__codelineno-0-2887"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error loading optical flow transform."</span><span class="p">)</span>
</span><span id="__span-0-2888"><a id="__codelineno-0-2888" name="__codelineno-0-2888"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2889"><a id="__codelineno-0-2889" name="__codelineno-0-2889"></a>
</span><span id="__span-0-2890"><a id="__codelineno-0-2890" name="__codelineno-0-2890"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_coord_of_xform_px</span><span class="p">(</span>
</span><span id="__span-0-2891"><a id="__codelineno-0-2891" name="__codelineno-0-2891"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2892"><a id="__codelineno-0-2892" name="__codelineno-0-2892"></a>        <span class="n">of_xform_px</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-2893"><a id="__codelineno-0-2893" name="__codelineno-0-2893"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2894"><a id="__codelineno-0-2894" name="__codelineno-0-2894"></a>        <span class="n">block_size</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-2895"><a id="__codelineno-0-2895" name="__codelineno-0-2895"></a>        <span class="n">block_stride</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-2896"><a id="__codelineno-0-2896" name="__codelineno-0-2896"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2897"><a id="__codelineno-0-2897" name="__codelineno-0-2897"></a>        <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2898"><a id="__codelineno-0-2898" name="__codelineno-0-2898"></a>    <span class="p">):</span>
</span><span id="__span-0-2899"><a id="__codelineno-0-2899" name="__codelineno-0-2899"></a><span class="w">        </span><span class="sd">"""Save fidicual optical flow matrix for one round and tile.</span>
</span><span id="__span-0-2900"><a id="__codelineno-0-2900" name="__codelineno-0-2900"></a>
</span><span id="__span-0-2901"><a id="__codelineno-0-2901" name="__codelineno-0-2901"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-2902"><a id="__codelineno-0-2902" name="__codelineno-0-2902"></a><span class="sd">        ----------</span>
</span><span id="__span-0-2903"><a id="__codelineno-0-2903" name="__codelineno-0-2903"></a><span class="sd">        of_xform_px : ArrayLike</span>
</span><span id="__span-0-2904"><a id="__codelineno-0-2904" name="__codelineno-0-2904"></a><span class="sd">            Local fidicual optical flow matrix for one round and tile.</span>
</span><span id="__span-0-2905"><a id="__codelineno-0-2905" name="__codelineno-0-2905"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-2906"><a id="__codelineno-0-2906" name="__codelineno-0-2906"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-2907"><a id="__codelineno-0-2907" name="__codelineno-0-2907"></a><span class="sd">        block_size : Sequence[float]</span>
</span><span id="__span-0-2908"><a id="__codelineno-0-2908" name="__codelineno-0-2908"></a><span class="sd">            Block size for pixel warp</span>
</span><span id="__span-0-2909"><a id="__codelineno-0-2909" name="__codelineno-0-2909"></a><span class="sd">        block_stride: Sequence[float]</span>
</span><span id="__span-0-2910"><a id="__codelineno-0-2910" name="__codelineno-0-2910"></a><span class="sd">            Block stride for pixel warp</span>
</span><span id="__span-0-2911"><a id="__codelineno-0-2911" name="__codelineno-0-2911"></a><span class="sd">        round : Union[int, str] </span>
</span><span id="__span-0-2912"><a id="__codelineno-0-2912" name="__codelineno-0-2912"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-2913"><a id="__codelineno-0-2913" name="__codelineno-0-2913"></a><span class="sd">        return_future : Optional[bool]</span>
</span><span id="__span-0-2914"><a id="__codelineno-0-2914" name="__codelineno-0-2914"></a><span class="sd">            Return future array.</span>
</span><span id="__span-0-2915"><a id="__codelineno-0-2915" name="__codelineno-0-2915"></a><span class="sd">        """</span>
</span><span id="__span-0-2916"><a id="__codelineno-0-2916" name="__codelineno-0-2916"></a>
</span><span id="__span-0-2917"><a id="__codelineno-0-2917" name="__codelineno-0-2917"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2918"><a id="__codelineno-0-2918" name="__codelineno-0-2918"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2919"><a id="__codelineno-0-2919" name="__codelineno-0-2919"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2920"><a id="__codelineno-0-2920" name="__codelineno-0-2920"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2921"><a id="__codelineno-0-2921" name="__codelineno-0-2921"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2922"><a id="__codelineno-0-2922" name="__codelineno-0-2922"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2923"><a id="__codelineno-0-2923" name="__codelineno-0-2923"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2924"><a id="__codelineno-0-2924" name="__codelineno-0-2924"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2925"><a id="__codelineno-0-2925" name="__codelineno-0-2925"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2926"><a id="__codelineno-0-2926" name="__codelineno-0-2926"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2927"><a id="__codelineno-0-2927" name="__codelineno-0-2927"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2928"><a id="__codelineno-0-2928" name="__codelineno-0-2928"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2929"><a id="__codelineno-0-2929" name="__codelineno-0-2929"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2930"><a id="__codelineno-0-2930" name="__codelineno-0-2930"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2931"><a id="__codelineno-0-2931" name="__codelineno-0-2931"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2932"><a id="__codelineno-0-2932" name="__codelineno-0-2932"></a>
</span><span id="__span-0-2933"><a id="__codelineno-0-2933" name="__codelineno-0-2933"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2934"><a id="__codelineno-0-2934" name="__codelineno-0-2934"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2935"><a id="__codelineno-0-2935" name="__codelineno-0-2935"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2936"><a id="__codelineno-0-2936" name="__codelineno-0-2936"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2937"><a id="__codelineno-0-2937" name="__codelineno-0-2937"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2938"><a id="__codelineno-0-2938" name="__codelineno-0-2938"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2939"><a id="__codelineno-0-2939" name="__codelineno-0-2939"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2940"><a id="__codelineno-0-2940" name="__codelineno-0-2940"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2941"><a id="__codelineno-0-2941" name="__codelineno-0-2941"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2942"><a id="__codelineno-0-2942" name="__codelineno-0-2942"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2943"><a id="__codelineno-0-2943" name="__codelineno-0-2943"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2944"><a id="__codelineno-0-2944" name="__codelineno-0-2944"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2945"><a id="__codelineno-0-2945" name="__codelineno-0-2945"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2946"><a id="__codelineno-0-2946" name="__codelineno-0-2946"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2947"><a id="__codelineno-0-2947" name="__codelineno-0-2947"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2948"><a id="__codelineno-0-2948" name="__codelineno-0-2948"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2949"><a id="__codelineno-0-2949" name="__codelineno-0-2949"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2950"><a id="__codelineno-0-2950" name="__codelineno-0-2950"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2951"><a id="__codelineno-0-2951" name="__codelineno-0-2951"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2952"><a id="__codelineno-0-2952" name="__codelineno-0-2952"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"opticalflow_xform_px"</span><span class="p">)</span>
</span><span id="__span-0-2953"><a id="__codelineno-0-2953" name="__codelineno-0-2953"></a>        <span class="p">)</span>
</span><span id="__span-0-2954"><a id="__codelineno-0-2954" name="__codelineno-0-2954"></a>        <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2955"><a id="__codelineno-0-2955" name="__codelineno-0-2955"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2956"><a id="__codelineno-0-2956" name="__codelineno-0-2956"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2957"><a id="__codelineno-0-2957" name="__codelineno-0-2957"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2958"><a id="__codelineno-0-2958" name="__codelineno-0-2958"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2959"><a id="__codelineno-0-2959" name="__codelineno-0-2959"></a>        <span class="p">)</span>
</span><span id="__span-0-2960"><a id="__codelineno-0-2960" name="__codelineno-0-2960"></a>
</span><span id="__span-0-2961"><a id="__codelineno-0-2961" name="__codelineno-0-2961"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2962"><a id="__codelineno-0-2962" name="__codelineno-0-2962"></a>            <span class="n">compressor</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-2963"><a id="__codelineno-0-2963" name="__codelineno-0-2963"></a>                <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"blosc"</span><span class="p">,</span>
</span><span id="__span-0-2964"><a id="__codelineno-0-2964" name="__codelineno-0-2964"></a>                <span class="s2">"cname"</span><span class="p">:</span> <span class="s2">"zstd"</span><span class="p">,</span>
</span><span id="__span-0-2965"><a id="__codelineno-0-2965" name="__codelineno-0-2965"></a>                <span class="s2">"clevel"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="__span-0-2966"><a id="__codelineno-0-2966" name="__codelineno-0-2966"></a>                <span class="s2">"shuffle"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="__span-0-2967"><a id="__codelineno-0-2967" name="__codelineno-0-2967"></a>            <span class="p">}</span>
</span><span id="__span-0-2968"><a id="__codelineno-0-2968" name="__codelineno-0-2968"></a>            <span class="n">spec_of</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-2969"><a id="__codelineno-0-2969" name="__codelineno-0-2969"></a>                <span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"zarr"</span><span class="p">,</span>
</span><span id="__span-0-2970"><a id="__codelineno-0-2970" name="__codelineno-0-2970"></a>                <span class="s2">"kvstore"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2971"><a id="__codelineno-0-2971" name="__codelineno-0-2971"></a>                <span class="s2">"metadata"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"compressor"</span><span class="p">:</span> <span class="n">compressor</span><span class="p">},</span>
</span><span id="__span-0-2972"><a id="__codelineno-0-2972" name="__codelineno-0-2972"></a>                <span class="s2">"open"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2973"><a id="__codelineno-0-2973" name="__codelineno-0-2973"></a>                <span class="s2">"assume_metadata"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2974"><a id="__codelineno-0-2974" name="__codelineno-0-2974"></a>                <span class="s2">"create"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2975"><a id="__codelineno-0-2975" name="__codelineno-0-2975"></a>                <span class="s2">"delete_existing"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2976"><a id="__codelineno-0-2976" name="__codelineno-0-2976"></a>            <span class="p">}</span>
</span><span id="__span-0-2977"><a id="__codelineno-0-2977" name="__codelineno-0-2977"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-2978"><a id="__codelineno-0-2978" name="__codelineno-0-2978"></a>                <span class="n">of_xform_px</span><span class="p">,</span>
</span><span id="__span-0-2979"><a id="__codelineno-0-2979" name="__codelineno-0-2979"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-2980"><a id="__codelineno-0-2980" name="__codelineno-0-2980"></a>                <span class="n">spec_of</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-2981"><a id="__codelineno-0-2981" name="__codelineno-0-2981"></a>                <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-2982"><a id="__codelineno-0-2982" name="__codelineno-0-2982"></a>            <span class="p">)</span>
</span><span id="__span-0-2983"><a id="__codelineno-0-2983" name="__codelineno-0-2983"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2984"><a id="__codelineno-0-2984" name="__codelineno-0-2984"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"block_size"</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_size</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-2985"><a id="__codelineno-0-2985" name="__codelineno-0-2985"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"block_stride"</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_stride</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-2986"><a id="__codelineno-0-2986" name="__codelineno-0-2986"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2987"><a id="__codelineno-0-2987" name="__codelineno-0-2987"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">):</span>
</span><span id="__span-0-2988"><a id="__codelineno-0-2988" name="__codelineno-0-2988"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving optical flow transform."</span><span class="p">)</span>
</span><span id="__span-0-2989"><a id="__codelineno-0-2989" name="__codelineno-0-2989"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2990"><a id="__codelineno-0-2990" name="__codelineno-0-2990"></a>
</span><span id="__span-0-2991"><a id="__codelineno-0-2991" name="__codelineno-0-2991"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_local_registered_image</span><span class="p">(</span>
</span><span id="__span-0-2992"><a id="__codelineno-0-2992" name="__codelineno-0-2992"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2993"><a id="__codelineno-0-2993" name="__codelineno-0-2993"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2994"><a id="__codelineno-0-2994" name="__codelineno-0-2994"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2995"><a id="__codelineno-0-2995" name="__codelineno-0-2995"></a>        <span class="n">bit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2996"><a id="__codelineno-0-2996" name="__codelineno-0-2996"></a>        <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2997"><a id="__codelineno-0-2997" name="__codelineno-0-2997"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-2998"><a id="__codelineno-0-2998" name="__codelineno-0-2998"></a><span class="w">        </span><span class="sd">"""Local registered, deconvolved image for fidiculial OR readout bit for one tile.</span>
</span><span id="__span-0-2999"><a id="__codelineno-0-2999" name="__codelineno-0-2999"></a>
</span><span id="__span-0-3000"><a id="__codelineno-0-3000" name="__codelineno-0-3000"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3001"><a id="__codelineno-0-3001" name="__codelineno-0-3001"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3002"><a id="__codelineno-0-3002" name="__codelineno-0-3002"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-3003"><a id="__codelineno-0-3003" name="__codelineno-0-3003"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-3004"><a id="__codelineno-0-3004" name="__codelineno-0-3004"></a><span class="sd">        round : Optional[Union[int, str]]</span>
</span><span id="__span-0-3005"><a id="__codelineno-0-3005" name="__codelineno-0-3005"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-3006"><a id="__codelineno-0-3006" name="__codelineno-0-3006"></a><span class="sd">        bit : Optional[Union[int, str]]</span>
</span><span id="__span-0-3007"><a id="__codelineno-0-3007" name="__codelineno-0-3007"></a><span class="sd">            Bit index or bit id.</span>
</span><span id="__span-0-3008"><a id="__codelineno-0-3008" name="__codelineno-0-3008"></a><span class="sd">        return_future : Optional[bool]</span>
</span><span id="__span-0-3009"><a id="__codelineno-0-3009" name="__codelineno-0-3009"></a><span class="sd">            Return future array.</span>
</span><span id="__span-0-3010"><a id="__codelineno-0-3010" name="__codelineno-0-3010"></a>
</span><span id="__span-0-3011"><a id="__codelineno-0-3011" name="__codelineno-0-3011"></a><span class="sd">        Returns</span>
</span><span id="__span-0-3012"><a id="__codelineno-0-3012" name="__codelineno-0-3012"></a><span class="sd">        -------</span>
</span><span id="__span-0-3013"><a id="__codelineno-0-3013" name="__codelineno-0-3013"></a><span class="sd">        registered_decon_image : Optional[ArrayLike]</span>
</span><span id="__span-0-3014"><a id="__codelineno-0-3014" name="__codelineno-0-3014"></a><span class="sd">            Registered, deconvolved image for fidiculial OR readout bit for one tile.</span>
</span><span id="__span-0-3015"><a id="__codelineno-0-3015" name="__codelineno-0-3015"></a><span class="sd">        """</span>
</span><span id="__span-0-3016"><a id="__codelineno-0-3016" name="__codelineno-0-3016"></a>
</span><span id="__span-0-3017"><a id="__codelineno-0-3017" name="__codelineno-0-3017"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-3018"><a id="__codelineno-0-3018" name="__codelineno-0-3018"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Provide either 'round' or 'bit', but not both"</span><span class="p">)</span>
</span><span id="__span-0-3019"><a id="__codelineno-0-3019" name="__codelineno-0-3019"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3020"><a id="__codelineno-0-3020" name="__codelineno-0-3020"></a>
</span><span id="__span-0-3021"><a id="__codelineno-0-3021" name="__codelineno-0-3021"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3022"><a id="__codelineno-0-3022" name="__codelineno-0-3022"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3023"><a id="__codelineno-0-3023" name="__codelineno-0-3023"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3024"><a id="__codelineno-0-3024" name="__codelineno-0-3024"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3025"><a id="__codelineno-0-3025" name="__codelineno-0-3025"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3026"><a id="__codelineno-0-3026" name="__codelineno-0-3026"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3027"><a id="__codelineno-0-3027" name="__codelineno-0-3027"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3028"><a id="__codelineno-0-3028" name="__codelineno-0-3028"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3029"><a id="__codelineno-0-3029" name="__codelineno-0-3029"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3030"><a id="__codelineno-0-3030" name="__codelineno-0-3030"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3031"><a id="__codelineno-0-3031" name="__codelineno-0-3031"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3032"><a id="__codelineno-0-3032" name="__codelineno-0-3032"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3033"><a id="__codelineno-0-3033" name="__codelineno-0-3033"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3034"><a id="__codelineno-0-3034" name="__codelineno-0-3034"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3035"><a id="__codelineno-0-3035" name="__codelineno-0-3035"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3036"><a id="__codelineno-0-3036" name="__codelineno-0-3036"></a>
</span><span id="__span-0-3037"><a id="__codelineno-0-3037" name="__codelineno-0-3037"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-3038"><a id="__codelineno-0-3038" name="__codelineno-0-3038"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3039"><a id="__codelineno-0-3039" name="__codelineno-0-3039"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-3040"><a id="__codelineno-0-3040" name="__codelineno-0-3040"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-3041"><a id="__codelineno-0-3041" name="__codelineno-0-3041"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3042"><a id="__codelineno-0-3042" name="__codelineno-0-3042"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3043"><a id="__codelineno-0-3043" name="__codelineno-0-3043"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-3044"><a id="__codelineno-0-3044" name="__codelineno-0-3044"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3045"><a id="__codelineno-0-3045" name="__codelineno-0-3045"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-3046"><a id="__codelineno-0-3046" name="__codelineno-0-3046"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-3047"><a id="__codelineno-0-3047" name="__codelineno-0-3047"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3048"><a id="__codelineno-0-3048" name="__codelineno-0-3048"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3049"><a id="__codelineno-0-3049" name="__codelineno-0-3049"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-3050"><a id="__codelineno-0-3050" name="__codelineno-0-3050"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3051"><a id="__codelineno-0-3051" name="__codelineno-0-3051"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3052"><a id="__codelineno-0-3052" name="__codelineno-0-3052"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3053"><a id="__codelineno-0-3053" name="__codelineno-0-3053"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3054"><a id="__codelineno-0-3054" name="__codelineno-0-3054"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-3055"><a id="__codelineno-0-3055" name="__codelineno-0-3055"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3056"><a id="__codelineno-0-3056" name="__codelineno-0-3056"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3057"><a id="__codelineno-0-3057" name="__codelineno-0-3057"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_decon_data"</span><span class="p">)</span>
</span><span id="__span-0-3058"><a id="__codelineno-0-3058" name="__codelineno-0-3058"></a>            <span class="p">)</span>
</span><span id="__span-0-3059"><a id="__codelineno-0-3059" name="__codelineno-0-3059"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3060"><a id="__codelineno-0-3060" name="__codelineno-0-3060"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3061"><a id="__codelineno-0-3061" name="__codelineno-0-3061"></a>                <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-3062"><a id="__codelineno-0-3062" name="__codelineno-0-3062"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-3063"><a id="__codelineno-0-3063" name="__codelineno-0-3063"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3064"><a id="__codelineno-0-3064" name="__codelineno-0-3064"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3065"><a id="__codelineno-0-3065" name="__codelineno-0-3065"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-3066"><a id="__codelineno-0-3066" name="__codelineno-0-3066"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3067"><a id="__codelineno-0-3067" name="__codelineno-0-3067"></a>                <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-3068"><a id="__codelineno-0-3068" name="__codelineno-0-3068"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-3069"><a id="__codelineno-0-3069" name="__codelineno-0-3069"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3070"><a id="__codelineno-0-3070" name="__codelineno-0-3070"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3071"><a id="__codelineno-0-3071" name="__codelineno-0-3071"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-3072"><a id="__codelineno-0-3072" name="__codelineno-0-3072"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3073"><a id="__codelineno-0-3073" name="__codelineno-0-3073"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3074"><a id="__codelineno-0-3074" name="__codelineno-0-3074"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3075"><a id="__codelineno-0-3075" name="__codelineno-0-3075"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3076"><a id="__codelineno-0-3076" name="__codelineno-0-3076"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-3077"><a id="__codelineno-0-3077" name="__codelineno-0-3077"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3078"><a id="__codelineno-0-3078" name="__codelineno-0-3078"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3079"><a id="__codelineno-0-3079" name="__codelineno-0-3079"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_decon_data"</span><span class="p">)</span>
</span><span id="__span-0-3080"><a id="__codelineno-0-3080" name="__codelineno-0-3080"></a>            <span class="p">)</span>
</span><span id="__span-0-3081"><a id="__codelineno-0-3081" name="__codelineno-0-3081"></a>
</span><span id="__span-0-3082"><a id="__codelineno-0-3082" name="__codelineno-0-3082"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3083"><a id="__codelineno-0-3083" name="__codelineno-0-3083"></a>            <span class="c1">#print("Registered deconvolved image not found.")</span>
</span><span id="__span-0-3084"><a id="__codelineno-0-3084" name="__codelineno-0-3084"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3085"><a id="__codelineno-0-3085" name="__codelineno-0-3085"></a>
</span><span id="__span-0-3086"><a id="__codelineno-0-3086" name="__codelineno-0-3086"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3087"><a id="__codelineno-0-3087" name="__codelineno-0-3087"></a>            <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-0-3088"><a id="__codelineno-0-3088" name="__codelineno-0-3088"></a>            <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"&lt;u2"</span>
</span><span id="__span-0-3089"><a id="__codelineno-0-3089" name="__codelineno-0-3089"></a>            <span class="n">registered_decon_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3090"><a id="__codelineno-0-3090" name="__codelineno-0-3090"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3091"><a id="__codelineno-0-3091" name="__codelineno-0-3091"></a>                <span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-3092"><a id="__codelineno-0-3092" name="__codelineno-0-3092"></a>                <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3093"><a id="__codelineno-0-3093" name="__codelineno-0-3093"></a>            <span class="p">)</span>
</span><span id="__span-0-3094"><a id="__codelineno-0-3094" name="__codelineno-0-3094"></a>            <span class="k">return</span> <span class="n">registered_decon_image</span>
</span><span id="__span-0-3095"><a id="__codelineno-0-3095" name="__codelineno-0-3095"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-3096"><a id="__codelineno-0-3096" name="__codelineno-0-3096"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-3097"><a id="__codelineno-0-3097" name="__codelineno-0-3097"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error loading registered deconvolved image."</span><span class="p">)</span>
</span><span id="__span-0-3098"><a id="__codelineno-0-3098" name="__codelineno-0-3098"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3099"><a id="__codelineno-0-3099" name="__codelineno-0-3099"></a>
</span><span id="__span-0-3100"><a id="__codelineno-0-3100" name="__codelineno-0-3100"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_local_registered_image</span><span class="p">(</span>
</span><span id="__span-0-3101"><a id="__codelineno-0-3101" name="__codelineno-0-3101"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3102"><a id="__codelineno-0-3102" name="__codelineno-0-3102"></a>        <span class="n">registered_image</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3103"><a id="__codelineno-0-3103" name="__codelineno-0-3103"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3104"><a id="__codelineno-0-3104" name="__codelineno-0-3104"></a>        <span class="n">deconvolution</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-3105"><a id="__codelineno-0-3105" name="__codelineno-0-3105"></a>        <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-3106"><a id="__codelineno-0-3106" name="__codelineno-0-3106"></a>        <span class="n">bit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-3107"><a id="__codelineno-0-3107" name="__codelineno-0-3107"></a>        <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-3108"><a id="__codelineno-0-3108" name="__codelineno-0-3108"></a>    <span class="p">):</span>
</span><span id="__span-0-3109"><a id="__codelineno-0-3109" name="__codelineno-0-3109"></a><span class="w">        </span><span class="sd">"""Save registered, deconvolved image.</span>
</span><span id="__span-0-3110"><a id="__codelineno-0-3110" name="__codelineno-0-3110"></a>
</span><span id="__span-0-3111"><a id="__codelineno-0-3111" name="__codelineno-0-3111"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3112"><a id="__codelineno-0-3112" name="__codelineno-0-3112"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3113"><a id="__codelineno-0-3113" name="__codelineno-0-3113"></a><span class="sd">        registered_image : ArrayLike</span>
</span><span id="__span-0-3114"><a id="__codelineno-0-3114" name="__codelineno-0-3114"></a><span class="sd">            Registered, deconvolved image.</span>
</span><span id="__span-0-3115"><a id="__codelineno-0-3115" name="__codelineno-0-3115"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-3116"><a id="__codelineno-0-3116" name="__codelineno-0-3116"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-3117"><a id="__codelineno-0-3117" name="__codelineno-0-3117"></a><span class="sd">        deconvolution : bool</span>
</span><span id="__span-0-3118"><a id="__codelineno-0-3118" name="__codelineno-0-3118"></a><span class="sd">            Deconvolution applied (True) or not (False).</span>
</span><span id="__span-0-3119"><a id="__codelineno-0-3119" name="__codelineno-0-3119"></a><span class="sd">        round : Optional[Union[int, str]]</span>
</span><span id="__span-0-3120"><a id="__codelineno-0-3120" name="__codelineno-0-3120"></a><span class="sd">            Round index or round id.</span>
</span><span id="__span-0-3121"><a id="__codelineno-0-3121" name="__codelineno-0-3121"></a><span class="sd">        bit : Optional[Union[int, str]]</span>
</span><span id="__span-0-3122"><a id="__codelineno-0-3122" name="__codelineno-0-3122"></a><span class="sd">            Bit index or bit id.</span>
</span><span id="__span-0-3123"><a id="__codelineno-0-3123" name="__codelineno-0-3123"></a><span class="sd">        return_future : Optional[bool]</span>
</span><span id="__span-0-3124"><a id="__codelineno-0-3124" name="__codelineno-0-3124"></a><span class="sd">            Return future array.</span>
</span><span id="__span-0-3125"><a id="__codelineno-0-3125" name="__codelineno-0-3125"></a><span class="sd">        """</span>
</span><span id="__span-0-3126"><a id="__codelineno-0-3126" name="__codelineno-0-3126"></a>
</span><span id="__span-0-3127"><a id="__codelineno-0-3127" name="__codelineno-0-3127"></a>        <span class="k">if</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-3128"><a id="__codelineno-0-3128" name="__codelineno-0-3128"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Provide either 'round' or 'bit', but not both"</span><span class="p">)</span>
</span><span id="__span-0-3129"><a id="__codelineno-0-3129" name="__codelineno-0-3129"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3130"><a id="__codelineno-0-3130" name="__codelineno-0-3130"></a>
</span><span id="__span-0-3131"><a id="__codelineno-0-3131" name="__codelineno-0-3131"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3132"><a id="__codelineno-0-3132" name="__codelineno-0-3132"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3133"><a id="__codelineno-0-3133" name="__codelineno-0-3133"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3134"><a id="__codelineno-0-3134" name="__codelineno-0-3134"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3135"><a id="__codelineno-0-3135" name="__codelineno-0-3135"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3136"><a id="__codelineno-0-3136" name="__codelineno-0-3136"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3137"><a id="__codelineno-0-3137" name="__codelineno-0-3137"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3138"><a id="__codelineno-0-3138" name="__codelineno-0-3138"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3139"><a id="__codelineno-0-3139" name="__codelineno-0-3139"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3140"><a id="__codelineno-0-3140" name="__codelineno-0-3140"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3141"><a id="__codelineno-0-3141" name="__codelineno-0-3141"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3142"><a id="__codelineno-0-3142" name="__codelineno-0-3142"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3143"><a id="__codelineno-0-3143" name="__codelineno-0-3143"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3144"><a id="__codelineno-0-3144" name="__codelineno-0-3144"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3145"><a id="__codelineno-0-3145" name="__codelineno-0-3145"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3146"><a id="__codelineno-0-3146" name="__codelineno-0-3146"></a>
</span><span id="__span-0-3147"><a id="__codelineno-0-3147" name="__codelineno-0-3147"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-3148"><a id="__codelineno-0-3148" name="__codelineno-0-3148"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3149"><a id="__codelineno-0-3149" name="__codelineno-0-3149"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-3150"><a id="__codelineno-0-3150" name="__codelineno-0-3150"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-3151"><a id="__codelineno-0-3151" name="__codelineno-0-3151"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3152"><a id="__codelineno-0-3152" name="__codelineno-0-3152"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3153"><a id="__codelineno-0-3153" name="__codelineno-0-3153"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-3154"><a id="__codelineno-0-3154" name="__codelineno-0-3154"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3155"><a id="__codelineno-0-3155" name="__codelineno-0-3155"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-3156"><a id="__codelineno-0-3156" name="__codelineno-0-3156"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-3157"><a id="__codelineno-0-3157" name="__codelineno-0-3157"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3158"><a id="__codelineno-0-3158" name="__codelineno-0-3158"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3159"><a id="__codelineno-0-3159" name="__codelineno-0-3159"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-3160"><a id="__codelineno-0-3160" name="__codelineno-0-3160"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3161"><a id="__codelineno-0-3161" name="__codelineno-0-3161"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3162"><a id="__codelineno-0-3162" name="__codelineno-0-3162"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3163"><a id="__codelineno-0-3163" name="__codelineno-0-3163"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3164"><a id="__codelineno-0-3164" name="__codelineno-0-3164"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-3165"><a id="__codelineno-0-3165" name="__codelineno-0-3165"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3166"><a id="__codelineno-0-3166" name="__codelineno-0-3166"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3167"><a id="__codelineno-0-3167" name="__codelineno-0-3167"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_decon_data"</span><span class="p">)</span>
</span><span id="__span-0-3168"><a id="__codelineno-0-3168" name="__codelineno-0-3168"></a>            <span class="p">)</span>
</span><span id="__span-0-3169"><a id="__codelineno-0-3169" name="__codelineno-0-3169"></a>            <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3170"><a id="__codelineno-0-3170" name="__codelineno-0-3170"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-3171"><a id="__codelineno-0-3171" name="__codelineno-0-3171"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3172"><a id="__codelineno-0-3172" name="__codelineno-0-3172"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3173"><a id="__codelineno-0-3173" name="__codelineno-0-3173"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-3174"><a id="__codelineno-0-3174" name="__codelineno-0-3174"></a>            <span class="p">)</span>
</span><span id="__span-0-3175"><a id="__codelineno-0-3175" name="__codelineno-0-3175"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3176"><a id="__codelineno-0-3176" name="__codelineno-0-3176"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3177"><a id="__codelineno-0-3177" name="__codelineno-0-3177"></a>                <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-3178"><a id="__codelineno-0-3178" name="__codelineno-0-3178"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-3179"><a id="__codelineno-0-3179" name="__codelineno-0-3179"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3180"><a id="__codelineno-0-3180" name="__codelineno-0-3180"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3181"><a id="__codelineno-0-3181" name="__codelineno-0-3181"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-3182"><a id="__codelineno-0-3182" name="__codelineno-0-3182"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3183"><a id="__codelineno-0-3183" name="__codelineno-0-3183"></a>                <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-3184"><a id="__codelineno-0-3184" name="__codelineno-0-3184"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-3185"><a id="__codelineno-0-3185" name="__codelineno-0-3185"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3186"><a id="__codelineno-0-3186" name="__codelineno-0-3186"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3187"><a id="__codelineno-0-3187" name="__codelineno-0-3187"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-3188"><a id="__codelineno-0-3188" name="__codelineno-0-3188"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3189"><a id="__codelineno-0-3189" name="__codelineno-0-3189"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3190"><a id="__codelineno-0-3190" name="__codelineno-0-3190"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3191"><a id="__codelineno-0-3191" name="__codelineno-0-3191"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3192"><a id="__codelineno-0-3192" name="__codelineno-0-3192"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-3193"><a id="__codelineno-0-3193" name="__codelineno-0-3193"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3194"><a id="__codelineno-0-3194" name="__codelineno-0-3194"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3195"><a id="__codelineno-0-3195" name="__codelineno-0-3195"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_decon_data"</span><span class="p">)</span>
</span><span id="__span-0-3196"><a id="__codelineno-0-3196" name="__codelineno-0-3196"></a>            <span class="p">)</span>
</span><span id="__span-0-3197"><a id="__codelineno-0-3197" name="__codelineno-0-3197"></a>            <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3198"><a id="__codelineno-0-3198" name="__codelineno-0-3198"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-3199"><a id="__codelineno-0-3199" name="__codelineno-0-3199"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3200"><a id="__codelineno-0-3200" name="__codelineno-0-3200"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3201"><a id="__codelineno-0-3201" name="__codelineno-0-3201"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-3202"><a id="__codelineno-0-3202" name="__codelineno-0-3202"></a>            <span class="p">)</span>
</span><span id="__span-0-3203"><a id="__codelineno-0-3203" name="__codelineno-0-3203"></a>
</span><span id="__span-0-3204"><a id="__codelineno-0-3204" name="__codelineno-0-3204"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3205"><a id="__codelineno-0-3205" name="__codelineno-0-3205"></a>            <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-0-3206"><a id="__codelineno-0-3206" name="__codelineno-0-3206"></a>            <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"&lt;u2"</span>
</span><span id="__span-0-3207"><a id="__codelineno-0-3207" name="__codelineno-0-3207"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3208"><a id="__codelineno-0-3208" name="__codelineno-0-3208"></a>                <span class="n">registered_image</span><span class="p">,</span>
</span><span id="__span-0-3209"><a id="__codelineno-0-3209" name="__codelineno-0-3209"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3210"><a id="__codelineno-0-3210" name="__codelineno-0-3210"></a>                <span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-3211"><a id="__codelineno-0-3211" name="__codelineno-0-3211"></a>                <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3212"><a id="__codelineno-0-3212" name="__codelineno-0-3212"></a>            <span class="p">)</span>
</span><span id="__span-0-3213"><a id="__codelineno-0-3213" name="__codelineno-0-3213"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3214"><a id="__codelineno-0-3214" name="__codelineno-0-3214"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"deconvolution"</span><span class="p">]</span> <span class="o">=</span> <span class="n">deconvolution</span>
</span><span id="__span-0-3215"><a id="__codelineno-0-3215" name="__codelineno-0-3215"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3216"><a id="__codelineno-0-3216" name="__codelineno-0-3216"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">):</span>
</span><span id="__span-0-3217"><a id="__codelineno-0-3217" name="__codelineno-0-3217"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving corrected image."</span><span class="p">)</span>
</span><span id="__span-0-3218"><a id="__codelineno-0-3218" name="__codelineno-0-3218"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3219"><a id="__codelineno-0-3219" name="__codelineno-0-3219"></a>
</span><span id="__span-0-3220"><a id="__codelineno-0-3220" name="__codelineno-0-3220"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_local_ufish_image</span><span class="p">(</span>
</span><span id="__span-0-3221"><a id="__codelineno-0-3221" name="__codelineno-0-3221"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3222"><a id="__codelineno-0-3222" name="__codelineno-0-3222"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3223"><a id="__codelineno-0-3223" name="__codelineno-0-3223"></a>        <span class="n">bit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3224"><a id="__codelineno-0-3224" name="__codelineno-0-3224"></a>        <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-3225"><a id="__codelineno-0-3225" name="__codelineno-0-3225"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-3226"><a id="__codelineno-0-3226" name="__codelineno-0-3226"></a><span class="w">        </span><span class="sd">"""Load readout bit U-FISH prediction image for one tile.</span>
</span><span id="__span-0-3227"><a id="__codelineno-0-3227" name="__codelineno-0-3227"></a>
</span><span id="__span-0-3228"><a id="__codelineno-0-3228" name="__codelineno-0-3228"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3229"><a id="__codelineno-0-3229" name="__codelineno-0-3229"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3230"><a id="__codelineno-0-3230" name="__codelineno-0-3230"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-3231"><a id="__codelineno-0-3231" name="__codelineno-0-3231"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-3232"><a id="__codelineno-0-3232" name="__codelineno-0-3232"></a><span class="sd">        bit : Union[int, str]</span>
</span><span id="__span-0-3233"><a id="__codelineno-0-3233" name="__codelineno-0-3233"></a><span class="sd">            Bit index or bit id.</span>
</span><span id="__span-0-3234"><a id="__codelineno-0-3234" name="__codelineno-0-3234"></a><span class="sd">        return_future : Optional[bool]</span>
</span><span id="__span-0-3235"><a id="__codelineno-0-3235" name="__codelineno-0-3235"></a>
</span><span id="__span-0-3236"><a id="__codelineno-0-3236" name="__codelineno-0-3236"></a><span class="sd">        Returns</span>
</span><span id="__span-0-3237"><a id="__codelineno-0-3237" name="__codelineno-0-3237"></a><span class="sd">        -------</span>
</span><span id="__span-0-3238"><a id="__codelineno-0-3238" name="__codelineno-0-3238"></a><span class="sd">        registered_ufish_image : Optional[ArrayLike]</span>
</span><span id="__span-0-3239"><a id="__codelineno-0-3239" name="__codelineno-0-3239"></a><span class="sd">            U-FISH prediction image for one tile.</span>
</span><span id="__span-0-3240"><a id="__codelineno-0-3240" name="__codelineno-0-3240"></a><span class="sd">        """</span>
</span><span id="__span-0-3241"><a id="__codelineno-0-3241" name="__codelineno-0-3241"></a>
</span><span id="__span-0-3242"><a id="__codelineno-0-3242" name="__codelineno-0-3242"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3243"><a id="__codelineno-0-3243" name="__codelineno-0-3243"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3244"><a id="__codelineno-0-3244" name="__codelineno-0-3244"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3245"><a id="__codelineno-0-3245" name="__codelineno-0-3245"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3246"><a id="__codelineno-0-3246" name="__codelineno-0-3246"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3247"><a id="__codelineno-0-3247" name="__codelineno-0-3247"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3248"><a id="__codelineno-0-3248" name="__codelineno-0-3248"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3249"><a id="__codelineno-0-3249" name="__codelineno-0-3249"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3250"><a id="__codelineno-0-3250" name="__codelineno-0-3250"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3251"><a id="__codelineno-0-3251" name="__codelineno-0-3251"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3252"><a id="__codelineno-0-3252" name="__codelineno-0-3252"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3253"><a id="__codelineno-0-3253" name="__codelineno-0-3253"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3254"><a id="__codelineno-0-3254" name="__codelineno-0-3254"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3255"><a id="__codelineno-0-3255" name="__codelineno-0-3255"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3256"><a id="__codelineno-0-3256" name="__codelineno-0-3256"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3257"><a id="__codelineno-0-3257" name="__codelineno-0-3257"></a>
</span><span id="__span-0-3258"><a id="__codelineno-0-3258" name="__codelineno-0-3258"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3259"><a id="__codelineno-0-3259" name="__codelineno-0-3259"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-3260"><a id="__codelineno-0-3260" name="__codelineno-0-3260"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-3261"><a id="__codelineno-0-3261" name="__codelineno-0-3261"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3262"><a id="__codelineno-0-3262" name="__codelineno-0-3262"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3263"><a id="__codelineno-0-3263" name="__codelineno-0-3263"></a>                <span class="n">bit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-3264"><a id="__codelineno-0-3264" name="__codelineno-0-3264"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3265"><a id="__codelineno-0-3265" name="__codelineno-0-3265"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-3266"><a id="__codelineno-0-3266" name="__codelineno-0-3266"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-3267"><a id="__codelineno-0-3267" name="__codelineno-0-3267"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3268"><a id="__codelineno-0-3268" name="__codelineno-0-3268"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3269"><a id="__codelineno-0-3269" name="__codelineno-0-3269"></a>                <span class="n">bit_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-3270"><a id="__codelineno-0-3270" name="__codelineno-0-3270"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3271"><a id="__codelineno-0-3271" name="__codelineno-0-3271"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3272"><a id="__codelineno-0-3272" name="__codelineno-0-3272"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3273"><a id="__codelineno-0-3273" name="__codelineno-0-3273"></a>
</span><span id="__span-0-3274"><a id="__codelineno-0-3274" name="__codelineno-0-3274"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3275"><a id="__codelineno-0-3275" name="__codelineno-0-3275"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-3276"><a id="__codelineno-0-3276" name="__codelineno-0-3276"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3277"><a id="__codelineno-0-3277" name="__codelineno-0-3277"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3278"><a id="__codelineno-0-3278" name="__codelineno-0-3278"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_ufish_data"</span><span class="p">)</span>
</span><span id="__span-0-3279"><a id="__codelineno-0-3279" name="__codelineno-0-3279"></a>        <span class="p">)</span>
</span><span id="__span-0-3280"><a id="__codelineno-0-3280" name="__codelineno-0-3280"></a>
</span><span id="__span-0-3281"><a id="__codelineno-0-3281" name="__codelineno-0-3281"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3282"><a id="__codelineno-0-3282" name="__codelineno-0-3282"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"U-FISH prediction image not found."</span><span class="p">)</span>
</span><span id="__span-0-3283"><a id="__codelineno-0-3283" name="__codelineno-0-3283"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3284"><a id="__codelineno-0-3284" name="__codelineno-0-3284"></a>
</span><span id="__span-0-3285"><a id="__codelineno-0-3285" name="__codelineno-0-3285"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3286"><a id="__codelineno-0-3286" name="__codelineno-0-3286"></a>            <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-0-3287"><a id="__codelineno-0-3287" name="__codelineno-0-3287"></a>            <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"&lt;f4"</span>
</span><span id="__span-0-3288"><a id="__codelineno-0-3288" name="__codelineno-0-3288"></a>            <span class="n">registered_ufish_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3289"><a id="__codelineno-0-3289" name="__codelineno-0-3289"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3290"><a id="__codelineno-0-3290" name="__codelineno-0-3290"></a>                <span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-3291"><a id="__codelineno-0-3291" name="__codelineno-0-3291"></a>                <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3292"><a id="__codelineno-0-3292" name="__codelineno-0-3292"></a>            <span class="p">)</span>
</span><span id="__span-0-3293"><a id="__codelineno-0-3293" name="__codelineno-0-3293"></a>            <span class="k">return</span> <span class="n">registered_ufish_image</span>
</span><span id="__span-0-3294"><a id="__codelineno-0-3294" name="__codelineno-0-3294"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-3295"><a id="__codelineno-0-3295" name="__codelineno-0-3295"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-3296"><a id="__codelineno-0-3296" name="__codelineno-0-3296"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error loading U-FISH image."</span><span class="p">)</span>
</span><span id="__span-0-3297"><a id="__codelineno-0-3297" name="__codelineno-0-3297"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3298"><a id="__codelineno-0-3298" name="__codelineno-0-3298"></a>
</span><span id="__span-0-3299"><a id="__codelineno-0-3299" name="__codelineno-0-3299"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_local_ufish_image</span><span class="p">(</span>
</span><span id="__span-0-3300"><a id="__codelineno-0-3300" name="__codelineno-0-3300"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3301"><a id="__codelineno-0-3301" name="__codelineno-0-3301"></a>        <span class="n">ufish_image</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3302"><a id="__codelineno-0-3302" name="__codelineno-0-3302"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3303"><a id="__codelineno-0-3303" name="__codelineno-0-3303"></a>        <span class="n">bit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3304"><a id="__codelineno-0-3304" name="__codelineno-0-3304"></a>        <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-3305"><a id="__codelineno-0-3305" name="__codelineno-0-3305"></a>    <span class="p">):</span>
</span><span id="__span-0-3306"><a id="__codelineno-0-3306" name="__codelineno-0-3306"></a><span class="w">        </span><span class="sd">"""Save U-FISH prediction image.</span>
</span><span id="__span-0-3307"><a id="__codelineno-0-3307" name="__codelineno-0-3307"></a>
</span><span id="__span-0-3308"><a id="__codelineno-0-3308" name="__codelineno-0-3308"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3309"><a id="__codelineno-0-3309" name="__codelineno-0-3309"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3310"><a id="__codelineno-0-3310" name="__codelineno-0-3310"></a><span class="sd">        ufish_image : ArrayLike</span>
</span><span id="__span-0-3311"><a id="__codelineno-0-3311" name="__codelineno-0-3311"></a><span class="sd">            U-FISH prediction image.</span>
</span><span id="__span-0-3312"><a id="__codelineno-0-3312" name="__codelineno-0-3312"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-3313"><a id="__codelineno-0-3313" name="__codelineno-0-3313"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-3314"><a id="__codelineno-0-3314" name="__codelineno-0-3314"></a><span class="sd">        bit : Union[int, str]</span>
</span><span id="__span-0-3315"><a id="__codelineno-0-3315" name="__codelineno-0-3315"></a><span class="sd">            Bit index or bit id.</span>
</span><span id="__span-0-3316"><a id="__codelineno-0-3316" name="__codelineno-0-3316"></a><span class="sd">        return_future : Optional[bool]</span>
</span><span id="__span-0-3317"><a id="__codelineno-0-3317" name="__codelineno-0-3317"></a><span class="sd">            Return future array.</span>
</span><span id="__span-0-3318"><a id="__codelineno-0-3318" name="__codelineno-0-3318"></a><span class="sd">        """</span>
</span><span id="__span-0-3319"><a id="__codelineno-0-3319" name="__codelineno-0-3319"></a>
</span><span id="__span-0-3320"><a id="__codelineno-0-3320" name="__codelineno-0-3320"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3321"><a id="__codelineno-0-3321" name="__codelineno-0-3321"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3322"><a id="__codelineno-0-3322" name="__codelineno-0-3322"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3323"><a id="__codelineno-0-3323" name="__codelineno-0-3323"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3324"><a id="__codelineno-0-3324" name="__codelineno-0-3324"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3325"><a id="__codelineno-0-3325" name="__codelineno-0-3325"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3326"><a id="__codelineno-0-3326" name="__codelineno-0-3326"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3327"><a id="__codelineno-0-3327" name="__codelineno-0-3327"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3328"><a id="__codelineno-0-3328" name="__codelineno-0-3328"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3329"><a id="__codelineno-0-3329" name="__codelineno-0-3329"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3330"><a id="__codelineno-0-3330" name="__codelineno-0-3330"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3331"><a id="__codelineno-0-3331" name="__codelineno-0-3331"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3332"><a id="__codelineno-0-3332" name="__codelineno-0-3332"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3333"><a id="__codelineno-0-3333" name="__codelineno-0-3333"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3334"><a id="__codelineno-0-3334" name="__codelineno-0-3334"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3335"><a id="__codelineno-0-3335" name="__codelineno-0-3335"></a>
</span><span id="__span-0-3336"><a id="__codelineno-0-3336" name="__codelineno-0-3336"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-3337"><a id="__codelineno-0-3337" name="__codelineno-0-3337"></a>            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3338"><a id="__codelineno-0-3338" name="__codelineno-0-3338"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-3339"><a id="__codelineno-0-3339" name="__codelineno-0-3339"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-3340"><a id="__codelineno-0-3340" name="__codelineno-0-3340"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3341"><a id="__codelineno-0-3341" name="__codelineno-0-3341"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3342"><a id="__codelineno-0-3342" name="__codelineno-0-3342"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-3343"><a id="__codelineno-0-3343" name="__codelineno-0-3343"></a>            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3344"><a id="__codelineno-0-3344" name="__codelineno-0-3344"></a>                <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-3345"><a id="__codelineno-0-3345" name="__codelineno-0-3345"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-3346"><a id="__codelineno-0-3346" name="__codelineno-0-3346"></a>                    <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3347"><a id="__codelineno-0-3347" name="__codelineno-0-3347"></a>                <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3348"><a id="__codelineno-0-3348" name="__codelineno-0-3348"></a>                    <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-3349"><a id="__codelineno-0-3349" name="__codelineno-0-3349"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3350"><a id="__codelineno-0-3350" name="__codelineno-0-3350"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3351"><a id="__codelineno-0-3351" name="__codelineno-0-3351"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3352"><a id="__codelineno-0-3352" name="__codelineno-0-3352"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3353"><a id="__codelineno-0-3353" name="__codelineno-0-3353"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-3354"><a id="__codelineno-0-3354" name="__codelineno-0-3354"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3355"><a id="__codelineno-0-3355" name="__codelineno-0-3355"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3356"><a id="__codelineno-0-3356" name="__codelineno-0-3356"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_ufish_data"</span><span class="p">)</span>
</span><span id="__span-0-3357"><a id="__codelineno-0-3357" name="__codelineno-0-3357"></a>            <span class="p">)</span>
</span><span id="__span-0-3358"><a id="__codelineno-0-3358" name="__codelineno-0-3358"></a>
</span><span id="__span-0-3359"><a id="__codelineno-0-3359" name="__codelineno-0-3359"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3360"><a id="__codelineno-0-3360" name="__codelineno-0-3360"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3361"><a id="__codelineno-0-3361" name="__codelineno-0-3361"></a>                <span class="n">ufish_image</span><span class="p">,</span>
</span><span id="__span-0-3362"><a id="__codelineno-0-3362" name="__codelineno-0-3362"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3363"><a id="__codelineno-0-3363" name="__codelineno-0-3363"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-3364"><a id="__codelineno-0-3364" name="__codelineno-0-3364"></a>                <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3365"><a id="__codelineno-0-3365" name="__codelineno-0-3365"></a>            <span class="p">)</span>
</span><span id="__span-0-3366"><a id="__codelineno-0-3366" name="__codelineno-0-3366"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-3367"><a id="__codelineno-0-3367" name="__codelineno-0-3367"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-3368"><a id="__codelineno-0-3368" name="__codelineno-0-3368"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving U-Fish image."</span><span class="p">)</span>
</span><span id="__span-0-3369"><a id="__codelineno-0-3369" name="__codelineno-0-3369"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3370"><a id="__codelineno-0-3370" name="__codelineno-0-3370"></a>
</span><span id="__span-0-3371"><a id="__codelineno-0-3371" name="__codelineno-0-3371"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_local_ufish_spots</span><span class="p">(</span>
</span><span id="__span-0-3372"><a id="__codelineno-0-3372" name="__codelineno-0-3372"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3373"><a id="__codelineno-0-3373" name="__codelineno-0-3373"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3374"><a id="__codelineno-0-3374" name="__codelineno-0-3374"></a>        <span class="n">bit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3375"><a id="__codelineno-0-3375" name="__codelineno-0-3375"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="__span-0-3376"><a id="__codelineno-0-3376" name="__codelineno-0-3376"></a><span class="w">        </span><span class="sd">"""Load U-FISH spot localizations and features for one tile.</span>
</span><span id="__span-0-3377"><a id="__codelineno-0-3377" name="__codelineno-0-3377"></a>
</span><span id="__span-0-3378"><a id="__codelineno-0-3378" name="__codelineno-0-3378"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3379"><a id="__codelineno-0-3379" name="__codelineno-0-3379"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3380"><a id="__codelineno-0-3380" name="__codelineno-0-3380"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-3381"><a id="__codelineno-0-3381" name="__codelineno-0-3381"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-3382"><a id="__codelineno-0-3382" name="__codelineno-0-3382"></a><span class="sd">        bit : Union[int, str]</span>
</span><span id="__span-0-3383"><a id="__codelineno-0-3383" name="__codelineno-0-3383"></a><span class="sd">            Bit index or bit id.</span>
</span><span id="__span-0-3384"><a id="__codelineno-0-3384" name="__codelineno-0-3384"></a>
</span><span id="__span-0-3385"><a id="__codelineno-0-3385" name="__codelineno-0-3385"></a><span class="sd">        Returns</span>
</span><span id="__span-0-3386"><a id="__codelineno-0-3386" name="__codelineno-0-3386"></a><span class="sd">        -------</span>
</span><span id="__span-0-3387"><a id="__codelineno-0-3387" name="__codelineno-0-3387"></a><span class="sd">        ufish_localizations : Optional[pd.DataFrame]</span>
</span><span id="__span-0-3388"><a id="__codelineno-0-3388" name="__codelineno-0-3388"></a><span class="sd">            U-FISH localizations and features for one tile.</span>
</span><span id="__span-0-3389"><a id="__codelineno-0-3389" name="__codelineno-0-3389"></a><span class="sd">        """</span>
</span><span id="__span-0-3390"><a id="__codelineno-0-3390" name="__codelineno-0-3390"></a>
</span><span id="__span-0-3391"><a id="__codelineno-0-3391" name="__codelineno-0-3391"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3392"><a id="__codelineno-0-3392" name="__codelineno-0-3392"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3393"><a id="__codelineno-0-3393" name="__codelineno-0-3393"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3394"><a id="__codelineno-0-3394" name="__codelineno-0-3394"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3395"><a id="__codelineno-0-3395" name="__codelineno-0-3395"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3396"><a id="__codelineno-0-3396" name="__codelineno-0-3396"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3397"><a id="__codelineno-0-3397" name="__codelineno-0-3397"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3398"><a id="__codelineno-0-3398" name="__codelineno-0-3398"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3399"><a id="__codelineno-0-3399" name="__codelineno-0-3399"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3400"><a id="__codelineno-0-3400" name="__codelineno-0-3400"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3401"><a id="__codelineno-0-3401" name="__codelineno-0-3401"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3402"><a id="__codelineno-0-3402" name="__codelineno-0-3402"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3403"><a id="__codelineno-0-3403" name="__codelineno-0-3403"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3404"><a id="__codelineno-0-3404" name="__codelineno-0-3404"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3405"><a id="__codelineno-0-3405" name="__codelineno-0-3405"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3406"><a id="__codelineno-0-3406" name="__codelineno-0-3406"></a>
</span><span id="__span-0-3407"><a id="__codelineno-0-3407" name="__codelineno-0-3407"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3408"><a id="__codelineno-0-3408" name="__codelineno-0-3408"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-3409"><a id="__codelineno-0-3409" name="__codelineno-0-3409"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-3410"><a id="__codelineno-0-3410" name="__codelineno-0-3410"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3411"><a id="__codelineno-0-3411" name="__codelineno-0-3411"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3412"><a id="__codelineno-0-3412" name="__codelineno-0-3412"></a>                <span class="n">bit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-3413"><a id="__codelineno-0-3413" name="__codelineno-0-3413"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3414"><a id="__codelineno-0-3414" name="__codelineno-0-3414"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-3415"><a id="__codelineno-0-3415" name="__codelineno-0-3415"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-3416"><a id="__codelineno-0-3416" name="__codelineno-0-3416"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3417"><a id="__codelineno-0-3417" name="__codelineno-0-3417"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3418"><a id="__codelineno-0-3418" name="__codelineno-0-3418"></a>                <span class="n">bit_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-3419"><a id="__codelineno-0-3419" name="__codelineno-0-3419"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3420"><a id="__codelineno-0-3420" name="__codelineno-0-3420"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3421"><a id="__codelineno-0-3421" name="__codelineno-0-3421"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3422"><a id="__codelineno-0-3422" name="__codelineno-0-3422"></a>
</span><span id="__span-0-3423"><a id="__codelineno-0-3423" name="__codelineno-0-3423"></a>        <span class="n">current_ufish_localizations_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-3424"><a id="__codelineno-0-3424" name="__codelineno-0-3424"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span>
</span><span id="__span-0-3425"><a id="__codelineno-0-3425" name="__codelineno-0-3425"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3426"><a id="__codelineno-0-3426" name="__codelineno-0-3426"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".parquet"</span><span class="p">)</span>
</span><span id="__span-0-3427"><a id="__codelineno-0-3427" name="__codelineno-0-3427"></a>        <span class="p">)</span>
</span><span id="__span-0-3428"><a id="__codelineno-0-3428" name="__codelineno-0-3428"></a>
</span><span id="__span-0-3429"><a id="__codelineno-0-3429" name="__codelineno-0-3429"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_ufish_localizations_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3430"><a id="__codelineno-0-3430" name="__codelineno-0-3430"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"U-FISH localizations not found."</span><span class="p">)</span>
</span><span id="__span-0-3431"><a id="__codelineno-0-3431" name="__codelineno-0-3431"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3432"><a id="__codelineno-0-3432" name="__codelineno-0-3432"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3433"><a id="__codelineno-0-3433" name="__codelineno-0-3433"></a>            <span class="n">ufish_localizations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_parquet</span><span class="p">(</span>
</span><span id="__span-0-3434"><a id="__codelineno-0-3434" name="__codelineno-0-3434"></a>                <span class="n">current_ufish_localizations_path</span>
</span><span id="__span-0-3435"><a id="__codelineno-0-3435" name="__codelineno-0-3435"></a>            <span class="p">)</span>
</span><span id="__span-0-3436"><a id="__codelineno-0-3436" name="__codelineno-0-3436"></a>            <span class="k">return</span> <span class="n">ufish_localizations</span>
</span><span id="__span-0-3437"><a id="__codelineno-0-3437" name="__codelineno-0-3437"></a>
</span><span id="__span-0-3438"><a id="__codelineno-0-3438" name="__codelineno-0-3438"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_local_ufish_spots</span><span class="p">(</span>
</span><span id="__span-0-3439"><a id="__codelineno-0-3439" name="__codelineno-0-3439"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3440"><a id="__codelineno-0-3440" name="__codelineno-0-3440"></a>        <span class="n">spot_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="__span-0-3441"><a id="__codelineno-0-3441" name="__codelineno-0-3441"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3442"><a id="__codelineno-0-3442" name="__codelineno-0-3442"></a>        <span class="n">bit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3443"><a id="__codelineno-0-3443" name="__codelineno-0-3443"></a>    <span class="p">):</span>
</span><span id="__span-0-3444"><a id="__codelineno-0-3444" name="__codelineno-0-3444"></a><span class="w">        </span><span class="sd">"""Save U-FISH localizations and features.</span>
</span><span id="__span-0-3445"><a id="__codelineno-0-3445" name="__codelineno-0-3445"></a>
</span><span id="__span-0-3446"><a id="__codelineno-0-3446" name="__codelineno-0-3446"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3447"><a id="__codelineno-0-3447" name="__codelineno-0-3447"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3448"><a id="__codelineno-0-3448" name="__codelineno-0-3448"></a><span class="sd">        spot_df : pd.DataFrame</span>
</span><span id="__span-0-3449"><a id="__codelineno-0-3449" name="__codelineno-0-3449"></a><span class="sd">            U-FISH localizations and features.</span>
</span><span id="__span-0-3450"><a id="__codelineno-0-3450" name="__codelineno-0-3450"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-3451"><a id="__codelineno-0-3451" name="__codelineno-0-3451"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-3452"><a id="__codelineno-0-3452" name="__codelineno-0-3452"></a><span class="sd">        bit : Union[int, str]</span>
</span><span id="__span-0-3453"><a id="__codelineno-0-3453" name="__codelineno-0-3453"></a><span class="sd">            Bit index or bit id.</span>
</span><span id="__span-0-3454"><a id="__codelineno-0-3454" name="__codelineno-0-3454"></a><span class="sd">        """</span>
</span><span id="__span-0-3455"><a id="__codelineno-0-3455" name="__codelineno-0-3455"></a>
</span><span id="__span-0-3456"><a id="__codelineno-0-3456" name="__codelineno-0-3456"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3457"><a id="__codelineno-0-3457" name="__codelineno-0-3457"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3458"><a id="__codelineno-0-3458" name="__codelineno-0-3458"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3459"><a id="__codelineno-0-3459" name="__codelineno-0-3459"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3460"><a id="__codelineno-0-3460" name="__codelineno-0-3460"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3461"><a id="__codelineno-0-3461" name="__codelineno-0-3461"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3462"><a id="__codelineno-0-3462" name="__codelineno-0-3462"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3463"><a id="__codelineno-0-3463" name="__codelineno-0-3463"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3464"><a id="__codelineno-0-3464" name="__codelineno-0-3464"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3465"><a id="__codelineno-0-3465" name="__codelineno-0-3465"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3466"><a id="__codelineno-0-3466" name="__codelineno-0-3466"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3467"><a id="__codelineno-0-3467" name="__codelineno-0-3467"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3468"><a id="__codelineno-0-3468" name="__codelineno-0-3468"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3469"><a id="__codelineno-0-3469" name="__codelineno-0-3469"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3470"><a id="__codelineno-0-3470" name="__codelineno-0-3470"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3471"><a id="__codelineno-0-3471" name="__codelineno-0-3471"></a>
</span><span id="__span-0-3472"><a id="__codelineno-0-3472" name="__codelineno-0-3472"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3473"><a id="__codelineno-0-3473" name="__codelineno-0-3473"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-3474"><a id="__codelineno-0-3474" name="__codelineno-0-3474"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-3475"><a id="__codelineno-0-3475" name="__codelineno-0-3475"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3476"><a id="__codelineno-0-3476" name="__codelineno-0-3476"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3477"><a id="__codelineno-0-3477" name="__codelineno-0-3477"></a>                <span class="n">bit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-3478"><a id="__codelineno-0-3478" name="__codelineno-0-3478"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3479"><a id="__codelineno-0-3479" name="__codelineno-0-3479"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-3480"><a id="__codelineno-0-3480" name="__codelineno-0-3480"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-3481"><a id="__codelineno-0-3481" name="__codelineno-0-3481"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3482"><a id="__codelineno-0-3482" name="__codelineno-0-3482"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3483"><a id="__codelineno-0-3483" name="__codelineno-0-3483"></a>                <span class="n">bit_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-3484"><a id="__codelineno-0-3484" name="__codelineno-0-3484"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3485"><a id="__codelineno-0-3485" name="__codelineno-0-3485"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3486"><a id="__codelineno-0-3486" name="__codelineno-0-3486"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3487"><a id="__codelineno-0-3487" name="__codelineno-0-3487"></a>
</span><span id="__span-0-3488"><a id="__codelineno-0-3488" name="__codelineno-0-3488"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">))</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3489"><a id="__codelineno-0-3489" name="__codelineno-0-3489"></a>            <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">))</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-3490"><a id="__codelineno-0-3490" name="__codelineno-0-3490"></a>
</span><span id="__span-0-3491"><a id="__codelineno-0-3491" name="__codelineno-0-3491"></a>        <span class="n">current_ufish_localizations_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-3492"><a id="__codelineno-0-3492" name="__codelineno-0-3492"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span>
</span><span id="__span-0-3493"><a id="__codelineno-0-3493" name="__codelineno-0-3493"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3494"><a id="__codelineno-0-3494" name="__codelineno-0-3494"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".parquet"</span><span class="p">)</span>
</span><span id="__span-0-3495"><a id="__codelineno-0-3495" name="__codelineno-0-3495"></a>        <span class="p">)</span>
</span><span id="__span-0-3496"><a id="__codelineno-0-3496" name="__codelineno-0-3496"></a>
</span><span id="__span-0-3497"><a id="__codelineno-0-3497" name="__codelineno-0-3497"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3498"><a id="__codelineno-0-3498" name="__codelineno-0-3498"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_parquet</span><span class="p">(</span><span class="n">spot_df</span><span class="p">,</span> <span class="n">current_ufish_localizations_path</span><span class="p">)</span>
</span><span id="__span-0-3499"><a id="__codelineno-0-3499" name="__codelineno-0-3499"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-3500"><a id="__codelineno-0-3500" name="__codelineno-0-3500"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-3501"><a id="__codelineno-0-3501" name="__codelineno-0-3501"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving U-FISH localizations."</span><span class="p">)</span>
</span><span id="__span-0-3502"><a id="__codelineno-0-3502" name="__codelineno-0-3502"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3503"><a id="__codelineno-0-3503" name="__codelineno-0-3503"></a>
</span><span id="__span-0-3504"><a id="__codelineno-0-3504" name="__codelineno-0-3504"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_global_coord_xforms_um</span><span class="p">(</span>
</span><span id="__span-0-3505"><a id="__codelineno-0-3505" name="__codelineno-0-3505"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3506"><a id="__codelineno-0-3506" name="__codelineno-0-3506"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3507"><a id="__codelineno-0-3507" name="__codelineno-0-3507"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">]]:</span>
</span><span id="__span-0-3508"><a id="__codelineno-0-3508" name="__codelineno-0-3508"></a><span class="w">        </span><span class="sd">"""Load global registration transform for one tile.</span>
</span><span id="__span-0-3509"><a id="__codelineno-0-3509" name="__codelineno-0-3509"></a>
</span><span id="__span-0-3510"><a id="__codelineno-0-3510" name="__codelineno-0-3510"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3511"><a id="__codelineno-0-3511" name="__codelineno-0-3511"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3512"><a id="__codelineno-0-3512" name="__codelineno-0-3512"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-3513"><a id="__codelineno-0-3513" name="__codelineno-0-3513"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-3514"><a id="__codelineno-0-3514" name="__codelineno-0-3514"></a>
</span><span id="__span-0-3515"><a id="__codelineno-0-3515" name="__codelineno-0-3515"></a><span class="sd">        Returns</span>
</span><span id="__span-0-3516"><a id="__codelineno-0-3516" name="__codelineno-0-3516"></a><span class="sd">        -------</span>
</span><span id="__span-0-3517"><a id="__codelineno-0-3517" name="__codelineno-0-3517"></a><span class="sd">        affine_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-3518"><a id="__codelineno-0-3518" name="__codelineno-0-3518"></a><span class="sd">            Global affine registration transform for one tile.</span>
</span><span id="__span-0-3519"><a id="__codelineno-0-3519" name="__codelineno-0-3519"></a><span class="sd">        origin_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-3520"><a id="__codelineno-0-3520" name="__codelineno-0-3520"></a><span class="sd">            Global origin registration transform for one tile.</span>
</span><span id="__span-0-3521"><a id="__codelineno-0-3521" name="__codelineno-0-3521"></a><span class="sd">        spacing_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-3522"><a id="__codelineno-0-3522" name="__codelineno-0-3522"></a><span class="sd">            Global spacing registration transform for one tile.</span>
</span><span id="__span-0-3523"><a id="__codelineno-0-3523" name="__codelineno-0-3523"></a><span class="sd">        """</span>
</span><span id="__span-0-3524"><a id="__codelineno-0-3524" name="__codelineno-0-3524"></a>
</span><span id="__span-0-3525"><a id="__codelineno-0-3525" name="__codelineno-0-3525"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3526"><a id="__codelineno-0-3526" name="__codelineno-0-3526"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3527"><a id="__codelineno-0-3527" name="__codelineno-0-3527"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3528"><a id="__codelineno-0-3528" name="__codelineno-0-3528"></a>                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-0-3529"><a id="__codelineno-0-3529" name="__codelineno-0-3529"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3530"><a id="__codelineno-0-3530" name="__codelineno-0-3530"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3531"><a id="__codelineno-0-3531" name="__codelineno-0-3531"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3532"><a id="__codelineno-0-3532" name="__codelineno-0-3532"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3533"><a id="__codelineno-0-3533" name="__codelineno-0-3533"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3534"><a id="__codelineno-0-3534" name="__codelineno-0-3534"></a>                <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-0-3535"><a id="__codelineno-0-3535" name="__codelineno-0-3535"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3536"><a id="__codelineno-0-3536" name="__codelineno-0-3536"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3537"><a id="__codelineno-0-3537" name="__codelineno-0-3537"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3538"><a id="__codelineno-0-3538" name="__codelineno-0-3538"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3539"><a id="__codelineno-0-3539" name="__codelineno-0-3539"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3540"><a id="__codelineno-0-3540" name="__codelineno-0-3540"></a>
</span><span id="__span-0-3541"><a id="__codelineno-0-3541" name="__codelineno-0-3541"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3542"><a id="__codelineno-0-3542" name="__codelineno-0-3542"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3543"><a id="__codelineno-0-3543" name="__codelineno-0-3543"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-3544"><a id="__codelineno-0-3544" name="__codelineno-0-3544"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3545"><a id="__codelineno-0-3545" name="__codelineno-0-3545"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3546"><a id="__codelineno-0-3546" name="__codelineno-0-3546"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-3547"><a id="__codelineno-0-3547" name="__codelineno-0-3547"></a>            <span class="p">)</span>
</span><span id="__span-0-3548"><a id="__codelineno-0-3548" name="__codelineno-0-3548"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3549"><a id="__codelineno-0-3549" name="__codelineno-0-3549"></a>            <span class="n">affine_zyx_um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"affine_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-3550"><a id="__codelineno-0-3550" name="__codelineno-0-3550"></a>            <span class="n">origin_zyx_um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"origin_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-3551"><a id="__codelineno-0-3551" name="__codelineno-0-3551"></a>            <span class="n">spacing_zyx_um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"spacing_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-3552"><a id="__codelineno-0-3552" name="__codelineno-0-3552"></a>            <span class="k">return</span> <span class="p">(</span><span class="n">affine_zyx_um</span><span class="p">,</span> <span class="n">origin_zyx_um</span><span class="p">,</span> <span class="n">spacing_zyx_um</span><span class="p">)</span>
</span><span id="__span-0-3553"><a id="__codelineno-0-3553" name="__codelineno-0-3553"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-3554"><a id="__codelineno-0-3554" name="__codelineno-0-3554"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-3555"><a id="__codelineno-0-3555" name="__codelineno-0-3555"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Global coordinate transforms not found"</span><span class="p">)</span>
</span><span id="__span-0-3556"><a id="__codelineno-0-3556" name="__codelineno-0-3556"></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-0-3557"><a id="__codelineno-0-3557" name="__codelineno-0-3557"></a>
</span><span id="__span-0-3558"><a id="__codelineno-0-3558" name="__codelineno-0-3558"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_global_coord_xforms_um</span><span class="p">(</span>
</span><span id="__span-0-3559"><a id="__codelineno-0-3559" name="__codelineno-0-3559"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3560"><a id="__codelineno-0-3560" name="__codelineno-0-3560"></a>        <span class="n">affine_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3561"><a id="__codelineno-0-3561" name="__codelineno-0-3561"></a>        <span class="n">origin_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3562"><a id="__codelineno-0-3562" name="__codelineno-0-3562"></a>        <span class="n">spacing_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3563"><a id="__codelineno-0-3563" name="__codelineno-0-3563"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3564"><a id="__codelineno-0-3564" name="__codelineno-0-3564"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-3565"><a id="__codelineno-0-3565" name="__codelineno-0-3565"></a><span class="w">        </span><span class="sd">"""Save global registration transform for one tile.</span>
</span><span id="__span-0-3566"><a id="__codelineno-0-3566" name="__codelineno-0-3566"></a>
</span><span id="__span-0-3567"><a id="__codelineno-0-3567" name="__codelineno-0-3567"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3568"><a id="__codelineno-0-3568" name="__codelineno-0-3568"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3569"><a id="__codelineno-0-3569" name="__codelineno-0-3569"></a><span class="sd">        affine_zyx_um : ArrayLike</span>
</span><span id="__span-0-3570"><a id="__codelineno-0-3570" name="__codelineno-0-3570"></a><span class="sd">            Global affine registration transform for one tile.</span>
</span><span id="__span-0-3571"><a id="__codelineno-0-3571" name="__codelineno-0-3571"></a><span class="sd">        origin_zyx_um : ArrayLike</span>
</span><span id="__span-0-3572"><a id="__codelineno-0-3572" name="__codelineno-0-3572"></a><span class="sd">            Global origin registration transform for one tile.</span>
</span><span id="__span-0-3573"><a id="__codelineno-0-3573" name="__codelineno-0-3573"></a><span class="sd">        spacing_zyx_um : ArrayLike</span>
</span><span id="__span-0-3574"><a id="__codelineno-0-3574" name="__codelineno-0-3574"></a><span class="sd">            Global spacing registration transform for one tile.</span>
</span><span id="__span-0-3575"><a id="__codelineno-0-3575" name="__codelineno-0-3575"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-3576"><a id="__codelineno-0-3576" name="__codelineno-0-3576"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-3577"><a id="__codelineno-0-3577" name="__codelineno-0-3577"></a><span class="sd">        """</span>
</span><span id="__span-0-3578"><a id="__codelineno-0-3578" name="__codelineno-0-3578"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3579"><a id="__codelineno-0-3579" name="__codelineno-0-3579"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3580"><a id="__codelineno-0-3580" name="__codelineno-0-3580"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3581"><a id="__codelineno-0-3581" name="__codelineno-0-3581"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3582"><a id="__codelineno-0-3582" name="__codelineno-0-3582"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3583"><a id="__codelineno-0-3583" name="__codelineno-0-3583"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3584"><a id="__codelineno-0-3584" name="__codelineno-0-3584"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3585"><a id="__codelineno-0-3585" name="__codelineno-0-3585"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3586"><a id="__codelineno-0-3586" name="__codelineno-0-3586"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3587"><a id="__codelineno-0-3587" name="__codelineno-0-3587"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3588"><a id="__codelineno-0-3588" name="__codelineno-0-3588"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3589"><a id="__codelineno-0-3589" name="__codelineno-0-3589"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3590"><a id="__codelineno-0-3590" name="__codelineno-0-3590"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3591"><a id="__codelineno-0-3591" name="__codelineno-0-3591"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3592"><a id="__codelineno-0-3592" name="__codelineno-0-3592"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3593"><a id="__codelineno-0-3593" name="__codelineno-0-3593"></a>
</span><span id="__span-0-3594"><a id="__codelineno-0-3594" name="__codelineno-0-3594"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3595"><a id="__codelineno-0-3595" name="__codelineno-0-3595"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3596"><a id="__codelineno-0-3596" name="__codelineno-0-3596"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-3597"><a id="__codelineno-0-3597" name="__codelineno-0-3597"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3598"><a id="__codelineno-0-3598" name="__codelineno-0-3598"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3599"><a id="__codelineno-0-3599" name="__codelineno-0-3599"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-3600"><a id="__codelineno-0-3600" name="__codelineno-0-3600"></a>            <span class="p">)</span>
</span><span id="__span-0-3601"><a id="__codelineno-0-3601" name="__codelineno-0-3601"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3602"><a id="__codelineno-0-3602" name="__codelineno-0-3602"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"affine_zyx_um"</span><span class="p">]</span> <span class="o">=</span> <span class="n">affine_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-3603"><a id="__codelineno-0-3603" name="__codelineno-0-3603"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"origin_zyx_um"</span><span class="p">]</span> <span class="o">=</span> <span class="n">origin_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-3604"><a id="__codelineno-0-3604" name="__codelineno-0-3604"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"spacing_zyx_um"</span><span class="p">]</span> <span class="o">=</span> <span class="n">spacing_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-3605"><a id="__codelineno-0-3605" name="__codelineno-0-3605"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3606"><a id="__codelineno-0-3606" name="__codelineno-0-3606"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-3607"><a id="__codelineno-0-3607" name="__codelineno-0-3607"></a>            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-3608"><a id="__codelineno-0-3608" name="__codelineno-0-3608"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Could not save global coordinate transforms."</span><span class="p">)</span>
</span><span id="__span-0-3609"><a id="__codelineno-0-3609" name="__codelineno-0-3609"></a>
</span><span id="__span-0-3610"><a id="__codelineno-0-3610" name="__codelineno-0-3610"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_global_fidicual_image</span><span class="p">(</span>
</span><span id="__span-0-3611"><a id="__codelineno-0-3611" name="__codelineno-0-3611"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3612"><a id="__codelineno-0-3612" name="__codelineno-0-3612"></a>        <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-3613"><a id="__codelineno-0-3613" name="__codelineno-0-3613"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">]]:</span>
</span><span id="__span-0-3614"><a id="__codelineno-0-3614" name="__codelineno-0-3614"></a><span class="w">        </span><span class="sd">"""Load downsampled, fused fidicual image.</span>
</span><span id="__span-0-3615"><a id="__codelineno-0-3615" name="__codelineno-0-3615"></a>
</span><span id="__span-0-3616"><a id="__codelineno-0-3616" name="__codelineno-0-3616"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3617"><a id="__codelineno-0-3617" name="__codelineno-0-3617"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3618"><a id="__codelineno-0-3618" name="__codelineno-0-3618"></a><span class="sd">        return_future : Optional[bool]</span>
</span><span id="__span-0-3619"><a id="__codelineno-0-3619" name="__codelineno-0-3619"></a><span class="sd">            Return future array.</span>
</span><span id="__span-0-3620"><a id="__codelineno-0-3620" name="__codelineno-0-3620"></a>
</span><span id="__span-0-3621"><a id="__codelineno-0-3621" name="__codelineno-0-3621"></a><span class="sd">        Returns</span>
</span><span id="__span-0-3622"><a id="__codelineno-0-3622" name="__codelineno-0-3622"></a><span class="sd">        -------</span>
</span><span id="__span-0-3623"><a id="__codelineno-0-3623" name="__codelineno-0-3623"></a><span class="sd">        fused_image : Optional[ArrayLike]</span>
</span><span id="__span-0-3624"><a id="__codelineno-0-3624" name="__codelineno-0-3624"></a><span class="sd">            Downsampled, fused fidicual image.</span>
</span><span id="__span-0-3625"><a id="__codelineno-0-3625" name="__codelineno-0-3625"></a><span class="sd">        affine_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-3626"><a id="__codelineno-0-3626" name="__codelineno-0-3626"></a><span class="sd">            Global affine registration transform for fused image.</span>
</span><span id="__span-0-3627"><a id="__codelineno-0-3627" name="__codelineno-0-3627"></a><span class="sd">        origin_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-3628"><a id="__codelineno-0-3628" name="__codelineno-0-3628"></a><span class="sd">            Global origin registration transform for fused image.</span>
</span><span id="__span-0-3629"><a id="__codelineno-0-3629" name="__codelineno-0-3629"></a><span class="sd">        spacing_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-3630"><a id="__codelineno-0-3630" name="__codelineno-0-3630"></a><span class="sd">            Global spacing registration transform for fused image.</span>
</span><span id="__span-0-3631"><a id="__codelineno-0-3631" name="__codelineno-0-3631"></a><span class="sd">        """</span>
</span><span id="__span-0-3632"><a id="__codelineno-0-3632" name="__codelineno-0-3632"></a>
</span><span id="__span-0-3633"><a id="__codelineno-0-3633" name="__codelineno-0-3633"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3634"><a id="__codelineno-0-3634" name="__codelineno-0-3634"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused.zarr"</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-3635"><a id="__codelineno-0-3635" name="__codelineno-0-3635"></a>        <span class="p">)</span>
</span><span id="__span-0-3636"><a id="__codelineno-0-3636" name="__codelineno-0-3636"></a>
</span><span id="__span-0-3637"><a id="__codelineno-0-3637" name="__codelineno-0-3637"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3638"><a id="__codelineno-0-3638" name="__codelineno-0-3638"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Globally registered, fused image not found."</span><span class="p">)</span>
</span><span id="__span-0-3639"><a id="__codelineno-0-3639" name="__codelineno-0-3639"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3640"><a id="__codelineno-0-3640" name="__codelineno-0-3640"></a>
</span><span id="__span-0-3641"><a id="__codelineno-0-3641" name="__codelineno-0-3641"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_local_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">))</span>
</span><span id="__span-0-3642"><a id="__codelineno-0-3642" name="__codelineno-0-3642"></a>
</span><span id="__span-0-3643"><a id="__codelineno-0-3643" name="__codelineno-0-3643"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3644"><a id="__codelineno-0-3644" name="__codelineno-0-3644"></a>            <span class="n">fused_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3645"><a id="__codelineno-0-3645" name="__codelineno-0-3645"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3646"><a id="__codelineno-0-3646" name="__codelineno-0-3646"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-3647"><a id="__codelineno-0-3647" name="__codelineno-0-3647"></a>                <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3648"><a id="__codelineno-0-3648" name="__codelineno-0-3648"></a>            <span class="p">)</span>
</span><span id="__span-0-3649"><a id="__codelineno-0-3649" name="__codelineno-0-3649"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3650"><a id="__codelineno-0-3650" name="__codelineno-0-3650"></a>            <span class="n">affine_zyx_um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"affine_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-3651"><a id="__codelineno-0-3651" name="__codelineno-0-3651"></a>            <span class="n">origin_zyx_um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"origin_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-3652"><a id="__codelineno-0-3652" name="__codelineno-0-3652"></a>            <span class="n">spacing_zyx_um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"spacing_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-3653"><a id="__codelineno-0-3653" name="__codelineno-0-3653"></a>            <span class="k">return</span> <span class="n">fused_image</span><span class="p">,</span> <span class="n">affine_zyx_um</span><span class="p">,</span> <span class="n">origin_zyx_um</span><span class="p">,</span> <span class="n">spacing_zyx_um</span>
</span><span id="__span-0-3654"><a id="__codelineno-0-3654" name="__codelineno-0-3654"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-3655"><a id="__codelineno-0-3655" name="__codelineno-0-3655"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error loading globally registered, fused image."</span><span class="p">)</span>
</span><span id="__span-0-3656"><a id="__codelineno-0-3656" name="__codelineno-0-3656"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3657"><a id="__codelineno-0-3657" name="__codelineno-0-3657"></a>
</span><span id="__span-0-3658"><a id="__codelineno-0-3658" name="__codelineno-0-3658"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_global_fidicual_image</span><span class="p">(</span>
</span><span id="__span-0-3659"><a id="__codelineno-0-3659" name="__codelineno-0-3659"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3660"><a id="__codelineno-0-3660" name="__codelineno-0-3660"></a>        <span class="n">fused_image</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3661"><a id="__codelineno-0-3661" name="__codelineno-0-3661"></a>        <span class="n">affine_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3662"><a id="__codelineno-0-3662" name="__codelineno-0-3662"></a>        <span class="n">origin_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3663"><a id="__codelineno-0-3663" name="__codelineno-0-3663"></a>        <span class="n">spacing_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3664"><a id="__codelineno-0-3664" name="__codelineno-0-3664"></a>        <span class="n">fusion_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"polyDT"</span><span class="p">,</span>
</span><span id="__span-0-3665"><a id="__codelineno-0-3665" name="__codelineno-0-3665"></a>        <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-3666"><a id="__codelineno-0-3666" name="__codelineno-0-3666"></a>    <span class="p">):</span>
</span><span id="__span-0-3667"><a id="__codelineno-0-3667" name="__codelineno-0-3667"></a><span class="w">        </span><span class="sd">"""Save downsampled, fused fidicual image.</span>
</span><span id="__span-0-3668"><a id="__codelineno-0-3668" name="__codelineno-0-3668"></a>
</span><span id="__span-0-3669"><a id="__codelineno-0-3669" name="__codelineno-0-3669"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3670"><a id="__codelineno-0-3670" name="__codelineno-0-3670"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3671"><a id="__codelineno-0-3671" name="__codelineno-0-3671"></a><span class="sd">        fused_image : ArrayLike</span>
</span><span id="__span-0-3672"><a id="__codelineno-0-3672" name="__codelineno-0-3672"></a><span class="sd">            Downsampled, fused fidicual image.</span>
</span><span id="__span-0-3673"><a id="__codelineno-0-3673" name="__codelineno-0-3673"></a><span class="sd">        affine_zyx_um : ArrayLike</span>
</span><span id="__span-0-3674"><a id="__codelineno-0-3674" name="__codelineno-0-3674"></a><span class="sd">            Global affine registration transform for fused image.</span>
</span><span id="__span-0-3675"><a id="__codelineno-0-3675" name="__codelineno-0-3675"></a><span class="sd">        origin_zyx_um : ArrayLike</span>
</span><span id="__span-0-3676"><a id="__codelineno-0-3676" name="__codelineno-0-3676"></a><span class="sd">            Global origin registration transform for fused image.</span>
</span><span id="__span-0-3677"><a id="__codelineno-0-3677" name="__codelineno-0-3677"></a><span class="sd">        spacing_zyx_um : ArrayLike</span>
</span><span id="__span-0-3678"><a id="__codelineno-0-3678" name="__codelineno-0-3678"></a><span class="sd">            Global spacing registration transform for fused image.</span>
</span><span id="__span-0-3679"><a id="__codelineno-0-3679" name="__codelineno-0-3679"></a><span class="sd">        fusion_type : str</span>
</span><span id="__span-0-3680"><a id="__codelineno-0-3680" name="__codelineno-0-3680"></a><span class="sd">            Type of fusion (polyDT or all_channels).</span>
</span><span id="__span-0-3681"><a id="__codelineno-0-3681" name="__codelineno-0-3681"></a><span class="sd">        return_future : Optional[bool]</span>
</span><span id="__span-0-3682"><a id="__codelineno-0-3682" name="__codelineno-0-3682"></a><span class="sd">            Return future array.</span>
</span><span id="__span-0-3683"><a id="__codelineno-0-3683" name="__codelineno-0-3683"></a><span class="sd">        """</span>
</span><span id="__span-0-3684"><a id="__codelineno-0-3684" name="__codelineno-0-3684"></a>
</span><span id="__span-0-3685"><a id="__codelineno-0-3685" name="__codelineno-0-3685"></a>        <span class="k">if</span> <span class="n">fusion_type</span> <span class="o">==</span> <span class="s2">"polyDT"</span><span class="p">:</span>
</span><span id="__span-0-3686"><a id="__codelineno-0-3686" name="__codelineno-0-3686"></a>            <span class="n">filename</span> <span class="o">=</span> <span class="s2">"fused_polyDT_iso_zyx"</span>
</span><span id="__span-0-3687"><a id="__codelineno-0-3687" name="__codelineno-0-3687"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3688"><a id="__codelineno-0-3688" name="__codelineno-0-3688"></a>            <span class="n">filename</span> <span class="o">=</span> <span class="s2">"fused_all_channels_zyx"</span>
</span><span id="__span-0-3689"><a id="__codelineno-0-3689" name="__codelineno-0-3689"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3690"><a id="__codelineno-0-3690" name="__codelineno-0-3690"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused.zarr"</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="__span-0-3691"><a id="__codelineno-0-3691" name="__codelineno-0-3691"></a>        <span class="p">)</span>
</span><span id="__span-0-3692"><a id="__codelineno-0-3692" name="__codelineno-0-3692"></a>        <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3693"><a id="__codelineno-0-3693" name="__codelineno-0-3693"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span>
</span><span id="__span-0-3694"><a id="__codelineno-0-3694" name="__codelineno-0-3694"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused.zarr"</span><span class="p">)</span>
</span><span id="__span-0-3695"><a id="__codelineno-0-3695" name="__codelineno-0-3695"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="__span-0-3696"><a id="__codelineno-0-3696" name="__codelineno-0-3696"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-3697"><a id="__codelineno-0-3697" name="__codelineno-0-3697"></a>        <span class="p">)</span>
</span><span id="__span-0-3698"><a id="__codelineno-0-3698" name="__codelineno-0-3698"></a>
</span><span id="__span-0-3699"><a id="__codelineno-0-3699" name="__codelineno-0-3699"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-3700"><a id="__codelineno-0-3700" name="__codelineno-0-3700"></a>            <span class="s2">"affine_zyx_um"</span><span class="p">:</span> <span class="n">affine_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="__span-0-3701"><a id="__codelineno-0-3701" name="__codelineno-0-3701"></a>            <span class="s2">"origin_zyx_um"</span><span class="p">:</span> <span class="n">origin_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="__span-0-3702"><a id="__codelineno-0-3702" name="__codelineno-0-3702"></a>            <span class="s2">"spacing_zyx_um"</span><span class="p">:</span> <span class="n">spacing_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="__span-0-3703"><a id="__codelineno-0-3703" name="__codelineno-0-3703"></a>        <span class="p">}</span>
</span><span id="__span-0-3704"><a id="__codelineno-0-3704" name="__codelineno-0-3704"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3705"><a id="__codelineno-0-3705" name="__codelineno-0-3705"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3706"><a id="__codelineno-0-3706" name="__codelineno-0-3706"></a>                <span class="n">fused_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">),</span>
</span><span id="__span-0-3707"><a id="__codelineno-0-3707" name="__codelineno-0-3707"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3708"><a id="__codelineno-0-3708" name="__codelineno-0-3708"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-3709"><a id="__codelineno-0-3709" name="__codelineno-0-3709"></a>                <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3710"><a id="__codelineno-0-3710" name="__codelineno-0-3710"></a>            <span class="p">)</span>
</span><span id="__span-0-3711"><a id="__codelineno-0-3711" name="__codelineno-0-3711"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3712"><a id="__codelineno-0-3712" name="__codelineno-0-3712"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">):</span>
</span><span id="__span-0-3713"><a id="__codelineno-0-3713" name="__codelineno-0-3713"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving fused image."</span><span class="p">)</span>
</span><span id="__span-0-3714"><a id="__codelineno-0-3714" name="__codelineno-0-3714"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3715"><a id="__codelineno-0-3715" name="__codelineno-0-3715"></a>
</span><span id="__span-0-3716"><a id="__codelineno-0-3716" name="__codelineno-0-3716"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_local_decoded_spots</span><span class="p">(</span>
</span><span id="__span-0-3717"><a id="__codelineno-0-3717" name="__codelineno-0-3717"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3718"><a id="__codelineno-0-3718" name="__codelineno-0-3718"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3719"><a id="__codelineno-0-3719" name="__codelineno-0-3719"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="__span-0-3720"><a id="__codelineno-0-3720" name="__codelineno-0-3720"></a><span class="w">        </span><span class="sd">"""Load decoded spots and features for one tile.</span>
</span><span id="__span-0-3721"><a id="__codelineno-0-3721" name="__codelineno-0-3721"></a>
</span><span id="__span-0-3722"><a id="__codelineno-0-3722" name="__codelineno-0-3722"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3723"><a id="__codelineno-0-3723" name="__codelineno-0-3723"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3724"><a id="__codelineno-0-3724" name="__codelineno-0-3724"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-3725"><a id="__codelineno-0-3725" name="__codelineno-0-3725"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-3726"><a id="__codelineno-0-3726" name="__codelineno-0-3726"></a>
</span><span id="__span-0-3727"><a id="__codelineno-0-3727" name="__codelineno-0-3727"></a><span class="sd">        Returns</span>
</span><span id="__span-0-3728"><a id="__codelineno-0-3728" name="__codelineno-0-3728"></a><span class="sd">        -------</span>
</span><span id="__span-0-3729"><a id="__codelineno-0-3729" name="__codelineno-0-3729"></a><span class="sd">        tile_features : Optional[pd.DataFrame]</span>
</span><span id="__span-0-3730"><a id="__codelineno-0-3730" name="__codelineno-0-3730"></a><span class="sd">            Decoded spots and features for one tile.</span>
</span><span id="__span-0-3731"><a id="__codelineno-0-3731" name="__codelineno-0-3731"></a><span class="sd">        """</span>
</span><span id="__span-0-3732"><a id="__codelineno-0-3732" name="__codelineno-0-3732"></a>
</span><span id="__span-0-3733"><a id="__codelineno-0-3733" name="__codelineno-0-3733"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3734"><a id="__codelineno-0-3734" name="__codelineno-0-3734"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3735"><a id="__codelineno-0-3735" name="__codelineno-0-3735"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3736"><a id="__codelineno-0-3736" name="__codelineno-0-3736"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3737"><a id="__codelineno-0-3737" name="__codelineno-0-3737"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3738"><a id="__codelineno-0-3738" name="__codelineno-0-3738"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3739"><a id="__codelineno-0-3739" name="__codelineno-0-3739"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3740"><a id="__codelineno-0-3740" name="__codelineno-0-3740"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3741"><a id="__codelineno-0-3741" name="__codelineno-0-3741"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3742"><a id="__codelineno-0-3742" name="__codelineno-0-3742"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3743"><a id="__codelineno-0-3743" name="__codelineno-0-3743"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3744"><a id="__codelineno-0-3744" name="__codelineno-0-3744"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3745"><a id="__codelineno-0-3745" name="__codelineno-0-3745"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3746"><a id="__codelineno-0-3746" name="__codelineno-0-3746"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3747"><a id="__codelineno-0-3747" name="__codelineno-0-3747"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3748"><a id="__codelineno-0-3748" name="__codelineno-0-3748"></a>
</span><span id="__span-0-3749"><a id="__codelineno-0-3749" name="__codelineno-0-3749"></a>        <span class="n">current_tile_features_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-3750"><a id="__codelineno-0-3750" name="__codelineno-0-3750"></a>            <span class="n">tile_id</span> <span class="o">+</span> <span class="s2">"_decoded_features.parquet"</span>
</span><span id="__span-0-3751"><a id="__codelineno-0-3751" name="__codelineno-0-3751"></a>        <span class="p">)</span>
</span><span id="__span-0-3752"><a id="__codelineno-0-3752" name="__codelineno-0-3752"></a>
</span><span id="__span-0-3753"><a id="__codelineno-0-3753" name="__codelineno-0-3753"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_tile_features_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3754"><a id="__codelineno-0-3754" name="__codelineno-0-3754"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Decoded spots not found."</span><span class="p">)</span>
</span><span id="__span-0-3755"><a id="__codelineno-0-3755" name="__codelineno-0-3755"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3756"><a id="__codelineno-0-3756" name="__codelineno-0-3756"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3757"><a id="__codelineno-0-3757" name="__codelineno-0-3757"></a>            <span class="n">tile_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_parquet</span><span class="p">(</span><span class="n">current_tile_features_path</span><span class="p">)</span>
</span><span id="__span-0-3758"><a id="__codelineno-0-3758" name="__codelineno-0-3758"></a>            <span class="k">return</span> <span class="n">tile_features</span>
</span><span id="__span-0-3759"><a id="__codelineno-0-3759" name="__codelineno-0-3759"></a>
</span><span id="__span-0-3760"><a id="__codelineno-0-3760" name="__codelineno-0-3760"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_local_decoded_spots</span><span class="p">(</span>
</span><span id="__span-0-3761"><a id="__codelineno-0-3761" name="__codelineno-0-3761"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3762"><a id="__codelineno-0-3762" name="__codelineno-0-3762"></a>        <span class="n">features_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="__span-0-3763"><a id="__codelineno-0-3763" name="__codelineno-0-3763"></a>        <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3764"><a id="__codelineno-0-3764" name="__codelineno-0-3764"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-3765"><a id="__codelineno-0-3765" name="__codelineno-0-3765"></a><span class="w">        </span><span class="sd">"""Save decoded spots and features for one tile.</span>
</span><span id="__span-0-3766"><a id="__codelineno-0-3766" name="__codelineno-0-3766"></a>
</span><span id="__span-0-3767"><a id="__codelineno-0-3767" name="__codelineno-0-3767"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3768"><a id="__codelineno-0-3768" name="__codelineno-0-3768"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3769"><a id="__codelineno-0-3769" name="__codelineno-0-3769"></a><span class="sd">        features_df : pd.DataFrame</span>
</span><span id="__span-0-3770"><a id="__codelineno-0-3770" name="__codelineno-0-3770"></a><span class="sd">            Decoded spots and features for one tile.</span>
</span><span id="__span-0-3771"><a id="__codelineno-0-3771" name="__codelineno-0-3771"></a><span class="sd">        tile : Union[int, str]</span>
</span><span id="__span-0-3772"><a id="__codelineno-0-3772" name="__codelineno-0-3772"></a><span class="sd">            Tile index or tile id.</span>
</span><span id="__span-0-3773"><a id="__codelineno-0-3773" name="__codelineno-0-3773"></a><span class="sd">        """</span>
</span><span id="__span-0-3774"><a id="__codelineno-0-3774" name="__codelineno-0-3774"></a>
</span><span id="__span-0-3775"><a id="__codelineno-0-3775" name="__codelineno-0-3775"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3776"><a id="__codelineno-0-3776" name="__codelineno-0-3776"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3777"><a id="__codelineno-0-3777" name="__codelineno-0-3777"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3778"><a id="__codelineno-0-3778" name="__codelineno-0-3778"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3779"><a id="__codelineno-0-3779" name="__codelineno-0-3779"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3780"><a id="__codelineno-0-3780" name="__codelineno-0-3780"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3781"><a id="__codelineno-0-3781" name="__codelineno-0-3781"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3782"><a id="__codelineno-0-3782" name="__codelineno-0-3782"></a>            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3783"><a id="__codelineno-0-3783" name="__codelineno-0-3783"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3784"><a id="__codelineno-0-3784" name="__codelineno-0-3784"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3785"><a id="__codelineno-0-3785" name="__codelineno-0-3785"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3786"><a id="__codelineno-0-3786" name="__codelineno-0-3786"></a>                <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3787"><a id="__codelineno-0-3787" name="__codelineno-0-3787"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3788"><a id="__codelineno-0-3788" name="__codelineno-0-3788"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3789"><a id="__codelineno-0-3789" name="__codelineno-0-3789"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3790"><a id="__codelineno-0-3790" name="__codelineno-0-3790"></a>
</span><span id="__span-0-3791"><a id="__codelineno-0-3791" name="__codelineno-0-3791"></a>        <span class="n">current_tile_features_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-3792"><a id="__codelineno-0-3792" name="__codelineno-0-3792"></a>            <span class="n">tile_id</span> <span class="o">+</span> <span class="s2">"_decoded_features.parquet"</span>
</span><span id="__span-0-3793"><a id="__codelineno-0-3793" name="__codelineno-0-3793"></a>        <span class="p">)</span>
</span><span id="__span-0-3794"><a id="__codelineno-0-3794" name="__codelineno-0-3794"></a>
</span><span id="__span-0-3795"><a id="__codelineno-0-3795" name="__codelineno-0-3795"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_parquet</span><span class="p">(</span><span class="n">features_df</span><span class="p">,</span> <span class="n">current_tile_features_path</span><span class="p">)</span>
</span><span id="__span-0-3796"><a id="__codelineno-0-3796" name="__codelineno-0-3796"></a>
</span><span id="__span-0-3797"><a id="__codelineno-0-3797" name="__codelineno-0-3797"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_global_filtered_decoded_spots</span><span class="p">(</span>
</span><span id="__span-0-3798"><a id="__codelineno-0-3798" name="__codelineno-0-3798"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3799"><a id="__codelineno-0-3799" name="__codelineno-0-3799"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="__span-0-3800"><a id="__codelineno-0-3800" name="__codelineno-0-3800"></a><span class="w">        </span><span class="sd">"""Load all decoded and filtered spots.</span>
</span><span id="__span-0-3801"><a id="__codelineno-0-3801" name="__codelineno-0-3801"></a>
</span><span id="__span-0-3802"><a id="__codelineno-0-3802" name="__codelineno-0-3802"></a><span class="sd">        Returns</span>
</span><span id="__span-0-3803"><a id="__codelineno-0-3803" name="__codelineno-0-3803"></a><span class="sd">        -------</span>
</span><span id="__span-0-3804"><a id="__codelineno-0-3804" name="__codelineno-0-3804"></a><span class="sd">        all_tiles_filtered : Optional[pd.DataFrame]</span>
</span><span id="__span-0-3805"><a id="__codelineno-0-3805" name="__codelineno-0-3805"></a><span class="sd">            All decoded and filtered spots.</span>
</span><span id="__span-0-3806"><a id="__codelineno-0-3806" name="__codelineno-0-3806"></a><span class="sd">        """</span>
</span><span id="__span-0-3807"><a id="__codelineno-0-3807" name="__codelineno-0-3807"></a>
</span><span id="__span-0-3808"><a id="__codelineno-0-3808" name="__codelineno-0-3808"></a>        <span class="n">current_global_filtered_decoded_dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-3809"><a id="__codelineno-0-3809" name="__codelineno-0-3809"></a>            <span class="s2">"all_tiles_filtered_decoded_features"</span>
</span><span id="__span-0-3810"><a id="__codelineno-0-3810" name="__codelineno-0-3810"></a>        <span class="p">)</span>
</span><span id="__span-0-3811"><a id="__codelineno-0-3811" name="__codelineno-0-3811"></a>        <span class="n">current_global_filtered_decoded_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-3812"><a id="__codelineno-0-3812" name="__codelineno-0-3812"></a>            <span class="n">current_global_filtered_decoded_dir_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"decoded_features.parquet"</span><span class="p">)</span>
</span><span id="__span-0-3813"><a id="__codelineno-0-3813" name="__codelineno-0-3813"></a>        <span class="p">)</span>
</span><span id="__span-0-3814"><a id="__codelineno-0-3814" name="__codelineno-0-3814"></a>
</span><span id="__span-0-3815"><a id="__codelineno-0-3815" name="__codelineno-0-3815"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_global_filtered_decoded_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3816"><a id="__codelineno-0-3816" name="__codelineno-0-3816"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Global, filtered, decoded spots not found."</span><span class="p">)</span>
</span><span id="__span-0-3817"><a id="__codelineno-0-3817" name="__codelineno-0-3817"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3818"><a id="__codelineno-0-3818" name="__codelineno-0-3818"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3819"><a id="__codelineno-0-3819" name="__codelineno-0-3819"></a>            <span class="n">all_tiles_filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_parquet</span><span class="p">(</span>
</span><span id="__span-0-3820"><a id="__codelineno-0-3820" name="__codelineno-0-3820"></a>                <span class="n">current_global_filtered_decoded_path</span>
</span><span id="__span-0-3821"><a id="__codelineno-0-3821" name="__codelineno-0-3821"></a>            <span class="p">)</span>
</span><span id="__span-0-3822"><a id="__codelineno-0-3822" name="__codelineno-0-3822"></a>            <span class="k">return</span> <span class="n">all_tiles_filtered</span>
</span><span id="__span-0-3823"><a id="__codelineno-0-3823" name="__codelineno-0-3823"></a>
</span><span id="__span-0-3824"><a id="__codelineno-0-3824" name="__codelineno-0-3824"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_global_filtered_decoded_spots</span><span class="p">(</span>
</span><span id="__span-0-3825"><a id="__codelineno-0-3825" name="__codelineno-0-3825"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3826"><a id="__codelineno-0-3826" name="__codelineno-0-3826"></a>        <span class="n">filtered_decoded_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="__span-0-3827"><a id="__codelineno-0-3827" name="__codelineno-0-3827"></a>    <span class="p">):</span>
</span><span id="__span-0-3828"><a id="__codelineno-0-3828" name="__codelineno-0-3828"></a><span class="w">        </span><span class="sd">"""Save all decoded and filtered spots.</span>
</span><span id="__span-0-3829"><a id="__codelineno-0-3829" name="__codelineno-0-3829"></a>
</span><span id="__span-0-3830"><a id="__codelineno-0-3830" name="__codelineno-0-3830"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3831"><a id="__codelineno-0-3831" name="__codelineno-0-3831"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3832"><a id="__codelineno-0-3832" name="__codelineno-0-3832"></a><span class="sd">        filtered_decoded_df : pd.DataFrame</span>
</span><span id="__span-0-3833"><a id="__codelineno-0-3833" name="__codelineno-0-3833"></a><span class="sd">            All decoded and filtered spots.</span>
</span><span id="__span-0-3834"><a id="__codelineno-0-3834" name="__codelineno-0-3834"></a><span class="sd">        """</span>
</span><span id="__span-0-3835"><a id="__codelineno-0-3835" name="__codelineno-0-3835"></a>
</span><span id="__span-0-3836"><a id="__codelineno-0-3836" name="__codelineno-0-3836"></a>        <span class="n">current_global_filtered_decoded_dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-3837"><a id="__codelineno-0-3837" name="__codelineno-0-3837"></a>            <span class="s2">"all_tiles_filtered_decoded_features"</span>
</span><span id="__span-0-3838"><a id="__codelineno-0-3838" name="__codelineno-0-3838"></a>        <span class="p">)</span>
</span><span id="__span-0-3839"><a id="__codelineno-0-3839" name="__codelineno-0-3839"></a>
</span><span id="__span-0-3840"><a id="__codelineno-0-3840" name="__codelineno-0-3840"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_global_filtered_decoded_dir_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3841"><a id="__codelineno-0-3841" name="__codelineno-0-3841"></a>            <span class="n">current_global_filtered_decoded_dir_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-3842"><a id="__codelineno-0-3842" name="__codelineno-0-3842"></a>
</span><span id="__span-0-3843"><a id="__codelineno-0-3843" name="__codelineno-0-3843"></a>        <span class="n">current_global_filtered_decoded_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-3844"><a id="__codelineno-0-3844" name="__codelineno-0-3844"></a>            <span class="n">current_global_filtered_decoded_dir_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"decoded_features.parquet"</span><span class="p">)</span>
</span><span id="__span-0-3845"><a id="__codelineno-0-3845" name="__codelineno-0-3845"></a>        <span class="p">)</span>
</span><span id="__span-0-3846"><a id="__codelineno-0-3846" name="__codelineno-0-3846"></a>
</span><span id="__span-0-3847"><a id="__codelineno-0-3847" name="__codelineno-0-3847"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_parquet</span><span class="p">(</span><span class="n">filtered_decoded_df</span><span class="p">,</span> <span class="n">current_global_filtered_decoded_path</span><span class="p">)</span>
</span><span id="__span-0-3848"><a id="__codelineno-0-3848" name="__codelineno-0-3848"></a>
</span><span id="__span-0-3849"><a id="__codelineno-0-3849" name="__codelineno-0-3849"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_global_cellpose_outlines</span><span class="p">(</span>
</span><span id="__span-0-3850"><a id="__codelineno-0-3850" name="__codelineno-0-3850"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3851"><a id="__codelineno-0-3851" name="__codelineno-0-3851"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="__span-0-3852"><a id="__codelineno-0-3852" name="__codelineno-0-3852"></a><span class="w">        </span><span class="sd">"""Load Cellpose max projection cell outlines.</span>
</span><span id="__span-0-3853"><a id="__codelineno-0-3853" name="__codelineno-0-3853"></a>
</span><span id="__span-0-3854"><a id="__codelineno-0-3854" name="__codelineno-0-3854"></a><span class="sd">        Returns</span>
</span><span id="__span-0-3855"><a id="__codelineno-0-3855" name="__codelineno-0-3855"></a><span class="sd">        -------</span>
</span><span id="__span-0-3856"><a id="__codelineno-0-3856" name="__codelineno-0-3856"></a><span class="sd">        cellpose_outlines : Optional[dict]</span>
</span><span id="__span-0-3857"><a id="__codelineno-0-3857" name="__codelineno-0-3857"></a><span class="sd">            Cellpose cell mask outlines.</span>
</span><span id="__span-0-3858"><a id="__codelineno-0-3858" name="__codelineno-0-3858"></a><span class="sd">        """</span>
</span><span id="__span-0-3859"><a id="__codelineno-0-3859" name="__codelineno-0-3859"></a>
</span><span id="__span-0-3860"><a id="__codelineno-0-3860" name="__codelineno-0-3860"></a>        <span class="n">current_cellpose_outlines_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-3861"><a id="__codelineno-0-3861" name="__codelineno-0-3861"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose"</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cell_outlines.json"</span><span class="p">)</span>
</span><span id="__span-0-3862"><a id="__codelineno-0-3862" name="__codelineno-0-3862"></a>        <span class="p">)</span>
</span><span id="__span-0-3863"><a id="__codelineno-0-3863" name="__codelineno-0-3863"></a>
</span><span id="__span-0-3864"><a id="__codelineno-0-3864" name="__codelineno-0-3864"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_cellpose_outlines_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3865"><a id="__codelineno-0-3865" name="__codelineno-0-3865"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Cellpose cell mask outlines not found."</span><span class="p">)</span>
</span><span id="__span-0-3866"><a id="__codelineno-0-3866" name="__codelineno-0-3866"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3867"><a id="__codelineno-0-3867" name="__codelineno-0-3867"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3868"><a id="__codelineno-0-3868" name="__codelineno-0-3868"></a>            <span class="n">cellpose_outlines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_microjson</span><span class="p">(</span>
</span><span id="__span-0-3869"><a id="__codelineno-0-3869" name="__codelineno-0-3869"></a>                <span class="n">current_cellpose_outlines_path</span>
</span><span id="__span-0-3870"><a id="__codelineno-0-3870" name="__codelineno-0-3870"></a>            <span class="p">)</span>
</span><span id="__span-0-3871"><a id="__codelineno-0-3871" name="__codelineno-0-3871"></a>            <span class="k">return</span> <span class="n">cellpose_outlines</span>
</span><span id="__span-0-3872"><a id="__codelineno-0-3872" name="__codelineno-0-3872"></a>
</span><span id="__span-0-3873"><a id="__codelineno-0-3873" name="__codelineno-0-3873"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_global_cellpose_segmentation_image</span><span class="p">(</span>
</span><span id="__span-0-3874"><a id="__codelineno-0-3874" name="__codelineno-0-3874"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3875"><a id="__codelineno-0-3875" name="__codelineno-0-3875"></a>        <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-3876"><a id="__codelineno-0-3876" name="__codelineno-0-3876"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-3877"><a id="__codelineno-0-3877" name="__codelineno-0-3877"></a><span class="w">        </span><span class="sd">"""Load Cellpose max projection, downsampled segmentation image.</span>
</span><span id="__span-0-3878"><a id="__codelineno-0-3878" name="__codelineno-0-3878"></a>
</span><span id="__span-0-3879"><a id="__codelineno-0-3879" name="__codelineno-0-3879"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3880"><a id="__codelineno-0-3880" name="__codelineno-0-3880"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3881"><a id="__codelineno-0-3881" name="__codelineno-0-3881"></a><span class="sd">        return_future : Optional[bool]</span>
</span><span id="__span-0-3882"><a id="__codelineno-0-3882" name="__codelineno-0-3882"></a><span class="sd">            Return future array.</span>
</span><span id="__span-0-3883"><a id="__codelineno-0-3883" name="__codelineno-0-3883"></a>
</span><span id="__span-0-3884"><a id="__codelineno-0-3884" name="__codelineno-0-3884"></a><span class="sd">        Returns</span>
</span><span id="__span-0-3885"><a id="__codelineno-0-3885" name="__codelineno-0-3885"></a><span class="sd">        -------</span>
</span><span id="__span-0-3886"><a id="__codelineno-0-3886" name="__codelineno-0-3886"></a><span class="sd">        fused_image : Optional[ArrayLike]</span>
</span><span id="__span-0-3887"><a id="__codelineno-0-3887" name="__codelineno-0-3887"></a><span class="sd">            Cellpose max projection, downsampled segmentation image.</span>
</span><span id="__span-0-3888"><a id="__codelineno-0-3888" name="__codelineno-0-3888"></a><span class="sd">        """</span>
</span><span id="__span-0-3889"><a id="__codelineno-0-3889" name="__codelineno-0-3889"></a>
</span><span id="__span-0-3890"><a id="__codelineno-0-3890" name="__codelineno-0-3890"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3891"><a id="__codelineno-0-3891" name="__codelineno-0-3891"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-3892"><a id="__codelineno-0-3892" name="__codelineno-0-3892"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose"</span><span class="p">)</span>
</span><span id="__span-0-3893"><a id="__codelineno-0-3893" name="__codelineno-0-3893"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose.zarr"</span><span class="p">)</span>
</span><span id="__span-0-3894"><a id="__codelineno-0-3894" name="__codelineno-0-3894"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"masks_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-3895"><a id="__codelineno-0-3895" name="__codelineno-0-3895"></a>        <span class="p">)</span>
</span><span id="__span-0-3896"><a id="__codelineno-0-3896" name="__codelineno-0-3896"></a>
</span><span id="__span-0-3897"><a id="__codelineno-0-3897" name="__codelineno-0-3897"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_local_zarr_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3898"><a id="__codelineno-0-3898" name="__codelineno-0-3898"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Cellpose prediction on global fused image not found."</span><span class="p">)</span>
</span><span id="__span-0-3899"><a id="__codelineno-0-3899" name="__codelineno-0-3899"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3900"><a id="__codelineno-0-3900" name="__codelineno-0-3900"></a>
</span><span id="__span-0-3901"><a id="__codelineno-0-3901" name="__codelineno-0-3901"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3902"><a id="__codelineno-0-3902" name="__codelineno-0-3902"></a>            <span class="n">fused_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3903"><a id="__codelineno-0-3903" name="__codelineno-0-3903"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3904"><a id="__codelineno-0-3904" name="__codelineno-0-3904"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-3905"><a id="__codelineno-0-3905" name="__codelineno-0-3905"></a>                <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3906"><a id="__codelineno-0-3906" name="__codelineno-0-3906"></a>            <span class="p">)</span>
</span><span id="__span-0-3907"><a id="__codelineno-0-3907" name="__codelineno-0-3907"></a>            <span class="k">return</span> <span class="n">fused_image</span>
</span><span id="__span-0-3908"><a id="__codelineno-0-3908" name="__codelineno-0-3908"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-3909"><a id="__codelineno-0-3909" name="__codelineno-0-3909"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error loading Cellpose image."</span><span class="p">)</span>
</span><span id="__span-0-3910"><a id="__codelineno-0-3910" name="__codelineno-0-3910"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3911"><a id="__codelineno-0-3911" name="__codelineno-0-3911"></a>
</span><span id="__span-0-3912"><a id="__codelineno-0-3912" name="__codelineno-0-3912"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_global_cellpose_segmentation_image</span><span class="p">(</span>
</span><span id="__span-0-3913"><a id="__codelineno-0-3913" name="__codelineno-0-3913"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3914"><a id="__codelineno-0-3914" name="__codelineno-0-3914"></a>        <span class="n">cellpose_image</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3915"><a id="__codelineno-0-3915" name="__codelineno-0-3915"></a>        <span class="n">downsampling</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-3916"><a id="__codelineno-0-3916" name="__codelineno-0-3916"></a>        <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-3917"><a id="__codelineno-0-3917" name="__codelineno-0-3917"></a>    <span class="p">):</span>
</span><span id="__span-0-3918"><a id="__codelineno-0-3918" name="__codelineno-0-3918"></a><span class="w">        </span><span class="sd">"""Save Cellpose max projection, downsampled segmentation image.</span>
</span><span id="__span-0-3919"><a id="__codelineno-0-3919" name="__codelineno-0-3919"></a>
</span><span id="__span-0-3920"><a id="__codelineno-0-3920" name="__codelineno-0-3920"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3921"><a id="__codelineno-0-3921" name="__codelineno-0-3921"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3922"><a id="__codelineno-0-3922" name="__codelineno-0-3922"></a><span class="sd">        cellpose_image : ArrayLike</span>
</span><span id="__span-0-3923"><a id="__codelineno-0-3923" name="__codelineno-0-3923"></a><span class="sd">            Cellpose max projection, downsampled segmentation image.</span>
</span><span id="__span-0-3924"><a id="__codelineno-0-3924" name="__codelineno-0-3924"></a><span class="sd">        downsampling : Sequence[float]</span>
</span><span id="__span-0-3925"><a id="__codelineno-0-3925" name="__codelineno-0-3925"></a><span class="sd">            Downsample factors.</span>
</span><span id="__span-0-3926"><a id="__codelineno-0-3926" name="__codelineno-0-3926"></a><span class="sd">        return_future : Optional[bool]</span>
</span><span id="__span-0-3927"><a id="__codelineno-0-3927" name="__codelineno-0-3927"></a><span class="sd">            Return future array.</span>
</span><span id="__span-0-3928"><a id="__codelineno-0-3928" name="__codelineno-0-3928"></a><span class="sd">        """</span>
</span><span id="__span-0-3929"><a id="__codelineno-0-3929" name="__codelineno-0-3929"></a>
</span><span id="__span-0-3930"><a id="__codelineno-0-3930" name="__codelineno-0-3930"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3931"><a id="__codelineno-0-3931" name="__codelineno-0-3931"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-3932"><a id="__codelineno-0-3932" name="__codelineno-0-3932"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose"</span><span class="p">)</span>
</span><span id="__span-0-3933"><a id="__codelineno-0-3933" name="__codelineno-0-3933"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose.zarr"</span><span class="p">)</span>
</span><span id="__span-0-3934"><a id="__codelineno-0-3934" name="__codelineno-0-3934"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"masks_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-3935"><a id="__codelineno-0-3935" name="__codelineno-0-3935"></a>        <span class="p">)</span>
</span><span id="__span-0-3936"><a id="__codelineno-0-3936" name="__codelineno-0-3936"></a>        <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3937"><a id="__codelineno-0-3937" name="__codelineno-0-3937"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-3938"><a id="__codelineno-0-3938" name="__codelineno-0-3938"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose"</span><span class="p">)</span>
</span><span id="__span-0-3939"><a id="__codelineno-0-3939" name="__codelineno-0-3939"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose.zarr"</span><span class="p">)</span>
</span><span id="__span-0-3940"><a id="__codelineno-0-3940" name="__codelineno-0-3940"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"masks_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-3941"><a id="__codelineno-0-3941" name="__codelineno-0-3941"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-3942"><a id="__codelineno-0-3942" name="__codelineno-0-3942"></a>        <span class="p">)</span>
</span><span id="__span-0-3943"><a id="__codelineno-0-3943" name="__codelineno-0-3943"></a>
</span><span id="__span-0-3944"><a id="__codelineno-0-3944" name="__codelineno-0-3944"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"downsampling"</span><span class="p">:</span> <span class="n">downsampling</span><span class="p">}</span>
</span><span id="__span-0-3945"><a id="__codelineno-0-3945" name="__codelineno-0-3945"></a>
</span><span id="__span-0-3946"><a id="__codelineno-0-3946" name="__codelineno-0-3946"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3947"><a id="__codelineno-0-3947" name="__codelineno-0-3947"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3948"><a id="__codelineno-0-3948" name="__codelineno-0-3948"></a>                <span class="n">cellpose_image</span><span class="p">,</span>
</span><span id="__span-0-3949"><a id="__codelineno-0-3949" name="__codelineno-0-3949"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3950"><a id="__codelineno-0-3950" name="__codelineno-0-3950"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-3951"><a id="__codelineno-0-3951" name="__codelineno-0-3951"></a>                <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3952"><a id="__codelineno-0-3952" name="__codelineno-0-3952"></a>            <span class="p">)</span>
</span><span id="__span-0-3953"><a id="__codelineno-0-3953" name="__codelineno-0-3953"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3954"><a id="__codelineno-0-3954" name="__codelineno-0-3954"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">):</span>
</span><span id="__span-0-3955"><a id="__codelineno-0-3955" name="__codelineno-0-3955"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving Cellpose image."</span><span class="p">)</span>
</span><span id="__span-0-3956"><a id="__codelineno-0-3956" name="__codelineno-0-3956"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3957"><a id="__codelineno-0-3957" name="__codelineno-0-3957"></a>
</span><span id="__span-0-3958"><a id="__codelineno-0-3958" name="__codelineno-0-3958"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_spots_prepped_for_baysor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prepped_for_baysor_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="__span-0-3959"><a id="__codelineno-0-3959" name="__codelineno-0-3959"></a><span class="w">        </span><span class="sd">"""Save spots prepped for Baysor.</span>
</span><span id="__span-0-3960"><a id="__codelineno-0-3960" name="__codelineno-0-3960"></a>
</span><span id="__span-0-3961"><a id="__codelineno-0-3961" name="__codelineno-0-3961"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-3962"><a id="__codelineno-0-3962" name="__codelineno-0-3962"></a><span class="sd">        ----------</span>
</span><span id="__span-0-3963"><a id="__codelineno-0-3963" name="__codelineno-0-3963"></a><span class="sd">        prepped_for_baysor_df : pd.DataFrame</span>
</span><span id="__span-0-3964"><a id="__codelineno-0-3964" name="__codelineno-0-3964"></a><span class="sd">            Spots prepped for Baysor.</span>
</span><span id="__span-0-3965"><a id="__codelineno-0-3965" name="__codelineno-0-3965"></a><span class="sd">        """</span>
</span><span id="__span-0-3966"><a id="__codelineno-0-3966" name="__codelineno-0-3966"></a>
</span><span id="__span-0-3967"><a id="__codelineno-0-3967" name="__codelineno-0-3967"></a>        <span class="n">current_global_filtered_decoded_dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-3968"><a id="__codelineno-0-3968" name="__codelineno-0-3968"></a>            <span class="s2">"all_tiles_filtered_decoded_features"</span>
</span><span id="__span-0-3969"><a id="__codelineno-0-3969" name="__codelineno-0-3969"></a>        <span class="p">)</span>
</span><span id="__span-0-3970"><a id="__codelineno-0-3970" name="__codelineno-0-3970"></a>
</span><span id="__span-0-3971"><a id="__codelineno-0-3971" name="__codelineno-0-3971"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_global_filtered_decoded_dir_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3972"><a id="__codelineno-0-3972" name="__codelineno-0-3972"></a>            <span class="n">current_global_filtered_decoded_dir_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-3973"><a id="__codelineno-0-3973" name="__codelineno-0-3973"></a>
</span><span id="__span-0-3974"><a id="__codelineno-0-3974" name="__codelineno-0-3974"></a>        <span class="n">current_global_filtered_decoded_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-3975"><a id="__codelineno-0-3975" name="__codelineno-0-3975"></a>            <span class="n">current_global_filtered_decoded_dir_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"transcripts.parquet"</span><span class="p">)</span>
</span><span id="__span-0-3976"><a id="__codelineno-0-3976" name="__codelineno-0-3976"></a>        <span class="p">)</span>
</span><span id="__span-0-3977"><a id="__codelineno-0-3977" name="__codelineno-0-3977"></a>
</span><span id="__span-0-3978"><a id="__codelineno-0-3978" name="__codelineno-0-3978"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_parquet</span><span class="p">(</span><span class="n">prepped_for_baysor_df</span><span class="p">,</span> <span class="n">current_global_filtered_decoded_path</span><span class="p">)</span>
</span><span id="__span-0-3979"><a id="__codelineno-0-3979" name="__codelineno-0-3979"></a>
</span><span id="__span-0-3980"><a id="__codelineno-0-3980" name="__codelineno-0-3980"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">run_baysor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-3981"><a id="__codelineno-0-3981" name="__codelineno-0-3981"></a><span class="w">        </span><span class="sd">"""Run Baysor"</span>
</span><span id="__span-0-3982"><a id="__codelineno-0-3982" name="__codelineno-0-3982"></a>
</span><span id="__span-0-3983"><a id="__codelineno-0-3983" name="__codelineno-0-3983"></a><span class="sd">        Assumes that spots are prepped for Baysor and the Baysor path and options are set.</span>
</span><span id="__span-0-3984"><a id="__codelineno-0-3984" name="__codelineno-0-3984"></a><span class="sd">        Reformats ROIs into ImageJ style ROIs for later use.</span>
</span><span id="__span-0-3985"><a id="__codelineno-0-3985" name="__codelineno-0-3985"></a><span class="sd">        """</span>
</span><span id="__span-0-3986"><a id="__codelineno-0-3986" name="__codelineno-0-3986"></a>
</span><span id="__span-0-3987"><a id="__codelineno-0-3987" name="__codelineno-0-3987"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
</span><span id="__span-0-3988"><a id="__codelineno-0-3988" name="__codelineno-0-3988"></a>
</span><span id="__span-0-3989"><a id="__codelineno-0-3989" name="__codelineno-0-3989"></a>        <span class="n">baysor_input_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"all_tiles_filtered_decoded_features"</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"transcripts.parquet"</span><span class="p">)</span>
</span><span id="__span-0-3990"><a id="__codelineno-0-3990" name="__codelineno-0-3990"></a>        <span class="n">baysor_output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"baysor"</span><span class="p">)</span>
</span><span id="__span-0-3991"><a id="__codelineno-0-3991" name="__codelineno-0-3991"></a>        <span class="n">baysor_output_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-3992"><a id="__codelineno-0-3992" name="__codelineno-0-3992"></a>
</span><span id="__span-0-3993"><a id="__codelineno-0-3993" name="__codelineno-0-3993"></a>        <span class="n">julia_threading</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"JULIA_NUM_THREADS="</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_julia_threads</span><span class="p">)</span><span class="o">+</span> <span class="s2">" "</span>
</span><span id="__span-0-3994"><a id="__codelineno-0-3994" name="__codelineno-0-3994"></a>        <span class="n">preview_baysor_options</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"preview -c "</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span><span class="p">)</span>
</span><span id="__span-0-3995"><a id="__codelineno-0-3995" name="__codelineno-0-3995"></a>        <span class="n">command</span> <span class="o">=</span> <span class="n">julia_threading</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="n">preview_baysor_options</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span>\
</span><span id="__span-0-3996"><a id="__codelineno-0-3996" name="__codelineno-0-3996"></a>            <span class="nb">str</span><span class="p">(</span><span class="n">baysor_input_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" -o "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">baysor_output_path</span><span class="p">)</span>
</span><span id="__span-0-3997"><a id="__codelineno-0-3997" name="__codelineno-0-3997"></a>
</span><span id="__span-0-3998"><a id="__codelineno-0-3998" name="__codelineno-0-3998"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3999"><a id="__codelineno-0-3999" name="__codelineno-0-3999"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-4000"><a id="__codelineno-0-4000" name="__codelineno-0-4000"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor finished with return code:"</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">)</span>
</span><span id="__span-0-4001"><a id="__codelineno-0-4001" name="__codelineno-0-4001"></a>        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-4002"><a id="__codelineno-0-4002" name="__codelineno-0-4002"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor failed with:"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-4003"><a id="__codelineno-0-4003" name="__codelineno-0-4003"></a>
</span><span id="__span-0-4004"><a id="__codelineno-0-4004" name="__codelineno-0-4004"></a>        <span class="c1"># first try to run Baysor assuming that prior segmentations are present               </span>
</span><span id="__span-0-4005"><a id="__codelineno-0-4005" name="__codelineno-0-4005"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-4006"><a id="__codelineno-0-4006" name="__codelineno-0-4006"></a>            <span class="n">run_baysor_options</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"run -p -c "</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span><span class="p">)</span>
</span><span id="__span-0-4007"><a id="__codelineno-0-4007" name="__codelineno-0-4007"></a>            <span class="n">command</span> <span class="o">=</span> <span class="n">julia_threading</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="n">run_baysor_options</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span>\
</span><span id="__span-0-4008"><a id="__codelineno-0-4008" name="__codelineno-0-4008"></a>                <span class="nb">str</span><span class="p">(</span><span class="n">baysor_input_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" -o "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">baysor_output_path</span><span class="p">)</span> <span class="o">+</span> \
</span><span id="__span-0-4009"><a id="__codelineno-0-4009" name="__codelineno-0-4009"></a>                <span class="s2">" --polygon-format GeometryCollectionLegacy --count-matrix-format tsv :cell_id"</span>
</span><span id="__span-0-4010"><a id="__codelineno-0-4010" name="__codelineno-0-4010"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-4011"><a id="__codelineno-0-4011" name="__codelineno-0-4011"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor finished with return code:"</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">)</span>
</span><span id="__span-0-4012"><a id="__codelineno-0-4012" name="__codelineno-0-4012"></a>        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
</span><span id="__span-0-4013"><a id="__codelineno-0-4013" name="__codelineno-0-4013"></a>            <span class="c1"># then fall back and run without prior segmentations.</span>
</span><span id="__span-0-4014"><a id="__codelineno-0-4014" name="__codelineno-0-4014"></a>            <span class="c1"># IMPORTANT: the .toml file has to be defined correctly for this to work!</span>
</span><span id="__span-0-4015"><a id="__codelineno-0-4015" name="__codelineno-0-4015"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-4016"><a id="__codelineno-0-4016" name="__codelineno-0-4016"></a>                <span class="n">run_baysor_options</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"run -p -c "</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span><span class="p">)</span>
</span><span id="__span-0-4017"><a id="__codelineno-0-4017" name="__codelineno-0-4017"></a>                <span class="n">command</span> <span class="o">=</span> <span class="n">julia_threading</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="n">run_baysor_options</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span>\
</span><span id="__span-0-4018"><a id="__codelineno-0-4018" name="__codelineno-0-4018"></a>                    <span class="nb">str</span><span class="p">(</span><span class="n">baysor_input_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" -o "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">baysor_output_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" --count-matrix-format tsv"</span>
</span><span id="__span-0-4019"><a id="__codelineno-0-4019" name="__codelineno-0-4019"></a>                <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-4020"><a id="__codelineno-0-4020" name="__codelineno-0-4020"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor finished with return code:"</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">)</span>
</span><span id="__span-0-4021"><a id="__codelineno-0-4021" name="__codelineno-0-4021"></a>            <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-4022"><a id="__codelineno-0-4022" name="__codelineno-0-4022"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor failed with:"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-4023"><a id="__codelineno-0-4023" name="__codelineno-0-4023"></a>
</span><span id="__span-0-4024"><a id="__codelineno-0-4024" name="__codelineno-0-4024"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reformat_baysor_3D_oultines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-4025"><a id="__codelineno-0-4025" name="__codelineno-0-4025"></a><span class="w">        </span><span class="sd">"""Reformat baysor 3D json file into ImageJ ROIs."""</span>
</span><span id="__span-0-4026"><a id="__codelineno-0-4026" name="__codelineno-0-4026"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="__span-0-4027"><a id="__codelineno-0-4027" name="__codelineno-0-4027"></a>
</span><span id="__span-0-4028"><a id="__codelineno-0-4028" name="__codelineno-0-4028"></a>        <span class="c1"># Load the JSON file</span>
</span><span id="__span-0-4029"><a id="__codelineno-0-4029" name="__codelineno-0-4029"></a>        <span class="n">baysor_output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"baysor"</span><span class="p">)</span>
</span><span id="__span-0-4030"><a id="__codelineno-0-4030" name="__codelineno-0-4030"></a>        <span class="n">baysor_segmentation</span> <span class="o">=</span> <span class="n">baysor_output_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"segmentation_polygons_3d.json"</span><span class="p">)</span>
</span><span id="__span-0-4031"><a id="__codelineno-0-4031" name="__codelineno-0-4031"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">baysor_segmentation</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="__span-0-4032"><a id="__codelineno-0-4032" name="__codelineno-0-4032"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="__span-0-4033"><a id="__codelineno-0-4033" name="__codelineno-0-4033"></a>
</span><span id="__span-0-4034"><a id="__codelineno-0-4034" name="__codelineno-0-4034"></a>
</span><span id="__span-0-4035"><a id="__codelineno-0-4035" name="__codelineno-0-4035"></a>        <span class="c1"># Dictionary to group polygons by cell ID</span>
</span><span id="__span-0-4036"><a id="__codelineno-0-4036" name="__codelineno-0-4036"></a>        <span class="n">cell_polygons</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="__span-0-4037"><a id="__codelineno-0-4037" name="__codelineno-0-4037"></a>
</span><span id="__span-0-4038"><a id="__codelineno-0-4038" name="__codelineno-0-4038"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">parse_z_range</span><span class="p">(</span><span class="n">z_range</span><span class="p">):</span>
</span><span id="__span-0-4039"><a id="__codelineno-0-4039" name="__codelineno-0-4039"></a>            <span class="n">cleaned_range</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">"[^\d.,-]"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="n">z_range</span><span class="p">)</span>  <span class="c1"># Remove non-numeric, non-period, non-comma, non-dash characters</span>
</span><span id="__span-0-4040"><a id="__codelineno-0-4040" name="__codelineno-0-4040"></a>            <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">cleaned_range</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">))</span>
</span><span id="__span-0-4041"><a id="__codelineno-0-4041" name="__codelineno-0-4041"></a>
</span><span id="__span-0-4042"><a id="__codelineno-0-4042" name="__codelineno-0-4042"></a>        <span class="c1"># Iterate through each z-plane and corresponding polygons</span>
</span><span id="__span-0-4043"><a id="__codelineno-0-4043" name="__codelineno-0-4043"></a>        <span class="k">for</span> <span class="n">z_range</span><span class="p">,</span> <span class="n">details</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-4044"><a id="__codelineno-0-4044" name="__codelineno-0-4044"></a>            <span class="n">z_start</span><span class="p">,</span> <span class="n">z_end</span> <span class="o">=</span> <span class="n">parse_z_range</span><span class="p">(</span><span class="n">z_range</span><span class="p">)</span>
</span><span id="__span-0-4045"><a id="__codelineno-0-4045" name="__codelineno-0-4045"></a>
</span><span id="__span-0-4046"><a id="__codelineno-0-4046" name="__codelineno-0-4046"></a>            <span class="k">for</span> <span class="n">geometry</span> <span class="ow">in</span> <span class="n">details</span><span class="p">[</span><span class="s2">"geometries"</span><span class="p">]:</span>
</span><span id="__span-0-4047"><a id="__codelineno-0-4047" name="__codelineno-0-4047"></a>                <span class="n">coordinates</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">"coordinates"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Assuming the outer ring of the polygon</span>
</span><span id="__span-0-4048"><a id="__codelineno-0-4048" name="__codelineno-0-4048"></a>                <span class="n">cell_id</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">"cell"</span><span class="p">]</span>  <span class="c1"># Get the cell ID</span>
</span><span id="__span-0-4049"><a id="__codelineno-0-4049" name="__codelineno-0-4049"></a>
</span><span id="__span-0-4050"><a id="__codelineno-0-4050" name="__codelineno-0-4050"></a>                <span class="c1"># Store the polygon with its z-range</span>
</span><span id="__span-0-4051"><a id="__codelineno-0-4051" name="__codelineno-0-4051"></a>                <span class="n">cell_polygons</span><span class="p">[</span><span class="n">cell_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-0-4052"><a id="__codelineno-0-4052" name="__codelineno-0-4052"></a>                    <span class="s2">"z_start"</span><span class="p">:</span> <span class="n">z_start</span><span class="p">,</span>
</span><span id="__span-0-4053"><a id="__codelineno-0-4053" name="__codelineno-0-4053"></a>                    <span class="s2">"z_end"</span><span class="p">:</span> <span class="n">z_end</span><span class="p">,</span>
</span><span id="__span-0-4054"><a id="__codelineno-0-4054" name="__codelineno-0-4054"></a>                    <span class="s2">"coordinates"</span><span class="p">:</span> <span class="n">coordinates</span>
</span><span id="__span-0-4055"><a id="__codelineno-0-4055" name="__codelineno-0-4055"></a>                <span class="p">})</span>
</span><span id="__span-0-4056"><a id="__codelineno-0-4056" name="__codelineno-0-4056"></a>
</span><span id="__span-0-4057"><a id="__codelineno-0-4057" name="__codelineno-0-4057"></a>        <span class="n">rois</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-4058"><a id="__codelineno-0-4058" name="__codelineno-0-4058"></a>
</span><span id="__span-0-4059"><a id="__codelineno-0-4059" name="__codelineno-0-4059"></a>        <span class="c1"># Process each cell ID to create 3D ROIs</span>
</span><span id="__span-0-4060"><a id="__codelineno-0-4060" name="__codelineno-0-4060"></a>        <span class="k">for</span> <span class="n">cell_id</span><span class="p">,</span> <span class="n">polygons</span> <span class="ow">in</span> <span class="n">cell_polygons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-4061"><a id="__codelineno-0-4061" name="__codelineno-0-4061"></a>            <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polygons</span><span class="p">):</span>
</span><span id="__span-0-4062"><a id="__codelineno-0-4062" name="__codelineno-0-4062"></a>                <span class="n">x_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">[</span><span class="s2">"coordinates"</span><span class="p">]]</span>
</span><span id="__span-0-4063"><a id="__codelineno-0-4063" name="__codelineno-0-4063"></a>                <span class="n">y_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">[</span><span class="s2">"coordinates"</span><span class="p">]]</span>
</span><span id="__span-0-4064"><a id="__codelineno-0-4064" name="__codelineno-0-4064"></a>
</span><span id="__span-0-4065"><a id="__codelineno-0-4065" name="__codelineno-0-4065"></a>
</span><span id="__span-0-4066"><a id="__codelineno-0-4066" name="__codelineno-0-4066"></a>                <span class="n">z_start</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">[</span><span class="s2">"z_start"</span><span class="p">]</span>
</span><span id="__span-0-4067"><a id="__codelineno-0-4067" name="__codelineno-0-4067"></a>                <span class="n">z_end</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">[</span><span class="s2">"z_end"</span><span class="p">]</span>
</span><span id="__span-0-4068"><a id="__codelineno-0-4068" name="__codelineno-0-4068"></a>
</span><span id="__span-0-4069"><a id="__codelineno-0-4069" name="__codelineno-0-4069"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-4070"><a id="__codelineno-0-4070" name="__codelineno-0-4070"></a>                    <span class="c1"># Create an ImageJRoi object for the polygon using frompoints</span>
</span><span id="__span-0-4071"><a id="__codelineno-0-4071" name="__codelineno-0-4071"></a>                    <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">))</span>  <span class="c1"># List of (x, y) tuples</span>
</span><span id="__span-0-4072"><a id="__codelineno-0-4072" name="__codelineno-0-4072"></a>                    <span class="n">roi</span> <span class="o">=</span> <span class="n">ImagejRoi</span><span class="o">.</span><span class="n">frompoints</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
</span><span id="__span-0-4073"><a id="__codelineno-0-4073" name="__codelineno-0-4073"></a>                    <span class="n">roi</span><span class="o">.</span><span class="n">roitype</span> <span class="o">=</span> <span class="n">ROI_TYPE</span><span class="o">.</span><span class="n">POLYGON</span>  <span class="c1"># Set the ROI type to Polygon</span>
</span><span id="__span-0-4074"><a id="__codelineno-0-4074" name="__codelineno-0-4074"></a>                    <span class="n">roi</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">coords</span>  <span class="c1"># Explicitly assign coordinates to the ROI</span>
</span><span id="__span-0-4075"><a id="__codelineno-0-4075" name="__codelineno-0-4075"></a>                    <span class="n">roi</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"cell_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">cell_id</span><span class="p">)</span><span class="si">}</span><span class="s2">_zstart_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">z_start</span><span class="p">)</span><span class="si">}</span><span class="s2">_zend_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">z_end</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>  <span class="c1"># Ensure unique name</span>
</span><span id="__span-0-4076"><a id="__codelineno-0-4076" name="__codelineno-0-4076"></a>                    <span class="n">rois</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>
</span><span id="__span-0-4077"><a id="__codelineno-0-4077" name="__codelineno-0-4077"></a>                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-4078"><a id="__codelineno-0-4078" name="__codelineno-0-4078"></a>                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error while creating ROI for cell ID </span><span class="si">{</span><span class="n">cell_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-0-4079"><a id="__codelineno-0-4079" name="__codelineno-0-4079"></a>
</span><span id="__span-0-4080"><a id="__codelineno-0-4080" name="__codelineno-0-4080"></a>        <span class="c1"># Write all ROIs to a ZIP file   </span>
</span><span id="__span-0-4081"><a id="__codelineno-0-4081" name="__codelineno-0-4081"></a>        <span class="n">output_file</span> <span class="o">=</span> <span class="n">baysor_output_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"3d_cell_rois.zip"</span><span class="p">)</span>
</span><span id="__span-0-4082"><a id="__codelineno-0-4082" name="__codelineno-0-4082"></a>        <span class="n">roiwrite</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">rois</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">'w'</span><span class="p">)</span>
</span><span id="__span-0-4083"><a id="__codelineno-0-4083" name="__codelineno-0-4083"></a>
</span><span id="__span-0-4084"><a id="__codelineno-0-4084" name="__codelineno-0-4084"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_global_baysor_filtered_spots</span><span class="p">(</span>
</span><span id="__span-0-4085"><a id="__codelineno-0-4085" name="__codelineno-0-4085"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-4086"><a id="__codelineno-0-4086" name="__codelineno-0-4086"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="__span-0-4087"><a id="__codelineno-0-4087" name="__codelineno-0-4087"></a><span class="w">        </span><span class="sd">"""Load Baysor re-assigned decoded RNA.</span>
</span><span id="__span-0-4088"><a id="__codelineno-0-4088" name="__codelineno-0-4088"></a>
</span><span id="__span-0-4089"><a id="__codelineno-0-4089" name="__codelineno-0-4089"></a><span class="sd">        Assumes Baysor has been run.</span>
</span><span id="__span-0-4090"><a id="__codelineno-0-4090" name="__codelineno-0-4090"></a>
</span><span id="__span-0-4091"><a id="__codelineno-0-4091" name="__codelineno-0-4091"></a><span class="sd">        Returns</span>
</span><span id="__span-0-4092"><a id="__codelineno-0-4092" name="__codelineno-0-4092"></a><span class="sd">        -------</span>
</span><span id="__span-0-4093"><a id="__codelineno-0-4093" name="__codelineno-0-4093"></a><span class="sd">        baysor_filtered_genes : Optional[pd.DataFrame]</span>
</span><span id="__span-0-4094"><a id="__codelineno-0-4094" name="__codelineno-0-4094"></a><span class="sd">            Baysor re-assigned decoded RNA.</span>
</span><span id="__span-0-4095"><a id="__codelineno-0-4095" name="__codelineno-0-4095"></a><span class="sd">        """</span>
</span><span id="__span-0-4096"><a id="__codelineno-0-4096" name="__codelineno-0-4096"></a>
</span><span id="__span-0-4097"><a id="__codelineno-0-4097" name="__codelineno-0-4097"></a>        <span class="n">current_baysor_spots_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-4098"><a id="__codelineno-0-4098" name="__codelineno-0-4098"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-4099"><a id="__codelineno-0-4099" name="__codelineno-0-4099"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"baysor"</span><span class="p">)</span>
</span><span id="__span-0-4100"><a id="__codelineno-0-4100" name="__codelineno-0-4100"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"segmentation.csv"</span><span class="p">)</span>
</span><span id="__span-0-4101"><a id="__codelineno-0-4101" name="__codelineno-0-4101"></a>        <span class="p">)</span>
</span><span id="__span-0-4102"><a id="__codelineno-0-4102" name="__codelineno-0-4102"></a>
</span><span id="__span-0-4103"><a id="__codelineno-0-4103" name="__codelineno-0-4103"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_baysor_spots_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-4104"><a id="__codelineno-0-4104" name="__codelineno-0-4104"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor filtered genes not found."</span><span class="p">)</span>
</span><span id="__span-0-4105"><a id="__codelineno-0-4105" name="__codelineno-0-4105"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-4106"><a id="__codelineno-0-4106" name="__codelineno-0-4106"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-4107"><a id="__codelineno-0-4107" name="__codelineno-0-4107"></a>            <span class="n">baysor_filtered_genes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_csv</span><span class="p">(</span><span class="n">current_baysor_spots_path</span><span class="p">)</span>
</span><span id="__span-0-4108"><a id="__codelineno-0-4108" name="__codelineno-0-4108"></a>            <span class="k">return</span> <span class="n">baysor_filtered_genes</span>
</span><span id="__span-0-4109"><a id="__codelineno-0-4109" name="__codelineno-0-4109"></a>
</span><span id="__span-0-4110"><a id="__codelineno-0-4110" name="__codelineno-0-4110"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">load_global_baysor_outlines</span><span class="p">(</span>
</span><span id="__span-0-4111"><a id="__codelineno-0-4111" name="__codelineno-0-4111"></a>        <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-4112"><a id="__codelineno-0-4112" name="__codelineno-0-4112"></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="__span-0-4113"><a id="__codelineno-0-4113" name="__codelineno-0-4113"></a><span class="w">        </span><span class="sd">"""Load Baysor cell outlines.</span>
</span><span id="__span-0-4114"><a id="__codelineno-0-4114" name="__codelineno-0-4114"></a>
</span><span id="__span-0-4115"><a id="__codelineno-0-4115" name="__codelineno-0-4115"></a><span class="sd">        Assumes Baysor has been run.</span>
</span><span id="__span-0-4116"><a id="__codelineno-0-4116" name="__codelineno-0-4116"></a>
</span><span id="__span-0-4117"><a id="__codelineno-0-4117" name="__codelineno-0-4117"></a><span class="sd">        Returns</span>
</span><span id="__span-0-4118"><a id="__codelineno-0-4118" name="__codelineno-0-4118"></a><span class="sd">        -------</span>
</span><span id="__span-0-4119"><a id="__codelineno-0-4119" name="__codelineno-0-4119"></a><span class="sd">        baysor_outlines : Optional[dict]</span>
</span><span id="__span-0-4120"><a id="__codelineno-0-4120" name="__codelineno-0-4120"></a><span class="sd">            Baysor cell outlines.</span>
</span><span id="__span-0-4121"><a id="__codelineno-0-4121" name="__codelineno-0-4121"></a><span class="sd">        """</span>
</span><span id="__span-0-4122"><a id="__codelineno-0-4122" name="__codelineno-0-4122"></a>
</span><span id="__span-0-4123"><a id="__codelineno-0-4123" name="__codelineno-0-4123"></a>        <span class="n">current_baysor_outlines_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-4124"><a id="__codelineno-0-4124" name="__codelineno-0-4124"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span> 
</span><span id="__span-0-4125"><a id="__codelineno-0-4125" name="__codelineno-0-4125"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"baysor"</span><span class="p">)</span> 
</span><span id="__span-0-4126"><a id="__codelineno-0-4126" name="__codelineno-0-4126"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"3d_cell_rois.zip"</span><span class="p">)</span>
</span><span id="__span-0-4127"><a id="__codelineno-0-4127" name="__codelineno-0-4127"></a>        <span class="p">)</span>
</span><span id="__span-0-4128"><a id="__codelineno-0-4128" name="__codelineno-0-4128"></a>
</span><span id="__span-0-4129"><a id="__codelineno-0-4129" name="__codelineno-0-4129"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="n">current_baysor_outlines_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-4130"><a id="__codelineno-0-4130" name="__codelineno-0-4130"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor outlines not found."</span><span class="p">)</span>
</span><span id="__span-0-4131"><a id="__codelineno-0-4131" name="__codelineno-0-4131"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-4132"><a id="__codelineno-0-4132" name="__codelineno-0-4132"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-4133"><a id="__codelineno-0-4133" name="__codelineno-0-4133"></a>            <span class="n">baysor_rois</span> <span class="o">=</span> <span class="n">roiread</span><span class="p">(</span><span class="n">current_baysor_outlines_path</span><span class="p">)</span>
</span><span id="__span-0-4134"><a id="__codelineno-0-4134" name="__codelineno-0-4134"></a>            <span class="k">return</span> <span class="n">baysor_rois</span>
</span><span id="__span-0-4135"><a id="__codelineno-0-4135" name="__codelineno-0-4135"></a>
</span><span id="__span-0-4136"><a id="__codelineno-0-4136" name="__codelineno-0-4136"></a>    <span class="nd">@staticmethod</span>
</span><span id="__span-0-4137"><a id="__codelineno-0-4137" name="__codelineno-0-4137"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">_roi_to_shapely</span><span class="p">(</span><span class="n">roi</span><span class="p">):</span>
</span><span id="__span-0-4138"><a id="__codelineno-0-4138" name="__codelineno-0-4138"></a>        <span class="k">return</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">subpixel_coordinates</span><span class="p">[:,</span> <span class="p">::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-4139"><a id="__codelineno-0-4139" name="__codelineno-0-4139"></a>
</span><span id="__span-0-4140"><a id="__codelineno-0-4140" name="__codelineno-0-4140"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">reprocess_and_save_filtered_spots_with_baysor_outlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-4141"><a id="__codelineno-0-4141" name="__codelineno-0-4141"></a><span class="w">        </span><span class="sd">"""Reprocess filtered spots using baysor cell outlines, then save.</span>
</span><span id="__span-0-4142"><a id="__codelineno-0-4142" name="__codelineno-0-4142"></a>
</span><span id="__span-0-4143"><a id="__codelineno-0-4143" name="__codelineno-0-4143"></a><span class="sd">        Loads the 3D cell outlines from Baysor, checks all points to see what </span>
</span><span id="__span-0-4144"><a id="__codelineno-0-4144" name="__codelineno-0-4144"></a><span class="sd">        (if any) cell outline that the spot falls within, and then saves the</span>
</span><span id="__span-0-4145"><a id="__codelineno-0-4145" name="__codelineno-0-4145"></a><span class="sd">        data back to the datastore.</span>
</span><span id="__span-0-4146"><a id="__codelineno-0-4146" name="__codelineno-0-4146"></a><span class="sd">        """</span>
</span><span id="__span-0-4147"><a id="__codelineno-0-4147" name="__codelineno-0-4147"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">rtree</span><span class="w"> </span><span class="kn">import</span> <span class="n">index</span>
</span><span id="__span-0-4148"><a id="__codelineno-0-4148" name="__codelineno-0-4148"></a>        <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="__span-0-4149"><a id="__codelineno-0-4149" name="__codelineno-0-4149"></a>
</span><span id="__span-0-4150"><a id="__codelineno-0-4150" name="__codelineno-0-4150"></a>        <span class="n">rois</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_global_baysor_outlines</span><span class="p">()</span>
</span><span id="__span-0-4151"><a id="__codelineno-0-4151" name="__codelineno-0-4151"></a>        <span class="n">filtered_spots_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_global_filtered_decoded_spots</span><span class="p">()</span>
</span><span id="__span-0-4152"><a id="__codelineno-0-4152" name="__codelineno-0-4152"></a>
</span><span id="__span-0-4153"><a id="__codelineno-0-4153" name="__codelineno-0-4153"></a>        <span class="n">parsed_spots_df</span> <span class="o">=</span> <span class="n">filtered_spots_df</span><span class="p">[</span>
</span><span id="__span-0-4154"><a id="__codelineno-0-4154" name="__codelineno-0-4154"></a>                <span class="p">[</span>
</span><span id="__span-0-4155"><a id="__codelineno-0-4155" name="__codelineno-0-4155"></a>                    <span class="s2">"gene_id"</span><span class="p">,</span>
</span><span id="__span-0-4156"><a id="__codelineno-0-4156" name="__codelineno-0-4156"></a>                    <span class="s2">"global_z"</span><span class="p">,</span>
</span><span id="__span-0-4157"><a id="__codelineno-0-4157" name="__codelineno-0-4157"></a>                    <span class="s2">"global_y"</span><span class="p">,</span>
</span><span id="__span-0-4158"><a id="__codelineno-0-4158" name="__codelineno-0-4158"></a>                    <span class="s2">"global_x"</span><span class="p">,</span>
</span><span id="__span-0-4159"><a id="__codelineno-0-4159" name="__codelineno-0-4159"></a>                    <span class="s2">"cell_id"</span><span class="p">,</span>
</span><span id="__span-0-4160"><a id="__codelineno-0-4160" name="__codelineno-0-4160"></a>                    <span class="s2">"tile_idx"</span><span class="p">,</span>
</span><span id="__span-0-4161"><a id="__codelineno-0-4161" name="__codelineno-0-4161"></a>                <span class="p">]</span>
</span><span id="__span-0-4162"><a id="__codelineno-0-4162" name="__codelineno-0-4162"></a>        <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-0-4163"><a id="__codelineno-0-4163" name="__codelineno-0-4163"></a>        <span class="n">parsed_spots_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="__span-0-4164"><a id="__codelineno-0-4164" name="__codelineno-0-4164"></a>            <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-0-4165"><a id="__codelineno-0-4165" name="__codelineno-0-4165"></a>                <span class="s2">"global_x"</span><span class="p">:</span> <span class="s2">"x"</span><span class="p">,</span>
</span><span id="__span-0-4166"><a id="__codelineno-0-4166" name="__codelineno-0-4166"></a>                <span class="s2">"global_y"</span><span class="p">:</span> <span class="s2">"y"</span><span class="p">,</span>
</span><span id="__span-0-4167"><a id="__codelineno-0-4167" name="__codelineno-0-4167"></a>                <span class="s2">"global_z"</span><span class="p">:</span> <span class="s2">"z"</span><span class="p">,</span>
</span><span id="__span-0-4168"><a id="__codelineno-0-4168" name="__codelineno-0-4168"></a>                <span class="s2">"gene_id"</span> <span class="p">:</span> <span class="s2">"gene"</span><span class="p">,</span>
</span><span id="__span-0-4169"><a id="__codelineno-0-4169" name="__codelineno-0-4169"></a>                <span class="s2">"cell_id"</span> <span class="p">:</span> <span class="s2">"cell"</span><span class="p">,</span>
</span><span id="__span-0-4170"><a id="__codelineno-0-4170" name="__codelineno-0-4170"></a>            <span class="p">},</span>
</span><span id="__span-0-4171"><a id="__codelineno-0-4171" name="__codelineno-0-4171"></a>            <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-4172"><a id="__codelineno-0-4172" name="__codelineno-0-4172"></a>        <span class="p">)</span>
</span><span id="__span-0-4173"><a id="__codelineno-0-4173" name="__codelineno-0-4173"></a>        <span class="n">parsed_spots_df</span><span class="p">[</span><span class="s2">"transcript_id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">hash_pandas_object</span><span class="p">(</span>
</span><span id="__span-0-4174"><a id="__codelineno-0-4174" name="__codelineno-0-4174"></a>            <span class="n">parsed_spots_df</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
</span><span id="__span-0-4175"><a id="__codelineno-0-4175" name="__codelineno-0-4175"></a>        <span class="p">)</span>
</span><span id="__span-0-4176"><a id="__codelineno-0-4176" name="__codelineno-0-4176"></a>
</span><span id="__span-0-4177"><a id="__codelineno-0-4177" name="__codelineno-0-4177"></a>        <span class="n">parsed_spots_df</span><span class="p">[</span><span class="s2">"assignment_confidence"</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="__span-0-4178"><a id="__codelineno-0-4178" name="__codelineno-0-4178"></a>
</span><span id="__span-0-4179"><a id="__codelineno-0-4179" name="__codelineno-0-4179"></a>        <span class="c1"># Create spatial index for ROIs</span>
</span><span id="__span-0-4180"><a id="__codelineno-0-4180" name="__codelineno-0-4180"></a>        <span class="n">roi_index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">Index</span><span class="p">()</span>
</span><span id="__span-0-4181"><a id="__codelineno-0-4181" name="__codelineno-0-4181"></a>        <span class="n">roi_map</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Map index IDs to ROIs</span>
</span><span id="__span-0-4182"><a id="__codelineno-0-4182" name="__codelineno-0-4182"></a>
</span><span id="__span-0-4183"><a id="__codelineno-0-4183" name="__codelineno-0-4183"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">roi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rois</span><span class="p">):</span>
</span><span id="__span-0-4184"><a id="__codelineno-0-4184" name="__codelineno-0-4184"></a>            <span class="c1"># Ensure roi.coordinates contains the polygon points</span>
</span><span id="__span-0-4185"><a id="__codelineno-0-4185" name="__codelineno-0-4185"></a>            <span class="n">coords</span> <span class="o">=</span> <span class="n">roi</span><span class="o">.</span><span class="n">coordinates</span><span class="p">()</span>
</span><span id="__span-0-4186"><a id="__codelineno-0-4186" name="__codelineno-0-4186"></a>
</span><span id="__span-0-4187"><a id="__codelineno-0-4187" name="__codelineno-0-4187"></a>            <span class="c1"># Insert the polygon bounds into the spatial index</span>
</span><span id="__span-0-4188"><a id="__codelineno-0-4188" name="__codelineno-0-4188"></a>            <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
</span><span id="__span-0-4189"><a id="__codelineno-0-4189" name="__codelineno-0-4189"></a>            <span class="n">roi_index</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">polygon</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>  <span class="c1"># Use polygon bounds for indexing</span>
</span><span id="__span-0-4190"><a id="__codelineno-0-4190" name="__codelineno-0-4190"></a>            <span class="n">roi_map</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">roi</span>
</span><span id="__span-0-4191"><a id="__codelineno-0-4191" name="__codelineno-0-4191"></a>
</span><span id="__span-0-4192"><a id="__codelineno-0-4192" name="__codelineno-0-4192"></a>        <span class="c1"># Function to check a single point</span>
</span><span id="__span-0-4193"><a id="__codelineno-0-4193" name="__codelineno-0-4193"></a>        <span class="k">def</span><span class="w"> </span><span class="nf">point_in_roi</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
</span><span id="__span-0-4194"><a id="__codelineno-0-4194" name="__codelineno-0-4194"></a>            <span class="n">point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">"y"</span><span class="p">])</span>
</span><span id="__span-0-4195"><a id="__codelineno-0-4195" name="__codelineno-0-4195"></a>            <span class="n">candidate_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">roi_index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">bounds</span><span class="p">))</span>  <span class="c1"># Search spatial index</span>
</span><span id="__span-0-4196"><a id="__codelineno-0-4196" name="__codelineno-0-4196"></a>            <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">candidate_indices</span><span class="p">:</span>
</span><span id="__span-0-4197"><a id="__codelineno-0-4197" name="__codelineno-0-4197"></a>                <span class="n">roi</span> <span class="o">=</span> <span class="n">roi_map</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="__span-0-4198"><a id="__codelineno-0-4198" name="__codelineno-0-4198"></a>                <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">"zstart_([-\d.]+)_zend_([-\d.]+)"</span><span class="p">,</span> <span class="n">roi</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-0-4199"><a id="__codelineno-0-4199" name="__codelineno-0-4199"></a>                <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
</span><span id="__span-0-4200"><a id="__codelineno-0-4200" name="__codelineno-0-4200"></a>                    <span class="n">z_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-0-4201"><a id="__codelineno-0-4201" name="__codelineno-0-4201"></a>                    <span class="n">z_end</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-4202"><a id="__codelineno-0-4202" name="__codelineno-0-4202"></a>                    <span class="k">if</span> <span class="n">z_start</span> <span class="o">&lt;=</span> <span class="n">row</span><span class="p">[</span><span class="s2">"z"</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">z_end</span><span class="p">:</span>
</span><span id="__span-0-4203"><a id="__codelineno-0-4203" name="__codelineno-0-4203"></a>                        <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">coordinates</span><span class="p">())</span>
</span><span id="__span-0-4204"><a id="__codelineno-0-4204" name="__codelineno-0-4204"></a>                        <span class="k">if</span> <span class="n">polygon</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
</span><span id="__span-0-4205"><a id="__codelineno-0-4205" name="__codelineno-0-4205"></a>                            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> 
</span><span id="__span-0-4206"><a id="__codelineno-0-4206" name="__codelineno-0-4206"></a>            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-0-4207"><a id="__codelineno-0-4207" name="__codelineno-0-4207"></a>
</span><span id="__span-0-4208"><a id="__codelineno-0-4208" name="__codelineno-0-4208"></a>        <span class="c1"># Apply optimized spatial lookup</span>
</span><span id="__span-0-4209"><a id="__codelineno-0-4209" name="__codelineno-0-4209"></a>        <span class="n">parsed_spots_df</span><span class="p">[</span><span class="s2">"cell"</span><span class="p">]</span> <span class="o">=</span> <span class="n">parsed_spots_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">point_in_roi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-4210"><a id="__codelineno-0-4210" name="__codelineno-0-4210"></a>        <span class="n">parsed_spots_df</span> <span class="o">=</span> <span class="n">parsed_spots_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">parsed_spots_df</span><span class="p">[</span><span class="s2">"cell"</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-4211"><a id="__codelineno-0-4211" name="__codelineno-0-4211"></a>
</span><span id="__span-0-4212"><a id="__codelineno-0-4212" name="__codelineno-0-4212"></a>        <span class="n">current_global_filtered_decoded_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-4213"><a id="__codelineno-0-4213" name="__codelineno-0-4213"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> 
</span><span id="__span-0-4214"><a id="__codelineno-0-4214" name="__codelineno-0-4214"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"all_tiles_filtered_decoded_features"</span><span class="p">)</span>
</span><span id="__span-0-4215"><a id="__codelineno-0-4215" name="__codelineno-0-4215"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"refined_transcripts.parquet"</span><span class="p">)</span>
</span><span id="__span-0-4216"><a id="__codelineno-0-4216" name="__codelineno-0-4216"></a>        <span class="p">)</span>
</span><span id="__span-0-4217"><a id="__codelineno-0-4217" name="__codelineno-0-4217"></a>
</span><span id="__span-0-4218"><a id="__codelineno-0-4218" name="__codelineno-0-4218"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_parquet</span><span class="p">(</span><span class="n">parsed_spots_df</span><span class="p">,</span> <span class="n">current_global_filtered_decoded_path</span><span class="p">)</span>
</span><span id="__span-0-4219"><a id="__codelineno-0-4219" name="__codelineno-0-4219"></a>
</span><span id="__span-0-4220"><a id="__codelineno-0-4220" name="__codelineno-0-4220"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">save_mtx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spots_source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"baysor"</span><span class="p">):</span>
</span><span id="__span-0-4221"><a id="__codelineno-0-4221" name="__codelineno-0-4221"></a><span class="w">        </span><span class="sd">"""Save mtx file for downstream analysis. Assumes Baysor has been run.</span>
</span><span id="__span-0-4222"><a id="__codelineno-0-4222" name="__codelineno-0-4222"></a>
</span><span id="__span-0-4223"><a id="__codelineno-0-4223" name="__codelineno-0-4223"></a><span class="sd">        Parameters</span>
</span><span id="__span-0-4224"><a id="__codelineno-0-4224" name="__codelineno-0-4224"></a><span class="sd">        ----------</span>
</span><span id="__span-0-4225"><a id="__codelineno-0-4225" name="__codelineno-0-4225"></a><span class="sd">        spots_source: str, default "baysor"</span>
</span><span id="__span-0-4226"><a id="__codelineno-0-4226" name="__codelineno-0-4226"></a><span class="sd">            source of spots. "baysor" or "resegmented".</span>
</span><span id="__span-0-4227"><a id="__codelineno-0-4227" name="__codelineno-0-4227"></a><span class="sd">        """</span>
</span><span id="__span-0-4228"><a id="__codelineno-0-4228" name="__codelineno-0-4228"></a>
</span><span id="__span-0-4229"><a id="__codelineno-0-4229" name="__codelineno-0-4229"></a>        <span class="kn">from</span><span class="w"> </span><span class="nn">merfish3danalysis.utils.dataio</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_mtx</span>
</span><span id="__span-0-4230"><a id="__codelineno-0-4230" name="__codelineno-0-4230"></a>
</span><span id="__span-0-4231"><a id="__codelineno-0-4231" name="__codelineno-0-4231"></a>        <span class="k">if</span> <span class="n">spots_source</span> <span class="o">==</span> <span class="s2">"baysor"</span><span class="p">:</span>
</span><span id="__span-0-4232"><a id="__codelineno-0-4232" name="__codelineno-0-4232"></a>            <span class="n">spots_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"segmentation"</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"baysor"</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"segmentation.csv"</span><span class="p">)</span>
</span><span id="__span-0-4233"><a id="__codelineno-0-4233" name="__codelineno-0-4233"></a>        <span class="k">elif</span> <span class="n">spots_source</span> <span class="o">==</span> <span class="s2">"resegmented"</span><span class="p">:</span>
</span><span id="__span-0-4234"><a id="__codelineno-0-4234" name="__codelineno-0-4234"></a>            <span class="n">spots_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-4235"><a id="__codelineno-0-4235" name="__codelineno-0-4235"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> 
</span><span id="__span-0-4236"><a id="__codelineno-0-4236" name="__codelineno-0-4236"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"all_tiles_filtered_decoded_features"</span><span class="p">)</span>
</span><span id="__span-0-4237"><a id="__codelineno-0-4237" name="__codelineno-0-4237"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"refined_transcripts.parquet"</span><span class="p">)</span>
</span><span id="__span-0-4238"><a id="__codelineno-0-4238" name="__codelineno-0-4238"></a>            <span class="p">)</span>
</span><span id="__span-0-4239"><a id="__codelineno-0-4239" name="__codelineno-0-4239"></a>
</span><span id="__span-0-4240"><a id="__codelineno-0-4240" name="__codelineno-0-4240"></a>        <span class="n">mtx_output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"mtx_output"</span><span class="p">)</span>
</span><span id="__span-0-4241"><a id="__codelineno-0-4241" name="__codelineno-0-4241"></a>
</span><span id="__span-0-4242"><a id="__codelineno-0-4242" name="__codelineno-0-4242"></a>        <span class="n">create_mtx</span><span class="p">(</span>
</span><span id="__span-0-4243"><a id="__codelineno-0-4243" name="__codelineno-0-4243"></a>            <span class="n">spots_path</span><span class="o">=</span><span class="n">spots_path</span><span class="p">,</span>
</span><span id="__span-0-4244"><a id="__codelineno-0-4244" name="__codelineno-0-4244"></a>            <span class="n">output_dir_path</span><span class="o">=</span><span class="n">mtx_output_path</span><span class="p">,</span>
</span><span id="__span-0-4245"><a id="__codelineno-0-4245" name="__codelineno-0-4245"></a>        <span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> <div class="doc doc-children"> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.baysor_options"> <code class="highlight language-python"><span class="n">baysor_options</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Baysor options</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>baysor_options</code></td> <td> <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Baysor options.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.baysor_path"> <code class="highlight language-python"><span class="n">baysor_path</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Baysor path</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>baysor_path</code></td> <td> <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Baysor path.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.binning"> <code class="highlight language-python"><span class="n">binning</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Camera binning.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>binning</code></td> <td> <code><span title="int">int</span></code> </td> <td> <div class="doc-md-description"> <p>Camera binning.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.bit_ids"> <code class="highlight language-python"><span class="n">bit_ids</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents"> <p>Bit IDs.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>bit_ids</code></td> <td> <code><span title="typing.Collection">Collection</span>[<span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Bit IDs.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.camera_model"> <code class="highlight language-python"><span class="n">camera_model</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Camera model.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>camera_model</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Camera model.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.channel_psfs"> <code class="highlight language-python"><span class="n">channel_psfs</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Channel point spread functions (PSF).</p> <details class="return" open=""> <summary>Return</summary> <p>channel_psfs : ArrayLike Channel point spread functions (PSF).</p> </details> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.channel_shading_maps"> <code class="highlight language-python"><span class="n">channel_shading_maps</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Channel shaiding images.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>channel_shading_maps</code></td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Channel shading images.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.channels_in_data"> <code class="highlight language-python"><span class="n">channels_in_data</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Channel indices.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>channels_in_data</code></td> <td> <code><span title="typing.Collection">Collection</span>[<span title="int">int</span>]</code> </td> <td> <div class="doc-md-description"> <p>Channel indices.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.codebook"> <code class="highlight language-python"><span class="n">codebook</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Codebook.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>codebook</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class="doc-md-description"> <p>Codebook.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.datastore_state"> <code class="highlight language-python"><span class="n">datastore_state</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Datastore state.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>datastore_state</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="dict">dict</span>]</code> </td> <td> <div class="doc-md-description"> <p>Datastore state.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.e_per_ADU"> <code class="highlight language-python"><span class="n">e_per_ADU</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Electrons per camera ADU.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>e_per_ADU</code></td> <td> <code><span title="float">float</span></code> </td> <td> <div class="doc-md-description"> <p>Electrons per camera ADU.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.experiment_order"> <code class="highlight language-python"><span class="n">experiment_order</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Round and bit order.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>experiment_order</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class="doc-md-description"> <p>Round and bit order.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.global_background_vector"> <code class="highlight language-python"><span class="n">global_background_vector</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Global background vector.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>global_background_vector</code></td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Global background vector.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.global_normalization_vector"> <code class="highlight language-python"><span class="n">global_normalization_vector</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Global normalization vector.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>global_normalization_vector</code></td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Global normalization vector.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.iterative_background_vector"> <code class="highlight language-python"><span class="n">iterative_background_vector</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Iterative background vector.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>iterative_background_vector</code></td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Iterative background vector.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.iterative_normalization_vector"> <code class="highlight language-python"><span class="n">iterative_normalization_vector</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Iterative normalization vector.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>iterative_normalization_vector</code></td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Iterative normalization vector.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.julia_threads"> <code class="highlight language-python"><span class="n">julia_threads</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Julia thread number</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>julia_threads</code></td> <td> <code><span title="int">int</span></code> </td> <td> <div class="doc-md-description"> <p>Julia thread number.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.microscope_type"> <code class="highlight language-python"><span class="n">microscope_type</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Microscope type.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>microscope_type</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Microscope type.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.na"> <code class="highlight language-python"><span class="n">na</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Detection objective numerical aperture (NA).</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>na</code></td> <td> <code><span title="float">float</span></code> </td> <td> <div class="doc-md-description"> <p>Detection objective numerical aperture (NA).</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.noise_map"> <code class="highlight language-python"><span class="n">noise_map</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Camera noise image.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>noise_map</code></td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Camera noise image.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.num_bits"> <code class="highlight language-python"><span class="n">num_bits</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Number of bits.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>num_bits</code></td> <td> <code><span title="int">int</span></code> </td> <td> <div class="doc-md-description"> <p>Number of bits.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.num_rounds"> <code class="highlight language-python"><span class="n">num_rounds</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Number of rounds.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>num_rounds</code></td> <td> <code><span title="int">int</span></code> </td> <td> <div class="doc-md-description"> <p>Number of rounds.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.num_tiles"> <code class="highlight language-python"><span class="n">num_tiles</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Number of tiles.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>num_tiles</code></td> <td> <code><span title="int">int</span></code> </td> <td> <div class="doc-md-description"> <p>Number of tiles.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.ri"> <code class="highlight language-python"><span class="n">ri</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Detection objective refractive index (RI).</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>ri</code></td> <td> <code><span title="float">float</span></code> </td> <td> <div class="doc-md-description"> <p>Detection objective refractive index (RI).</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.round_ids"> <code class="highlight language-python"><span class="n">round_ids</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents"> <p>Round IDs.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>round_ids</code></td> <td> <code><span title="typing.Collection">Collection</span>[<span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Round IDs.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.tile_ids"> <code class="highlight language-python"><span class="n">tile_ids</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> </span> </h3> <div class="doc doc-contents"> <p>Tile IDs.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>tile_ids</code></td> <td> <code><span title="typing.Collection">Collection</span>[<span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile IDs.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.tile_overlap"> <code class="highlight language-python"><span class="n">tile_overlap</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>XY tile overlap.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>tile_overlap</code></td> <td> <code><span title="float">float</span></code> </td> <td> <div class="doc-md-description"> <p>XY tile overlap.</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-attribute"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.voxel_size_zyx_um"> <code class="highlight language-python"><span class="n">voxel_size_zyx_um</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-property"><code>property</code></small> <small class="doc doc-label doc-label-writable"><code>writable</code></small> </span> </h3> <div class="doc doc-contents"> <p>Voxel size, zyx order (microns).</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>voxel_size_zyx_um</code></td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Voxel size, zyx order (microns).</p> </div> </td> </tr> </tbody> </table> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore._check_for_zarr_array"> <code class="highlight language-python"><span class="n">_check_for_zarr_array</span><span class="p">(</span><span class="n">kvstore</span><span class="p">,</span> <span class="n">spec</span><span class="p">)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents"> <p>Check if zarr array exists using Tensortore.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>kvstore</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Datastore location.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>spec</code> </td> <td> <code><span title="dict">dict</span></code> </td> <td> <div class="doc-md-description"> <p>Zarr specification.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1075">1075</a></span>
<span class="normal"><a href="#__codelineno-0-1076">1076</a></span>
<span class="normal"><a href="#__codelineno-0-1077">1077</a></span>
<span class="normal"><a href="#__codelineno-0-1078">1078</a></span>
<span class="normal"><a href="#__codelineno-0-1079">1079</a></span>
<span class="normal"><a href="#__codelineno-0-1080">1080</a></span>
<span class="normal"><a href="#__codelineno-0-1081">1081</a></span>
<span class="normal"><a href="#__codelineno-0-1082">1082</a></span>
<span class="normal"><a href="#__codelineno-0-1083">1083</a></span>
<span class="normal"><a href="#__codelineno-0-1084">1084</a></span>
<span class="normal"><a href="#__codelineno-0-1085">1085</a></span>
<span class="normal"><a href="#__codelineno-0-1086">1086</a></span>
<span class="normal"><a href="#__codelineno-0-1087">1087</a></span>
<span class="normal"><a href="#__codelineno-0-1088">1088</a></span>
<span class="normal"><a href="#__codelineno-0-1089">1089</a></span>
<span class="normal"><a href="#__codelineno-0-1090">1090</a></span>
<span class="normal"><a href="#__codelineno-0-1091">1091</a></span>
<span class="normal"><a href="#__codelineno-0-1092">1092</a></span>
<span class="normal"><a href="#__codelineno-0-1093">1093</a></span>
<span class="normal"><a href="#__codelineno-0-1094">1094</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1075"><a id="__codelineno-0-1075" name="__codelineno-0-1075"></a><span class="nd">@staticmethod</span>
</span><span id="__span-0-1076"><a id="__codelineno-0-1076" name="__codelineno-0-1076"></a><span class="k">def</span><span class="w"> </span><span class="nf">_check_for_zarr_array</span><span class="p">(</span><span class="n">kvstore</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
</span><span id="__span-0-1077"><a id="__codelineno-0-1077" name="__codelineno-0-1077"></a><span class="w">    </span><span class="sd">"""Check if zarr array exists using Tensortore.</span>
</span><span id="__span-0-1078"><a id="__codelineno-0-1078" name="__codelineno-0-1078"></a>
</span><span id="__span-0-1079"><a id="__codelineno-0-1079" name="__codelineno-0-1079"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-1080"><a id="__codelineno-0-1080" name="__codelineno-0-1080"></a><span class="sd">    ----------</span>
</span><span id="__span-0-1081"><a id="__codelineno-0-1081" name="__codelineno-0-1081"></a><span class="sd">    kvstore : Union[Path, str]</span>
</span><span id="__span-0-1082"><a id="__codelineno-0-1082" name="__codelineno-0-1082"></a><span class="sd">        Datastore location.</span>
</span><span id="__span-0-1083"><a id="__codelineno-0-1083" name="__codelineno-0-1083"></a><span class="sd">    spec : dict</span>
</span><span id="__span-0-1084"><a id="__codelineno-0-1084" name="__codelineno-0-1084"></a><span class="sd">        Zarr specification.</span>
</span><span id="__span-0-1085"><a id="__codelineno-0-1085" name="__codelineno-0-1085"></a><span class="sd">    """</span>
</span><span id="__span-0-1086"><a id="__codelineno-0-1086" name="__codelineno-0-1086"></a>
</span><span id="__span-0-1087"><a id="__codelineno-0-1087" name="__codelineno-0-1087"></a>    <span class="n">current_zarr</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
</span><span id="__span-0-1088"><a id="__codelineno-0-1088" name="__codelineno-0-1088"></a>        <span class="p">{</span>
</span><span id="__span-0-1089"><a id="__codelineno-0-1089" name="__codelineno-0-1089"></a>            <span class="o">**</span><span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-1090"><a id="__codelineno-0-1090" name="__codelineno-0-1090"></a>            <span class="s2">"kvstore"</span><span class="p">:</span> <span class="n">kvstore</span><span class="p">,</span>
</span><span id="__span-0-1091"><a id="__codelineno-0-1091" name="__codelineno-0-1091"></a>        <span class="p">}</span>
</span><span id="__span-0-1092"><a id="__codelineno-0-1092" name="__codelineno-0-1092"></a>    <span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-0-1093"><a id="__codelineno-0-1093" name="__codelineno-0-1093"></a>
</span><span id="__span-0-1094"><a id="__codelineno-0-1094" name="__codelineno-0-1094"></a>    <span class="k">del</span> <span class="n">current_zarr</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore._get_kvstore_key"> <code class="highlight language-python"><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">path</span><span class="p">)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents"> <p>Convert datastore location to tensorstore kvstore key.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>path</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Datastore location.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>kvstore_key</code></td> <td> <code><span title="dict">dict</span></code> </td> <td> <div class="doc-md-description"> <p>Tensorstore kvstore key.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-984"> 984</a></span>
<span class="normal"><a href="#__codelineno-0-985"> 985</a></span>
<span class="normal"><a href="#__codelineno-0-986"> 986</a></span>
<span class="normal"><a href="#__codelineno-0-987"> 987</a></span>
<span class="normal"><a href="#__codelineno-0-988"> 988</a></span>
<span class="normal"><a href="#__codelineno-0-989"> 989</a></span>
<span class="normal"><a href="#__codelineno-0-990"> 990</a></span>
<span class="normal"><a href="#__codelineno-0-991"> 991</a></span>
<span class="normal"><a href="#__codelineno-0-992"> 992</a></span>
<span class="normal"><a href="#__codelineno-0-993"> 993</a></span>
<span class="normal"><a href="#__codelineno-0-994"> 994</a></span>
<span class="normal"><a href="#__codelineno-0-995"> 995</a></span>
<span class="normal"><a href="#__codelineno-0-996"> 996</a></span>
<span class="normal"><a href="#__codelineno-0-997"> 997</a></span>
<span class="normal"><a href="#__codelineno-0-998"> 998</a></span>
<span class="normal"><a href="#__codelineno-0-999"> 999</a></span>
<span class="normal"><a href="#__codelineno-0-1000">1000</a></span>
<span class="normal"><a href="#__codelineno-0-1001">1001</a></span>
<span class="normal"><a href="#__codelineno-0-1002">1002</a></span>
<span class="normal"><a href="#__codelineno-0-1003">1003</a></span>
<span class="normal"><a href="#__codelineno-0-1004">1004</a></span>
<span class="normal"><a href="#__codelineno-0-1005">1005</a></span>
<span class="normal"><a href="#__codelineno-0-1006">1006</a></span>
<span class="normal"><a href="#__codelineno-0-1007">1007</a></span>
<span class="normal"><a href="#__codelineno-0-1008">1008</a></span>
<span class="normal"><a href="#__codelineno-0-1009">1009</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-984"><a id="__codelineno-0-984" name="__codelineno-0-984"></a><span class="nd">@staticmethod</span>
</span><span id="__span-0-985"><a id="__codelineno-0-985" name="__codelineno-0-985"></a><span class="k">def</span><span class="w"> </span><span class="nf">_get_kvstore_key</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-0-986"><a id="__codelineno-0-986" name="__codelineno-0-986"></a><span class="w">    </span><span class="sd">"""Convert datastore location to tensorstore kvstore key.</span>
</span><span id="__span-0-987"><a id="__codelineno-0-987" name="__codelineno-0-987"></a>
</span><span id="__span-0-988"><a id="__codelineno-0-988" name="__codelineno-0-988"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-989"><a id="__codelineno-0-989" name="__codelineno-0-989"></a><span class="sd">    ----------</span>
</span><span id="__span-0-990"><a id="__codelineno-0-990" name="__codelineno-0-990"></a><span class="sd">    path : Union[Path, str]</span>
</span><span id="__span-0-991"><a id="__codelineno-0-991" name="__codelineno-0-991"></a><span class="sd">        Datastore location.</span>
</span><span id="__span-0-992"><a id="__codelineno-0-992" name="__codelineno-0-992"></a>
</span><span id="__span-0-993"><a id="__codelineno-0-993" name="__codelineno-0-993"></a><span class="sd">    Returns</span>
</span><span id="__span-0-994"><a id="__codelineno-0-994" name="__codelineno-0-994"></a><span class="sd">    -------</span>
</span><span id="__span-0-995"><a id="__codelineno-0-995" name="__codelineno-0-995"></a><span class="sd">    kvstore_key : dict</span>
</span><span id="__span-0-996"><a id="__codelineno-0-996" name="__codelineno-0-996"></a><span class="sd">        Tensorstore kvstore key.</span>
</span><span id="__span-0-997"><a id="__codelineno-0-997" name="__codelineno-0-997"></a><span class="sd">    """</span>
</span><span id="__span-0-998"><a id="__codelineno-0-998" name="__codelineno-0-998"></a>
</span><span id="__span-0-999"><a id="__codelineno-0-999" name="__codelineno-0-999"></a>    <span class="n">path_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
</span><span id="__span-0-1000"><a id="__codelineno-0-1000" name="__codelineno-0-1000"></a>    <span class="k">if</span> <span class="n">path_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"s3://"</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">"s3.amazonaws.com"</span> <span class="ow">in</span> <span class="n">path_str</span><span class="p">:</span>
</span><span id="__span-0-1001"><a id="__codelineno-0-1001" name="__codelineno-0-1001"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"s3"</span><span class="p">,</span> <span class="s2">"path"</span><span class="p">:</span> <span class="n">path_str</span><span class="p">}</span>
</span><span id="__span-0-1002"><a id="__codelineno-0-1002" name="__codelineno-0-1002"></a>    <span class="k">elif</span> <span class="n">path_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"gs://"</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">"storage.googleapis.com"</span> <span class="ow">in</span> <span class="n">path_str</span><span class="p">:</span>
</span><span id="__span-0-1003"><a id="__codelineno-0-1003" name="__codelineno-0-1003"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"gcs"</span><span class="p">,</span> <span class="s2">"path"</span><span class="p">:</span> <span class="n">path_str</span><span class="p">}</span>
</span><span id="__span-0-1004"><a id="__codelineno-0-1004" name="__codelineno-0-1004"></a>    <span class="k">elif</span> <span class="n">path_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"azure://"</span><span class="p">)</span> <span class="ow">or</span> <span class="s2">"blob.core.windows.net"</span> <span class="ow">in</span> <span class="n">path_str</span><span class="p">:</span>
</span><span id="__span-0-1005"><a id="__codelineno-0-1005" name="__codelineno-0-1005"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"azure"</span><span class="p">,</span> <span class="s2">"path"</span><span class="p">:</span> <span class="n">path_str</span><span class="p">}</span>
</span><span id="__span-0-1006"><a id="__codelineno-0-1006" name="__codelineno-0-1006"></a>    <span class="k">elif</span> <span class="n">path_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"http://"</span><span class="p">)</span> <span class="ow">or</span> <span class="n">path_str</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">"https://"</span><span class="p">):</span>
</span><span id="__span-0-1007"><a id="__codelineno-0-1007" name="__codelineno-0-1007"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">"Unsupported cloud storage provider in URL"</span><span class="p">)</span>
</span><span id="__span-0-1008"><a id="__codelineno-0-1008" name="__codelineno-0-1008"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1009"><a id="__codelineno-0-1009" name="__codelineno-0-1009"></a>        <span class="k">return</span> <span class="p">{</span><span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"file"</span><span class="p">,</span> <span class="s2">"path"</span><span class="p">:</span> <span class="n">path_str</span><span class="p">}</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore._init_datastore"> <code class="highlight language-python"><span class="n">_init_datastore</span><span class="p">()</span></code> </h3> <div class="doc doc-contents"> <p>Initialize datastore.</p> <p>Create directory structure and initialize datastore state.</p> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-928">928</a></span>
<span class="normal"><a href="#__codelineno-0-929">929</a></span>
<span class="normal"><a href="#__codelineno-0-930">930</a></span>
<span class="normal"><a href="#__codelineno-0-931">931</a></span>
<span class="normal"><a href="#__codelineno-0-932">932</a></span>
<span class="normal"><a href="#__codelineno-0-933">933</a></span>
<span class="normal"><a href="#__codelineno-0-934">934</a></span>
<span class="normal"><a href="#__codelineno-0-935">935</a></span>
<span class="normal"><a href="#__codelineno-0-936">936</a></span>
<span class="normal"><a href="#__codelineno-0-937">937</a></span>
<span class="normal"><a href="#__codelineno-0-938">938</a></span>
<span class="normal"><a href="#__codelineno-0-939">939</a></span>
<span class="normal"><a href="#__codelineno-0-940">940</a></span>
<span class="normal"><a href="#__codelineno-0-941">941</a></span>
<span class="normal"><a href="#__codelineno-0-942">942</a></span>
<span class="normal"><a href="#__codelineno-0-943">943</a></span>
<span class="normal"><a href="#__codelineno-0-944">944</a></span>
<span class="normal"><a href="#__codelineno-0-945">945</a></span>
<span class="normal"><a href="#__codelineno-0-946">946</a></span>
<span class="normal"><a href="#__codelineno-0-947">947</a></span>
<span class="normal"><a href="#__codelineno-0-948">948</a></span>
<span class="normal"><a href="#__codelineno-0-949">949</a></span>
<span class="normal"><a href="#__codelineno-0-950">950</a></span>
<span class="normal"><a href="#__codelineno-0-951">951</a></span>
<span class="normal"><a href="#__codelineno-0-952">952</a></span>
<span class="normal"><a href="#__codelineno-0-953">953</a></span>
<span class="normal"><a href="#__codelineno-0-954">954</a></span>
<span class="normal"><a href="#__codelineno-0-955">955</a></span>
<span class="normal"><a href="#__codelineno-0-956">956</a></span>
<span class="normal"><a href="#__codelineno-0-957">957</a></span>
<span class="normal"><a href="#__codelineno-0-958">958</a></span>
<span class="normal"><a href="#__codelineno-0-959">959</a></span>
<span class="normal"><a href="#__codelineno-0-960">960</a></span>
<span class="normal"><a href="#__codelineno-0-961">961</a></span>
<span class="normal"><a href="#__codelineno-0-962">962</a></span>
<span class="normal"><a href="#__codelineno-0-963">963</a></span>
<span class="normal"><a href="#__codelineno-0-964">964</a></span>
<span class="normal"><a href="#__codelineno-0-965">965</a></span>
<span class="normal"><a href="#__codelineno-0-966">966</a></span>
<span class="normal"><a href="#__codelineno-0-967">967</a></span>
<span class="normal"><a href="#__codelineno-0-968">968</a></span>
<span class="normal"><a href="#__codelineno-0-969">969</a></span>
<span class="normal"><a href="#__codelineno-0-970">970</a></span>
<span class="normal"><a href="#__codelineno-0-971">971</a></span>
<span class="normal"><a href="#__codelineno-0-972">972</a></span>
<span class="normal"><a href="#__codelineno-0-973">973</a></span>
<span class="normal"><a href="#__codelineno-0-974">974</a></span>
<span class="normal"><a href="#__codelineno-0-975">975</a></span>
<span class="normal"><a href="#__codelineno-0-976">976</a></span>
<span class="normal"><a href="#__codelineno-0-977">977</a></span>
<span class="normal"><a href="#__codelineno-0-978">978</a></span>
<span class="normal"><a href="#__codelineno-0-979">979</a></span>
<span class="normal"><a href="#__codelineno-0-980">980</a></span>
<span class="normal"><a href="#__codelineno-0-981">981</a></span>
<span class="normal"><a href="#__codelineno-0-982">982</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-928"><a id="__codelineno-0-928" name="__codelineno-0-928"></a><span class="k">def</span><span class="w"> </span><span class="nf">_init_datastore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-929"><a id="__codelineno-0-929" name="__codelineno-0-929"></a><span class="w">    </span><span class="sd">"""Initialize datastore.</span>
</span><span id="__span-0-930"><a id="__codelineno-0-930" name="__codelineno-0-930"></a>
</span><span id="__span-0-931"><a id="__codelineno-0-931" name="__codelineno-0-931"></a><span class="sd">    Create directory structure and initialize datastore state.</span>
</span><span id="__span-0-932"><a id="__codelineno-0-932" name="__codelineno-0-932"></a><span class="sd">    """</span>
</span><span id="__span-0-933"><a id="__codelineno-0-933" name="__codelineno-0-933"></a>
</span><span id="__span-0-934"><a id="__codelineno-0-934" name="__codelineno-0-934"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-935"><a id="__codelineno-0-935" name="__codelineno-0-935"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"calibrations.zarr"</span><span class="p">)</span>
</span><span id="__span-0-936"><a id="__codelineno-0-936" name="__codelineno-0-936"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-937"><a id="__codelineno-0-937" name="__codelineno-0-937"></a>    <span class="n">calibrations_zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-938"><a id="__codelineno-0-938" name="__codelineno-0-938"></a>    <span class="n">empty_zattrs</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-939"><a id="__codelineno-0-939" name="__codelineno-0-939"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">empty_zattrs</span><span class="p">,</span> <span class="n">calibrations_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-940"><a id="__codelineno-0-940" name="__codelineno-0-940"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"polyDT"</span><span class="p">)</span>
</span><span id="__span-0-941"><a id="__codelineno-0-941" name="__codelineno-0-941"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-942"><a id="__codelineno-0-942" name="__codelineno-0-942"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"readouts"</span><span class="p">)</span>
</span><span id="__span-0-943"><a id="__codelineno-0-943" name="__codelineno-0-943"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-944"><a id="__codelineno-0-944" name="__codelineno-0-944"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-945"><a id="__codelineno-0-945" name="__codelineno-0-945"></a>        <span class="sa">r</span><span class="s2">"ufish_localizations"</span>
</span><span id="__span-0-946"><a id="__codelineno-0-946" name="__codelineno-0-946"></a>    <span class="p">)</span>
</span><span id="__span-0-947"><a id="__codelineno-0-947" name="__codelineno-0-947"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-948"><a id="__codelineno-0-948" name="__codelineno-0-948"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"decoded"</span><span class="p">)</span>
</span><span id="__span-0-949"><a id="__codelineno-0-949" name="__codelineno-0-949"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-950"><a id="__codelineno-0-950" name="__codelineno-0-950"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"fused"</span><span class="p">)</span>
</span><span id="__span-0-951"><a id="__codelineno-0-951" name="__codelineno-0-951"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-952"><a id="__codelineno-0-952" name="__codelineno-0-952"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"segmentation"</span><span class="p">)</span>
</span><span id="__span-0-953"><a id="__codelineno-0-953" name="__codelineno-0-953"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-954"><a id="__codelineno-0-954" name="__codelineno-0-954"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_mtx_output_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"mtx_output"</span><span class="p">)</span>
</span><span id="__span-0-955"><a id="__codelineno-0-955" name="__codelineno-0-955"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_mtx_output_root_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-956"><a id="__codelineno-0-956" name="__codelineno-0-956"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">""</span>
</span><span id="__span-0-957"><a id="__codelineno-0-957" name="__codelineno-0-957"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">""</span>
</span><span id="__span-0-958"><a id="__codelineno-0-958" name="__codelineno-0-958"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_julia_threads</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="__span-0-959"><a id="__codelineno-0-959" name="__codelineno-0-959"></a>
</span><span id="__span-0-960"><a id="__codelineno-0-960" name="__codelineno-0-960"></a>    <span class="c1"># initialize datastore state</span>
</span><span id="__span-0-961"><a id="__codelineno-0-961" name="__codelineno-0-961"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state_json_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-962"><a id="__codelineno-0-962" name="__codelineno-0-962"></a>        <span class="sa">r</span><span class="s2">"datastore_state.json"</span>
</span><span id="__span-0-963"><a id="__codelineno-0-963" name="__codelineno-0-963"></a>    <span class="p">)</span>
</span><span id="__span-0-964"><a id="__codelineno-0-964" name="__codelineno-0-964"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-965"><a id="__codelineno-0-965" name="__codelineno-0-965"></a>        <span class="s2">"Version"</span><span class="p">:</span> <span class="mf">0.3</span><span class="p">,</span>
</span><span id="__span-0-966"><a id="__codelineno-0-966" name="__codelineno-0-966"></a>        <span class="s2">"Initialized"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-967"><a id="__codelineno-0-967" name="__codelineno-0-967"></a>        <span class="s2">"Calibrations"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-968"><a id="__codelineno-0-968" name="__codelineno-0-968"></a>        <span class="s2">"Corrected"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-969"><a id="__codelineno-0-969" name="__codelineno-0-969"></a>        <span class="s2">"LocalRegistered"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-970"><a id="__codelineno-0-970" name="__codelineno-0-970"></a>        <span class="s2">"GlobalRegistered"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-971"><a id="__codelineno-0-971" name="__codelineno-0-971"></a>        <span class="s2">"Fused"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-972"><a id="__codelineno-0-972" name="__codelineno-0-972"></a>        <span class="s2">"SegmentedCells"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-973"><a id="__codelineno-0-973" name="__codelineno-0-973"></a>        <span class="s2">"DecodedSpots"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-974"><a id="__codelineno-0-974" name="__codelineno-0-974"></a>        <span class="s2">"FilteredSpots"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-975"><a id="__codelineno-0-975" name="__codelineno-0-975"></a>        <span class="s2">"RefinedSpots"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-976"><a id="__codelineno-0-976" name="__codelineno-0-976"></a>        <span class="s2">"mtxOutput"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-977"><a id="__codelineno-0-977" name="__codelineno-0-977"></a>        <span class="s2">"BaysorPath"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span><span class="p">),</span>
</span><span id="__span-0-978"><a id="__codelineno-0-978" name="__codelineno-0-978"></a>        <span class="s2">"BaysorOptions"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span><span class="p">),</span>
</span><span id="__span-0-979"><a id="__codelineno-0-979" name="__codelineno-0-979"></a>        <span class="s2">"JuliaThreads"</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_julia_threads</span><span class="p">)</span>
</span><span id="__span-0-980"><a id="__codelineno-0-980" name="__codelineno-0-980"></a>    <span class="p">}</span>
</span><span id="__span-0-981"><a id="__codelineno-0-981" name="__codelineno-0-981"></a>
</span><span id="__span-0-982"><a id="__codelineno-0-982" name="__codelineno-0-982"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state_json_path</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore._load_from_json"> <code class="highlight language-python"><span class="n">_load_from_json</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents"> <p>Load json as dictionary.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>dictionary_path</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Path to json file.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>dictionary</code></td> <td> <code><span title="dict">dict</span></code> </td> <td> <div class="doc-md-description"> <p>Dictionary from json file.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1011">1011</a></span>
<span class="normal"><a href="#__codelineno-0-1012">1012</a></span>
<span class="normal"><a href="#__codelineno-0-1013">1013</a></span>
<span class="normal"><a href="#__codelineno-0-1014">1014</a></span>
<span class="normal"><a href="#__codelineno-0-1015">1015</a></span>
<span class="normal"><a href="#__codelineno-0-1016">1016</a></span>
<span class="normal"><a href="#__codelineno-0-1017">1017</a></span>
<span class="normal"><a href="#__codelineno-0-1018">1018</a></span>
<span class="normal"><a href="#__codelineno-0-1019">1019</a></span>
<span class="normal"><a href="#__codelineno-0-1020">1020</a></span>
<span class="normal"><a href="#__codelineno-0-1021">1021</a></span>
<span class="normal"><a href="#__codelineno-0-1022">1022</a></span>
<span class="normal"><a href="#__codelineno-0-1023">1023</a></span>
<span class="normal"><a href="#__codelineno-0-1024">1024</a></span>
<span class="normal"><a href="#__codelineno-0-1025">1025</a></span>
<span class="normal"><a href="#__codelineno-0-1026">1026</a></span>
<span class="normal"><a href="#__codelineno-0-1027">1027</a></span>
<span class="normal"><a href="#__codelineno-0-1028">1028</a></span>
<span class="normal"><a href="#__codelineno-0-1029">1029</a></span>
<span class="normal"><a href="#__codelineno-0-1030">1030</a></span>
<span class="normal"><a href="#__codelineno-0-1031">1031</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1011"><a id="__codelineno-0-1011" name="__codelineno-0-1011"></a><span class="nd">@staticmethod</span>
</span><span id="__span-0-1012"><a id="__codelineno-0-1012" name="__codelineno-0-1012"></a><span class="k">def</span><span class="w"> </span><span class="nf">_load_from_json</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-0-1013"><a id="__codelineno-0-1013" name="__codelineno-0-1013"></a><span class="w">    </span><span class="sd">"""Load json as dictionary.</span>
</span><span id="__span-0-1014"><a id="__codelineno-0-1014" name="__codelineno-0-1014"></a>
</span><span id="__span-0-1015"><a id="__codelineno-0-1015" name="__codelineno-0-1015"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-1016"><a id="__codelineno-0-1016" name="__codelineno-0-1016"></a><span class="sd">    ----------</span>
</span><span id="__span-0-1017"><a id="__codelineno-0-1017" name="__codelineno-0-1017"></a><span class="sd">    dictionary_path : Union[Path, str]</span>
</span><span id="__span-0-1018"><a id="__codelineno-0-1018" name="__codelineno-0-1018"></a><span class="sd">        Path to json file.</span>
</span><span id="__span-0-1019"><a id="__codelineno-0-1019" name="__codelineno-0-1019"></a>
</span><span id="__span-0-1020"><a id="__codelineno-0-1020" name="__codelineno-0-1020"></a><span class="sd">    Returns</span>
</span><span id="__span-0-1021"><a id="__codelineno-0-1021" name="__codelineno-0-1021"></a><span class="sd">    -------</span>
</span><span id="__span-0-1022"><a id="__codelineno-0-1022" name="__codelineno-0-1022"></a><span class="sd">    dictionary : dict</span>
</span><span id="__span-0-1023"><a id="__codelineno-0-1023" name="__codelineno-0-1023"></a><span class="sd">        Dictionary from json file.</span>
</span><span id="__span-0-1024"><a id="__codelineno-0-1024" name="__codelineno-0-1024"></a><span class="sd">    """</span>
</span><span id="__span-0-1025"><a id="__codelineno-0-1025" name="__codelineno-0-1025"></a>
</span><span id="__span-0-1026"><a id="__codelineno-0-1026" name="__codelineno-0-1026"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1027"><a id="__codelineno-0-1027" name="__codelineno-0-1027"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-1028"><a id="__codelineno-0-1028" name="__codelineno-0-1028"></a>            <span class="n">dictionary</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-0-1029"><a id="__codelineno-0-1029" name="__codelineno-0-1029"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1030"><a id="__codelineno-0-1030" name="__codelineno-0-1030"></a>        <span class="n">dictionary</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-1031"><a id="__codelineno-0-1031" name="__codelineno-0-1031"></a>    <span class="k">return</span> <span class="n">dictionary</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore._load_from_microjson"> <code class="highlight language-python"><span class="n">_load_from_microjson</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents"> <p>Load cell outlines outlines microjson as dictionary.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>dictionary_path</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Path to microjson file.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>outlines</code></td> <td> <code><span title="dict">dict</span></code> </td> <td> <div class="doc-md-description"> <p>Cell outlines dictionary.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1048">1048</a></span>
<span class="normal"><a href="#__codelineno-0-1049">1049</a></span>
<span class="normal"><a href="#__codelineno-0-1050">1050</a></span>
<span class="normal"><a href="#__codelineno-0-1051">1051</a></span>
<span class="normal"><a href="#__codelineno-0-1052">1052</a></span>
<span class="normal"><a href="#__codelineno-0-1053">1053</a></span>
<span class="normal"><a href="#__codelineno-0-1054">1054</a></span>
<span class="normal"><a href="#__codelineno-0-1055">1055</a></span>
<span class="normal"><a href="#__codelineno-0-1056">1056</a></span>
<span class="normal"><a href="#__codelineno-0-1057">1057</a></span>
<span class="normal"><a href="#__codelineno-0-1058">1058</a></span>
<span class="normal"><a href="#__codelineno-0-1059">1059</a></span>
<span class="normal"><a href="#__codelineno-0-1060">1060</a></span>
<span class="normal"><a href="#__codelineno-0-1061">1061</a></span>
<span class="normal"><a href="#__codelineno-0-1062">1062</a></span>
<span class="normal"><a href="#__codelineno-0-1063">1063</a></span>
<span class="normal"><a href="#__codelineno-0-1064">1064</a></span>
<span class="normal"><a href="#__codelineno-0-1065">1065</a></span>
<span class="normal"><a href="#__codelineno-0-1066">1066</a></span>
<span class="normal"><a href="#__codelineno-0-1067">1067</a></span>
<span class="normal"><a href="#__codelineno-0-1068">1068</a></span>
<span class="normal"><a href="#__codelineno-0-1069">1069</a></span>
<span class="normal"><a href="#__codelineno-0-1070">1070</a></span>
<span class="normal"><a href="#__codelineno-0-1071">1071</a></span>
<span class="normal"><a href="#__codelineno-0-1072">1072</a></span>
<span class="normal"><a href="#__codelineno-0-1073">1073</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1048"><a id="__codelineno-0-1048" name="__codelineno-0-1048"></a><span class="nd">@staticmethod</span>
</span><span id="__span-0-1049"><a id="__codelineno-0-1049" name="__codelineno-0-1049"></a><span class="k">def</span><span class="w"> </span><span class="nf">_load_from_microjson</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
</span><span id="__span-0-1050"><a id="__codelineno-0-1050" name="__codelineno-0-1050"></a><span class="w">    </span><span class="sd">"""Load cell outlines outlines microjson as dictionary.</span>
</span><span id="__span-0-1051"><a id="__codelineno-0-1051" name="__codelineno-0-1051"></a>
</span><span id="__span-0-1052"><a id="__codelineno-0-1052" name="__codelineno-0-1052"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-1053"><a id="__codelineno-0-1053" name="__codelineno-0-1053"></a><span class="sd">    ----------</span>
</span><span id="__span-0-1054"><a id="__codelineno-0-1054" name="__codelineno-0-1054"></a><span class="sd">    dictionary_path : Union[Path, str]</span>
</span><span id="__span-0-1055"><a id="__codelineno-0-1055" name="__codelineno-0-1055"></a><span class="sd">        Path to microjson file.</span>
</span><span id="__span-0-1056"><a id="__codelineno-0-1056" name="__codelineno-0-1056"></a>
</span><span id="__span-0-1057"><a id="__codelineno-0-1057" name="__codelineno-0-1057"></a><span class="sd">    Returns</span>
</span><span id="__span-0-1058"><a id="__codelineno-0-1058" name="__codelineno-0-1058"></a><span class="sd">    -------</span>
</span><span id="__span-0-1059"><a id="__codelineno-0-1059" name="__codelineno-0-1059"></a><span class="sd">    outlines : dict</span>
</span><span id="__span-0-1060"><a id="__codelineno-0-1060" name="__codelineno-0-1060"></a><span class="sd">        Cell outlines dictionary.</span>
</span><span id="__span-0-1061"><a id="__codelineno-0-1061" name="__codelineno-0-1061"></a><span class="sd">    """</span>
</span><span id="__span-0-1062"><a id="__codelineno-0-1062" name="__codelineno-0-1062"></a>
</span><span id="__span-0-1063"><a id="__codelineno-0-1063" name="__codelineno-0-1063"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1064"><a id="__codelineno-0-1064" name="__codelineno-0-1064"></a>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-1065"><a id="__codelineno-0-1065" name="__codelineno-0-1065"></a>            <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-0-1066"><a id="__codelineno-0-1066" name="__codelineno-0-1066"></a>            <span class="n">outlines</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-1067"><a id="__codelineno-0-1067" name="__codelineno-0-1067"></a>            <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">"features"</span><span class="p">]:</span>
</span><span id="__span-0-1068"><a id="__codelineno-0-1068" name="__codelineno-0-1068"></a>                <span class="n">cell_id</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s2">"properties"</span><span class="p">][</span><span class="s2">"cell_id"</span><span class="p">]</span>
</span><span id="__span-0-1069"><a id="__codelineno-0-1069" name="__codelineno-0-1069"></a>                <span class="n">coordinates</span> <span class="o">=</span> <span class="n">feature</span><span class="p">[</span><span class="s2">"geometry"</span><span class="p">][</span><span class="s2">"coordinates"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-1070"><a id="__codelineno-0-1070" name="__codelineno-0-1070"></a>                <span class="n">outlines</span><span class="p">[</span><span class="n">cell_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">coordinates</span><span class="p">)</span>
</span><span id="__span-0-1071"><a id="__codelineno-0-1071" name="__codelineno-0-1071"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">,</span> <span class="ne">KeyError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">):</span>
</span><span id="__span-0-1072"><a id="__codelineno-0-1072" name="__codelineno-0-1072"></a>        <span class="n">outlines</span> <span class="o">=</span> <span class="p">{}</span>
</span><span id="__span-0-1073"><a id="__codelineno-0-1073" name="__codelineno-0-1073"></a>    <span class="k">return</span> <span class="n">outlines</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore._load_from_parquet"> <code class="highlight language-python"><span class="n">_load_from_parquet</span><span class="p">(</span><span class="n">parquet_path</span><span class="p">)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents"> <p>Load dataframe from parquet.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>parquet_path</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Path to parquet file.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>df</code></td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class="doc-md-description"> <p>Dataframe from parquet file.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1202">1202</a></span>
<span class="normal"><a href="#__codelineno-0-1203">1203</a></span>
<span class="normal"><a href="#__codelineno-0-1204">1204</a></span>
<span class="normal"><a href="#__codelineno-0-1205">1205</a></span>
<span class="normal"><a href="#__codelineno-0-1206">1206</a></span>
<span class="normal"><a href="#__codelineno-0-1207">1207</a></span>
<span class="normal"><a href="#__codelineno-0-1208">1208</a></span>
<span class="normal"><a href="#__codelineno-0-1209">1209</a></span>
<span class="normal"><a href="#__codelineno-0-1210">1210</a></span>
<span class="normal"><a href="#__codelineno-0-1211">1211</a></span>
<span class="normal"><a href="#__codelineno-0-1212">1212</a></span>
<span class="normal"><a href="#__codelineno-0-1213">1213</a></span>
<span class="normal"><a href="#__codelineno-0-1214">1214</a></span>
<span class="normal"><a href="#__codelineno-0-1215">1215</a></span>
<span class="normal"><a href="#__codelineno-0-1216">1216</a></span>
<span class="normal"><a href="#__codelineno-0-1217">1217</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1202"><a id="__codelineno-0-1202" name="__codelineno-0-1202"></a><span class="nd">@staticmethod</span>
</span><span id="__span-0-1203"><a id="__codelineno-0-1203" name="__codelineno-0-1203"></a><span class="k">def</span><span class="w"> </span><span class="nf">_load_from_parquet</span><span class="p">(</span><span class="n">parquet_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
</span><span id="__span-0-1204"><a id="__codelineno-0-1204" name="__codelineno-0-1204"></a><span class="w">    </span><span class="sd">"""Load dataframe from parquet.</span>
</span><span id="__span-0-1205"><a id="__codelineno-0-1205" name="__codelineno-0-1205"></a>
</span><span id="__span-0-1206"><a id="__codelineno-0-1206" name="__codelineno-0-1206"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-1207"><a id="__codelineno-0-1207" name="__codelineno-0-1207"></a><span class="sd">    ----------</span>
</span><span id="__span-0-1208"><a id="__codelineno-0-1208" name="__codelineno-0-1208"></a><span class="sd">    parquet_path : Union[Path, str]</span>
</span><span id="__span-0-1209"><a id="__codelineno-0-1209" name="__codelineno-0-1209"></a><span class="sd">        Path to parquet file.</span>
</span><span id="__span-0-1210"><a id="__codelineno-0-1210" name="__codelineno-0-1210"></a>
</span><span id="__span-0-1211"><a id="__codelineno-0-1211" name="__codelineno-0-1211"></a><span class="sd">    Returns</span>
</span><span id="__span-0-1212"><a id="__codelineno-0-1212" name="__codelineno-0-1212"></a><span class="sd">    -------</span>
</span><span id="__span-0-1213"><a id="__codelineno-0-1213" name="__codelineno-0-1213"></a><span class="sd">    df : pd.DataFrame</span>
</span><span id="__span-0-1214"><a id="__codelineno-0-1214" name="__codelineno-0-1214"></a><span class="sd">        Dataframe from parquet file.</span>
</span><span id="__span-0-1215"><a id="__codelineno-0-1215" name="__codelineno-0-1215"></a><span class="sd">    """</span>
</span><span id="__span-0-1216"><a id="__codelineno-0-1216" name="__codelineno-0-1216"></a>
</span><span id="__span-0-1217"><a id="__codelineno-0-1217" name="__codelineno-0-1217"></a>    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_parquet</span><span class="p">(</span><span class="n">parquet_path</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore._load_from_zarr_array"> <code class="highlight language-python"><span class="n">_load_from_zarr_array</span><span class="p">(</span><span class="n">kvstore</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents"> <p>Return tensorstore array from zarr</p> <p>Defaults to returning future result.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>kvstore</code> </td> <td> <code><span title="dict">dict</span></code> </td> <td> <div class="doc-md-description"> <p>Tensorstore kvstore specification.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>spec</code> </td> <td> <code><span title="dict">dict</span></code> </td> <td> <div class="doc-md-description"> <p>Tensorstore zarr specification.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="bool">bool</span></code> </td> <td> <div class="doc-md-description"> <p>Return future (True) or immediately read (False).</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>array</code></td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Delayed (future) or immediate array.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1096">1096</a></span>
<span class="normal"><a href="#__codelineno-0-1097">1097</a></span>
<span class="normal"><a href="#__codelineno-0-1098">1098</a></span>
<span class="normal"><a href="#__codelineno-0-1099">1099</a></span>
<span class="normal"><a href="#__codelineno-0-1100">1100</a></span>
<span class="normal"><a href="#__codelineno-0-1101">1101</a></span>
<span class="normal"><a href="#__codelineno-0-1102">1102</a></span>
<span class="normal"><a href="#__codelineno-0-1103">1103</a></span>
<span class="normal"><a href="#__codelineno-0-1104">1104</a></span>
<span class="normal"><a href="#__codelineno-0-1105">1105</a></span>
<span class="normal"><a href="#__codelineno-0-1106">1106</a></span>
<span class="normal"><a href="#__codelineno-0-1107">1107</a></span>
<span class="normal"><a href="#__codelineno-0-1108">1108</a></span>
<span class="normal"><a href="#__codelineno-0-1109">1109</a></span>
<span class="normal"><a href="#__codelineno-0-1110">1110</a></span>
<span class="normal"><a href="#__codelineno-0-1111">1111</a></span>
<span class="normal"><a href="#__codelineno-0-1112">1112</a></span>
<span class="normal"><a href="#__codelineno-0-1113">1113</a></span>
<span class="normal"><a href="#__codelineno-0-1114">1114</a></span>
<span class="normal"><a href="#__codelineno-0-1115">1115</a></span>
<span class="normal"><a href="#__codelineno-0-1116">1116</a></span>
<span class="normal"><a href="#__codelineno-0-1117">1117</a></span>
<span class="normal"><a href="#__codelineno-0-1118">1118</a></span>
<span class="normal"><a href="#__codelineno-0-1119">1119</a></span>
<span class="normal"><a href="#__codelineno-0-1120">1120</a></span>
<span class="normal"><a href="#__codelineno-0-1121">1121</a></span>
<span class="normal"><a href="#__codelineno-0-1122">1122</a></span>
<span class="normal"><a href="#__codelineno-0-1123">1123</a></span>
<span class="normal"><a href="#__codelineno-0-1124">1124</a></span>
<span class="normal"><a href="#__codelineno-0-1125">1125</a></span>
<span class="normal"><a href="#__codelineno-0-1126">1126</a></span>
<span class="normal"><a href="#__codelineno-0-1127">1127</a></span>
<span class="normal"><a href="#__codelineno-0-1128">1128</a></span>
<span class="normal"><a href="#__codelineno-0-1129">1129</a></span>
<span class="normal"><a href="#__codelineno-0-1130">1130</a></span>
<span class="normal"><a href="#__codelineno-0-1131">1131</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1096"><a id="__codelineno-0-1096" name="__codelineno-0-1096"></a><span class="nd">@staticmethod</span>
</span><span id="__span-0-1097"><a id="__codelineno-0-1097" name="__codelineno-0-1097"></a><span class="k">def</span><span class="w"> </span><span class="nf">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1098"><a id="__codelineno-0-1098" name="__codelineno-0-1098"></a>    <span class="n">kvstore</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">True</span>
</span><span id="__span-0-1099"><a id="__codelineno-0-1099" name="__codelineno-0-1099"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ArrayLike</span><span class="p">:</span>
</span><span id="__span-0-1100"><a id="__codelineno-0-1100" name="__codelineno-0-1100"></a><span class="w">    </span><span class="sd">"""Return tensorstore array from zarr</span>
</span><span id="__span-0-1101"><a id="__codelineno-0-1101" name="__codelineno-0-1101"></a>
</span><span id="__span-0-1102"><a id="__codelineno-0-1102" name="__codelineno-0-1102"></a><span class="sd">    Defaults to returning future result.</span>
</span><span id="__span-0-1103"><a id="__codelineno-0-1103" name="__codelineno-0-1103"></a>
</span><span id="__span-0-1104"><a id="__codelineno-0-1104" name="__codelineno-0-1104"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-1105"><a id="__codelineno-0-1105" name="__codelineno-0-1105"></a><span class="sd">    ----------</span>
</span><span id="__span-0-1106"><a id="__codelineno-0-1106" name="__codelineno-0-1106"></a><span class="sd">    kvstore : dict</span>
</span><span id="__span-0-1107"><a id="__codelineno-0-1107" name="__codelineno-0-1107"></a><span class="sd">        Tensorstore kvstore specification.</span>
</span><span id="__span-0-1108"><a id="__codelineno-0-1108" name="__codelineno-0-1108"></a><span class="sd">    spec : dict</span>
</span><span id="__span-0-1109"><a id="__codelineno-0-1109" name="__codelineno-0-1109"></a><span class="sd">        Tensorstore zarr specification.</span>
</span><span id="__span-0-1110"><a id="__codelineno-0-1110" name="__codelineno-0-1110"></a><span class="sd">    return_future : bool</span>
</span><span id="__span-0-1111"><a id="__codelineno-0-1111" name="__codelineno-0-1111"></a><span class="sd">        Return future (True) or immediately read (False).</span>
</span><span id="__span-0-1112"><a id="__codelineno-0-1112" name="__codelineno-0-1112"></a>
</span><span id="__span-0-1113"><a id="__codelineno-0-1113" name="__codelineno-0-1113"></a><span class="sd">    Returns</span>
</span><span id="__span-0-1114"><a id="__codelineno-0-1114" name="__codelineno-0-1114"></a><span class="sd">    -------</span>
</span><span id="__span-0-1115"><a id="__codelineno-0-1115" name="__codelineno-0-1115"></a><span class="sd">    array : ArrayLike</span>
</span><span id="__span-0-1116"><a id="__codelineno-0-1116" name="__codelineno-0-1116"></a><span class="sd">        Delayed (future) or immediate array.</span>
</span><span id="__span-0-1117"><a id="__codelineno-0-1117" name="__codelineno-0-1117"></a><span class="sd">    """</span>
</span><span id="__span-0-1118"><a id="__codelineno-0-1118" name="__codelineno-0-1118"></a>
</span><span id="__span-0-1119"><a id="__codelineno-0-1119" name="__codelineno-0-1119"></a>    <span class="n">current_zarr</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
</span><span id="__span-0-1120"><a id="__codelineno-0-1120" name="__codelineno-0-1120"></a>        <span class="p">{</span>
</span><span id="__span-0-1121"><a id="__codelineno-0-1121" name="__codelineno-0-1121"></a>            <span class="o">**</span><span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-1122"><a id="__codelineno-0-1122" name="__codelineno-0-1122"></a>            <span class="s2">"kvstore"</span><span class="p">:</span> <span class="n">kvstore</span><span class="p">,</span>
</span><span id="__span-0-1123"><a id="__codelineno-0-1123" name="__codelineno-0-1123"></a>        <span class="p">}</span>
</span><span id="__span-0-1124"><a id="__codelineno-0-1124" name="__codelineno-0-1124"></a>    <span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-0-1125"><a id="__codelineno-0-1125" name="__codelineno-0-1125"></a>
</span><span id="__span-0-1126"><a id="__codelineno-0-1126" name="__codelineno-0-1126"></a>    <span class="n">read_future</span> <span class="o">=</span> <span class="n">current_zarr</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span id="__span-0-1127"><a id="__codelineno-0-1127" name="__codelineno-0-1127"></a>
</span><span id="__span-0-1128"><a id="__codelineno-0-1128" name="__codelineno-0-1128"></a>    <span class="k">if</span> <span class="n">return_future</span><span class="p">:</span>
</span><span id="__span-0-1129"><a id="__codelineno-0-1129" name="__codelineno-0-1129"></a>        <span class="k">return</span> <span class="n">read_future</span>
</span><span id="__span-0-1130"><a id="__codelineno-0-1130" name="__codelineno-0-1130"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1131"><a id="__codelineno-0-1131" name="__codelineno-0-1131"></a>        <span class="k">return</span> <span class="n">read_future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore._parse_datastore"> <code class="highlight language-python"><span class="n">_parse_datastore</span><span class="p">()</span></code> </h3> <div class="doc doc-contents"> <p>Parse datastore to discover available components.</p> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1244">1244</a></span>
<span class="normal"><a href="#__codelineno-0-1245">1245</a></span>
<span class="normal"><a href="#__codelineno-0-1246">1246</a></span>
<span class="normal"><a href="#__codelineno-0-1247">1247</a></span>
<span class="normal"><a href="#__codelineno-0-1248">1248</a></span>
<span class="normal"><a href="#__codelineno-0-1249">1249</a></span>
<span class="normal"><a href="#__codelineno-0-1250">1250</a></span>
<span class="normal"><a href="#__codelineno-0-1251">1251</a></span>
<span class="normal"><a href="#__codelineno-0-1252">1252</a></span>
<span class="normal"><a href="#__codelineno-0-1253">1253</a></span>
<span class="normal"><a href="#__codelineno-0-1254">1254</a></span>
<span class="normal"><a href="#__codelineno-0-1255">1255</a></span>
<span class="normal"><a href="#__codelineno-0-1256">1256</a></span>
<span class="normal"><a href="#__codelineno-0-1257">1257</a></span>
<span class="normal"><a href="#__codelineno-0-1258">1258</a></span>
<span class="normal"><a href="#__codelineno-0-1259">1259</a></span>
<span class="normal"><a href="#__codelineno-0-1260">1260</a></span>
<span class="normal"><a href="#__codelineno-0-1261">1261</a></span>
<span class="normal"><a href="#__codelineno-0-1262">1262</a></span>
<span class="normal"><a href="#__codelineno-0-1263">1263</a></span>
<span class="normal"><a href="#__codelineno-0-1264">1264</a></span>
<span class="normal"><a href="#__codelineno-0-1265">1265</a></span>
<span class="normal"><a href="#__codelineno-0-1266">1266</a></span>
<span class="normal"><a href="#__codelineno-0-1267">1267</a></span>
<span class="normal"><a href="#__codelineno-0-1268">1268</a></span>
<span class="normal"><a href="#__codelineno-0-1269">1269</a></span>
<span class="normal"><a href="#__codelineno-0-1270">1270</a></span>
<span class="normal"><a href="#__codelineno-0-1271">1271</a></span>
<span class="normal"><a href="#__codelineno-0-1272">1272</a></span>
<span class="normal"><a href="#__codelineno-0-1273">1273</a></span>
<span class="normal"><a href="#__codelineno-0-1274">1274</a></span>
<span class="normal"><a href="#__codelineno-0-1275">1275</a></span>
<span class="normal"><a href="#__codelineno-0-1276">1276</a></span>
<span class="normal"><a href="#__codelineno-0-1277">1277</a></span>
<span class="normal"><a href="#__codelineno-0-1278">1278</a></span>
<span class="normal"><a href="#__codelineno-0-1279">1279</a></span>
<span class="normal"><a href="#__codelineno-0-1280">1280</a></span>
<span class="normal"><a href="#__codelineno-0-1281">1281</a></span>
<span class="normal"><a href="#__codelineno-0-1282">1282</a></span>
<span class="normal"><a href="#__codelineno-0-1283">1283</a></span>
<span class="normal"><a href="#__codelineno-0-1284">1284</a></span>
<span class="normal"><a href="#__codelineno-0-1285">1285</a></span>
<span class="normal"><a href="#__codelineno-0-1286">1286</a></span>
<span class="normal"><a href="#__codelineno-0-1287">1287</a></span>
<span class="normal"><a href="#__codelineno-0-1288">1288</a></span>
<span class="normal"><a href="#__codelineno-0-1289">1289</a></span>
<span class="normal"><a href="#__codelineno-0-1290">1290</a></span>
<span class="normal"><a href="#__codelineno-0-1291">1291</a></span>
<span class="normal"><a href="#__codelineno-0-1292">1292</a></span>
<span class="normal"><a href="#__codelineno-0-1293">1293</a></span>
<span class="normal"><a href="#__codelineno-0-1294">1294</a></span>
<span class="normal"><a href="#__codelineno-0-1295">1295</a></span>
<span class="normal"><a href="#__codelineno-0-1296">1296</a></span>
<span class="normal"><a href="#__codelineno-0-1297">1297</a></span>
<span class="normal"><a href="#__codelineno-0-1298">1298</a></span>
<span class="normal"><a href="#__codelineno-0-1299">1299</a></span>
<span class="normal"><a href="#__codelineno-0-1300">1300</a></span>
<span class="normal"><a href="#__codelineno-0-1301">1301</a></span>
<span class="normal"><a href="#__codelineno-0-1302">1302</a></span>
<span class="normal"><a href="#__codelineno-0-1303">1303</a></span>
<span class="normal"><a href="#__codelineno-0-1304">1304</a></span>
<span class="normal"><a href="#__codelineno-0-1305">1305</a></span>
<span class="normal"><a href="#__codelineno-0-1306">1306</a></span>
<span class="normal"><a href="#__codelineno-0-1307">1307</a></span>
<span class="normal"><a href="#__codelineno-0-1308">1308</a></span>
<span class="normal"><a href="#__codelineno-0-1309">1309</a></span>
<span class="normal"><a href="#__codelineno-0-1310">1310</a></span>
<span class="normal"><a href="#__codelineno-0-1311">1311</a></span>
<span class="normal"><a href="#__codelineno-0-1312">1312</a></span>
<span class="normal"><a href="#__codelineno-0-1313">1313</a></span>
<span class="normal"><a href="#__codelineno-0-1314">1314</a></span>
<span class="normal"><a href="#__codelineno-0-1315">1315</a></span>
<span class="normal"><a href="#__codelineno-0-1316">1316</a></span>
<span class="normal"><a href="#__codelineno-0-1317">1317</a></span>
<span class="normal"><a href="#__codelineno-0-1318">1318</a></span>
<span class="normal"><a href="#__codelineno-0-1319">1319</a></span>
<span class="normal"><a href="#__codelineno-0-1320">1320</a></span>
<span class="normal"><a href="#__codelineno-0-1321">1321</a></span>
<span class="normal"><a href="#__codelineno-0-1322">1322</a></span>
<span class="normal"><a href="#__codelineno-0-1323">1323</a></span>
<span class="normal"><a href="#__codelineno-0-1324">1324</a></span>
<span class="normal"><a href="#__codelineno-0-1325">1325</a></span>
<span class="normal"><a href="#__codelineno-0-1326">1326</a></span>
<span class="normal"><a href="#__codelineno-0-1327">1327</a></span>
<span class="normal"><a href="#__codelineno-0-1328">1328</a></span>
<span class="normal"><a href="#__codelineno-0-1329">1329</a></span>
<span class="normal"><a href="#__codelineno-0-1330">1330</a></span>
<span class="normal"><a href="#__codelineno-0-1331">1331</a></span>
<span class="normal"><a href="#__codelineno-0-1332">1332</a></span>
<span class="normal"><a href="#__codelineno-0-1333">1333</a></span>
<span class="normal"><a href="#__codelineno-0-1334">1334</a></span>
<span class="normal"><a href="#__codelineno-0-1335">1335</a></span>
<span class="normal"><a href="#__codelineno-0-1336">1336</a></span>
<span class="normal"><a href="#__codelineno-0-1337">1337</a></span>
<span class="normal"><a href="#__codelineno-0-1338">1338</a></span>
<span class="normal"><a href="#__codelineno-0-1339">1339</a></span>
<span class="normal"><a href="#__codelineno-0-1340">1340</a></span>
<span class="normal"><a href="#__codelineno-0-1341">1341</a></span>
<span class="normal"><a href="#__codelineno-0-1342">1342</a></span>
<span class="normal"><a href="#__codelineno-0-1343">1343</a></span>
<span class="normal"><a href="#__codelineno-0-1344">1344</a></span>
<span class="normal"><a href="#__codelineno-0-1345">1345</a></span>
<span class="normal"><a href="#__codelineno-0-1346">1346</a></span>
<span class="normal"><a href="#__codelineno-0-1347">1347</a></span>
<span class="normal"><a href="#__codelineno-0-1348">1348</a></span>
<span class="normal"><a href="#__codelineno-0-1349">1349</a></span>
<span class="normal"><a href="#__codelineno-0-1350">1350</a></span>
<span class="normal"><a href="#__codelineno-0-1351">1351</a></span>
<span class="normal"><a href="#__codelineno-0-1352">1352</a></span>
<span class="normal"><a href="#__codelineno-0-1353">1353</a></span>
<span class="normal"><a href="#__codelineno-0-1354">1354</a></span>
<span class="normal"><a href="#__codelineno-0-1355">1355</a></span>
<span class="normal"><a href="#__codelineno-0-1356">1356</a></span>
<span class="normal"><a href="#__codelineno-0-1357">1357</a></span>
<span class="normal"><a href="#__codelineno-0-1358">1358</a></span>
<span class="normal"><a href="#__codelineno-0-1359">1359</a></span>
<span class="normal"><a href="#__codelineno-0-1360">1360</a></span>
<span class="normal"><a href="#__codelineno-0-1361">1361</a></span>
<span class="normal"><a href="#__codelineno-0-1362">1362</a></span>
<span class="normal"><a href="#__codelineno-0-1363">1363</a></span>
<span class="normal"><a href="#__codelineno-0-1364">1364</a></span>
<span class="normal"><a href="#__codelineno-0-1365">1365</a></span>
<span class="normal"><a href="#__codelineno-0-1366">1366</a></span>
<span class="normal"><a href="#__codelineno-0-1367">1367</a></span>
<span class="normal"><a href="#__codelineno-0-1368">1368</a></span>
<span class="normal"><a href="#__codelineno-0-1369">1369</a></span>
<span class="normal"><a href="#__codelineno-0-1370">1370</a></span>
<span class="normal"><a href="#__codelineno-0-1371">1371</a></span>
<span class="normal"><a href="#__codelineno-0-1372">1372</a></span>
<span class="normal"><a href="#__codelineno-0-1373">1373</a></span>
<span class="normal"><a href="#__codelineno-0-1374">1374</a></span>
<span class="normal"><a href="#__codelineno-0-1375">1375</a></span>
<span class="normal"><a href="#__codelineno-0-1376">1376</a></span>
<span class="normal"><a href="#__codelineno-0-1377">1377</a></span>
<span class="normal"><a href="#__codelineno-0-1378">1378</a></span>
<span class="normal"><a href="#__codelineno-0-1379">1379</a></span>
<span class="normal"><a href="#__codelineno-0-1380">1380</a></span>
<span class="normal"><a href="#__codelineno-0-1381">1381</a></span>
<span class="normal"><a href="#__codelineno-0-1382">1382</a></span>
<span class="normal"><a href="#__codelineno-0-1383">1383</a></span>
<span class="normal"><a href="#__codelineno-0-1384">1384</a></span>
<span class="normal"><a href="#__codelineno-0-1385">1385</a></span>
<span class="normal"><a href="#__codelineno-0-1386">1386</a></span>
<span class="normal"><a href="#__codelineno-0-1387">1387</a></span>
<span class="normal"><a href="#__codelineno-0-1388">1388</a></span>
<span class="normal"><a href="#__codelineno-0-1389">1389</a></span>
<span class="normal"><a href="#__codelineno-0-1390">1390</a></span>
<span class="normal"><a href="#__codelineno-0-1391">1391</a></span>
<span class="normal"><a href="#__codelineno-0-1392">1392</a></span>
<span class="normal"><a href="#__codelineno-0-1393">1393</a></span>
<span class="normal"><a href="#__codelineno-0-1394">1394</a></span>
<span class="normal"><a href="#__codelineno-0-1395">1395</a></span>
<span class="normal"><a href="#__codelineno-0-1396">1396</a></span>
<span class="normal"><a href="#__codelineno-0-1397">1397</a></span>
<span class="normal"><a href="#__codelineno-0-1398">1398</a></span>
<span class="normal"><a href="#__codelineno-0-1399">1399</a></span>
<span class="normal"><a href="#__codelineno-0-1400">1400</a></span>
<span class="normal"><a href="#__codelineno-0-1401">1401</a></span>
<span class="normal"><a href="#__codelineno-0-1402">1402</a></span>
<span class="normal"><a href="#__codelineno-0-1403">1403</a></span>
<span class="normal"><a href="#__codelineno-0-1404">1404</a></span>
<span class="normal"><a href="#__codelineno-0-1405">1405</a></span>
<span class="normal"><a href="#__codelineno-0-1406">1406</a></span>
<span class="normal"><a href="#__codelineno-0-1407">1407</a></span>
<span class="normal"><a href="#__codelineno-0-1408">1408</a></span>
<span class="normal"><a href="#__codelineno-0-1409">1409</a></span>
<span class="normal"><a href="#__codelineno-0-1410">1410</a></span>
<span class="normal"><a href="#__codelineno-0-1411">1411</a></span>
<span class="normal"><a href="#__codelineno-0-1412">1412</a></span>
<span class="normal"><a href="#__codelineno-0-1413">1413</a></span>
<span class="normal"><a href="#__codelineno-0-1414">1414</a></span>
<span class="normal"><a href="#__codelineno-0-1415">1415</a></span>
<span class="normal"><a href="#__codelineno-0-1416">1416</a></span>
<span class="normal"><a href="#__codelineno-0-1417">1417</a></span>
<span class="normal"><a href="#__codelineno-0-1418">1418</a></span>
<span class="normal"><a href="#__codelineno-0-1419">1419</a></span>
<span class="normal"><a href="#__codelineno-0-1420">1420</a></span>
<span class="normal"><a href="#__codelineno-0-1421">1421</a></span>
<span class="normal"><a href="#__codelineno-0-1422">1422</a></span>
<span class="normal"><a href="#__codelineno-0-1423">1423</a></span>
<span class="normal"><a href="#__codelineno-0-1424">1424</a></span>
<span class="normal"><a href="#__codelineno-0-1425">1425</a></span>
<span class="normal"><a href="#__codelineno-0-1426">1426</a></span>
<span class="normal"><a href="#__codelineno-0-1427">1427</a></span>
<span class="normal"><a href="#__codelineno-0-1428">1428</a></span>
<span class="normal"><a href="#__codelineno-0-1429">1429</a></span>
<span class="normal"><a href="#__codelineno-0-1430">1430</a></span>
<span class="normal"><a href="#__codelineno-0-1431">1431</a></span>
<span class="normal"><a href="#__codelineno-0-1432">1432</a></span>
<span class="normal"><a href="#__codelineno-0-1433">1433</a></span>
<span class="normal"><a href="#__codelineno-0-1434">1434</a></span>
<span class="normal"><a href="#__codelineno-0-1435">1435</a></span>
<span class="normal"><a href="#__codelineno-0-1436">1436</a></span>
<span class="normal"><a href="#__codelineno-0-1437">1437</a></span>
<span class="normal"><a href="#__codelineno-0-1438">1438</a></span>
<span class="normal"><a href="#__codelineno-0-1439">1439</a></span>
<span class="normal"><a href="#__codelineno-0-1440">1440</a></span>
<span class="normal"><a href="#__codelineno-0-1441">1441</a></span>
<span class="normal"><a href="#__codelineno-0-1442">1442</a></span>
<span class="normal"><a href="#__codelineno-0-1443">1443</a></span>
<span class="normal"><a href="#__codelineno-0-1444">1444</a></span>
<span class="normal"><a href="#__codelineno-0-1445">1445</a></span>
<span class="normal"><a href="#__codelineno-0-1446">1446</a></span>
<span class="normal"><a href="#__codelineno-0-1447">1447</a></span>
<span class="normal"><a href="#__codelineno-0-1448">1448</a></span>
<span class="normal"><a href="#__codelineno-0-1449">1449</a></span>
<span class="normal"><a href="#__codelineno-0-1450">1450</a></span>
<span class="normal"><a href="#__codelineno-0-1451">1451</a></span>
<span class="normal"><a href="#__codelineno-0-1452">1452</a></span>
<span class="normal"><a href="#__codelineno-0-1453">1453</a></span>
<span class="normal"><a href="#__codelineno-0-1454">1454</a></span>
<span class="normal"><a href="#__codelineno-0-1455">1455</a></span>
<span class="normal"><a href="#__codelineno-0-1456">1456</a></span>
<span class="normal"><a href="#__codelineno-0-1457">1457</a></span>
<span class="normal"><a href="#__codelineno-0-1458">1458</a></span>
<span class="normal"><a href="#__codelineno-0-1459">1459</a></span>
<span class="normal"><a href="#__codelineno-0-1460">1460</a></span>
<span class="normal"><a href="#__codelineno-0-1461">1461</a></span>
<span class="normal"><a href="#__codelineno-0-1462">1462</a></span>
<span class="normal"><a href="#__codelineno-0-1463">1463</a></span>
<span class="normal"><a href="#__codelineno-0-1464">1464</a></span>
<span class="normal"><a href="#__codelineno-0-1465">1465</a></span>
<span class="normal"><a href="#__codelineno-0-1466">1466</a></span>
<span class="normal"><a href="#__codelineno-0-1467">1467</a></span>
<span class="normal"><a href="#__codelineno-0-1468">1468</a></span>
<span class="normal"><a href="#__codelineno-0-1469">1469</a></span>
<span class="normal"><a href="#__codelineno-0-1470">1470</a></span>
<span class="normal"><a href="#__codelineno-0-1471">1471</a></span>
<span class="normal"><a href="#__codelineno-0-1472">1472</a></span>
<span class="normal"><a href="#__codelineno-0-1473">1473</a></span>
<span class="normal"><a href="#__codelineno-0-1474">1474</a></span>
<span class="normal"><a href="#__codelineno-0-1475">1475</a></span>
<span class="normal"><a href="#__codelineno-0-1476">1476</a></span>
<span class="normal"><a href="#__codelineno-0-1477">1477</a></span>
<span class="normal"><a href="#__codelineno-0-1478">1478</a></span>
<span class="normal"><a href="#__codelineno-0-1479">1479</a></span>
<span class="normal"><a href="#__codelineno-0-1480">1480</a></span>
<span class="normal"><a href="#__codelineno-0-1481">1481</a></span>
<span class="normal"><a href="#__codelineno-0-1482">1482</a></span>
<span class="normal"><a href="#__codelineno-0-1483">1483</a></span>
<span class="normal"><a href="#__codelineno-0-1484">1484</a></span>
<span class="normal"><a href="#__codelineno-0-1485">1485</a></span>
<span class="normal"><a href="#__codelineno-0-1486">1486</a></span>
<span class="normal"><a href="#__codelineno-0-1487">1487</a></span>
<span class="normal"><a href="#__codelineno-0-1488">1488</a></span>
<span class="normal"><a href="#__codelineno-0-1489">1489</a></span>
<span class="normal"><a href="#__codelineno-0-1490">1490</a></span>
<span class="normal"><a href="#__codelineno-0-1491">1491</a></span>
<span class="normal"><a href="#__codelineno-0-1492">1492</a></span>
<span class="normal"><a href="#__codelineno-0-1493">1493</a></span>
<span class="normal"><a href="#__codelineno-0-1494">1494</a></span>
<span class="normal"><a href="#__codelineno-0-1495">1495</a></span>
<span class="normal"><a href="#__codelineno-0-1496">1496</a></span>
<span class="normal"><a href="#__codelineno-0-1497">1497</a></span>
<span class="normal"><a href="#__codelineno-0-1498">1498</a></span>
<span class="normal"><a href="#__codelineno-0-1499">1499</a></span>
<span class="normal"><a href="#__codelineno-0-1500">1500</a></span>
<span class="normal"><a href="#__codelineno-0-1501">1501</a></span>
<span class="normal"><a href="#__codelineno-0-1502">1502</a></span>
<span class="normal"><a href="#__codelineno-0-1503">1503</a></span>
<span class="normal"><a href="#__codelineno-0-1504">1504</a></span>
<span class="normal"><a href="#__codelineno-0-1505">1505</a></span>
<span class="normal"><a href="#__codelineno-0-1506">1506</a></span>
<span class="normal"><a href="#__codelineno-0-1507">1507</a></span>
<span class="normal"><a href="#__codelineno-0-1508">1508</a></span>
<span class="normal"><a href="#__codelineno-0-1509">1509</a></span>
<span class="normal"><a href="#__codelineno-0-1510">1510</a></span>
<span class="normal"><a href="#__codelineno-0-1511">1511</a></span>
<span class="normal"><a href="#__codelineno-0-1512">1512</a></span>
<span class="normal"><a href="#__codelineno-0-1513">1513</a></span>
<span class="normal"><a href="#__codelineno-0-1514">1514</a></span>
<span class="normal"><a href="#__codelineno-0-1515">1515</a></span>
<span class="normal"><a href="#__codelineno-0-1516">1516</a></span>
<span class="normal"><a href="#__codelineno-0-1517">1517</a></span>
<span class="normal"><a href="#__codelineno-0-1518">1518</a></span>
<span class="normal"><a href="#__codelineno-0-1519">1519</a></span>
<span class="normal"><a href="#__codelineno-0-1520">1520</a></span>
<span class="normal"><a href="#__codelineno-0-1521">1521</a></span>
<span class="normal"><a href="#__codelineno-0-1522">1522</a></span>
<span class="normal"><a href="#__codelineno-0-1523">1523</a></span>
<span class="normal"><a href="#__codelineno-0-1524">1524</a></span>
<span class="normal"><a href="#__codelineno-0-1525">1525</a></span>
<span class="normal"><a href="#__codelineno-0-1526">1526</a></span>
<span class="normal"><a href="#__codelineno-0-1527">1527</a></span>
<span class="normal"><a href="#__codelineno-0-1528">1528</a></span>
<span class="normal"><a href="#__codelineno-0-1529">1529</a></span>
<span class="normal"><a href="#__codelineno-0-1530">1530</a></span>
<span class="normal"><a href="#__codelineno-0-1531">1531</a></span>
<span class="normal"><a href="#__codelineno-0-1532">1532</a></span>
<span class="normal"><a href="#__codelineno-0-1533">1533</a></span>
<span class="normal"><a href="#__codelineno-0-1534">1534</a></span>
<span class="normal"><a href="#__codelineno-0-1535">1535</a></span>
<span class="normal"><a href="#__codelineno-0-1536">1536</a></span>
<span class="normal"><a href="#__codelineno-0-1537">1537</a></span>
<span class="normal"><a href="#__codelineno-0-1538">1538</a></span>
<span class="normal"><a href="#__codelineno-0-1539">1539</a></span>
<span class="normal"><a href="#__codelineno-0-1540">1540</a></span>
<span class="normal"><a href="#__codelineno-0-1541">1541</a></span>
<span class="normal"><a href="#__codelineno-0-1542">1542</a></span>
<span class="normal"><a href="#__codelineno-0-1543">1543</a></span>
<span class="normal"><a href="#__codelineno-0-1544">1544</a></span>
<span class="normal"><a href="#__codelineno-0-1545">1545</a></span>
<span class="normal"><a href="#__codelineno-0-1546">1546</a></span>
<span class="normal"><a href="#__codelineno-0-1547">1547</a></span>
<span class="normal"><a href="#__codelineno-0-1548">1548</a></span>
<span class="normal"><a href="#__codelineno-0-1549">1549</a></span>
<span class="normal"><a href="#__codelineno-0-1550">1550</a></span>
<span class="normal"><a href="#__codelineno-0-1551">1551</a></span>
<span class="normal"><a href="#__codelineno-0-1552">1552</a></span>
<span class="normal"><a href="#__codelineno-0-1553">1553</a></span>
<span class="normal"><a href="#__codelineno-0-1554">1554</a></span>
<span class="normal"><a href="#__codelineno-0-1555">1555</a></span>
<span class="normal"><a href="#__codelineno-0-1556">1556</a></span>
<span class="normal"><a href="#__codelineno-0-1557">1557</a></span>
<span class="normal"><a href="#__codelineno-0-1558">1558</a></span>
<span class="normal"><a href="#__codelineno-0-1559">1559</a></span>
<span class="normal"><a href="#__codelineno-0-1560">1560</a></span>
<span class="normal"><a href="#__codelineno-0-1561">1561</a></span>
<span class="normal"><a href="#__codelineno-0-1562">1562</a></span>
<span class="normal"><a href="#__codelineno-0-1563">1563</a></span>
<span class="normal"><a href="#__codelineno-0-1564">1564</a></span>
<span class="normal"><a href="#__codelineno-0-1565">1565</a></span>
<span class="normal"><a href="#__codelineno-0-1566">1566</a></span>
<span class="normal"><a href="#__codelineno-0-1567">1567</a></span>
<span class="normal"><a href="#__codelineno-0-1568">1568</a></span>
<span class="normal"><a href="#__codelineno-0-1569">1569</a></span>
<span class="normal"><a href="#__codelineno-0-1570">1570</a></span>
<span class="normal"><a href="#__codelineno-0-1571">1571</a></span>
<span class="normal"><a href="#__codelineno-0-1572">1572</a></span>
<span class="normal"><a href="#__codelineno-0-1573">1573</a></span>
<span class="normal"><a href="#__codelineno-0-1574">1574</a></span>
<span class="normal"><a href="#__codelineno-0-1575">1575</a></span>
<span class="normal"><a href="#__codelineno-0-1576">1576</a></span>
<span class="normal"><a href="#__codelineno-0-1577">1577</a></span>
<span class="normal"><a href="#__codelineno-0-1578">1578</a></span>
<span class="normal"><a href="#__codelineno-0-1579">1579</a></span>
<span class="normal"><a href="#__codelineno-0-1580">1580</a></span>
<span class="normal"><a href="#__codelineno-0-1581">1581</a></span>
<span class="normal"><a href="#__codelineno-0-1582">1582</a></span>
<span class="normal"><a href="#__codelineno-0-1583">1583</a></span>
<span class="normal"><a href="#__codelineno-0-1584">1584</a></span>
<span class="normal"><a href="#__codelineno-0-1585">1585</a></span>
<span class="normal"><a href="#__codelineno-0-1586">1586</a></span>
<span class="normal"><a href="#__codelineno-0-1587">1587</a></span>
<span class="normal"><a href="#__codelineno-0-1588">1588</a></span>
<span class="normal"><a href="#__codelineno-0-1589">1589</a></span>
<span class="normal"><a href="#__codelineno-0-1590">1590</a></span>
<span class="normal"><a href="#__codelineno-0-1591">1591</a></span>
<span class="normal"><a href="#__codelineno-0-1592">1592</a></span>
<span class="normal"><a href="#__codelineno-0-1593">1593</a></span>
<span class="normal"><a href="#__codelineno-0-1594">1594</a></span>
<span class="normal"><a href="#__codelineno-0-1595">1595</a></span>
<span class="normal"><a href="#__codelineno-0-1596">1596</a></span>
<span class="normal"><a href="#__codelineno-0-1597">1597</a></span>
<span class="normal"><a href="#__codelineno-0-1598">1598</a></span>
<span class="normal"><a href="#__codelineno-0-1599">1599</a></span>
<span class="normal"><a href="#__codelineno-0-1600">1600</a></span>
<span class="normal"><a href="#__codelineno-0-1601">1601</a></span>
<span class="normal"><a href="#__codelineno-0-1602">1602</a></span>
<span class="normal"><a href="#__codelineno-0-1603">1603</a></span>
<span class="normal"><a href="#__codelineno-0-1604">1604</a></span>
<span class="normal"><a href="#__codelineno-0-1605">1605</a></span>
<span class="normal"><a href="#__codelineno-0-1606">1606</a></span>
<span class="normal"><a href="#__codelineno-0-1607">1607</a></span>
<span class="normal"><a href="#__codelineno-0-1608">1608</a></span>
<span class="normal"><a href="#__codelineno-0-1609">1609</a></span>
<span class="normal"><a href="#__codelineno-0-1610">1610</a></span>
<span class="normal"><a href="#__codelineno-0-1611">1611</a></span>
<span class="normal"><a href="#__codelineno-0-1612">1612</a></span>
<span class="normal"><a href="#__codelineno-0-1613">1613</a></span>
<span class="normal"><a href="#__codelineno-0-1614">1614</a></span>
<span class="normal"><a href="#__codelineno-0-1615">1615</a></span>
<span class="normal"><a href="#__codelineno-0-1616">1616</a></span>
<span class="normal"><a href="#__codelineno-0-1617">1617</a></span>
<span class="normal"><a href="#__codelineno-0-1618">1618</a></span>
<span class="normal"><a href="#__codelineno-0-1619">1619</a></span>
<span class="normal"><a href="#__codelineno-0-1620">1620</a></span>
<span class="normal"><a href="#__codelineno-0-1621">1621</a></span>
<span class="normal"><a href="#__codelineno-0-1622">1622</a></span>
<span class="normal"><a href="#__codelineno-0-1623">1623</a></span>
<span class="normal"><a href="#__codelineno-0-1624">1624</a></span>
<span class="normal"><a href="#__codelineno-0-1625">1625</a></span>
<span class="normal"><a href="#__codelineno-0-1626">1626</a></span>
<span class="normal"><a href="#__codelineno-0-1627">1627</a></span>
<span class="normal"><a href="#__codelineno-0-1628">1628</a></span>
<span class="normal"><a href="#__codelineno-0-1629">1629</a></span>
<span class="normal"><a href="#__codelineno-0-1630">1630</a></span>
<span class="normal"><a href="#__codelineno-0-1631">1631</a></span>
<span class="normal"><a href="#__codelineno-0-1632">1632</a></span>
<span class="normal"><a href="#__codelineno-0-1633">1633</a></span>
<span class="normal"><a href="#__codelineno-0-1634">1634</a></span>
<span class="normal"><a href="#__codelineno-0-1635">1635</a></span>
<span class="normal"><a href="#__codelineno-0-1636">1636</a></span>
<span class="normal"><a href="#__codelineno-0-1637">1637</a></span>
<span class="normal"><a href="#__codelineno-0-1638">1638</a></span>
<span class="normal"><a href="#__codelineno-0-1639">1639</a></span>
<span class="normal"><a href="#__codelineno-0-1640">1640</a></span>
<span class="normal"><a href="#__codelineno-0-1641">1641</a></span>
<span class="normal"><a href="#__codelineno-0-1642">1642</a></span>
<span class="normal"><a href="#__codelineno-0-1643">1643</a></span>
<span class="normal"><a href="#__codelineno-0-1644">1644</a></span>
<span class="normal"><a href="#__codelineno-0-1645">1645</a></span>
<span class="normal"><a href="#__codelineno-0-1646">1646</a></span>
<span class="normal"><a href="#__codelineno-0-1647">1647</a></span>
<span class="normal"><a href="#__codelineno-0-1648">1648</a></span>
<span class="normal"><a href="#__codelineno-0-1649">1649</a></span>
<span class="normal"><a href="#__codelineno-0-1650">1650</a></span>
<span class="normal"><a href="#__codelineno-0-1651">1651</a></span>
<span class="normal"><a href="#__codelineno-0-1652">1652</a></span>
<span class="normal"><a href="#__codelineno-0-1653">1653</a></span>
<span class="normal"><a href="#__codelineno-0-1654">1654</a></span>
<span class="normal"><a href="#__codelineno-0-1655">1655</a></span>
<span class="normal"><a href="#__codelineno-0-1656">1656</a></span>
<span class="normal"><a href="#__codelineno-0-1657">1657</a></span>
<span class="normal"><a href="#__codelineno-0-1658">1658</a></span>
<span class="normal"><a href="#__codelineno-0-1659">1659</a></span>
<span class="normal"><a href="#__codelineno-0-1660">1660</a></span>
<span class="normal"><a href="#__codelineno-0-1661">1661</a></span>
<span class="normal"><a href="#__codelineno-0-1662">1662</a></span>
<span class="normal"><a href="#__codelineno-0-1663">1663</a></span>
<span class="normal"><a href="#__codelineno-0-1664">1664</a></span>
<span class="normal"><a href="#__codelineno-0-1665">1665</a></span>
<span class="normal"><a href="#__codelineno-0-1666">1666</a></span>
<span class="normal"><a href="#__codelineno-0-1667">1667</a></span>
<span class="normal"><a href="#__codelineno-0-1668">1668</a></span>
<span class="normal"><a href="#__codelineno-0-1669">1669</a></span>
<span class="normal"><a href="#__codelineno-0-1670">1670</a></span>
<span class="normal"><a href="#__codelineno-0-1671">1671</a></span>
<span class="normal"><a href="#__codelineno-0-1672">1672</a></span>
<span class="normal"><a href="#__codelineno-0-1673">1673</a></span>
<span class="normal"><a href="#__codelineno-0-1674">1674</a></span>
<span class="normal"><a href="#__codelineno-0-1675">1675</a></span>
<span class="normal"><a href="#__codelineno-0-1676">1676</a></span>
<span class="normal"><a href="#__codelineno-0-1677">1677</a></span>
<span class="normal"><a href="#__codelineno-0-1678">1678</a></span>
<span class="normal"><a href="#__codelineno-0-1679">1679</a></span>
<span class="normal"><a href="#__codelineno-0-1680">1680</a></span>
<span class="normal"><a href="#__codelineno-0-1681">1681</a></span>
<span class="normal"><a href="#__codelineno-0-1682">1682</a></span>
<span class="normal"><a href="#__codelineno-0-1683">1683</a></span>
<span class="normal"><a href="#__codelineno-0-1684">1684</a></span>
<span class="normal"><a href="#__codelineno-0-1685">1685</a></span>
<span class="normal"><a href="#__codelineno-0-1686">1686</a></span>
<span class="normal"><a href="#__codelineno-0-1687">1687</a></span>
<span class="normal"><a href="#__codelineno-0-1688">1688</a></span>
<span class="normal"><a href="#__codelineno-0-1689">1689</a></span>
<span class="normal"><a href="#__codelineno-0-1690">1690</a></span>
<span class="normal"><a href="#__codelineno-0-1691">1691</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1244"><a id="__codelineno-0-1244" name="__codelineno-0-1244"></a><span class="k">def</span><span class="w"> </span><span class="nf">_parse_datastore</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-1245"><a id="__codelineno-0-1245" name="__codelineno-0-1245"></a><span class="w">    </span><span class="sd">"""Parse datastore to discover available components."""</span>
</span><span id="__span-0-1246"><a id="__codelineno-0-1246" name="__codelineno-0-1246"></a>
</span><span id="__span-0-1247"><a id="__codelineno-0-1247" name="__codelineno-0-1247"></a>    <span class="c1"># directory structure as defined by qi2lab spec</span>
</span><span id="__span-0-1248"><a id="__codelineno-0-1248" name="__codelineno-0-1248"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"calibrations.zarr"</span><span class="p">)</span>
</span><span id="__span-0-1249"><a id="__codelineno-0-1249" name="__codelineno-0-1249"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"polyDT"</span><span class="p">)</span>
</span><span id="__span-0-1250"><a id="__codelineno-0-1250" name="__codelineno-0-1250"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"readouts"</span><span class="p">)</span>
</span><span id="__span-0-1251"><a id="__codelineno-0-1251" name="__codelineno-0-1251"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-1252"><a id="__codelineno-0-1252" name="__codelineno-0-1252"></a>        <span class="sa">r</span><span class="s2">"ufish_localizations"</span>
</span><span id="__span-0-1253"><a id="__codelineno-0-1253" name="__codelineno-0-1253"></a>    <span class="p">)</span>
</span><span id="__span-0-1254"><a id="__codelineno-0-1254" name="__codelineno-0-1254"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"decoded"</span><span class="p">)</span>
</span><span id="__span-0-1255"><a id="__codelineno-0-1255" name="__codelineno-0-1255"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"fused"</span><span class="p">)</span>
</span><span id="__span-0-1256"><a id="__codelineno-0-1256" name="__codelineno-0-1256"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"segmentation"</span><span class="p">)</span>
</span><span id="__span-0-1257"><a id="__codelineno-0-1257" name="__codelineno-0-1257"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_mtx_output_root_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"mtx_output"</span><span class="p">)</span>
</span><span id="__span-0-1258"><a id="__codelineno-0-1258" name="__codelineno-0-1258"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state_json_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-1259"><a id="__codelineno-0-1259" name="__codelineno-0-1259"></a>        <span class="sa">r</span><span class="s2">"datastore_state.json"</span>
</span><span id="__span-0-1260"><a id="__codelineno-0-1260" name="__codelineno-0-1260"></a>    <span class="p">)</span>
</span><span id="__span-0-1261"><a id="__codelineno-0-1261" name="__codelineno-0-1261"></a>
</span><span id="__span-0-1262"><a id="__codelineno-0-1262" name="__codelineno-0-1262"></a>    <span class="c1"># read in .json in root directory that indicates what steps have been run</span>
</span><span id="__span-0-1263"><a id="__codelineno-0-1263" name="__codelineno-0-1263"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state_json_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">json_file</span><span class="p">:</span>
</span><span id="__span-0-1264"><a id="__codelineno-0-1264" name="__codelineno-0-1264"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">json_file</span><span class="p">)</span>
</span><span id="__span-0-1265"><a id="__codelineno-0-1265" name="__codelineno-0-1265"></a>
</span><span id="__span-0-1266"><a id="__codelineno-0-1266" name="__codelineno-0-1266"></a>    <span class="c1"># validate calibrations.zarr</span>
</span><span id="__span-0-1267"><a id="__codelineno-0-1267" name="__codelineno-0-1267"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"Calibrations"</span><span class="p">]:</span>
</span><span id="__span-0-1268"><a id="__codelineno-0-1268" name="__codelineno-0-1268"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1269"><a id="__codelineno-0-1269" name="__codelineno-0-1269"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Calibration data error."</span><span class="p">)</span>
</span><span id="__span-0-1270"><a id="__codelineno-0-1270" name="__codelineno-0-1270"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1271"><a id="__codelineno-0-1271" name="__codelineno-0-1271"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1272"><a id="__codelineno-0-1272" name="__codelineno-0-1272"></a>            <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1273"><a id="__codelineno-0-1273" name="__codelineno-0-1273"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1274"><a id="__codelineno-0-1274" name="__codelineno-0-1274"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Calibration attributes not found"</span><span class="p">)</span>
</span><span id="__span-0-1275"><a id="__codelineno-0-1275" name="__codelineno-0-1275"></a>
</span><span id="__span-0-1276"><a id="__codelineno-0-1276" name="__codelineno-0-1276"></a>        <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-1277"><a id="__codelineno-0-1277" name="__codelineno-0-1277"></a>            <span class="s2">"num_rounds"</span><span class="p">,</span>
</span><span id="__span-0-1278"><a id="__codelineno-0-1278" name="__codelineno-0-1278"></a>            <span class="s2">"num_tiles"</span><span class="p">,</span>
</span><span id="__span-0-1279"><a id="__codelineno-0-1279" name="__codelineno-0-1279"></a>            <span class="s2">"channels_in_data"</span><span class="p">,</span>
</span><span id="__span-0-1280"><a id="__codelineno-0-1280" name="__codelineno-0-1280"></a>            <span class="s2">"tile_overlap"</span><span class="p">,</span>
</span><span id="__span-0-1281"><a id="__codelineno-0-1281" name="__codelineno-0-1281"></a>            <span class="s2">"binning"</span><span class="p">,</span>
</span><span id="__span-0-1282"><a id="__codelineno-0-1282" name="__codelineno-0-1282"></a>            <span class="s2">"e_per_ADU"</span><span class="p">,</span>
</span><span id="__span-0-1283"><a id="__codelineno-0-1283" name="__codelineno-0-1283"></a>            <span class="s2">"na"</span><span class="p">,</span>
</span><span id="__span-0-1284"><a id="__codelineno-0-1284" name="__codelineno-0-1284"></a>            <span class="s2">"ri"</span><span class="p">,</span>
</span><span id="__span-0-1285"><a id="__codelineno-0-1285" name="__codelineno-0-1285"></a>            <span class="s2">"exp_order"</span><span class="p">,</span>
</span><span id="__span-0-1286"><a id="__codelineno-0-1286" name="__codelineno-0-1286"></a>            <span class="s2">"codebook"</span><span class="p">,</span>
</span><span id="__span-0-1287"><a id="__codelineno-0-1287" name="__codelineno-0-1287"></a>            <span class="s2">"num_bits"</span>
</span><span id="__span-0-1288"><a id="__codelineno-0-1288" name="__codelineno-0-1288"></a>        <span class="p">]</span>
</span><span id="__span-0-1289"><a id="__codelineno-0-1289" name="__codelineno-0-1289"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"Version"</span><span class="p">]</span> <span class="o">==</span> <span class="mf">0.3</span><span class="p">:</span>
</span><span id="__span-0-1290"><a id="__codelineno-0-1290" name="__codelineno-0-1290"></a>            <span class="n">keys_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"microscope_type"</span><span class="p">)</span>
</span><span id="__span-0-1291"><a id="__codelineno-0-1291" name="__codelineno-0-1291"></a>            <span class="n">keys_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"camera_model"</span><span class="p">)</span>
</span><span id="__span-0-1292"><a id="__codelineno-0-1292" name="__codelineno-0-1292"></a>            <span class="n">keys_to_check</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">"voxel_size_zyx_um"</span><span class="p">)</span>
</span><span id="__span-0-1293"><a id="__codelineno-0-1293" name="__codelineno-0-1293"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">:</span>
</span><span id="__span-0-1294"><a id="__codelineno-0-1294" name="__codelineno-0-1294"></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-0-1295"><a id="__codelineno-0-1295" name="__codelineno-0-1295"></a>                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Calibration attributes incomplete"</span><span class="p">)</span>
</span><span id="__span-0-1296"><a id="__codelineno-0-1296" name="__codelineno-0-1296"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1297"><a id="__codelineno-0-1297" name="__codelineno-0-1297"></a>                <span class="nb">setattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_"</span> <span class="o">+</span> <span class="n">key</span><span class="p">,</span> <span class="n">attributes</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
</span><span id="__span-0-1298"><a id="__codelineno-0-1298" name="__codelineno-0-1298"></a>
</span><span id="__span-0-1299"><a id="__codelineno-0-1299" name="__codelineno-0-1299"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1300"><a id="__codelineno-0-1300" name="__codelineno-0-1300"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_calibrations_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"psf_data"</span><span class="p">)</span>
</span><span id="__span-0-1301"><a id="__codelineno-0-1301" name="__codelineno-0-1301"></a>        <span class="p">)</span>
</span><span id="__span-0-1302"><a id="__codelineno-0-1302" name="__codelineno-0-1302"></a>
</span><span id="__span-0-1303"><a id="__codelineno-0-1303" name="__codelineno-0-1303"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1304"><a id="__codelineno-0-1304" name="__codelineno-0-1304"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_psfs</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-1305"><a id="__codelineno-0-1305" name="__codelineno-0-1305"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1306"><a id="__codelineno-0-1306" name="__codelineno-0-1306"></a>                    <span class="n">kvstore</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1307"><a id="__codelineno-0-1307" name="__codelineno-0-1307"></a>                    <span class="n">spec</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1308"><a id="__codelineno-0-1308" name="__codelineno-0-1308"></a>                <span class="p">)</span>
</span><span id="__span-0-1309"><a id="__codelineno-0-1309" name="__codelineno-0-1309"></a>            <span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-0-1310"><a id="__codelineno-0-1310" name="__codelineno-0-1310"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1311"><a id="__codelineno-0-1311" name="__codelineno-0-1311"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Calibration psfs missing."</span><span class="p">)</span>
</span><span id="__span-0-1312"><a id="__codelineno-0-1312" name="__codelineno-0-1312"></a>
</span><span id="__span-0-1313"><a id="__codelineno-0-1313" name="__codelineno-0-1313"></a>        <span class="k">del</span> <span class="n">current_local_zarr_path</span>
</span><span id="__span-0-1314"><a id="__codelineno-0-1314" name="__codelineno-0-1314"></a>
</span><span id="__span-0-1315"><a id="__codelineno-0-1315" name="__codelineno-0-1315"></a>        <span class="c1"># current_local_zarr_path = str(</span>
</span><span id="__span-0-1316"><a id="__codelineno-0-1316" name="__codelineno-0-1316"></a>        <span class="c1">#     self._calibrations_zarr_path / Path("noise_map")</span>
</span><span id="__span-0-1317"><a id="__codelineno-0-1317" name="__codelineno-0-1317"></a>        <span class="c1"># )</span>
</span><span id="__span-0-1318"><a id="__codelineno-0-1318" name="__codelineno-0-1318"></a>
</span><span id="__span-0-1319"><a id="__codelineno-0-1319" name="__codelineno-0-1319"></a>        <span class="c1"># try:</span>
</span><span id="__span-0-1320"><a id="__codelineno-0-1320" name="__codelineno-0-1320"></a>        <span class="c1">#     self._noise_map = (</span>
</span><span id="__span-0-1321"><a id="__codelineno-0-1321" name="__codelineno-0-1321"></a>        <span class="c1">#         self._load_from_zarr_array(</span>
</span><span id="__span-0-1322"><a id="__codelineno-0-1322" name="__codelineno-0-1322"></a>        <span class="c1">#             kvstore=self._get_kvstore_key(current_local_zarr_path),</span>
</span><span id="__span-0-1323"><a id="__codelineno-0-1323" name="__codelineno-0-1323"></a>        <span class="c1">#             spec=self._zarrv2_spec,</span>
</span><span id="__span-0-1324"><a id="__codelineno-0-1324" name="__codelineno-0-1324"></a>        <span class="c1">#         )</span>
</span><span id="__span-0-1325"><a id="__codelineno-0-1325" name="__codelineno-0-1325"></a>        <span class="c1">#     ).result()</span>
</span><span id="__span-0-1326"><a id="__codelineno-0-1326" name="__codelineno-0-1326"></a>        <span class="c1"># except Exception:</span>
</span><span id="__span-0-1327"><a id="__codelineno-0-1327" name="__codelineno-0-1327"></a>        <span class="c1">#     print("Calibration noise map missing.")</span>
</span><span id="__span-0-1328"><a id="__codelineno-0-1328" name="__codelineno-0-1328"></a>
</span><span id="__span-0-1329"><a id="__codelineno-0-1329" name="__codelineno-0-1329"></a>    <span class="c1"># validate polyDT and readout bits data</span>
</span><span id="__span-0-1330"><a id="__codelineno-0-1330" name="__codelineno-0-1330"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"Corrected"</span><span class="p">]:</span>
</span><span id="__span-0-1331"><a id="__codelineno-0-1331" name="__codelineno-0-1331"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1332"><a id="__codelineno-0-1332" name="__codelineno-0-1332"></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">"PolyDT directory not initialized"</span><span class="p">)</span>
</span><span id="__span-0-1333"><a id="__codelineno-0-1333" name="__codelineno-0-1333"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1334"><a id="__codelineno-0-1334" name="__codelineno-0-1334"></a>            <span class="n">polyDT_tile_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="__span-0-1335"><a id="__codelineno-0-1335" name="__codelineno-0-1335"></a>                <span class="p">[</span>
</span><span id="__span-0-1336"><a id="__codelineno-0-1336" name="__codelineno-0-1336"></a>                    <span class="n">entry</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-0-1337"><a id="__codelineno-0-1337" name="__codelineno-0-1337"></a>                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
</span><span id="__span-0-1338"><a id="__codelineno-0-1338" name="__codelineno-0-1338"></a>                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
</span><span id="__span-0-1339"><a id="__codelineno-0-1339" name="__codelineno-0-1339"></a>                <span class="p">],</span>
</span><span id="__span-0-1340"><a id="__codelineno-0-1340" name="__codelineno-0-1340"></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"tile"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">".zarr"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="__span-0-1341"><a id="__codelineno-0-1341" name="__codelineno-0-1341"></a>            <span class="p">)</span>
</span><span id="__span-0-1342"><a id="__codelineno-0-1342" name="__codelineno-0-1342"></a>            <span class="n">current_tile_dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-1343"><a id="__codelineno-0-1343" name="__codelineno-0-1343"></a>                <span class="n">polyDT_tile_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-1344"><a id="__codelineno-0-1344" name="__codelineno-0-1344"></a>            <span class="p">)</span>
</span><span id="__span-0-1345"><a id="__codelineno-0-1345" name="__codelineno-0-1345"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="__span-0-1346"><a id="__codelineno-0-1346" name="__codelineno-0-1346"></a>                <span class="p">[</span>
</span><span id="__span-0-1347"><a id="__codelineno-0-1347" name="__codelineno-0-1347"></a>                    <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"."</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-1348"><a id="__codelineno-0-1348" name="__codelineno-0-1348"></a>                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">current_tile_dir_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
</span><span id="__span-0-1349"><a id="__codelineno-0-1349" name="__codelineno-0-1349"></a>                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
</span><span id="__span-0-1350"><a id="__codelineno-0-1350" name="__codelineno-0-1350"></a>                <span class="p">],</span>
</span><span id="__span-0-1351"><a id="__codelineno-0-1351" name="__codelineno-0-1351"></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"round"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">".zarr"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="__span-0-1352"><a id="__codelineno-0-1352" name="__codelineno-0-1352"></a>            <span class="p">)</span>
</span><span id="__span-0-1353"><a id="__codelineno-0-1353" name="__codelineno-0-1353"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1354"><a id="__codelineno-0-1354" name="__codelineno-0-1354"></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">"Readout directory not initialized"</span><span class="p">)</span>
</span><span id="__span-0-1355"><a id="__codelineno-0-1355" name="__codelineno-0-1355"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1356"><a id="__codelineno-0-1356" name="__codelineno-0-1356"></a>            <span class="n">readout_tile_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="__span-0-1357"><a id="__codelineno-0-1357" name="__codelineno-0-1357"></a>                <span class="p">[</span>
</span><span id="__span-0-1358"><a id="__codelineno-0-1358" name="__codelineno-0-1358"></a>                    <span class="n">entry</span><span class="o">.</span><span class="n">name</span>
</span><span id="__span-0-1359"><a id="__codelineno-0-1359" name="__codelineno-0-1359"></a>                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
</span><span id="__span-0-1360"><a id="__codelineno-0-1360" name="__codelineno-0-1360"></a>                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
</span><span id="__span-0-1361"><a id="__codelineno-0-1361" name="__codelineno-0-1361"></a>                <span class="p">],</span>
</span><span id="__span-0-1362"><a id="__codelineno-0-1362" name="__codelineno-0-1362"></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"tile"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">".zarr"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="__span-0-1363"><a id="__codelineno-0-1363" name="__codelineno-0-1363"></a>            <span class="p">)</span>
</span><span id="__span-0-1364"><a id="__codelineno-0-1364" name="__codelineno-0-1364"></a>            <span class="n">current_tile_dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-1365"><a id="__codelineno-0-1365" name="__codelineno-0-1365"></a>                <span class="n">readout_tile_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-1366"><a id="__codelineno-0-1366" name="__codelineno-0-1366"></a>            <span class="p">)</span>
</span><span id="__span-0-1367"><a id="__codelineno-0-1367" name="__codelineno-0-1367"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span>
</span><span id="__span-0-1368"><a id="__codelineno-0-1368" name="__codelineno-0-1368"></a>                <span class="p">[</span>
</span><span id="__span-0-1369"><a id="__codelineno-0-1369" name="__codelineno-0-1369"></a>                    <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"."</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
</span><span id="__span-0-1370"><a id="__codelineno-0-1370" name="__codelineno-0-1370"></a>                    <span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">current_tile_dir_path</span><span class="o">.</span><span class="n">iterdir</span><span class="p">()</span>
</span><span id="__span-0-1371"><a id="__codelineno-0-1371" name="__codelineno-0-1371"></a>                    <span class="k">if</span> <span class="n">entry</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span>
</span><span id="__span-0-1372"><a id="__codelineno-0-1372" name="__codelineno-0-1372"></a>                <span class="p">],</span>
</span><span id="__span-0-1373"><a id="__codelineno-0-1373" name="__codelineno-0-1373"></a>                <span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"bit"</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">".zarr"</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span>
</span><span id="__span-0-1374"><a id="__codelineno-0-1374" name="__codelineno-0-1374"></a>            <span class="p">)</span>
</span><span id="__span-0-1375"><a id="__codelineno-0-1375" name="__codelineno-0-1375"></a>        <span class="k">assert</span> <span class="p">(</span>
</span><span id="__span-0-1376"><a id="__codelineno-0-1376" name="__codelineno-0-1376"></a>            <span class="n">polyDT_tile_ids</span> <span class="o">==</span> <span class="n">readout_tile_ids</span>
</span><span id="__span-0-1377"><a id="__codelineno-0-1377" name="__codelineno-0-1377"></a>        <span class="p">),</span> <span class="s2">"polyDT and readout tile ids do not match. Conversion error."</span>
</span><span id="__span-0-1378"><a id="__codelineno-0-1378" name="__codelineno-0-1378"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span> <span class="o">=</span> <span class="n">polyDT_tile_ids</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-0-1379"><a id="__codelineno-0-1379" name="__codelineno-0-1379"></a>        <span class="k">del</span> <span class="n">polyDT_tile_ids</span><span class="p">,</span> <span class="n">readout_tile_ids</span>
</span><span id="__span-0-1380"><a id="__codelineno-0-1380" name="__codelineno-0-1380"></a>
</span><span id="__span-0-1381"><a id="__codelineno-0-1381" name="__codelineno-0-1381"></a>        <span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">):</span>
</span><span id="__span-0-1382"><a id="__codelineno-0-1382" name="__codelineno-0-1382"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1383"><a id="__codelineno-0-1383" name="__codelineno-0-1383"></a>                <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1384"><a id="__codelineno-0-1384" name="__codelineno-0-1384"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1385"><a id="__codelineno-0-1385" name="__codelineno-0-1385"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1386"><a id="__codelineno-0-1386" name="__codelineno-0-1386"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1387"><a id="__codelineno-0-1387" name="__codelineno-0-1387"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1388"><a id="__codelineno-0-1388" name="__codelineno-0-1388"></a>                <span class="p">)</span>
</span><span id="__span-0-1389"><a id="__codelineno-0-1389" name="__codelineno-0-1389"></a>                <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1390"><a id="__codelineno-0-1390" name="__codelineno-0-1390"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1391"><a id="__codelineno-0-1391" name="__codelineno-0-1391"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"polyDT tile attributes not found"</span><span class="p">)</span>
</span><span id="__span-0-1392"><a id="__codelineno-0-1392" name="__codelineno-0-1392"></a>
</span><span id="__span-0-1393"><a id="__codelineno-0-1393" name="__codelineno-0-1393"></a>            <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-1394"><a id="__codelineno-0-1394" name="__codelineno-0-1394"></a>                <span class="s2">"stage_zyx_um"</span><span class="p">,</span>
</span><span id="__span-0-1395"><a id="__codelineno-0-1395" name="__codelineno-0-1395"></a>                <span class="s2">"excitation_um"</span><span class="p">,</span>
</span><span id="__span-0-1396"><a id="__codelineno-0-1396" name="__codelineno-0-1396"></a>                <span class="s2">"emission_um"</span><span class="p">,</span>
</span><span id="__span-0-1397"><a id="__codelineno-0-1397" name="__codelineno-0-1397"></a>                <span class="s2">"bit_linker"</span><span class="p">,</span>
</span><span id="__span-0-1398"><a id="__codelineno-0-1398" name="__codelineno-0-1398"></a>                <span class="c1"># "exposure_ms",</span>
</span><span id="__span-0-1399"><a id="__codelineno-0-1399" name="__codelineno-0-1399"></a>                <span class="s2">"psf_idx"</span><span class="p">,</span>
</span><span id="__span-0-1400"><a id="__codelineno-0-1400" name="__codelineno-0-1400"></a>            <span class="p">]</span>
</span><span id="__span-0-1401"><a id="__codelineno-0-1401" name="__codelineno-0-1401"></a>
</span><span id="__span-0-1402"><a id="__codelineno-0-1402" name="__codelineno-0-1402"></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">:</span>
</span><span id="__span-0-1403"><a id="__codelineno-0-1403" name="__codelineno-0-1403"></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-0-1404"><a id="__codelineno-0-1404" name="__codelineno-0-1404"></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>
</span><span id="__span-0-1405"><a id="__codelineno-0-1405" name="__codelineno-0-1405"></a>                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Corrected polyDT attributes incomplete"</span><span class="p">)</span>
</span><span id="__span-0-1406"><a id="__codelineno-0-1406" name="__codelineno-0-1406"></a>
</span><span id="__span-0-1407"><a id="__codelineno-0-1407" name="__codelineno-0-1407"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1408"><a id="__codelineno-0-1408" name="__codelineno-0-1408"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1409"><a id="__codelineno-0-1409" name="__codelineno-0-1409"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1410"><a id="__codelineno-0-1410" name="__codelineno-0-1410"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1411"><a id="__codelineno-0-1411" name="__codelineno-0-1411"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"corrected_data"</span><span class="p">)</span>
</span><span id="__span-0-1412"><a id="__codelineno-0-1412" name="__codelineno-0-1412"></a>            <span class="p">)</span>
</span><span id="__span-0-1413"><a id="__codelineno-0-1413" name="__codelineno-0-1413"></a>
</span><span id="__span-0-1414"><a id="__codelineno-0-1414" name="__codelineno-0-1414"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1415"><a id="__codelineno-0-1415" name="__codelineno-0-1415"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1416"><a id="__codelineno-0-1416" name="__codelineno-0-1416"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1417"><a id="__codelineno-0-1417" name="__codelineno-0-1417"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1418"><a id="__codelineno-0-1418" name="__codelineno-0-1418"></a>                <span class="p">)</span>
</span><span id="__span-0-1419"><a id="__codelineno-0-1419" name="__codelineno-0-1419"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1420"><a id="__codelineno-0-1420" name="__codelineno-0-1420"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-1421"><a id="__codelineno-0-1421" name="__codelineno-0-1421"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Corrected polyDT data missing."</span><span class="p">)</span>
</span><span id="__span-0-1422"><a id="__codelineno-0-1422" name="__codelineno-0-1422"></a>
</span><span id="__span-0-1423"><a id="__codelineno-0-1423" name="__codelineno-0-1423"></a>        <span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">bit_id</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-1424"><a id="__codelineno-0-1424" name="__codelineno-0-1424"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1425"><a id="__codelineno-0-1425" name="__codelineno-0-1425"></a>                <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1426"><a id="__codelineno-0-1426" name="__codelineno-0-1426"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-1427"><a id="__codelineno-0-1427" name="__codelineno-0-1427"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1428"><a id="__codelineno-0-1428" name="__codelineno-0-1428"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1429"><a id="__codelineno-0-1429" name="__codelineno-0-1429"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1430"><a id="__codelineno-0-1430" name="__codelineno-0-1430"></a>                <span class="p">)</span>
</span><span id="__span-0-1431"><a id="__codelineno-0-1431" name="__codelineno-0-1431"></a>                <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1432"><a id="__codelineno-0-1432" name="__codelineno-0-1432"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1433"><a id="__codelineno-0-1433" name="__codelineno-0-1433"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Readout tile attributes not found"</span><span class="p">)</span>
</span><span id="__span-0-1434"><a id="__codelineno-0-1434" name="__codelineno-0-1434"></a>
</span><span id="__span-0-1435"><a id="__codelineno-0-1435" name="__codelineno-0-1435"></a>            <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span>
</span><span id="__span-0-1436"><a id="__codelineno-0-1436" name="__codelineno-0-1436"></a>                <span class="s2">"excitation_um"</span><span class="p">,</span>
</span><span id="__span-0-1437"><a id="__codelineno-0-1437" name="__codelineno-0-1437"></a>                <span class="s2">"emission_um"</span><span class="p">,</span>
</span><span id="__span-0-1438"><a id="__codelineno-0-1438" name="__codelineno-0-1438"></a>                <span class="s2">"round_linker"</span><span class="p">,</span>
</span><span id="__span-0-1439"><a id="__codelineno-0-1439" name="__codelineno-0-1439"></a>                <span class="c1"># "exposure_ms",</span>
</span><span id="__span-0-1440"><a id="__codelineno-0-1440" name="__codelineno-0-1440"></a>                <span class="s2">"psf_idx"</span><span class="p">,</span>
</span><span id="__span-0-1441"><a id="__codelineno-0-1441" name="__codelineno-0-1441"></a>            <span class="p">]</span>
</span><span id="__span-0-1442"><a id="__codelineno-0-1442" name="__codelineno-0-1442"></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">:</span>
</span><span id="__span-0-1443"><a id="__codelineno-0-1443" name="__codelineno-0-1443"></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-0-1444"><a id="__codelineno-0-1444" name="__codelineno-0-1444"></a>                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Corrected readout attributes incomplete"</span><span class="p">)</span>
</span><span id="__span-0-1445"><a id="__codelineno-0-1445" name="__codelineno-0-1445"></a>
</span><span id="__span-0-1446"><a id="__codelineno-0-1446" name="__codelineno-0-1446"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1447"><a id="__codelineno-0-1447" name="__codelineno-0-1447"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-1448"><a id="__codelineno-0-1448" name="__codelineno-0-1448"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1449"><a id="__codelineno-0-1449" name="__codelineno-0-1449"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1450"><a id="__codelineno-0-1450" name="__codelineno-0-1450"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"corrected_data"</span><span class="p">)</span>
</span><span id="__span-0-1451"><a id="__codelineno-0-1451" name="__codelineno-0-1451"></a>            <span class="p">)</span>
</span><span id="__span-0-1452"><a id="__codelineno-0-1452" name="__codelineno-0-1452"></a>
</span><span id="__span-0-1453"><a id="__codelineno-0-1453" name="__codelineno-0-1453"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1454"><a id="__codelineno-0-1454" name="__codelineno-0-1454"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1455"><a id="__codelineno-0-1455" name="__codelineno-0-1455"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1456"><a id="__codelineno-0-1456" name="__codelineno-0-1456"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1457"><a id="__codelineno-0-1457" name="__codelineno-0-1457"></a>                <span class="p">)</span>
</span><span id="__span-0-1458"><a id="__codelineno-0-1458" name="__codelineno-0-1458"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1459"><a id="__codelineno-0-1459" name="__codelineno-0-1459"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">bit_id</span><span class="p">)</span>
</span><span id="__span-0-1460"><a id="__codelineno-0-1460" name="__codelineno-0-1460"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Corrected readout data missing."</span><span class="p">)</span>
</span><span id="__span-0-1461"><a id="__codelineno-0-1461" name="__codelineno-0-1461"></a>
</span><span id="__span-0-1462"><a id="__codelineno-0-1462" name="__codelineno-0-1462"></a>    <span class="c1"># check and validate local registered data</span>
</span><span id="__span-0-1463"><a id="__codelineno-0-1463" name="__codelineno-0-1463"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"LocalRegistered"</span><span class="p">]:</span>
</span><span id="__span-0-1464"><a id="__codelineno-0-1464" name="__codelineno-0-1464"></a>        <span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">):</span>
</span><span id="__span-0-1465"><a id="__codelineno-0-1465" name="__codelineno-0-1465"></a>            <span class="k">if</span> <span class="n">round_id</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="__span-0-1466"><a id="__codelineno-0-1466" name="__codelineno-0-1466"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1467"><a id="__codelineno-0-1467" name="__codelineno-0-1467"></a>                    <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1468"><a id="__codelineno-0-1468" name="__codelineno-0-1468"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1469"><a id="__codelineno-0-1469" name="__codelineno-0-1469"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1470"><a id="__codelineno-0-1470" name="__codelineno-0-1470"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1471"><a id="__codelineno-0-1471" name="__codelineno-0-1471"></a>                        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1472"><a id="__codelineno-0-1472" name="__codelineno-0-1472"></a>                    <span class="p">)</span>
</span><span id="__span-0-1473"><a id="__codelineno-0-1473" name="__codelineno-0-1473"></a>                    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-1474"><a id="__codelineno-0-1474" name="__codelineno-0-1474"></a>                        <span class="n">attributes</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-0-1475"><a id="__codelineno-0-1475" name="__codelineno-0-1475"></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1476"><a id="__codelineno-0-1476" name="__codelineno-0-1476"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"polyDT tile attributes not found"</span><span class="p">)</span>
</span><span id="__span-0-1477"><a id="__codelineno-0-1477" name="__codelineno-0-1477"></a>
</span><span id="__span-0-1478"><a id="__codelineno-0-1478" name="__codelineno-0-1478"></a>                <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"rigid_xform_xyz_px"</span><span class="p">]</span>
</span><span id="__span-0-1479"><a id="__codelineno-0-1479" name="__codelineno-0-1479"></a>
</span><span id="__span-0-1480"><a id="__codelineno-0-1480" name="__codelineno-0-1480"></a>                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">:</span>
</span><span id="__span-0-1481"><a id="__codelineno-0-1481" name="__codelineno-0-1481"></a>                    <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-0-1482"><a id="__codelineno-0-1482" name="__codelineno-0-1482"></a>                        <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="sa">f</span><span class="s2">"</span><span class="si">{</span><span class="n">round_id</span><span class="p">,</span><span class="n">tile_id</span><span class="si">}</span><span class="s2"> Rigid registration missing"</span><span class="p">)</span>
</span><span id="__span-0-1483"><a id="__codelineno-0-1483" name="__codelineno-0-1483"></a>
</span><span id="__span-0-1484"><a id="__codelineno-0-1484" name="__codelineno-0-1484"></a>                <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1485"><a id="__codelineno-0-1485" name="__codelineno-0-1485"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1486"><a id="__codelineno-0-1486" name="__codelineno-0-1486"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1487"><a id="__codelineno-0-1487" name="__codelineno-0-1487"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1488"><a id="__codelineno-0-1488" name="__codelineno-0-1488"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"opticalflow_xform_px"</span><span class="p">)</span>
</span><span id="__span-0-1489"><a id="__codelineno-0-1489" name="__codelineno-0-1489"></a>                <span class="p">)</span>
</span><span id="__span-0-1490"><a id="__codelineno-0-1490" name="__codelineno-0-1490"></a>
</span><span id="__span-0-1491"><a id="__codelineno-0-1491" name="__codelineno-0-1491"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1492"><a id="__codelineno-0-1492" name="__codelineno-0-1492"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1493"><a id="__codelineno-0-1493" name="__codelineno-0-1493"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1494"><a id="__codelineno-0-1494" name="__codelineno-0-1494"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1495"><a id="__codelineno-0-1495" name="__codelineno-0-1495"></a>                    <span class="p">)</span>
</span><span id="__span-0-1496"><a id="__codelineno-0-1496" name="__codelineno-0-1496"></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1497"><a id="__codelineno-0-1497" name="__codelineno-0-1497"></a>                    <span class="c1">#print(tile_id, round_id)</span>
</span><span id="__span-0-1498"><a id="__codelineno-0-1498" name="__codelineno-0-1498"></a>                    <span class="c1">#print("Optical flow registration data missing.")</span>
</span><span id="__span-0-1499"><a id="__codelineno-0-1499" name="__codelineno-0-1499"></a>                    <span class="k">pass</span>
</span><span id="__span-0-1500"><a id="__codelineno-0-1500" name="__codelineno-0-1500"></a>
</span><span id="__span-0-1501"><a id="__codelineno-0-1501" name="__codelineno-0-1501"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1502"><a id="__codelineno-0-1502" name="__codelineno-0-1502"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1503"><a id="__codelineno-0-1503" name="__codelineno-0-1503"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1504"><a id="__codelineno-0-1504" name="__codelineno-0-1504"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1505"><a id="__codelineno-0-1505" name="__codelineno-0-1505"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_decon_data"</span><span class="p">)</span>
</span><span id="__span-0-1506"><a id="__codelineno-0-1506" name="__codelineno-0-1506"></a>            <span class="p">)</span>
</span><span id="__span-0-1507"><a id="__codelineno-0-1507" name="__codelineno-0-1507"></a>            <span class="k">if</span> <span class="n">round_id</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
</span><span id="__span-0-1508"><a id="__codelineno-0-1508" name="__codelineno-0-1508"></a>                <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1509"><a id="__codelineno-0-1509" name="__codelineno-0-1509"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1510"><a id="__codelineno-0-1510" name="__codelineno-0-1510"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1511"><a id="__codelineno-0-1511" name="__codelineno-0-1511"></a>                        <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1512"><a id="__codelineno-0-1512" name="__codelineno-0-1512"></a>                    <span class="p">)</span>
</span><span id="__span-0-1513"><a id="__codelineno-0-1513" name="__codelineno-0-1513"></a>                <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1514"><a id="__codelineno-0-1514" name="__codelineno-0-1514"></a>                    <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-1515"><a id="__codelineno-0-1515" name="__codelineno-0-1515"></a>                    <span class="nb">print</span><span class="p">(</span><span class="s2">"Registered polyDT data missing."</span><span class="p">)</span>
</span><span id="__span-0-1516"><a id="__codelineno-0-1516" name="__codelineno-0-1516"></a>
</span><span id="__span-0-1517"><a id="__codelineno-0-1517" name="__codelineno-0-1517"></a>        <span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">bit_id</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-1518"><a id="__codelineno-0-1518" name="__codelineno-0-1518"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1519"><a id="__codelineno-0-1519" name="__codelineno-0-1519"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-1520"><a id="__codelineno-0-1520" name="__codelineno-0-1520"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1521"><a id="__codelineno-0-1521" name="__codelineno-0-1521"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1522"><a id="__codelineno-0-1522" name="__codelineno-0-1522"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_decon_data"</span><span class="p">)</span>
</span><span id="__span-0-1523"><a id="__codelineno-0-1523" name="__codelineno-0-1523"></a>            <span class="p">)</span>
</span><span id="__span-0-1524"><a id="__codelineno-0-1524" name="__codelineno-0-1524"></a>
</span><span id="__span-0-1525"><a id="__codelineno-0-1525" name="__codelineno-0-1525"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1526"><a id="__codelineno-0-1526" name="__codelineno-0-1526"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1527"><a id="__codelineno-0-1527" name="__codelineno-0-1527"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1528"><a id="__codelineno-0-1528" name="__codelineno-0-1528"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1529"><a id="__codelineno-0-1529" name="__codelineno-0-1529"></a>                <span class="p">)</span>
</span><span id="__span-0-1530"><a id="__codelineno-0-1530" name="__codelineno-0-1530"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1531"><a id="__codelineno-0-1531" name="__codelineno-0-1531"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-1532"><a id="__codelineno-0-1532" name="__codelineno-0-1532"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Registered readout data missing."</span><span class="p">)</span>
</span><span id="__span-0-1533"><a id="__codelineno-0-1533" name="__codelineno-0-1533"></a>
</span><span id="__span-0-1534"><a id="__codelineno-0-1534" name="__codelineno-0-1534"></a>            <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1535"><a id="__codelineno-0-1535" name="__codelineno-0-1535"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-1536"><a id="__codelineno-0-1536" name="__codelineno-0-1536"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1537"><a id="__codelineno-0-1537" name="__codelineno-0-1537"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1538"><a id="__codelineno-0-1538" name="__codelineno-0-1538"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_ufish_data"</span><span class="p">)</span>
</span><span id="__span-0-1539"><a id="__codelineno-0-1539" name="__codelineno-0-1539"></a>            <span class="p">)</span>
</span><span id="__span-0-1540"><a id="__codelineno-0-1540" name="__codelineno-0-1540"></a>
</span><span id="__span-0-1541"><a id="__codelineno-0-1541" name="__codelineno-0-1541"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1542"><a id="__codelineno-0-1542" name="__codelineno-0-1542"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1543"><a id="__codelineno-0-1543" name="__codelineno-0-1543"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1544"><a id="__codelineno-0-1544" name="__codelineno-0-1544"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1545"><a id="__codelineno-0-1545" name="__codelineno-0-1545"></a>                <span class="p">)</span>
</span><span id="__span-0-1546"><a id="__codelineno-0-1546" name="__codelineno-0-1546"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1547"><a id="__codelineno-0-1547" name="__codelineno-0-1547"></a>                <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-1548"><a id="__codelineno-0-1548" name="__codelineno-0-1548"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Registered ufish prediction missing."</span><span class="p">)</span>
</span><span id="__span-0-1549"><a id="__codelineno-0-1549" name="__codelineno-0-1549"></a>
</span><span id="__span-0-1550"><a id="__codelineno-0-1550" name="__codelineno-0-1550"></a>        <span class="k">for</span> <span class="n">tile_id</span><span class="p">,</span> <span class="n">bit_id</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-1551"><a id="__codelineno-0-1551" name="__codelineno-0-1551"></a>            <span class="n">current_ufish_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-1552"><a id="__codelineno-0-1552" name="__codelineno-0-1552"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span>
</span><span id="__span-0-1553"><a id="__codelineno-0-1553" name="__codelineno-0-1553"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1554"><a id="__codelineno-0-1554" name="__codelineno-0-1554"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".parquet"</span><span class="p">)</span>
</span><span id="__span-0-1555"><a id="__codelineno-0-1555" name="__codelineno-0-1555"></a>            <span class="p">)</span>
</span><span id="__span-0-1556"><a id="__codelineno-0-1556" name="__codelineno-0-1556"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">current_ufish_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1557"><a id="__codelineno-0-1557" name="__codelineno-0-1557"></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span>
</span><span id="__span-0-1558"><a id="__codelineno-0-1558" name="__codelineno-0-1558"></a>                    <span class="n">tile_id</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="n">bit_id</span> <span class="o">+</span> <span class="s2">" ufish localization missing"</span>
</span><span id="__span-0-1559"><a id="__codelineno-0-1559" name="__codelineno-0-1559"></a>                <span class="p">)</span>
</span><span id="__span-0-1560"><a id="__codelineno-0-1560" name="__codelineno-0-1560"></a>
</span><span id="__span-0-1561"><a id="__codelineno-0-1561" name="__codelineno-0-1561"></a>    <span class="c1"># check and validate global registered data</span>
</span><span id="__span-0-1562"><a id="__codelineno-0-1562" name="__codelineno-0-1562"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"GlobalRegistered"</span><span class="p">]:</span>
</span><span id="__span-0-1563"><a id="__codelineno-0-1563" name="__codelineno-0-1563"></a>        <span class="k">for</span> <span class="n">tile_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-1564"><a id="__codelineno-0-1564" name="__codelineno-0-1564"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1565"><a id="__codelineno-0-1565" name="__codelineno-0-1565"></a>                <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1566"><a id="__codelineno-0-1566" name="__codelineno-0-1566"></a>                    <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1567"><a id="__codelineno-0-1567" name="__codelineno-0-1567"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1568"><a id="__codelineno-0-1568" name="__codelineno-0-1568"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1569"><a id="__codelineno-0-1569" name="__codelineno-0-1569"></a>                    <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1570"><a id="__codelineno-0-1570" name="__codelineno-0-1570"></a>                <span class="p">)</span>
</span><span id="__span-0-1571"><a id="__codelineno-0-1571" name="__codelineno-0-1571"></a>                <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-1572"><a id="__codelineno-0-1572" name="__codelineno-0-1572"></a>                    <span class="n">attributes</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-0-1573"><a id="__codelineno-0-1573" name="__codelineno-0-1573"></a>            <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1574"><a id="__codelineno-0-1574" name="__codelineno-0-1574"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"polyDT tile attributes not found"</span><span class="p">)</span>
</span><span id="__span-0-1575"><a id="__codelineno-0-1575" name="__codelineno-0-1575"></a>
</span><span id="__span-0-1576"><a id="__codelineno-0-1576" name="__codelineno-0-1576"></a>            <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"affine_zyx_um"</span><span class="p">,</span> <span class="s2">"origin_zyx_um"</span><span class="p">,</span> <span class="s2">"spacing_zyx_um"</span><span class="p">]</span>
</span><span id="__span-0-1577"><a id="__codelineno-0-1577" name="__codelineno-0-1577"></a>
</span><span id="__span-0-1578"><a id="__codelineno-0-1578" name="__codelineno-0-1578"></a>            <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">:</span>
</span><span id="__span-0-1579"><a id="__codelineno-0-1579" name="__codelineno-0-1579"></a>                <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-0-1580"><a id="__codelineno-0-1580" name="__codelineno-0-1580"></a>                    <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Global registration missing"</span><span class="p">)</span>
</span><span id="__span-0-1581"><a id="__codelineno-0-1581" name="__codelineno-0-1581"></a>
</span><span id="__span-0-1582"><a id="__codelineno-0-1582" name="__codelineno-0-1582"></a>    <span class="c1"># check and validate fused</span>
</span><span id="__span-0-1583"><a id="__codelineno-0-1583" name="__codelineno-0-1583"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"Fused"</span><span class="p">]:</span>
</span><span id="__span-0-1584"><a id="__codelineno-0-1584" name="__codelineno-0-1584"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1585"><a id="__codelineno-0-1585" name="__codelineno-0-1585"></a>            <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1586"><a id="__codelineno-0-1586" name="__codelineno-0-1586"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span>
</span><span id="__span-0-1587"><a id="__codelineno-0-1587" name="__codelineno-0-1587"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused.zarr"</span><span class="p">)</span>
</span><span id="__span-0-1588"><a id="__codelineno-0-1588" name="__codelineno-0-1588"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-1589"><a id="__codelineno-0-1589" name="__codelineno-0-1589"></a>                <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1590"><a id="__codelineno-0-1590" name="__codelineno-0-1590"></a>            <span class="p">)</span>
</span><span id="__span-0-1591"><a id="__codelineno-0-1591" name="__codelineno-0-1591"></a>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">,</span> <span class="s2">"r"</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span id="__span-0-1592"><a id="__codelineno-0-1592" name="__codelineno-0-1592"></a>                <span class="n">attributes</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
</span><span id="__span-0-1593"><a id="__codelineno-0-1593" name="__codelineno-0-1593"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1594"><a id="__codelineno-0-1594" name="__codelineno-0-1594"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Fused image attributes not found"</span><span class="p">)</span>
</span><span id="__span-0-1595"><a id="__codelineno-0-1595" name="__codelineno-0-1595"></a>
</span><span id="__span-0-1596"><a id="__codelineno-0-1596" name="__codelineno-0-1596"></a>        <span class="n">keys_to_check</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"affine_zyx_um"</span><span class="p">,</span> <span class="s2">"origin_zyx_um"</span><span class="p">,</span> <span class="s2">"spacing_zyx_um"</span><span class="p">]</span>
</span><span id="__span-0-1597"><a id="__codelineno-0-1597" name="__codelineno-0-1597"></a>
</span><span id="__span-0-1598"><a id="__codelineno-0-1598" name="__codelineno-0-1598"></a>        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys_to_check</span><span class="p">:</span>
</span><span id="__span-0-1599"><a id="__codelineno-0-1599" name="__codelineno-0-1599"></a>            <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attributes</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
</span><span id="__span-0-1600"><a id="__codelineno-0-1600" name="__codelineno-0-1600"></a>                <span class="k">raise</span> <span class="ne">KeyError</span><span class="p">(</span><span class="s2">"Fused image metadata missing"</span><span class="p">)</span>
</span><span id="__span-0-1601"><a id="__codelineno-0-1601" name="__codelineno-0-1601"></a>
</span><span id="__span-0-1602"><a id="__codelineno-0-1602" name="__codelineno-0-1602"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1603"><a id="__codelineno-0-1603" name="__codelineno-0-1603"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span>
</span><span id="__span-0-1604"><a id="__codelineno-0-1604" name="__codelineno-0-1604"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused.zarr"</span><span class="p">)</span>
</span><span id="__span-0-1605"><a id="__codelineno-0-1605" name="__codelineno-0-1605"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-1606"><a id="__codelineno-0-1606" name="__codelineno-0-1606"></a>        <span class="p">)</span>
</span><span id="__span-0-1607"><a id="__codelineno-0-1607" name="__codelineno-0-1607"></a>
</span><span id="__span-0-1608"><a id="__codelineno-0-1608" name="__codelineno-0-1608"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1609"><a id="__codelineno-0-1609" name="__codelineno-0-1609"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1610"><a id="__codelineno-0-1610" name="__codelineno-0-1610"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1611"><a id="__codelineno-0-1611" name="__codelineno-0-1611"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1612"><a id="__codelineno-0-1612" name="__codelineno-0-1612"></a>            <span class="p">)</span>
</span><span id="__span-0-1613"><a id="__codelineno-0-1613" name="__codelineno-0-1613"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1614"><a id="__codelineno-0-1614" name="__codelineno-0-1614"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Fused data missing."</span><span class="p">)</span>
</span><span id="__span-0-1615"><a id="__codelineno-0-1615" name="__codelineno-0-1615"></a>
</span><span id="__span-0-1616"><a id="__codelineno-0-1616" name="__codelineno-0-1616"></a>    <span class="c1"># check and validate cellpose segmentation</span>
</span><span id="__span-0-1617"><a id="__codelineno-0-1617" name="__codelineno-0-1617"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"SegmentedCells"</span><span class="p">]:</span>
</span><span id="__span-0-1618"><a id="__codelineno-0-1618" name="__codelineno-0-1618"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1619"><a id="__codelineno-0-1619" name="__codelineno-0-1619"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-1620"><a id="__codelineno-0-1620" name="__codelineno-0-1620"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose"</span><span class="p">)</span>
</span><span id="__span-0-1621"><a id="__codelineno-0-1621" name="__codelineno-0-1621"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose.zarr"</span><span class="p">)</span>
</span><span id="__span-0-1622"><a id="__codelineno-0-1622" name="__codelineno-0-1622"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"masks_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-1623"><a id="__codelineno-0-1623" name="__codelineno-0-1623"></a>        <span class="p">)</span>
</span><span id="__span-0-1624"><a id="__codelineno-0-1624" name="__codelineno-0-1624"></a>
</span><span id="__span-0-1625"><a id="__codelineno-0-1625" name="__codelineno-0-1625"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1626"><a id="__codelineno-0-1626" name="__codelineno-0-1626"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_check_for_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1627"><a id="__codelineno-0-1627" name="__codelineno-0-1627"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-1628"><a id="__codelineno-0-1628" name="__codelineno-0-1628"></a>                <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-1629"><a id="__codelineno-0-1629" name="__codelineno-0-1629"></a>            <span class="p">)</span>
</span><span id="__span-0-1630"><a id="__codelineno-0-1630" name="__codelineno-0-1630"></a>        <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-1631"><a id="__codelineno-0-1631" name="__codelineno-0-1631"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Cellpose data missing."</span><span class="p">)</span>
</span><span id="__span-0-1632"><a id="__codelineno-0-1632" name="__codelineno-0-1632"></a>
</span><span id="__span-0-1633"><a id="__codelineno-0-1633" name="__codelineno-0-1633"></a>        <span class="n">cell_outlines_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-1634"><a id="__codelineno-0-1634" name="__codelineno-0-1634"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-1635"><a id="__codelineno-0-1635" name="__codelineno-0-1635"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose"</span><span class="p">)</span>
</span><span id="__span-0-1636"><a id="__codelineno-0-1636" name="__codelineno-0-1636"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"imagej_rois"</span><span class="p">)</span>
</span><span id="__span-0-1637"><a id="__codelineno-0-1637" name="__codelineno-0-1637"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"global_coords_rois.zip"</span><span class="p">)</span>
</span><span id="__span-0-1638"><a id="__codelineno-0-1638" name="__codelineno-0-1638"></a>        <span class="p">)</span>
</span><span id="__span-0-1639"><a id="__codelineno-0-1639" name="__codelineno-0-1639"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">cell_outlines_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1640"><a id="__codelineno-0-1640" name="__codelineno-0-1640"></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">"Cellpose cell outlines missing."</span><span class="p">)</span>
</span><span id="__span-0-1641"><a id="__codelineno-0-1641" name="__codelineno-0-1641"></a>
</span><span id="__span-0-1642"><a id="__codelineno-0-1642" name="__codelineno-0-1642"></a>    <span class="c1"># check and validate decoded spots</span>
</span><span id="__span-0-1643"><a id="__codelineno-0-1643" name="__codelineno-0-1643"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"DecodedSpots"</span><span class="p">]:</span>
</span><span id="__span-0-1644"><a id="__codelineno-0-1644" name="__codelineno-0-1644"></a>        <span class="k">for</span> <span class="n">tile_id</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-1645"><a id="__codelineno-0-1645" name="__codelineno-0-1645"></a>            <span class="n">decoded_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-1646"><a id="__codelineno-0-1646" name="__codelineno-0-1646"></a>                <span class="n">tile_id</span> <span class="o">+</span> <span class="s2">"_decoded_features.parquet"</span>
</span><span id="__span-0-1647"><a id="__codelineno-0-1647" name="__codelineno-0-1647"></a>            <span class="p">)</span>
</span><span id="__span-0-1648"><a id="__codelineno-0-1648" name="__codelineno-0-1648"></a>
</span><span id="__span-0-1649"><a id="__codelineno-0-1649" name="__codelineno-0-1649"></a>            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">decoded_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1650"><a id="__codelineno-0-1650" name="__codelineno-0-1650"></a>                <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="n">tile_id</span> <span class="o">+</span> <span class="s2">" decoded spots missing."</span><span class="p">)</span>
</span><span id="__span-0-1651"><a id="__codelineno-0-1651" name="__codelineno-0-1651"></a>
</span><span id="__span-0-1652"><a id="__codelineno-0-1652" name="__codelineno-0-1652"></a>    <span class="c1"># check and validate filtered decoded spots</span>
</span><span id="__span-0-1653"><a id="__codelineno-0-1653" name="__codelineno-0-1653"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"FilteredSpots"</span><span class="p">]:</span>
</span><span id="__span-0-1654"><a id="__codelineno-0-1654" name="__codelineno-0-1654"></a>        <span class="n">filtered_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-1655"><a id="__codelineno-0-1655" name="__codelineno-0-1655"></a>            <span class="s2">"all_tiles_filtered_decoded_features.parquet"</span>
</span><span id="__span-0-1656"><a id="__codelineno-0-1656" name="__codelineno-0-1656"></a>        <span class="p">)</span>
</span><span id="__span-0-1657"><a id="__codelineno-0-1657" name="__codelineno-0-1657"></a>
</span><span id="__span-0-1658"><a id="__codelineno-0-1658" name="__codelineno-0-1658"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">filtered_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1659"><a id="__codelineno-0-1659" name="__codelineno-0-1659"></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">"filtered decoded spots missing."</span><span class="p">)</span>
</span><span id="__span-0-1660"><a id="__codelineno-0-1660" name="__codelineno-0-1660"></a>
</span><span id="__span-0-1661"><a id="__codelineno-0-1661" name="__codelineno-0-1661"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"RefinedSpots"</span><span class="p">]:</span>
</span><span id="__span-0-1662"><a id="__codelineno-0-1662" name="__codelineno-0-1662"></a>        <span class="n">baysor_spots_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-1663"><a id="__codelineno-0-1663" name="__codelineno-0-1663"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-1664"><a id="__codelineno-0-1664" name="__codelineno-0-1664"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"baysor"</span><span class="p">)</span>
</span><span id="__span-0-1665"><a id="__codelineno-0-1665" name="__codelineno-0-1665"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"segmentation.csv"</span><span class="p">)</span>
</span><span id="__span-0-1666"><a id="__codelineno-0-1666" name="__codelineno-0-1666"></a>        <span class="p">)</span>
</span><span id="__span-0-1667"><a id="__codelineno-0-1667" name="__codelineno-0-1667"></a>
</span><span id="__span-0-1668"><a id="__codelineno-0-1668" name="__codelineno-0-1668"></a>        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">baysor_spots_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()):</span>
</span><span id="__span-0-1669"><a id="__codelineno-0-1669" name="__codelineno-0-1669"></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">"Baysor filtered decoded spots missing."</span><span class="p">)</span>
</span><span id="__span-0-1670"><a id="__codelineno-0-1670" name="__codelineno-0-1670"></a>
</span><span id="__span-0-1671"><a id="__codelineno-0-1671" name="__codelineno-0-1671"></a>    <span class="c1"># check and validate mtx</span>
</span><span id="__span-0-1672"><a id="__codelineno-0-1672" name="__codelineno-0-1672"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"mtxOutput"</span><span class="p">]:</span>
</span><span id="__span-0-1673"><a id="__codelineno-0-1673" name="__codelineno-0-1673"></a>        <span class="n">mtx_barcodes_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mtx_output_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"barcodes.tsv.gz"</span><span class="p">)</span>
</span><span id="__span-0-1674"><a id="__codelineno-0-1674" name="__codelineno-0-1674"></a>        <span class="n">mtx_features_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mtx_output_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"features.tsv.gz"</span><span class="p">)</span>
</span><span id="__span-0-1675"><a id="__codelineno-0-1675" name="__codelineno-0-1675"></a>        <span class="n">mtx_matrix_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_mtx_output_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"matrix.tsv.gz"</span><span class="p">)</span>
</span><span id="__span-0-1676"><a id="__codelineno-0-1676" name="__codelineno-0-1676"></a>
</span><span id="__span-0-1677"><a id="__codelineno-0-1677" name="__codelineno-0-1677"></a>        <span class="k">if</span> <span class="p">(</span>
</span><span id="__span-0-1678"><a id="__codelineno-0-1678" name="__codelineno-0-1678"></a>            <span class="ow">not</span> <span class="p">(</span><span class="n">mtx_barcodes_path</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span>
</span><span id="__span-0-1679"><a id="__codelineno-0-1679" name="__codelineno-0-1679"></a>            <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mtx_features_path</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span>
</span><span id="__span-0-1680"><a id="__codelineno-0-1680" name="__codelineno-0-1680"></a>            <span class="ow">or</span> <span class="ow">not</span> <span class="p">(</span><span class="n">mtx_matrix_path</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span>
</span><span id="__span-0-1681"><a id="__codelineno-0-1681" name="__codelineno-0-1681"></a>        <span class="p">):</span>
</span><span id="__span-0-1682"><a id="__codelineno-0-1682" name="__codelineno-0-1682"></a>            <span class="k">raise</span> <span class="ne">FileNotFoundError</span><span class="p">(</span><span class="s2">"mtx output missing."</span><span class="p">)</span>
</span><span id="__span-0-1683"><a id="__codelineno-0-1683" name="__codelineno-0-1683"></a>
</span><span id="__span-0-1684"><a id="__codelineno-0-1684" name="__codelineno-0-1684"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1685"><a id="__codelineno-0-1685" name="__codelineno-0-1685"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"BaysorPath"</span><span class="p">]))</span>
</span><span id="__span-0-1686"><a id="__codelineno-0-1686" name="__codelineno-0-1686"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"BaysorOptions"</span><span class="p">]))</span>
</span><span id="__span-0-1687"><a id="__codelineno-0-1687" name="__codelineno-0-1687"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_julia_threads</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_datastore_state</span><span class="p">[</span><span class="s2">"JuliaThreads"</span><span class="p">])</span>
</span><span id="__span-0-1688"><a id="__codelineno-0-1688" name="__codelineno-0-1688"></a>    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="__span-0-1689"><a id="__codelineno-0-1689" name="__codelineno-0-1689"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">""</span>
</span><span id="__span-0-1690"><a id="__codelineno-0-1690" name="__codelineno-0-1690"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">""</span>
</span><span id="__span-0-1691"><a id="__codelineno-0-1691" name="__codelineno-0-1691"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_julia_threads</span> <span class="o">=</span> <span class="mi">1</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore._save_to_json"> <code class="highlight language-python"><span class="n">_save_to_json</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">dictionary_path</span><span class="p">)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents"> <p>Save dictionary to json.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>dictionary</code> </td> <td> <code><span title="dict">dict</span></code> </td> <td> <div class="doc-md-description"> <p>The data to be saved.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>dictionary_path</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>The path to the JSON file where the data will be saved.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1033">1033</a></span>
<span class="normal"><a href="#__codelineno-0-1034">1034</a></span>
<span class="normal"><a href="#__codelineno-0-1035">1035</a></span>
<span class="normal"><a href="#__codelineno-0-1036">1036</a></span>
<span class="normal"><a href="#__codelineno-0-1037">1037</a></span>
<span class="normal"><a href="#__codelineno-0-1038">1038</a></span>
<span class="normal"><a href="#__codelineno-0-1039">1039</a></span>
<span class="normal"><a href="#__codelineno-0-1040">1040</a></span>
<span class="normal"><a href="#__codelineno-0-1041">1041</a></span>
<span class="normal"><a href="#__codelineno-0-1042">1042</a></span>
<span class="normal"><a href="#__codelineno-0-1043">1043</a></span>
<span class="normal"><a href="#__codelineno-0-1044">1044</a></span>
<span class="normal"><a href="#__codelineno-0-1045">1045</a></span>
<span class="normal"><a href="#__codelineno-0-1046">1046</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1033"><a id="__codelineno-0-1033" name="__codelineno-0-1033"></a><span class="nd">@staticmethod</span>
</span><span id="__span-0-1034"><a id="__codelineno-0-1034" name="__codelineno-0-1034"></a><span class="k">def</span><span class="w"> </span><span class="nf">_save_to_json</span><span class="p">(</span><span class="n">dictionary</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">dictionary_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
</span><span id="__span-0-1035"><a id="__codelineno-0-1035" name="__codelineno-0-1035"></a><span class="w">    </span><span class="sd">"""Save dictionary to json.</span>
</span><span id="__span-0-1036"><a id="__codelineno-0-1036" name="__codelineno-0-1036"></a>
</span><span id="__span-0-1037"><a id="__codelineno-0-1037" name="__codelineno-0-1037"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-1038"><a id="__codelineno-0-1038" name="__codelineno-0-1038"></a><span class="sd">    ----------</span>
</span><span id="__span-0-1039"><a id="__codelineno-0-1039" name="__codelineno-0-1039"></a><span class="sd">    dictionary : dict</span>
</span><span id="__span-0-1040"><a id="__codelineno-0-1040" name="__codelineno-0-1040"></a><span class="sd">        The data to be saved.</span>
</span><span id="__span-0-1041"><a id="__codelineno-0-1041" name="__codelineno-0-1041"></a><span class="sd">    dictionary_path : Union[Path,str]</span>
</span><span id="__span-0-1042"><a id="__codelineno-0-1042" name="__codelineno-0-1042"></a><span class="sd">        The path to the JSON file where the data will be saved.</span>
</span><span id="__span-0-1043"><a id="__codelineno-0-1043" name="__codelineno-0-1043"></a><span class="sd">    """</span>
</span><span id="__span-0-1044"><a id="__codelineno-0-1044" name="__codelineno-0-1044"></a>
</span><span id="__span-0-1045"><a id="__codelineno-0-1045" name="__codelineno-0-1045"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">dictionary_path</span><span class="p">,</span> <span class="s2">"w"</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="__span-0-1046"><a id="__codelineno-0-1046" name="__codelineno-0-1046"></a>        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dictionary</span><span class="p">,</span> <span class="n">file</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore._save_to_parquet"> <code class="highlight language-python"><span class="n">_save_to_parquet</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">parquet_path</span><span class="p">)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents"> <p>Save dataframe to parquet.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>df</code> </td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class="doc-md-description"> <p>Dataframe to save.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>parquet_path</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="pathlib.Path">Path</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Path to parquet file.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1219">1219</a></span>
<span class="normal"><a href="#__codelineno-0-1220">1220</a></span>
<span class="normal"><a href="#__codelineno-0-1221">1221</a></span>
<span class="normal"><a href="#__codelineno-0-1222">1222</a></span>
<span class="normal"><a href="#__codelineno-0-1223">1223</a></span>
<span class="normal"><a href="#__codelineno-0-1224">1224</a></span>
<span class="normal"><a href="#__codelineno-0-1225">1225</a></span>
<span class="normal"><a href="#__codelineno-0-1226">1226</a></span>
<span class="normal"><a href="#__codelineno-0-1227">1227</a></span>
<span class="normal"><a href="#__codelineno-0-1228">1228</a></span>
<span class="normal"><a href="#__codelineno-0-1229">1229</a></span>
<span class="normal"><a href="#__codelineno-0-1230">1230</a></span>
<span class="normal"><a href="#__codelineno-0-1231">1231</a></span>
<span class="normal"><a href="#__codelineno-0-1232">1232</a></span>
<span class="normal"><a href="#__codelineno-0-1233">1233</a></span>
<span class="normal"><a href="#__codelineno-0-1234">1234</a></span>
<span class="normal"><a href="#__codelineno-0-1235">1235</a></span>
<span class="normal"><a href="#__codelineno-0-1236">1236</a></span>
<span class="normal"><a href="#__codelineno-0-1237">1237</a></span>
<span class="normal"><a href="#__codelineno-0-1238">1238</a></span>
<span class="normal"><a href="#__codelineno-0-1239">1239</a></span>
<span class="normal"><a href="#__codelineno-0-1240">1240</a></span>
<span class="normal"><a href="#__codelineno-0-1241">1241</a></span>
<span class="normal"><a href="#__codelineno-0-1242">1242</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1219"><a id="__codelineno-0-1219" name="__codelineno-0-1219"></a><span class="nd">@staticmethod</span>
</span><span id="__span-0-1220"><a id="__codelineno-0-1220" name="__codelineno-0-1220"></a><span class="k">def</span><span class="w"> </span><span class="nf">_save_to_parquet</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">parquet_path</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Path</span><span class="p">,</span> <span class="nb">str</span><span class="p">]):</span>
</span><span id="__span-0-1221"><a id="__codelineno-0-1221" name="__codelineno-0-1221"></a><span class="w">    </span><span class="sd">"""Save dataframe to parquet.</span>
</span><span id="__span-0-1222"><a id="__codelineno-0-1222" name="__codelineno-0-1222"></a>
</span><span id="__span-0-1223"><a id="__codelineno-0-1223" name="__codelineno-0-1223"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-1224"><a id="__codelineno-0-1224" name="__codelineno-0-1224"></a><span class="sd">    ----------</span>
</span><span id="__span-0-1225"><a id="__codelineno-0-1225" name="__codelineno-0-1225"></a><span class="sd">    df : pd.DataFrame</span>
</span><span id="__span-0-1226"><a id="__codelineno-0-1226" name="__codelineno-0-1226"></a><span class="sd">        Dataframe to save.</span>
</span><span id="__span-0-1227"><a id="__codelineno-0-1227" name="__codelineno-0-1227"></a><span class="sd">    parquet_path : Union[Path, str]</span>
</span><span id="__span-0-1228"><a id="__codelineno-0-1228" name="__codelineno-0-1228"></a><span class="sd">        Path to parquet file.</span>
</span><span id="__span-0-1229"><a id="__codelineno-0-1229" name="__codelineno-0-1229"></a><span class="sd">    """</span>
</span><span id="__span-0-1230"><a id="__codelineno-0-1230" name="__codelineno-0-1230"></a>
</span><span id="__span-0-1231"><a id="__codelineno-0-1231" name="__codelineno-0-1231"></a>    <span class="c1"># df.to_parquet(</span>
</span><span id="__span-0-1232"><a id="__codelineno-0-1232" name="__codelineno-0-1232"></a>    <span class="c1">#     parquet_path,</span>
</span><span id="__span-0-1233"><a id="__codelineno-0-1233" name="__codelineno-0-1233"></a>    <span class="c1">#     engine="pyarrow",</span>
</span><span id="__span-0-1234"><a id="__codelineno-0-1234" name="__codelineno-0-1234"></a>    <span class="c1">#     version="1.0",</span>
</span><span id="__span-0-1235"><a id="__codelineno-0-1235" name="__codelineno-0-1235"></a>    <span class="c1">#     write_statistics=False</span>
</span><span id="__span-0-1236"><a id="__codelineno-0-1236" name="__codelineno-0-1236"></a>    <span class="c1"># )</span>
</span><span id="__span-0-1237"><a id="__codelineno-0-1237" name="__codelineno-0-1237"></a>
</span><span id="__span-0-1238"><a id="__codelineno-0-1238" name="__codelineno-0-1238"></a>    <span class="n">df</span><span class="o">.</span><span class="n">to_parquet</span><span class="p">(</span>
</span><span id="__span-0-1239"><a id="__codelineno-0-1239" name="__codelineno-0-1239"></a>        <span class="n">parquet_path</span><span class="p">,</span>
</span><span id="__span-0-1240"><a id="__codelineno-0-1240" name="__codelineno-0-1240"></a>        <span class="n">engine</span><span class="o">=</span><span class="s2">"fastparquet"</span><span class="p">,</span> 
</span><span id="__span-0-1241"><a id="__codelineno-0-1241" name="__codelineno-0-1241"></a>        <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
</span><span id="__span-0-1242"><a id="__codelineno-0-1242" name="__codelineno-0-1242"></a>    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore._save_to_zarr_array"> <code class="highlight language-python"><span class="n">_save_to_zarr_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">kvstore</span><span class="p">,</span> <span class="n">spec</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code> <span class="doc doc-labels"> <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small> </span> </h3> <div class="doc doc-contents"> <p>Save array to zarr using tensorstore.</p> <p>Defaults to returning future result.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>array</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Array to save.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>kvstore</code> </td> <td> <code><span title="dict">dict</span></code> </td> <td> <div class="doc-md-description"> <p>Tensorstore kvstore specification.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>spec</code> </td> <td> <code><span title="dict">dict</span></code> </td> <td> <div class="doc-md-description"> <p>Tensorstore zarr specification.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code> </td> <td> <div class="doc-md-description"> <p>Return future (True) or immediately write (False).</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>write_future</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Delayed (future) if return_future is True.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1133">1133</a></span>
<span class="normal"><a href="#__codelineno-0-1134">1134</a></span>
<span class="normal"><a href="#__codelineno-0-1135">1135</a></span>
<span class="normal"><a href="#__codelineno-0-1136">1136</a></span>
<span class="normal"><a href="#__codelineno-0-1137">1137</a></span>
<span class="normal"><a href="#__codelineno-0-1138">1138</a></span>
<span class="normal"><a href="#__codelineno-0-1139">1139</a></span>
<span class="normal"><a href="#__codelineno-0-1140">1140</a></span>
<span class="normal"><a href="#__codelineno-0-1141">1141</a></span>
<span class="normal"><a href="#__codelineno-0-1142">1142</a></span>
<span class="normal"><a href="#__codelineno-0-1143">1143</a></span>
<span class="normal"><a href="#__codelineno-0-1144">1144</a></span>
<span class="normal"><a href="#__codelineno-0-1145">1145</a></span>
<span class="normal"><a href="#__codelineno-0-1146">1146</a></span>
<span class="normal"><a href="#__codelineno-0-1147">1147</a></span>
<span class="normal"><a href="#__codelineno-0-1148">1148</a></span>
<span class="normal"><a href="#__codelineno-0-1149">1149</a></span>
<span class="normal"><a href="#__codelineno-0-1150">1150</a></span>
<span class="normal"><a href="#__codelineno-0-1151">1151</a></span>
<span class="normal"><a href="#__codelineno-0-1152">1152</a></span>
<span class="normal"><a href="#__codelineno-0-1153">1153</a></span>
<span class="normal"><a href="#__codelineno-0-1154">1154</a></span>
<span class="normal"><a href="#__codelineno-0-1155">1155</a></span>
<span class="normal"><a href="#__codelineno-0-1156">1156</a></span>
<span class="normal"><a href="#__codelineno-0-1157">1157</a></span>
<span class="normal"><a href="#__codelineno-0-1158">1158</a></span>
<span class="normal"><a href="#__codelineno-0-1159">1159</a></span>
<span class="normal"><a href="#__codelineno-0-1160">1160</a></span>
<span class="normal"><a href="#__codelineno-0-1161">1161</a></span>
<span class="normal"><a href="#__codelineno-0-1162">1162</a></span>
<span class="normal"><a href="#__codelineno-0-1163">1163</a></span>
<span class="normal"><a href="#__codelineno-0-1164">1164</a></span>
<span class="normal"><a href="#__codelineno-0-1165">1165</a></span>
<span class="normal"><a href="#__codelineno-0-1166">1166</a></span>
<span class="normal"><a href="#__codelineno-0-1167">1167</a></span>
<span class="normal"><a href="#__codelineno-0-1168">1168</a></span>
<span class="normal"><a href="#__codelineno-0-1169">1169</a></span>
<span class="normal"><a href="#__codelineno-0-1170">1170</a></span>
<span class="normal"><a href="#__codelineno-0-1171">1171</a></span>
<span class="normal"><a href="#__codelineno-0-1172">1172</a></span>
<span class="normal"><a href="#__codelineno-0-1173">1173</a></span>
<span class="normal"><a href="#__codelineno-0-1174">1174</a></span>
<span class="normal"><a href="#__codelineno-0-1175">1175</a></span>
<span class="normal"><a href="#__codelineno-0-1176">1176</a></span>
<span class="normal"><a href="#__codelineno-0-1177">1177</a></span>
<span class="normal"><a href="#__codelineno-0-1178">1178</a></span>
<span class="normal"><a href="#__codelineno-0-1179">1179</a></span>
<span class="normal"><a href="#__codelineno-0-1180">1180</a></span>
<span class="normal"><a href="#__codelineno-0-1181">1181</a></span>
<span class="normal"><a href="#__codelineno-0-1182">1182</a></span>
<span class="normal"><a href="#__codelineno-0-1183">1183</a></span>
<span class="normal"><a href="#__codelineno-0-1184">1184</a></span>
<span class="normal"><a href="#__codelineno-0-1185">1185</a></span>
<span class="normal"><a href="#__codelineno-0-1186">1186</a></span>
<span class="normal"><a href="#__codelineno-0-1187">1187</a></span>
<span class="normal"><a href="#__codelineno-0-1188">1188</a></span>
<span class="normal"><a href="#__codelineno-0-1189">1189</a></span>
<span class="normal"><a href="#__codelineno-0-1190">1190</a></span>
<span class="normal"><a href="#__codelineno-0-1191">1191</a></span>
<span class="normal"><a href="#__codelineno-0-1192">1192</a></span>
<span class="normal"><a href="#__codelineno-0-1193">1193</a></span>
<span class="normal"><a href="#__codelineno-0-1194">1194</a></span>
<span class="normal"><a href="#__codelineno-0-1195">1195</a></span>
<span class="normal"><a href="#__codelineno-0-1196">1196</a></span>
<span class="normal"><a href="#__codelineno-0-1197">1197</a></span>
<span class="normal"><a href="#__codelineno-0-1198">1198</a></span>
<span class="normal"><a href="#__codelineno-0-1199">1199</a></span>
<span class="normal"><a href="#__codelineno-0-1200">1200</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1133"><a id="__codelineno-0-1133" name="__codelineno-0-1133"></a><span class="nd">@staticmethod</span>
</span><span id="__span-0-1134"><a id="__codelineno-0-1134" name="__codelineno-0-1134"></a><span class="k">def</span><span class="w"> </span><span class="nf">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-1135"><a id="__codelineno-0-1135" name="__codelineno-0-1135"></a>    <span class="n">array</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-1136"><a id="__codelineno-0-1136" name="__codelineno-0-1136"></a>    <span class="n">kvstore</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="__span-0-1137"><a id="__codelineno-0-1137" name="__codelineno-0-1137"></a>    <span class="n">spec</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span>
</span><span id="__span-0-1138"><a id="__codelineno-0-1138" name="__codelineno-0-1138"></a>    <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-1139"><a id="__codelineno-0-1139" name="__codelineno-0-1139"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-1140"><a id="__codelineno-0-1140" name="__codelineno-0-1140"></a><span class="w">    </span><span class="sd">"""Save array to zarr using tensorstore.</span>
</span><span id="__span-0-1141"><a id="__codelineno-0-1141" name="__codelineno-0-1141"></a>
</span><span id="__span-0-1142"><a id="__codelineno-0-1142" name="__codelineno-0-1142"></a><span class="sd">    Defaults to returning future result.</span>
</span><span id="__span-0-1143"><a id="__codelineno-0-1143" name="__codelineno-0-1143"></a>
</span><span id="__span-0-1144"><a id="__codelineno-0-1144" name="__codelineno-0-1144"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-1145"><a id="__codelineno-0-1145" name="__codelineno-0-1145"></a><span class="sd">    ----------</span>
</span><span id="__span-0-1146"><a id="__codelineno-0-1146" name="__codelineno-0-1146"></a><span class="sd">    array : ArrayLike</span>
</span><span id="__span-0-1147"><a id="__codelineno-0-1147" name="__codelineno-0-1147"></a><span class="sd">        Array to save.</span>
</span><span id="__span-0-1148"><a id="__codelineno-0-1148" name="__codelineno-0-1148"></a><span class="sd">    kvstore : dict</span>
</span><span id="__span-0-1149"><a id="__codelineno-0-1149" name="__codelineno-0-1149"></a><span class="sd">        Tensorstore kvstore specification.</span>
</span><span id="__span-0-1150"><a id="__codelineno-0-1150" name="__codelineno-0-1150"></a><span class="sd">    spec : dict</span>
</span><span id="__span-0-1151"><a id="__codelineno-0-1151" name="__codelineno-0-1151"></a><span class="sd">        Tensorstore zarr specification.</span>
</span><span id="__span-0-1152"><a id="__codelineno-0-1152" name="__codelineno-0-1152"></a><span class="sd">    return_future : Optional[bool]</span>
</span><span id="__span-0-1153"><a id="__codelineno-0-1153" name="__codelineno-0-1153"></a><span class="sd">        Return future (True) or immediately write (False).</span>
</span><span id="__span-0-1154"><a id="__codelineno-0-1154" name="__codelineno-0-1154"></a>
</span><span id="__span-0-1155"><a id="__codelineno-0-1155" name="__codelineno-0-1155"></a><span class="sd">    Returns</span>
</span><span id="__span-0-1156"><a id="__codelineno-0-1156" name="__codelineno-0-1156"></a><span class="sd">    -------</span>
</span><span id="__span-0-1157"><a id="__codelineno-0-1157" name="__codelineno-0-1157"></a><span class="sd">    write_future : Optional[ArrayLike]</span>
</span><span id="__span-0-1158"><a id="__codelineno-0-1158" name="__codelineno-0-1158"></a><span class="sd">        Delayed (future) if return_future is True.</span>
</span><span id="__span-0-1159"><a id="__codelineno-0-1159" name="__codelineno-0-1159"></a><span class="sd">    """</span>
</span><span id="__span-0-1160"><a id="__codelineno-0-1160" name="__codelineno-0-1160"></a>
</span><span id="__span-0-1161"><a id="__codelineno-0-1161" name="__codelineno-0-1161"></a>    <span class="c1"># check datatype</span>
</span><span id="__span-0-1162"><a id="__codelineno-0-1162" name="__codelineno-0-1162"></a>    <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"uint8"</span><span class="p">:</span>
</span><span id="__span-0-1163"><a id="__codelineno-0-1163" name="__codelineno-0-1163"></a>        <span class="n">array_dtype</span> <span class="o">=</span> <span class="s2">"&lt;u1"</span>
</span><span id="__span-0-1164"><a id="__codelineno-0-1164" name="__codelineno-0-1164"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"uint16"</span><span class="p">:</span>
</span><span id="__span-0-1165"><a id="__codelineno-0-1165" name="__codelineno-0-1165"></a>        <span class="n">array_dtype</span> <span class="o">=</span> <span class="s2">"&lt;u2"</span>
</span><span id="__span-0-1166"><a id="__codelineno-0-1166" name="__codelineno-0-1166"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"float16"</span><span class="p">:</span>
</span><span id="__span-0-1167"><a id="__codelineno-0-1167" name="__codelineno-0-1167"></a>        <span class="n">array_dtype</span> <span class="o">=</span> <span class="s2">"&lt;f2"</span>
</span><span id="__span-0-1168"><a id="__codelineno-0-1168" name="__codelineno-0-1168"></a>    <span class="k">elif</span> <span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span> <span class="o">==</span> <span class="s2">"float32"</span><span class="p">:</span>
</span><span id="__span-0-1169"><a id="__codelineno-0-1169" name="__codelineno-0-1169"></a>        <span class="n">array_dtype</span> <span class="o">=</span> <span class="s2">"&lt;f4"</span>
</span><span id="__span-0-1170"><a id="__codelineno-0-1170" name="__codelineno-0-1170"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1171"><a id="__codelineno-0-1171" name="__codelineno-0-1171"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Unsupported data type: "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">dtype</span><span class="p">))</span>
</span><span id="__span-0-1172"><a id="__codelineno-0-1172" name="__codelineno-0-1172"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1173"><a id="__codelineno-0-1173" name="__codelineno-0-1173"></a>
</span><span id="__span-0-1174"><a id="__codelineno-0-1174" name="__codelineno-0-1174"></a>    <span class="c1"># check array dimension</span>
</span><span id="__span-0-1175"><a id="__codelineno-0-1175" name="__codelineno-0-1175"></a>    <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"shape"</span><span class="p">]</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
</span><span id="__span-0-1176"><a id="__codelineno-0-1176" name="__codelineno-0-1176"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="__span-0-1177"><a id="__codelineno-0-1177" name="__codelineno-0-1177"></a>        <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"chunks"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
</span><span id="__span-0-1178"><a id="__codelineno-0-1178" name="__codelineno-0-1178"></a>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-1179"><a id="__codelineno-0-1179" name="__codelineno-0-1179"></a>        <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"chunks"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span><span id="__span-0-1180"><a id="__codelineno-0-1180" name="__codelineno-0-1180"></a>    <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
</span><span id="__span-0-1181"><a id="__codelineno-0-1181" name="__codelineno-0-1181"></a>        <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"chunks"</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
</span><span id="__span-0-1182"><a id="__codelineno-0-1182" name="__codelineno-0-1182"></a>    <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="n">array_dtype</span>
</span><span id="__span-0-1183"><a id="__codelineno-0-1183" name="__codelineno-0-1183"></a>
</span><span id="__span-0-1184"><a id="__codelineno-0-1184" name="__codelineno-0-1184"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1185"><a id="__codelineno-0-1185" name="__codelineno-0-1185"></a>        <span class="n">current_zarr</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">open</span><span class="p">(</span>
</span><span id="__span-0-1186"><a id="__codelineno-0-1186" name="__codelineno-0-1186"></a>            <span class="p">{</span>
</span><span id="__span-0-1187"><a id="__codelineno-0-1187" name="__codelineno-0-1187"></a>                <span class="o">**</span><span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-1188"><a id="__codelineno-0-1188" name="__codelineno-0-1188"></a>                <span class="s2">"kvstore"</span><span class="p">:</span> <span class="n">kvstore</span><span class="p">,</span>
</span><span id="__span-0-1189"><a id="__codelineno-0-1189" name="__codelineno-0-1189"></a>            <span class="p">}</span>
</span><span id="__span-0-1190"><a id="__codelineno-0-1190" name="__codelineno-0-1190"></a>        <span class="p">)</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-0-1191"><a id="__codelineno-0-1191" name="__codelineno-0-1191"></a>
</span><span id="__span-0-1192"><a id="__codelineno-0-1192" name="__codelineno-0-1192"></a>        <span class="n">write_future</span> <span class="o">=</span> <span class="n">current_zarr</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
</span><span id="__span-0-1193"><a id="__codelineno-0-1193" name="__codelineno-0-1193"></a>
</span><span id="__span-0-1194"><a id="__codelineno-0-1194" name="__codelineno-0-1194"></a>        <span class="k">if</span> <span class="n">return_future</span><span class="p">:</span>
</span><span id="__span-0-1195"><a id="__codelineno-0-1195" name="__codelineno-0-1195"></a>            <span class="k">return</span> <span class="n">write_future</span>
</span><span id="__span-0-1196"><a id="__codelineno-0-1196" name="__codelineno-0-1196"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1197"><a id="__codelineno-0-1197" name="__codelineno-0-1197"></a>            <span class="n">write_future</span><span class="o">.</span><span class="n">result</span><span class="p">()</span>
</span><span id="__span-0-1198"><a id="__codelineno-0-1198" name="__codelineno-0-1198"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1199"><a id="__codelineno-0-1199" name="__codelineno-0-1199"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">):</span>
</span><span id="__span-0-1200"><a id="__codelineno-0-1200" name="__codelineno-0-1200"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error writing zarr array."</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.initialize_tile"> <code class="highlight language-python"><span class="n">initialize_tile</span><span class="p">(</span><span class="n">tile</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Initialize directory structure for a tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1723">1723</a></span>
<span class="normal"><a href="#__codelineno-0-1724">1724</a></span>
<span class="normal"><a href="#__codelineno-0-1725">1725</a></span>
<span class="normal"><a href="#__codelineno-0-1726">1726</a></span>
<span class="normal"><a href="#__codelineno-0-1727">1727</a></span>
<span class="normal"><a href="#__codelineno-0-1728">1728</a></span>
<span class="normal"><a href="#__codelineno-0-1729">1729</a></span>
<span class="normal"><a href="#__codelineno-0-1730">1730</a></span>
<span class="normal"><a href="#__codelineno-0-1731">1731</a></span>
<span class="normal"><a href="#__codelineno-0-1732">1732</a></span>
<span class="normal"><a href="#__codelineno-0-1733">1733</a></span>
<span class="normal"><a href="#__codelineno-0-1734">1734</a></span>
<span class="normal"><a href="#__codelineno-0-1735">1735</a></span>
<span class="normal"><a href="#__codelineno-0-1736">1736</a></span>
<span class="normal"><a href="#__codelineno-0-1737">1737</a></span>
<span class="normal"><a href="#__codelineno-0-1738">1738</a></span>
<span class="normal"><a href="#__codelineno-0-1739">1739</a></span>
<span class="normal"><a href="#__codelineno-0-1740">1740</a></span>
<span class="normal"><a href="#__codelineno-0-1741">1741</a></span>
<span class="normal"><a href="#__codelineno-0-1742">1742</a></span>
<span class="normal"><a href="#__codelineno-0-1743">1743</a></span>
<span class="normal"><a href="#__codelineno-0-1744">1744</a></span>
<span class="normal"><a href="#__codelineno-0-1745">1745</a></span>
<span class="normal"><a href="#__codelineno-0-1746">1746</a></span>
<span class="normal"><a href="#__codelineno-0-1747">1747</a></span>
<span class="normal"><a href="#__codelineno-0-1748">1748</a></span>
<span class="normal"><a href="#__codelineno-0-1749">1749</a></span>
<span class="normal"><a href="#__codelineno-0-1750">1750</a></span>
<span class="normal"><a href="#__codelineno-0-1751">1751</a></span>
<span class="normal"><a href="#__codelineno-0-1752">1752</a></span>
<span class="normal"><a href="#__codelineno-0-1753">1753</a></span>
<span class="normal"><a href="#__codelineno-0-1754">1754</a></span>
<span class="normal"><a href="#__codelineno-0-1755">1755</a></span>
<span class="normal"><a href="#__codelineno-0-1756">1756</a></span>
<span class="normal"><a href="#__codelineno-0-1757">1757</a></span>
<span class="normal"><a href="#__codelineno-0-1758">1758</a></span>
<span class="normal"><a href="#__codelineno-0-1759">1759</a></span>
<span class="normal"><a href="#__codelineno-0-1760">1760</a></span>
<span class="normal"><a href="#__codelineno-0-1761">1761</a></span>
<span class="normal"><a href="#__codelineno-0-1762">1762</a></span>
<span class="normal"><a href="#__codelineno-0-1763">1763</a></span>
<span class="normal"><a href="#__codelineno-0-1764">1764</a></span>
<span class="normal"><a href="#__codelineno-0-1765">1765</a></span>
<span class="normal"><a href="#__codelineno-0-1766">1766</a></span>
<span class="normal"><a href="#__codelineno-0-1767">1767</a></span>
<span class="normal"><a href="#__codelineno-0-1768">1768</a></span>
<span class="normal"><a href="#__codelineno-0-1769">1769</a></span>
<span class="normal"><a href="#__codelineno-0-1770">1770</a></span>
<span class="normal"><a href="#__codelineno-0-1771">1771</a></span>
<span class="normal"><a href="#__codelineno-0-1772">1772</a></span>
<span class="normal"><a href="#__codelineno-0-1773">1773</a></span>
<span class="normal"><a href="#__codelineno-0-1774">1774</a></span>
<span class="normal"><a href="#__codelineno-0-1775">1775</a></span>
<span class="normal"><a href="#__codelineno-0-1776">1776</a></span>
<span class="normal"><a href="#__codelineno-0-1777">1777</a></span>
<span class="normal"><a href="#__codelineno-0-1778">1778</a></span>
<span class="normal"><a href="#__codelineno-0-1779">1779</a></span>
<span class="normal"><a href="#__codelineno-0-1780">1780</a></span>
<span class="normal"><a href="#__codelineno-0-1781">1781</a></span>
<span class="normal"><a href="#__codelineno-0-1782">1782</a></span>
<span class="normal"><a href="#__codelineno-0-1783">1783</a></span>
<span class="normal"><a href="#__codelineno-0-1784">1784</a></span>
<span class="normal"><a href="#__codelineno-0-1785">1785</a></span>
<span class="normal"><a href="#__codelineno-0-1786">1786</a></span>
<span class="normal"><a href="#__codelineno-0-1787">1787</a></span>
<span class="normal"><a href="#__codelineno-0-1788">1788</a></span>
<span class="normal"><a href="#__codelineno-0-1789">1789</a></span>
<span class="normal"><a href="#__codelineno-0-1790">1790</a></span>
<span class="normal"><a href="#__codelineno-0-1791">1791</a></span>
<span class="normal"><a href="#__codelineno-0-1792">1792</a></span>
<span class="normal"><a href="#__codelineno-0-1793">1793</a></span>
<span class="normal"><a href="#__codelineno-0-1794">1794</a></span>
<span class="normal"><a href="#__codelineno-0-1795">1795</a></span>
<span class="normal"><a href="#__codelineno-0-1796">1796</a></span>
<span class="normal"><a href="#__codelineno-0-1797">1797</a></span>
<span class="normal"><a href="#__codelineno-0-1798">1798</a></span>
<span class="normal"><a href="#__codelineno-0-1799">1799</a></span>
<span class="normal"><a href="#__codelineno-0-1800">1800</a></span>
<span class="normal"><a href="#__codelineno-0-1801">1801</a></span>
<span class="normal"><a href="#__codelineno-0-1802">1802</a></span>
<span class="normal"><a href="#__codelineno-0-1803">1803</a></span>
<span class="normal"><a href="#__codelineno-0-1804">1804</a></span>
<span class="normal"><a href="#__codelineno-0-1805">1805</a></span>
<span class="normal"><a href="#__codelineno-0-1806">1806</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1723"><a id="__codelineno-0-1723" name="__codelineno-0-1723"></a><span class="k">def</span><span class="w"> </span><span class="nf">initialize_tile</span><span class="p">(</span>
</span><span id="__span-0-1724"><a id="__codelineno-0-1724" name="__codelineno-0-1724"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1725"><a id="__codelineno-0-1725" name="__codelineno-0-1725"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1726"><a id="__codelineno-0-1726" name="__codelineno-0-1726"></a><span class="p">):</span>
</span><span id="__span-0-1727"><a id="__codelineno-0-1727" name="__codelineno-0-1727"></a><span class="w">    </span><span class="sd">"""Initialize directory structure for a tile.</span>
</span><span id="__span-0-1728"><a id="__codelineno-0-1728" name="__codelineno-0-1728"></a>
</span><span id="__span-0-1729"><a id="__codelineno-0-1729" name="__codelineno-0-1729"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-1730"><a id="__codelineno-0-1730" name="__codelineno-0-1730"></a><span class="sd">    ----------</span>
</span><span id="__span-0-1731"><a id="__codelineno-0-1731" name="__codelineno-0-1731"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-1732"><a id="__codelineno-0-1732" name="__codelineno-0-1732"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-1733"><a id="__codelineno-0-1733" name="__codelineno-0-1733"></a><span class="sd">    """</span>
</span><span id="__span-0-1734"><a id="__codelineno-0-1734" name="__codelineno-0-1734"></a>
</span><span id="__span-0-1735"><a id="__codelineno-0-1735" name="__codelineno-0-1735"></a>    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_experiment_order"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1736"><a id="__codelineno-0-1736" name="__codelineno-0-1736"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Assign experimental order before creating tiles."</span><span class="p">)</span>
</span><span id="__span-0-1737"><a id="__codelineno-0-1737" name="__codelineno-0-1737"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1738"><a id="__codelineno-0-1738" name="__codelineno-0-1738"></a>
</span><span id="__span-0-1739"><a id="__codelineno-0-1739" name="__codelineno-0-1739"></a>    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_num_tiles"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1740"><a id="__codelineno-0-1740" name="__codelineno-0-1740"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Assign number of tiles before creating tiles."</span><span class="p">)</span>
</span><span id="__span-0-1741"><a id="__codelineno-0-1741" name="__codelineno-0-1741"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1742"><a id="__codelineno-0-1742" name="__codelineno-0-1742"></a>
</span><span id="__span-0-1743"><a id="__codelineno-0-1743" name="__codelineno-0-1743"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1744"><a id="__codelineno-0-1744" name="__codelineno-0-1744"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-1745"><a id="__codelineno-0-1745" name="__codelineno-0-1745"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-1746"><a id="__codelineno-0-1746" name="__codelineno-0-1746"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1747"><a id="__codelineno-0-1747" name="__codelineno-0-1747"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1748"><a id="__codelineno-0-1748" name="__codelineno-0-1748"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-1749"><a id="__codelineno-0-1749" name="__codelineno-0-1749"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1750"><a id="__codelineno-0-1750" name="__codelineno-0-1750"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-1751"><a id="__codelineno-0-1751" name="__codelineno-0-1751"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tile id."</span><span class="p">)</span>
</span><span id="__span-0-1752"><a id="__codelineno-0-1752" name="__codelineno-0-1752"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1753"><a id="__codelineno-0-1753" name="__codelineno-0-1753"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1754"><a id="__codelineno-0-1754" name="__codelineno-0-1754"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-1755"><a id="__codelineno-0-1755" name="__codelineno-0-1755"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1756"><a id="__codelineno-0-1756" name="__codelineno-0-1756"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1757"><a id="__codelineno-0-1757" name="__codelineno-0-1757"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1758"><a id="__codelineno-0-1758" name="__codelineno-0-1758"></a>
</span><span id="__span-0-1759"><a id="__codelineno-0-1759" name="__codelineno-0-1759"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1760"><a id="__codelineno-0-1760" name="__codelineno-0-1760"></a>        <span class="n">polyDT_tile_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1761"><a id="__codelineno-0-1761" name="__codelineno-0-1761"></a>        <span class="n">polyDT_tile_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-1762"><a id="__codelineno-0-1762" name="__codelineno-0-1762"></a>        <span class="k">for</span> <span class="n">round_idx</span><span class="p">,</span> <span class="n">round_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">):</span>
</span><span id="__span-0-1763"><a id="__codelineno-0-1763" name="__codelineno-0-1763"></a>            <span class="n">polyDT_round_path</span> <span class="o">=</span> <span class="n">polyDT_tile_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1764"><a id="__codelineno-0-1764" name="__codelineno-0-1764"></a>            <span class="n">polyDT_round_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-1765"><a id="__codelineno-0-1765" name="__codelineno-0-1765"></a>            <span class="n">polydt_round_attrs_path</span> <span class="o">=</span> <span class="n">polyDT_round_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1766"><a id="__codelineno-0-1766" name="__codelineno-0-1766"></a>            <span class="n">round_attrs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-1767"><a id="__codelineno-0-1767" name="__codelineno-0-1767"></a>                <span class="s2">"bit_linker"</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_order</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="n">round_idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-0-1768"><a id="__codelineno-0-1768" name="__codelineno-0-1768"></a>                <span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-0-1769"><a id="__codelineno-0-1769" name="__codelineno-0-1769"></a>                <span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="__span-0-1770"><a id="__codelineno-0-1770" name="__codelineno-0-1770"></a>            <span class="p">}</span>
</span><span id="__span-0-1771"><a id="__codelineno-0-1771" name="__codelineno-0-1771"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">round_attrs</span><span class="p">,</span> <span class="n">polydt_round_attrs_path</span><span class="p">)</span>
</span><span id="__span-0-1772"><a id="__codelineno-0-1772" name="__codelineno-0-1772"></a>    <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="__span-0-1773"><a id="__codelineno-0-1773" name="__codelineno-0-1773"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error creating polyDT tile. Does it exist already?"</span><span class="p">)</span>
</span><span id="__span-0-1774"><a id="__codelineno-0-1774" name="__codelineno-0-1774"></a>
</span><span id="__span-0-1775"><a id="__codelineno-0-1775" name="__codelineno-0-1775"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1776"><a id="__codelineno-0-1776" name="__codelineno-0-1776"></a>        <span class="n">readout_tile_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1777"><a id="__codelineno-0-1777" name="__codelineno-0-1777"></a>        <span class="n">readout_tile_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-1778"><a id="__codelineno-0-1778" name="__codelineno-0-1778"></a>        <span class="k">for</span> <span class="n">bit_idx</span><span class="p">,</span> <span class="n">bit_id</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-1779"><a id="__codelineno-0-1779" name="__codelineno-0-1779"></a>            <span class="n">readout_bit_path</span> <span class="o">=</span> <span class="n">readout_tile_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1780"><a id="__codelineno-0-1780" name="__codelineno-0-1780"></a>            <span class="n">readout_bit_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-1781"><a id="__codelineno-0-1781" name="__codelineno-0-1781"></a>            <span class="n">readout_bit_attrs_path</span> <span class="o">=</span> <span class="n">readout_bit_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1782"><a id="__codelineno-0-1782" name="__codelineno-0-1782"></a>            <span class="n">fiducial_channel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channels_in_data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-1783"><a id="__codelineno-0-1783" name="__codelineno-0-1783"></a>            <span class="n">readout_one_channel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channels_in_data</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-1784"><a id="__codelineno-0-1784" name="__codelineno-0-1784"></a>
</span><span id="__span-0-1785"><a id="__codelineno-0-1785" name="__codelineno-0-1785"></a>            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channels_in_data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
</span><span id="__span-0-1786"><a id="__codelineno-0-1786" name="__codelineno-0-1786"></a>                <span class="n">readout_two_channel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channels_in_data</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</span><span id="__span-0-1787"><a id="__codelineno-0-1787" name="__codelineno-0-1787"></a>                <span class="n">condition_one</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_order</span><span class="p">[</span><span class="n">readout_one_channel</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span>
</span><span id="__span-0-1788"><a id="__codelineno-0-1788" name="__codelineno-0-1788"></a>                    <span class="n">bit_idx</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-0-1789"><a id="__codelineno-0-1789" name="__codelineno-0-1789"></a>                <span class="p">)</span>
</span><span id="__span-0-1790"><a id="__codelineno-0-1790" name="__codelineno-0-1790"></a>                <span class="n">condition_two</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_order</span><span class="p">[</span><span class="n">readout_two_channel</span><span class="p">]</span> <span class="o">==</span> <span class="p">(</span>
</span><span id="__span-0-1791"><a id="__codelineno-0-1791" name="__codelineno-0-1791"></a>                    <span class="n">bit_idx</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="__span-0-1792"><a id="__codelineno-0-1792" name="__codelineno-0-1792"></a>                <span class="p">)</span>
</span><span id="__span-0-1793"><a id="__codelineno-0-1793" name="__codelineno-0-1793"></a>                <span class="n">combined_condition</span> <span class="o">=</span> <span class="n">condition_one</span> <span class="o">|</span> <span class="n">condition_two</span>
</span><span id="__span-0-1794"><a id="__codelineno-0-1794" name="__codelineno-0-1794"></a>
</span><span id="__span-0-1795"><a id="__codelineno-0-1795" name="__codelineno-0-1795"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1796"><a id="__codelineno-0-1796" name="__codelineno-0-1796"></a>                <span class="n">combined_condition</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_order</span><span class="p">[</span>
</span><span id="__span-0-1797"><a id="__codelineno-0-1797" name="__codelineno-0-1797"></a>                    <span class="n">readout_one_channel</span>
</span><span id="__span-0-1798"><a id="__codelineno-0-1798" name="__codelineno-0-1798"></a>                <span class="p">]</span> <span class="o">==</span> <span class="p">(</span><span class="n">bit_idx</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-1799"><a id="__codelineno-0-1799" name="__codelineno-0-1799"></a>            <span class="n">matching_rows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_experiment_order</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">combined_condition</span><span class="p">]</span>
</span><span id="__span-0-1800"><a id="__codelineno-0-1800" name="__codelineno-0-1800"></a>
</span><span id="__span-0-1801"><a id="__codelineno-0-1801" name="__codelineno-0-1801"></a>            <span class="n">bit_attrs</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-1802"><a id="__codelineno-0-1802" name="__codelineno-0-1802"></a>                <span class="s2">"round_linker"</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">matching_rows</span><span class="p">[</span><span class="n">fiducial_channel</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-1803"><a id="__codelineno-0-1803" name="__codelineno-0-1803"></a>            <span class="p">}</span>
</span><span id="__span-0-1804"><a id="__codelineno-0-1804" name="__codelineno-0-1804"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">bit_attrs</span><span class="p">,</span> <span class="n">readout_bit_attrs_path</span><span class="p">)</span>
</span><span id="__span-0-1805"><a id="__codelineno-0-1805" name="__codelineno-0-1805"></a>    <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
</span><span id="__span-0-1806"><a id="__codelineno-0-1806" name="__codelineno-0-1806"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error creating readout tile. Does it exist already?"</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_codebook_parsed"> <code class="highlight language-python"><span class="n">load_codebook_parsed</span><span class="p">()</span></code> </h3> <div class="doc doc-contents"> <p>Load and split codebook into gene_ids and codebook matrix.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>gene_ids</code></td> <td> <code><span title="typing.Collection">Collection</span>[<span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Gene IDs.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code>codebook_matrix</code></td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Codebook matrix.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1693">1693</a></span>
<span class="normal"><a href="#__codelineno-0-1694">1694</a></span>
<span class="normal"><a href="#__codelineno-0-1695">1695</a></span>
<span class="normal"><a href="#__codelineno-0-1696">1696</a></span>
<span class="normal"><a href="#__codelineno-0-1697">1697</a></span>
<span class="normal"><a href="#__codelineno-0-1698">1698</a></span>
<span class="normal"><a href="#__codelineno-0-1699">1699</a></span>
<span class="normal"><a href="#__codelineno-0-1700">1700</a></span>
<span class="normal"><a href="#__codelineno-0-1701">1701</a></span>
<span class="normal"><a href="#__codelineno-0-1702">1702</a></span>
<span class="normal"><a href="#__codelineno-0-1703">1703</a></span>
<span class="normal"><a href="#__codelineno-0-1704">1704</a></span>
<span class="normal"><a href="#__codelineno-0-1705">1705</a></span>
<span class="normal"><a href="#__codelineno-0-1706">1706</a></span>
<span class="normal"><a href="#__codelineno-0-1707">1707</a></span>
<span class="normal"><a href="#__codelineno-0-1708">1708</a></span>
<span class="normal"><a href="#__codelineno-0-1709">1709</a></span>
<span class="normal"><a href="#__codelineno-0-1710">1710</a></span>
<span class="normal"><a href="#__codelineno-0-1711">1711</a></span>
<span class="normal"><a href="#__codelineno-0-1712">1712</a></span>
<span class="normal"><a href="#__codelineno-0-1713">1713</a></span>
<span class="normal"><a href="#__codelineno-0-1714">1714</a></span>
<span class="normal"><a href="#__codelineno-0-1715">1715</a></span>
<span class="normal"><a href="#__codelineno-0-1716">1716</a></span>
<span class="normal"><a href="#__codelineno-0-1717">1717</a></span>
<span class="normal"><a href="#__codelineno-0-1718">1718</a></span>
<span class="normal"><a href="#__codelineno-0-1719">1719</a></span>
<span class="normal"><a href="#__codelineno-0-1720">1720</a></span>
<span class="normal"><a href="#__codelineno-0-1721">1721</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1693"><a id="__codelineno-0-1693" name="__codelineno-0-1693"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_codebook_parsed</span><span class="p">(</span>
</span><span id="__span-0-1694"><a id="__codelineno-0-1694" name="__codelineno-0-1694"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1695"><a id="__codelineno-0-1695" name="__codelineno-0-1695"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">Collection</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">ArrayLike</span><span class="p">]]:</span>
</span><span id="__span-0-1696"><a id="__codelineno-0-1696" name="__codelineno-0-1696"></a><span class="w">    </span><span class="sd">"""Load and split codebook into gene_ids and codebook matrix.</span>
</span><span id="__span-0-1697"><a id="__codelineno-0-1697" name="__codelineno-0-1697"></a>
</span><span id="__span-0-1698"><a id="__codelineno-0-1698" name="__codelineno-0-1698"></a><span class="sd">    Returns</span>
</span><span id="__span-0-1699"><a id="__codelineno-0-1699" name="__codelineno-0-1699"></a><span class="sd">    -------</span>
</span><span id="__span-0-1700"><a id="__codelineno-0-1700" name="__codelineno-0-1700"></a><span class="sd">    gene_ids : Collection[str]</span>
</span><span id="__span-0-1701"><a id="__codelineno-0-1701" name="__codelineno-0-1701"></a><span class="sd">        Gene IDs.</span>
</span><span id="__span-0-1702"><a id="__codelineno-0-1702" name="__codelineno-0-1702"></a><span class="sd">    codebook_matrix : ArrayLike</span>
</span><span id="__span-0-1703"><a id="__codelineno-0-1703" name="__codelineno-0-1703"></a><span class="sd">        Codebook matrix.</span>
</span><span id="__span-0-1704"><a id="__codelineno-0-1704" name="__codelineno-0-1704"></a><span class="sd">    """</span>
</span><span id="__span-0-1705"><a id="__codelineno-0-1705" name="__codelineno-0-1705"></a>
</span><span id="__span-0-1706"><a id="__codelineno-0-1706" name="__codelineno-0-1706"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1707"><a id="__codelineno-0-1707" name="__codelineno-0-1707"></a>        <span class="n">data</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">"_codebook"</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="__span-0-1708"><a id="__codelineno-0-1708" name="__codelineno-0-1708"></a>
</span><span id="__span-0-1709"><a id="__codelineno-0-1709" name="__codelineno-0-1709"></a>        <span class="k">if</span> <span class="n">data</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-1710"><a id="__codelineno-0-1710" name="__codelineno-0-1710"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1711"><a id="__codelineno-0-1711" name="__codelineno-0-1711"></a>        <span class="n">num_columns</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="k">if</span> <span class="n">data</span> <span class="k">else</span> <span class="mi">0</span>
</span><span id="__span-0-1712"><a id="__codelineno-0-1712" name="__codelineno-0-1712"></a>        <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">"gene_id"</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="sa">f</span><span class="s2">"bit</span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">02d</span><span class="si">}</span><span class="s2">"</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_columns</span><span class="p">)]</span>
</span><span id="__span-0-1713"><a id="__codelineno-0-1713" name="__codelineno-0-1713"></a>        <span class="n">codebook_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
</span><span id="__span-0-1714"><a id="__codelineno-0-1714" name="__codelineno-0-1714"></a>
</span><span id="__span-0-1715"><a id="__codelineno-0-1715" name="__codelineno-0-1715"></a>        <span class="n">gene_ids</span> <span class="o">=</span> <span class="n">codebook_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-1716"><a id="__codelineno-0-1716" name="__codelineno-0-1716"></a>        <span class="n">codebook_matrix</span> <span class="o">=</span> <span class="n">codebook_df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="__span-0-1717"><a id="__codelineno-0-1717" name="__codelineno-0-1717"></a>        <span class="k">del</span> <span class="n">data</span><span class="p">,</span> <span class="n">codebook_df</span>
</span><span id="__span-0-1718"><a id="__codelineno-0-1718" name="__codelineno-0-1718"></a>        <span class="k">return</span> <span class="n">gene_ids</span><span class="p">,</span> <span class="n">codebook_matrix</span>
</span><span id="__span-0-1719"><a id="__codelineno-0-1719" name="__codelineno-0-1719"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">KeyError</span><span class="p">,</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
</span><span id="__span-0-1720"><a id="__codelineno-0-1720" name="__codelineno-0-1720"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error parsing codebook."</span><span class="p">)</span>
</span><span id="__span-0-1721"><a id="__codelineno-0-1721" name="__codelineno-0-1721"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_coord_of_xform_px"> <code class="highlight language-python"><span class="n">load_coord_of_xform_px</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Local fidicual optical flow matrix for one round and tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code> </td> <td> <div class="doc-md-description"> <p>Return future array.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>of_xform_px</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Local fidicual optical flow matrix for one round and tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code>downsampling</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Downsampling factor.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2780">2780</a></span>
<span class="normal"><a href="#__codelineno-0-2781">2781</a></span>
<span class="normal"><a href="#__codelineno-0-2782">2782</a></span>
<span class="normal"><a href="#__codelineno-0-2783">2783</a></span>
<span class="normal"><a href="#__codelineno-0-2784">2784</a></span>
<span class="normal"><a href="#__codelineno-0-2785">2785</a></span>
<span class="normal"><a href="#__codelineno-0-2786">2786</a></span>
<span class="normal"><a href="#__codelineno-0-2787">2787</a></span>
<span class="normal"><a href="#__codelineno-0-2788">2788</a></span>
<span class="normal"><a href="#__codelineno-0-2789">2789</a></span>
<span class="normal"><a href="#__codelineno-0-2790">2790</a></span>
<span class="normal"><a href="#__codelineno-0-2791">2791</a></span>
<span class="normal"><a href="#__codelineno-0-2792">2792</a></span>
<span class="normal"><a href="#__codelineno-0-2793">2793</a></span>
<span class="normal"><a href="#__codelineno-0-2794">2794</a></span>
<span class="normal"><a href="#__codelineno-0-2795">2795</a></span>
<span class="normal"><a href="#__codelineno-0-2796">2796</a></span>
<span class="normal"><a href="#__codelineno-0-2797">2797</a></span>
<span class="normal"><a href="#__codelineno-0-2798">2798</a></span>
<span class="normal"><a href="#__codelineno-0-2799">2799</a></span>
<span class="normal"><a href="#__codelineno-0-2800">2800</a></span>
<span class="normal"><a href="#__codelineno-0-2801">2801</a></span>
<span class="normal"><a href="#__codelineno-0-2802">2802</a></span>
<span class="normal"><a href="#__codelineno-0-2803">2803</a></span>
<span class="normal"><a href="#__codelineno-0-2804">2804</a></span>
<span class="normal"><a href="#__codelineno-0-2805">2805</a></span>
<span class="normal"><a href="#__codelineno-0-2806">2806</a></span>
<span class="normal"><a href="#__codelineno-0-2807">2807</a></span>
<span class="normal"><a href="#__codelineno-0-2808">2808</a></span>
<span class="normal"><a href="#__codelineno-0-2809">2809</a></span>
<span class="normal"><a href="#__codelineno-0-2810">2810</a></span>
<span class="normal"><a href="#__codelineno-0-2811">2811</a></span>
<span class="normal"><a href="#__codelineno-0-2812">2812</a></span>
<span class="normal"><a href="#__codelineno-0-2813">2813</a></span>
<span class="normal"><a href="#__codelineno-0-2814">2814</a></span>
<span class="normal"><a href="#__codelineno-0-2815">2815</a></span>
<span class="normal"><a href="#__codelineno-0-2816">2816</a></span>
<span class="normal"><a href="#__codelineno-0-2817">2817</a></span>
<span class="normal"><a href="#__codelineno-0-2818">2818</a></span>
<span class="normal"><a href="#__codelineno-0-2819">2819</a></span>
<span class="normal"><a href="#__codelineno-0-2820">2820</a></span>
<span class="normal"><a href="#__codelineno-0-2821">2821</a></span>
<span class="normal"><a href="#__codelineno-0-2822">2822</a></span>
<span class="normal"><a href="#__codelineno-0-2823">2823</a></span>
<span class="normal"><a href="#__codelineno-0-2824">2824</a></span>
<span class="normal"><a href="#__codelineno-0-2825">2825</a></span>
<span class="normal"><a href="#__codelineno-0-2826">2826</a></span>
<span class="normal"><a href="#__codelineno-0-2827">2827</a></span>
<span class="normal"><a href="#__codelineno-0-2828">2828</a></span>
<span class="normal"><a href="#__codelineno-0-2829">2829</a></span>
<span class="normal"><a href="#__codelineno-0-2830">2830</a></span>
<span class="normal"><a href="#__codelineno-0-2831">2831</a></span>
<span class="normal"><a href="#__codelineno-0-2832">2832</a></span>
<span class="normal"><a href="#__codelineno-0-2833">2833</a></span>
<span class="normal"><a href="#__codelineno-0-2834">2834</a></span>
<span class="normal"><a href="#__codelineno-0-2835">2835</a></span>
<span class="normal"><a href="#__codelineno-0-2836">2836</a></span>
<span class="normal"><a href="#__codelineno-0-2837">2837</a></span>
<span class="normal"><a href="#__codelineno-0-2838">2838</a></span>
<span class="normal"><a href="#__codelineno-0-2839">2839</a></span>
<span class="normal"><a href="#__codelineno-0-2840">2840</a></span>
<span class="normal"><a href="#__codelineno-0-2841">2841</a></span>
<span class="normal"><a href="#__codelineno-0-2842">2842</a></span>
<span class="normal"><a href="#__codelineno-0-2843">2843</a></span>
<span class="normal"><a href="#__codelineno-0-2844">2844</a></span>
<span class="normal"><a href="#__codelineno-0-2845">2845</a></span>
<span class="normal"><a href="#__codelineno-0-2846">2846</a></span>
<span class="normal"><a href="#__codelineno-0-2847">2847</a></span>
<span class="normal"><a href="#__codelineno-0-2848">2848</a></span>
<span class="normal"><a href="#__codelineno-0-2849">2849</a></span>
<span class="normal"><a href="#__codelineno-0-2850">2850</a></span>
<span class="normal"><a href="#__codelineno-0-2851">2851</a></span>
<span class="normal"><a href="#__codelineno-0-2852">2852</a></span>
<span class="normal"><a href="#__codelineno-0-2853">2853</a></span>
<span class="normal"><a href="#__codelineno-0-2854">2854</a></span>
<span class="normal"><a href="#__codelineno-0-2855">2855</a></span>
<span class="normal"><a href="#__codelineno-0-2856">2856</a></span>
<span class="normal"><a href="#__codelineno-0-2857">2857</a></span>
<span class="normal"><a href="#__codelineno-0-2858">2858</a></span>
<span class="normal"><a href="#__codelineno-0-2859">2859</a></span>
<span class="normal"><a href="#__codelineno-0-2860">2860</a></span>
<span class="normal"><a href="#__codelineno-0-2861">2861</a></span>
<span class="normal"><a href="#__codelineno-0-2862">2862</a></span>
<span class="normal"><a href="#__codelineno-0-2863">2863</a></span>
<span class="normal"><a href="#__codelineno-0-2864">2864</a></span>
<span class="normal"><a href="#__codelineno-0-2865">2865</a></span>
<span class="normal"><a href="#__codelineno-0-2866">2866</a></span>
<span class="normal"><a href="#__codelineno-0-2867">2867</a></span>
<span class="normal"><a href="#__codelineno-0-2868">2868</a></span>
<span class="normal"><a href="#__codelineno-0-2869">2869</a></span>
<span class="normal"><a href="#__codelineno-0-2870">2870</a></span>
<span class="normal"><a href="#__codelineno-0-2871">2871</a></span>
<span class="normal"><a href="#__codelineno-0-2872">2872</a></span>
<span class="normal"><a href="#__codelineno-0-2873">2873</a></span>
<span class="normal"><a href="#__codelineno-0-2874">2874</a></span>
<span class="normal"><a href="#__codelineno-0-2875">2875</a></span>
<span class="normal"><a href="#__codelineno-0-2876">2876</a></span>
<span class="normal"><a href="#__codelineno-0-2877">2877</a></span>
<span class="normal"><a href="#__codelineno-0-2878">2878</a></span>
<span class="normal"><a href="#__codelineno-0-2879">2879</a></span>
<span class="normal"><a href="#__codelineno-0-2880">2880</a></span>
<span class="normal"><a href="#__codelineno-0-2881">2881</a></span>
<span class="normal"><a href="#__codelineno-0-2882">2882</a></span>
<span class="normal"><a href="#__codelineno-0-2883">2883</a></span>
<span class="normal"><a href="#__codelineno-0-2884">2884</a></span>
<span class="normal"><a href="#__codelineno-0-2885">2885</a></span>
<span class="normal"><a href="#__codelineno-0-2886">2886</a></span>
<span class="normal"><a href="#__codelineno-0-2887">2887</a></span>
<span class="normal"><a href="#__codelineno-0-2888">2888</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2780"><a id="__codelineno-0-2780" name="__codelineno-0-2780"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_coord_of_xform_px</span><span class="p">(</span>
</span><span id="__span-0-2781"><a id="__codelineno-0-2781" name="__codelineno-0-2781"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2782"><a id="__codelineno-0-2782" name="__codelineno-0-2782"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
</span><span id="__span-0-2783"><a id="__codelineno-0-2783" name="__codelineno-0-2783"></a>    <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]],</span>
</span><span id="__span-0-2784"><a id="__codelineno-0-2784" name="__codelineno-0-2784"></a>    <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2785"><a id="__codelineno-0-2785" name="__codelineno-0-2785"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">]]:</span>
</span><span id="__span-0-2786"><a id="__codelineno-0-2786" name="__codelineno-0-2786"></a><span class="w">    </span><span class="sd">"""Local fidicual optical flow matrix for one round and tile.</span>
</span><span id="__span-0-2787"><a id="__codelineno-0-2787" name="__codelineno-0-2787"></a>
</span><span id="__span-0-2788"><a id="__codelineno-0-2788" name="__codelineno-0-2788"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-2789"><a id="__codelineno-0-2789" name="__codelineno-0-2789"></a><span class="sd">    ----------</span>
</span><span id="__span-0-2790"><a id="__codelineno-0-2790" name="__codelineno-0-2790"></a><span class="sd">    tile : Optional[Union[int, str]]</span>
</span><span id="__span-0-2791"><a id="__codelineno-0-2791" name="__codelineno-0-2791"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-2792"><a id="__codelineno-0-2792" name="__codelineno-0-2792"></a><span class="sd">    round : Optional[Union[int, str]]</span>
</span><span id="__span-0-2793"><a id="__codelineno-0-2793" name="__codelineno-0-2793"></a><span class="sd">        Round index or round id.</span>
</span><span id="__span-0-2794"><a id="__codelineno-0-2794" name="__codelineno-0-2794"></a><span class="sd">    return_future : Optional[bool]</span>
</span><span id="__span-0-2795"><a id="__codelineno-0-2795" name="__codelineno-0-2795"></a><span class="sd">        Return future array.</span>
</span><span id="__span-0-2796"><a id="__codelineno-0-2796" name="__codelineno-0-2796"></a>
</span><span id="__span-0-2797"><a id="__codelineno-0-2797" name="__codelineno-0-2797"></a><span class="sd">    Returns</span>
</span><span id="__span-0-2798"><a id="__codelineno-0-2798" name="__codelineno-0-2798"></a><span class="sd">    -------</span>
</span><span id="__span-0-2799"><a id="__codelineno-0-2799" name="__codelineno-0-2799"></a><span class="sd">    of_xform_px : Optional[ArrayLike]</span>
</span><span id="__span-0-2800"><a id="__codelineno-0-2800" name="__codelineno-0-2800"></a><span class="sd">        Local fidicual optical flow matrix for one round and tile.</span>
</span><span id="__span-0-2801"><a id="__codelineno-0-2801" name="__codelineno-0-2801"></a><span class="sd">    downsampling : Optional[ArrayLike]</span>
</span><span id="__span-0-2802"><a id="__codelineno-0-2802" name="__codelineno-0-2802"></a><span class="sd">        Downsampling factor.</span>
</span><span id="__span-0-2803"><a id="__codelineno-0-2803" name="__codelineno-0-2803"></a><span class="sd">    """</span>
</span><span id="__span-0-2804"><a id="__codelineno-0-2804" name="__codelineno-0-2804"></a>
</span><span id="__span-0-2805"><a id="__codelineno-0-2805" name="__codelineno-0-2805"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2806"><a id="__codelineno-0-2806" name="__codelineno-0-2806"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2807"><a id="__codelineno-0-2807" name="__codelineno-0-2807"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2808"><a id="__codelineno-0-2808" name="__codelineno-0-2808"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2809"><a id="__codelineno-0-2809" name="__codelineno-0-2809"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2810"><a id="__codelineno-0-2810" name="__codelineno-0-2810"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2811"><a id="__codelineno-0-2811" name="__codelineno-0-2811"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2812"><a id="__codelineno-0-2812" name="__codelineno-0-2812"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2813"><a id="__codelineno-0-2813" name="__codelineno-0-2813"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2814"><a id="__codelineno-0-2814" name="__codelineno-0-2814"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2815"><a id="__codelineno-0-2815" name="__codelineno-0-2815"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2816"><a id="__codelineno-0-2816" name="__codelineno-0-2816"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2817"><a id="__codelineno-0-2817" name="__codelineno-0-2817"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2818"><a id="__codelineno-0-2818" name="__codelineno-0-2818"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2819"><a id="__codelineno-0-2819" name="__codelineno-0-2819"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2820"><a id="__codelineno-0-2820" name="__codelineno-0-2820"></a>
</span><span id="__span-0-2821"><a id="__codelineno-0-2821" name="__codelineno-0-2821"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2822"><a id="__codelineno-0-2822" name="__codelineno-0-2822"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2823"><a id="__codelineno-0-2823" name="__codelineno-0-2823"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2824"><a id="__codelineno-0-2824" name="__codelineno-0-2824"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2825"><a id="__codelineno-0-2825" name="__codelineno-0-2825"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2826"><a id="__codelineno-0-2826" name="__codelineno-0-2826"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2827"><a id="__codelineno-0-2827" name="__codelineno-0-2827"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2828"><a id="__codelineno-0-2828" name="__codelineno-0-2828"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2829"><a id="__codelineno-0-2829" name="__codelineno-0-2829"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2830"><a id="__codelineno-0-2830" name="__codelineno-0-2830"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2831"><a id="__codelineno-0-2831" name="__codelineno-0-2831"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2832"><a id="__codelineno-0-2832" name="__codelineno-0-2832"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2833"><a id="__codelineno-0-2833" name="__codelineno-0-2833"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2834"><a id="__codelineno-0-2834" name="__codelineno-0-2834"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2835"><a id="__codelineno-0-2835" name="__codelineno-0-2835"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2836"><a id="__codelineno-0-2836" name="__codelineno-0-2836"></a>
</span><span id="__span-0-2837"><a id="__codelineno-0-2837" name="__codelineno-0-2837"></a>    <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2838"><a id="__codelineno-0-2838" name="__codelineno-0-2838"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2839"><a id="__codelineno-0-2839" name="__codelineno-0-2839"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2840"><a id="__codelineno-0-2840" name="__codelineno-0-2840"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2841"><a id="__codelineno-0-2841" name="__codelineno-0-2841"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"opticalflow_xform_px"</span><span class="p">)</span>
</span><span id="__span-0-2842"><a id="__codelineno-0-2842" name="__codelineno-0-2842"></a>    <span class="p">)</span>
</span><span id="__span-0-2843"><a id="__codelineno-0-2843" name="__codelineno-0-2843"></a>    <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2844"><a id="__codelineno-0-2844" name="__codelineno-0-2844"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2845"><a id="__codelineno-0-2845" name="__codelineno-0-2845"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2846"><a id="__codelineno-0-2846" name="__codelineno-0-2846"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2847"><a id="__codelineno-0-2847" name="__codelineno-0-2847"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2848"><a id="__codelineno-0-2848" name="__codelineno-0-2848"></a>    <span class="p">)</span>
</span><span id="__span-0-2849"><a id="__codelineno-0-2849" name="__codelineno-0-2849"></a>
</span><span id="__span-0-2850"><a id="__codelineno-0-2850" name="__codelineno-0-2850"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-2851"><a id="__codelineno-0-2851" name="__codelineno-0-2851"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Optical flow transform mapping back to first round not found."</span><span class="p">)</span>
</span><span id="__span-0-2852"><a id="__codelineno-0-2852" name="__codelineno-0-2852"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2853"><a id="__codelineno-0-2853" name="__codelineno-0-2853"></a>
</span><span id="__span-0-2854"><a id="__codelineno-0-2854" name="__codelineno-0-2854"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2855"><a id="__codelineno-0-2855" name="__codelineno-0-2855"></a>        <span class="n">compressor</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-2856"><a id="__codelineno-0-2856" name="__codelineno-0-2856"></a>            <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"blosc"</span><span class="p">,</span>
</span><span id="__span-0-2857"><a id="__codelineno-0-2857" name="__codelineno-0-2857"></a>            <span class="s2">"cname"</span><span class="p">:</span> <span class="s2">"zstd"</span><span class="p">,</span>
</span><span id="__span-0-2858"><a id="__codelineno-0-2858" name="__codelineno-0-2858"></a>            <span class="s2">"clevel"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="__span-0-2859"><a id="__codelineno-0-2859" name="__codelineno-0-2859"></a>            <span class="s2">"shuffle"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="__span-0-2860"><a id="__codelineno-0-2860" name="__codelineno-0-2860"></a>        <span class="p">}</span>
</span><span id="__span-0-2861"><a id="__codelineno-0-2861" name="__codelineno-0-2861"></a>        <span class="n">spec_of</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-2862"><a id="__codelineno-0-2862" name="__codelineno-0-2862"></a>            <span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"zarr"</span><span class="p">,</span>
</span><span id="__span-0-2863"><a id="__codelineno-0-2863" name="__codelineno-0-2863"></a>            <span class="s2">"kvstore"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2864"><a id="__codelineno-0-2864" name="__codelineno-0-2864"></a>            <span class="s2">"metadata"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"compressor"</span><span class="p">:</span> <span class="n">compressor</span><span class="p">},</span>
</span><span id="__span-0-2865"><a id="__codelineno-0-2865" name="__codelineno-0-2865"></a>            <span class="s2">"open"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2866"><a id="__codelineno-0-2866" name="__codelineno-0-2866"></a>            <span class="s2">"assume_metadata"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2867"><a id="__codelineno-0-2867" name="__codelineno-0-2867"></a>            <span class="s2">"create"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2868"><a id="__codelineno-0-2868" name="__codelineno-0-2868"></a>            <span class="s2">"delete_existing"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2869"><a id="__codelineno-0-2869" name="__codelineno-0-2869"></a>        <span class="p">}</span>
</span><span id="__span-0-2870"><a id="__codelineno-0-2870" name="__codelineno-0-2870"></a>        <span class="n">spec_of</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"&lt;f4"</span>
</span><span id="__span-0-2871"><a id="__codelineno-0-2871" name="__codelineno-0-2871"></a>        <span class="n">of_xform_px</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-2872"><a id="__codelineno-0-2872" name="__codelineno-0-2872"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-2873"><a id="__codelineno-0-2873" name="__codelineno-0-2873"></a>            <span class="n">spec_of</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-2874"><a id="__codelineno-0-2874" name="__codelineno-0-2874"></a>            <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-2875"><a id="__codelineno-0-2875" name="__codelineno-0-2875"></a>        <span class="p">)</span>
</span><span id="__span-0-2876"><a id="__codelineno-0-2876" name="__codelineno-0-2876"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2877"><a id="__codelineno-0-2877" name="__codelineno-0-2877"></a>        <span class="n">block_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
</span><span id="__span-0-2878"><a id="__codelineno-0-2878" name="__codelineno-0-2878"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"block_size"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span><span id="__span-0-2879"><a id="__codelineno-0-2879" name="__codelineno-0-2879"></a>        <span class="p">)</span>
</span><span id="__span-0-2880"><a id="__codelineno-0-2880" name="__codelineno-0-2880"></a>        <span class="n">block_stride</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
</span><span id="__span-0-2881"><a id="__codelineno-0-2881" name="__codelineno-0-2881"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"block_stride"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span><span id="__span-0-2882"><a id="__codelineno-0-2882" name="__codelineno-0-2882"></a>        <span class="p">)</span>
</span><span id="__span-0-2883"><a id="__codelineno-0-2883" name="__codelineno-0-2883"></a>
</span><span id="__span-0-2884"><a id="__codelineno-0-2884" name="__codelineno-0-2884"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">of_xform_px</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">block_stride</span><span class="p">)</span>
</span><span id="__span-0-2885"><a id="__codelineno-0-2885" name="__codelineno-0-2885"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-2886"><a id="__codelineno-0-2886" name="__codelineno-0-2886"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-2887"><a id="__codelineno-0-2887" name="__codelineno-0-2887"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error loading optical flow transform."</span><span class="p">)</span>
</span><span id="__span-0-2888"><a id="__codelineno-0-2888" name="__codelineno-0-2888"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_baysor_filtered_spots"> <code class="highlight language-python"><span class="n">load_global_baysor_filtered_spots</span><span class="p">()</span></code> </h3> <div class="doc doc-contents"> <p>Load Baysor re-assigned decoded RNA.</p> <p>Assumes Baysor has been run.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>baysor_filtered_genes</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class="doc-md-description"> <p>Baysor re-assigned decoded RNA.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-4084">4084</a></span>
<span class="normal"><a href="#__codelineno-0-4085">4085</a></span>
<span class="normal"><a href="#__codelineno-0-4086">4086</a></span>
<span class="normal"><a href="#__codelineno-0-4087">4087</a></span>
<span class="normal"><a href="#__codelineno-0-4088">4088</a></span>
<span class="normal"><a href="#__codelineno-0-4089">4089</a></span>
<span class="normal"><a href="#__codelineno-0-4090">4090</a></span>
<span class="normal"><a href="#__codelineno-0-4091">4091</a></span>
<span class="normal"><a href="#__codelineno-0-4092">4092</a></span>
<span class="normal"><a href="#__codelineno-0-4093">4093</a></span>
<span class="normal"><a href="#__codelineno-0-4094">4094</a></span>
<span class="normal"><a href="#__codelineno-0-4095">4095</a></span>
<span class="normal"><a href="#__codelineno-0-4096">4096</a></span>
<span class="normal"><a href="#__codelineno-0-4097">4097</a></span>
<span class="normal"><a href="#__codelineno-0-4098">4098</a></span>
<span class="normal"><a href="#__codelineno-0-4099">4099</a></span>
<span class="normal"><a href="#__codelineno-0-4100">4100</a></span>
<span class="normal"><a href="#__codelineno-0-4101">4101</a></span>
<span class="normal"><a href="#__codelineno-0-4102">4102</a></span>
<span class="normal"><a href="#__codelineno-0-4103">4103</a></span>
<span class="normal"><a href="#__codelineno-0-4104">4104</a></span>
<span class="normal"><a href="#__codelineno-0-4105">4105</a></span>
<span class="normal"><a href="#__codelineno-0-4106">4106</a></span>
<span class="normal"><a href="#__codelineno-0-4107">4107</a></span>
<span class="normal"><a href="#__codelineno-0-4108">4108</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-4084"><a id="__codelineno-0-4084" name="__codelineno-0-4084"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_global_baysor_filtered_spots</span><span class="p">(</span>
</span><span id="__span-0-4085"><a id="__codelineno-0-4085" name="__codelineno-0-4085"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-4086"><a id="__codelineno-0-4086" name="__codelineno-0-4086"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="__span-0-4087"><a id="__codelineno-0-4087" name="__codelineno-0-4087"></a><span class="w">    </span><span class="sd">"""Load Baysor re-assigned decoded RNA.</span>
</span><span id="__span-0-4088"><a id="__codelineno-0-4088" name="__codelineno-0-4088"></a>
</span><span id="__span-0-4089"><a id="__codelineno-0-4089" name="__codelineno-0-4089"></a><span class="sd">    Assumes Baysor has been run.</span>
</span><span id="__span-0-4090"><a id="__codelineno-0-4090" name="__codelineno-0-4090"></a>
</span><span id="__span-0-4091"><a id="__codelineno-0-4091" name="__codelineno-0-4091"></a><span class="sd">    Returns</span>
</span><span id="__span-0-4092"><a id="__codelineno-0-4092" name="__codelineno-0-4092"></a><span class="sd">    -------</span>
</span><span id="__span-0-4093"><a id="__codelineno-0-4093" name="__codelineno-0-4093"></a><span class="sd">    baysor_filtered_genes : Optional[pd.DataFrame]</span>
</span><span id="__span-0-4094"><a id="__codelineno-0-4094" name="__codelineno-0-4094"></a><span class="sd">        Baysor re-assigned decoded RNA.</span>
</span><span id="__span-0-4095"><a id="__codelineno-0-4095" name="__codelineno-0-4095"></a><span class="sd">    """</span>
</span><span id="__span-0-4096"><a id="__codelineno-0-4096" name="__codelineno-0-4096"></a>
</span><span id="__span-0-4097"><a id="__codelineno-0-4097" name="__codelineno-0-4097"></a>    <span class="n">current_baysor_spots_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-4098"><a id="__codelineno-0-4098" name="__codelineno-0-4098"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-4099"><a id="__codelineno-0-4099" name="__codelineno-0-4099"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"baysor"</span><span class="p">)</span>
</span><span id="__span-0-4100"><a id="__codelineno-0-4100" name="__codelineno-0-4100"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"segmentation.csv"</span><span class="p">)</span>
</span><span id="__span-0-4101"><a id="__codelineno-0-4101" name="__codelineno-0-4101"></a>    <span class="p">)</span>
</span><span id="__span-0-4102"><a id="__codelineno-0-4102" name="__codelineno-0-4102"></a>
</span><span id="__span-0-4103"><a id="__codelineno-0-4103" name="__codelineno-0-4103"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">current_baysor_spots_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-4104"><a id="__codelineno-0-4104" name="__codelineno-0-4104"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor filtered genes not found."</span><span class="p">)</span>
</span><span id="__span-0-4105"><a id="__codelineno-0-4105" name="__codelineno-0-4105"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-4106"><a id="__codelineno-0-4106" name="__codelineno-0-4106"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-4107"><a id="__codelineno-0-4107" name="__codelineno-0-4107"></a>        <span class="n">baysor_filtered_genes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_csv</span><span class="p">(</span><span class="n">current_baysor_spots_path</span><span class="p">)</span>
</span><span id="__span-0-4108"><a id="__codelineno-0-4108" name="__codelineno-0-4108"></a>        <span class="k">return</span> <span class="n">baysor_filtered_genes</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_baysor_outlines"> <code class="highlight language-python"><span class="n">load_global_baysor_outlines</span><span class="p">()</span></code> </h3> <div class="doc doc-contents"> <p>Load Baysor cell outlines.</p> <p>Assumes Baysor has been run.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>baysor_outlines</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="dict">dict</span>]</code> </td> <td> <div class="doc-md-description"> <p>Baysor cell outlines.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-4110">4110</a></span>
<span class="normal"><a href="#__codelineno-0-4111">4111</a></span>
<span class="normal"><a href="#__codelineno-0-4112">4112</a></span>
<span class="normal"><a href="#__codelineno-0-4113">4113</a></span>
<span class="normal"><a href="#__codelineno-0-4114">4114</a></span>
<span class="normal"><a href="#__codelineno-0-4115">4115</a></span>
<span class="normal"><a href="#__codelineno-0-4116">4116</a></span>
<span class="normal"><a href="#__codelineno-0-4117">4117</a></span>
<span class="normal"><a href="#__codelineno-0-4118">4118</a></span>
<span class="normal"><a href="#__codelineno-0-4119">4119</a></span>
<span class="normal"><a href="#__codelineno-0-4120">4120</a></span>
<span class="normal"><a href="#__codelineno-0-4121">4121</a></span>
<span class="normal"><a href="#__codelineno-0-4122">4122</a></span>
<span class="normal"><a href="#__codelineno-0-4123">4123</a></span>
<span class="normal"><a href="#__codelineno-0-4124">4124</a></span>
<span class="normal"><a href="#__codelineno-0-4125">4125</a></span>
<span class="normal"><a href="#__codelineno-0-4126">4126</a></span>
<span class="normal"><a href="#__codelineno-0-4127">4127</a></span>
<span class="normal"><a href="#__codelineno-0-4128">4128</a></span>
<span class="normal"><a href="#__codelineno-0-4129">4129</a></span>
<span class="normal"><a href="#__codelineno-0-4130">4130</a></span>
<span class="normal"><a href="#__codelineno-0-4131">4131</a></span>
<span class="normal"><a href="#__codelineno-0-4132">4132</a></span>
<span class="normal"><a href="#__codelineno-0-4133">4133</a></span>
<span class="normal"><a href="#__codelineno-0-4134">4134</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-4110"><a id="__codelineno-0-4110" name="__codelineno-0-4110"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_global_baysor_outlines</span><span class="p">(</span>
</span><span id="__span-0-4111"><a id="__codelineno-0-4111" name="__codelineno-0-4111"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-4112"><a id="__codelineno-0-4112" name="__codelineno-0-4112"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="__span-0-4113"><a id="__codelineno-0-4113" name="__codelineno-0-4113"></a><span class="w">    </span><span class="sd">"""Load Baysor cell outlines.</span>
</span><span id="__span-0-4114"><a id="__codelineno-0-4114" name="__codelineno-0-4114"></a>
</span><span id="__span-0-4115"><a id="__codelineno-0-4115" name="__codelineno-0-4115"></a><span class="sd">    Assumes Baysor has been run.</span>
</span><span id="__span-0-4116"><a id="__codelineno-0-4116" name="__codelineno-0-4116"></a>
</span><span id="__span-0-4117"><a id="__codelineno-0-4117" name="__codelineno-0-4117"></a><span class="sd">    Returns</span>
</span><span id="__span-0-4118"><a id="__codelineno-0-4118" name="__codelineno-0-4118"></a><span class="sd">    -------</span>
</span><span id="__span-0-4119"><a id="__codelineno-0-4119" name="__codelineno-0-4119"></a><span class="sd">    baysor_outlines : Optional[dict]</span>
</span><span id="__span-0-4120"><a id="__codelineno-0-4120" name="__codelineno-0-4120"></a><span class="sd">        Baysor cell outlines.</span>
</span><span id="__span-0-4121"><a id="__codelineno-0-4121" name="__codelineno-0-4121"></a><span class="sd">    """</span>
</span><span id="__span-0-4122"><a id="__codelineno-0-4122" name="__codelineno-0-4122"></a>
</span><span id="__span-0-4123"><a id="__codelineno-0-4123" name="__codelineno-0-4123"></a>    <span class="n">current_baysor_outlines_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-4124"><a id="__codelineno-0-4124" name="__codelineno-0-4124"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span> 
</span><span id="__span-0-4125"><a id="__codelineno-0-4125" name="__codelineno-0-4125"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"baysor"</span><span class="p">)</span> 
</span><span id="__span-0-4126"><a id="__codelineno-0-4126" name="__codelineno-0-4126"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"3d_cell_rois.zip"</span><span class="p">)</span>
</span><span id="__span-0-4127"><a id="__codelineno-0-4127" name="__codelineno-0-4127"></a>    <span class="p">)</span>
</span><span id="__span-0-4128"><a id="__codelineno-0-4128" name="__codelineno-0-4128"></a>
</span><span id="__span-0-4129"><a id="__codelineno-0-4129" name="__codelineno-0-4129"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">current_baysor_outlines_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-4130"><a id="__codelineno-0-4130" name="__codelineno-0-4130"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor outlines not found."</span><span class="p">)</span>
</span><span id="__span-0-4131"><a id="__codelineno-0-4131" name="__codelineno-0-4131"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-4132"><a id="__codelineno-0-4132" name="__codelineno-0-4132"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-4133"><a id="__codelineno-0-4133" name="__codelineno-0-4133"></a>        <span class="n">baysor_rois</span> <span class="o">=</span> <span class="n">roiread</span><span class="p">(</span><span class="n">current_baysor_outlines_path</span><span class="p">)</span>
</span><span id="__span-0-4134"><a id="__codelineno-0-4134" name="__codelineno-0-4134"></a>        <span class="k">return</span> <span class="n">baysor_rois</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_cellpose_outlines"> <code class="highlight language-python"><span class="n">load_global_cellpose_outlines</span><span class="p">()</span></code> </h3> <div class="doc doc-contents"> <p>Load Cellpose max projection cell outlines.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>cellpose_outlines</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="dict">dict</span>]</code> </td> <td> <div class="doc-md-description"> <p>Cellpose cell mask outlines.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3849">3849</a></span>
<span class="normal"><a href="#__codelineno-0-3850">3850</a></span>
<span class="normal"><a href="#__codelineno-0-3851">3851</a></span>
<span class="normal"><a href="#__codelineno-0-3852">3852</a></span>
<span class="normal"><a href="#__codelineno-0-3853">3853</a></span>
<span class="normal"><a href="#__codelineno-0-3854">3854</a></span>
<span class="normal"><a href="#__codelineno-0-3855">3855</a></span>
<span class="normal"><a href="#__codelineno-0-3856">3856</a></span>
<span class="normal"><a href="#__codelineno-0-3857">3857</a></span>
<span class="normal"><a href="#__codelineno-0-3858">3858</a></span>
<span class="normal"><a href="#__codelineno-0-3859">3859</a></span>
<span class="normal"><a href="#__codelineno-0-3860">3860</a></span>
<span class="normal"><a href="#__codelineno-0-3861">3861</a></span>
<span class="normal"><a href="#__codelineno-0-3862">3862</a></span>
<span class="normal"><a href="#__codelineno-0-3863">3863</a></span>
<span class="normal"><a href="#__codelineno-0-3864">3864</a></span>
<span class="normal"><a href="#__codelineno-0-3865">3865</a></span>
<span class="normal"><a href="#__codelineno-0-3866">3866</a></span>
<span class="normal"><a href="#__codelineno-0-3867">3867</a></span>
<span class="normal"><a href="#__codelineno-0-3868">3868</a></span>
<span class="normal"><a href="#__codelineno-0-3869">3869</a></span>
<span class="normal"><a href="#__codelineno-0-3870">3870</a></span>
<span class="normal"><a href="#__codelineno-0-3871">3871</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3849"><a id="__codelineno-0-3849" name="__codelineno-0-3849"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_global_cellpose_outlines</span><span class="p">(</span>
</span><span id="__span-0-3850"><a id="__codelineno-0-3850" name="__codelineno-0-3850"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3851"><a id="__codelineno-0-3851" name="__codelineno-0-3851"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">dict</span><span class="p">]:</span>
</span><span id="__span-0-3852"><a id="__codelineno-0-3852" name="__codelineno-0-3852"></a><span class="w">    </span><span class="sd">"""Load Cellpose max projection cell outlines.</span>
</span><span id="__span-0-3853"><a id="__codelineno-0-3853" name="__codelineno-0-3853"></a>
</span><span id="__span-0-3854"><a id="__codelineno-0-3854" name="__codelineno-0-3854"></a><span class="sd">    Returns</span>
</span><span id="__span-0-3855"><a id="__codelineno-0-3855" name="__codelineno-0-3855"></a><span class="sd">    -------</span>
</span><span id="__span-0-3856"><a id="__codelineno-0-3856" name="__codelineno-0-3856"></a><span class="sd">    cellpose_outlines : Optional[dict]</span>
</span><span id="__span-0-3857"><a id="__codelineno-0-3857" name="__codelineno-0-3857"></a><span class="sd">        Cellpose cell mask outlines.</span>
</span><span id="__span-0-3858"><a id="__codelineno-0-3858" name="__codelineno-0-3858"></a><span class="sd">    """</span>
</span><span id="__span-0-3859"><a id="__codelineno-0-3859" name="__codelineno-0-3859"></a>
</span><span id="__span-0-3860"><a id="__codelineno-0-3860" name="__codelineno-0-3860"></a>    <span class="n">current_cellpose_outlines_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-3861"><a id="__codelineno-0-3861" name="__codelineno-0-3861"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose"</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cell_outlines.json"</span><span class="p">)</span>
</span><span id="__span-0-3862"><a id="__codelineno-0-3862" name="__codelineno-0-3862"></a>    <span class="p">)</span>
</span><span id="__span-0-3863"><a id="__codelineno-0-3863" name="__codelineno-0-3863"></a>
</span><span id="__span-0-3864"><a id="__codelineno-0-3864" name="__codelineno-0-3864"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">current_cellpose_outlines_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3865"><a id="__codelineno-0-3865" name="__codelineno-0-3865"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Cellpose cell mask outlines not found."</span><span class="p">)</span>
</span><span id="__span-0-3866"><a id="__codelineno-0-3866" name="__codelineno-0-3866"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3867"><a id="__codelineno-0-3867" name="__codelineno-0-3867"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3868"><a id="__codelineno-0-3868" name="__codelineno-0-3868"></a>        <span class="n">cellpose_outlines</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_microjson</span><span class="p">(</span>
</span><span id="__span-0-3869"><a id="__codelineno-0-3869" name="__codelineno-0-3869"></a>            <span class="n">current_cellpose_outlines_path</span>
</span><span id="__span-0-3870"><a id="__codelineno-0-3870" name="__codelineno-0-3870"></a>        <span class="p">)</span>
</span><span id="__span-0-3871"><a id="__codelineno-0-3871" name="__codelineno-0-3871"></a>        <span class="k">return</span> <span class="n">cellpose_outlines</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_cellpose_segmentation_image"> <code class="highlight language-python"><span class="n">load_global_cellpose_segmentation_image</span><span class="p">(</span><span class="n">return_future</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Load Cellpose max projection, downsampled segmentation image.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code> </td> <td> <div class="doc-md-description"> <p>Return future array.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>fused_image</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Cellpose max projection, downsampled segmentation image.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3873">3873</a></span>
<span class="normal"><a href="#__codelineno-0-3874">3874</a></span>
<span class="normal"><a href="#__codelineno-0-3875">3875</a></span>
<span class="normal"><a href="#__codelineno-0-3876">3876</a></span>
<span class="normal"><a href="#__codelineno-0-3877">3877</a></span>
<span class="normal"><a href="#__codelineno-0-3878">3878</a></span>
<span class="normal"><a href="#__codelineno-0-3879">3879</a></span>
<span class="normal"><a href="#__codelineno-0-3880">3880</a></span>
<span class="normal"><a href="#__codelineno-0-3881">3881</a></span>
<span class="normal"><a href="#__codelineno-0-3882">3882</a></span>
<span class="normal"><a href="#__codelineno-0-3883">3883</a></span>
<span class="normal"><a href="#__codelineno-0-3884">3884</a></span>
<span class="normal"><a href="#__codelineno-0-3885">3885</a></span>
<span class="normal"><a href="#__codelineno-0-3886">3886</a></span>
<span class="normal"><a href="#__codelineno-0-3887">3887</a></span>
<span class="normal"><a href="#__codelineno-0-3888">3888</a></span>
<span class="normal"><a href="#__codelineno-0-3889">3889</a></span>
<span class="normal"><a href="#__codelineno-0-3890">3890</a></span>
<span class="normal"><a href="#__codelineno-0-3891">3891</a></span>
<span class="normal"><a href="#__codelineno-0-3892">3892</a></span>
<span class="normal"><a href="#__codelineno-0-3893">3893</a></span>
<span class="normal"><a href="#__codelineno-0-3894">3894</a></span>
<span class="normal"><a href="#__codelineno-0-3895">3895</a></span>
<span class="normal"><a href="#__codelineno-0-3896">3896</a></span>
<span class="normal"><a href="#__codelineno-0-3897">3897</a></span>
<span class="normal"><a href="#__codelineno-0-3898">3898</a></span>
<span class="normal"><a href="#__codelineno-0-3899">3899</a></span>
<span class="normal"><a href="#__codelineno-0-3900">3900</a></span>
<span class="normal"><a href="#__codelineno-0-3901">3901</a></span>
<span class="normal"><a href="#__codelineno-0-3902">3902</a></span>
<span class="normal"><a href="#__codelineno-0-3903">3903</a></span>
<span class="normal"><a href="#__codelineno-0-3904">3904</a></span>
<span class="normal"><a href="#__codelineno-0-3905">3905</a></span>
<span class="normal"><a href="#__codelineno-0-3906">3906</a></span>
<span class="normal"><a href="#__codelineno-0-3907">3907</a></span>
<span class="normal"><a href="#__codelineno-0-3908">3908</a></span>
<span class="normal"><a href="#__codelineno-0-3909">3909</a></span>
<span class="normal"><a href="#__codelineno-0-3910">3910</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3873"><a id="__codelineno-0-3873" name="__codelineno-0-3873"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_global_cellpose_segmentation_image</span><span class="p">(</span>
</span><span id="__span-0-3874"><a id="__codelineno-0-3874" name="__codelineno-0-3874"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3875"><a id="__codelineno-0-3875" name="__codelineno-0-3875"></a>    <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-3876"><a id="__codelineno-0-3876" name="__codelineno-0-3876"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-3877"><a id="__codelineno-0-3877" name="__codelineno-0-3877"></a><span class="w">    </span><span class="sd">"""Load Cellpose max projection, downsampled segmentation image.</span>
</span><span id="__span-0-3878"><a id="__codelineno-0-3878" name="__codelineno-0-3878"></a>
</span><span id="__span-0-3879"><a id="__codelineno-0-3879" name="__codelineno-0-3879"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3880"><a id="__codelineno-0-3880" name="__codelineno-0-3880"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3881"><a id="__codelineno-0-3881" name="__codelineno-0-3881"></a><span class="sd">    return_future : Optional[bool]</span>
</span><span id="__span-0-3882"><a id="__codelineno-0-3882" name="__codelineno-0-3882"></a><span class="sd">        Return future array.</span>
</span><span id="__span-0-3883"><a id="__codelineno-0-3883" name="__codelineno-0-3883"></a>
</span><span id="__span-0-3884"><a id="__codelineno-0-3884" name="__codelineno-0-3884"></a><span class="sd">    Returns</span>
</span><span id="__span-0-3885"><a id="__codelineno-0-3885" name="__codelineno-0-3885"></a><span class="sd">    -------</span>
</span><span id="__span-0-3886"><a id="__codelineno-0-3886" name="__codelineno-0-3886"></a><span class="sd">    fused_image : Optional[ArrayLike]</span>
</span><span id="__span-0-3887"><a id="__codelineno-0-3887" name="__codelineno-0-3887"></a><span class="sd">        Cellpose max projection, downsampled segmentation image.</span>
</span><span id="__span-0-3888"><a id="__codelineno-0-3888" name="__codelineno-0-3888"></a><span class="sd">    """</span>
</span><span id="__span-0-3889"><a id="__codelineno-0-3889" name="__codelineno-0-3889"></a>
</span><span id="__span-0-3890"><a id="__codelineno-0-3890" name="__codelineno-0-3890"></a>    <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3891"><a id="__codelineno-0-3891" name="__codelineno-0-3891"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-3892"><a id="__codelineno-0-3892" name="__codelineno-0-3892"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose"</span><span class="p">)</span>
</span><span id="__span-0-3893"><a id="__codelineno-0-3893" name="__codelineno-0-3893"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose.zarr"</span><span class="p">)</span>
</span><span id="__span-0-3894"><a id="__codelineno-0-3894" name="__codelineno-0-3894"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"masks_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-3895"><a id="__codelineno-0-3895" name="__codelineno-0-3895"></a>    <span class="p">)</span>
</span><span id="__span-0-3896"><a id="__codelineno-0-3896" name="__codelineno-0-3896"></a>
</span><span id="__span-0-3897"><a id="__codelineno-0-3897" name="__codelineno-0-3897"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">current_local_zarr_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3898"><a id="__codelineno-0-3898" name="__codelineno-0-3898"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Cellpose prediction on global fused image not found."</span><span class="p">)</span>
</span><span id="__span-0-3899"><a id="__codelineno-0-3899" name="__codelineno-0-3899"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3900"><a id="__codelineno-0-3900" name="__codelineno-0-3900"></a>
</span><span id="__span-0-3901"><a id="__codelineno-0-3901" name="__codelineno-0-3901"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3902"><a id="__codelineno-0-3902" name="__codelineno-0-3902"></a>        <span class="n">fused_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3903"><a id="__codelineno-0-3903" name="__codelineno-0-3903"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3904"><a id="__codelineno-0-3904" name="__codelineno-0-3904"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-3905"><a id="__codelineno-0-3905" name="__codelineno-0-3905"></a>            <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3906"><a id="__codelineno-0-3906" name="__codelineno-0-3906"></a>        <span class="p">)</span>
</span><span id="__span-0-3907"><a id="__codelineno-0-3907" name="__codelineno-0-3907"></a>        <span class="k">return</span> <span class="n">fused_image</span>
</span><span id="__span-0-3908"><a id="__codelineno-0-3908" name="__codelineno-0-3908"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-3909"><a id="__codelineno-0-3909" name="__codelineno-0-3909"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error loading Cellpose image."</span><span class="p">)</span>
</span><span id="__span-0-3910"><a id="__codelineno-0-3910" name="__codelineno-0-3910"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_coord_xforms_um"> <code class="highlight language-python"><span class="n">load_global_coord_xforms_um</span><span class="p">(</span><span class="n">tile</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Load global registration transform for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>affine_zyx_um</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Global affine registration transform for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code>origin_zyx_um</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Global origin registration transform for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code>spacing_zyx_um</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Global spacing registration transform for one tile.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3504">3504</a></span>
<span class="normal"><a href="#__codelineno-0-3505">3505</a></span>
<span class="normal"><a href="#__codelineno-0-3506">3506</a></span>
<span class="normal"><a href="#__codelineno-0-3507">3507</a></span>
<span class="normal"><a href="#__codelineno-0-3508">3508</a></span>
<span class="normal"><a href="#__codelineno-0-3509">3509</a></span>
<span class="normal"><a href="#__codelineno-0-3510">3510</a></span>
<span class="normal"><a href="#__codelineno-0-3511">3511</a></span>
<span class="normal"><a href="#__codelineno-0-3512">3512</a></span>
<span class="normal"><a href="#__codelineno-0-3513">3513</a></span>
<span class="normal"><a href="#__codelineno-0-3514">3514</a></span>
<span class="normal"><a href="#__codelineno-0-3515">3515</a></span>
<span class="normal"><a href="#__codelineno-0-3516">3516</a></span>
<span class="normal"><a href="#__codelineno-0-3517">3517</a></span>
<span class="normal"><a href="#__codelineno-0-3518">3518</a></span>
<span class="normal"><a href="#__codelineno-0-3519">3519</a></span>
<span class="normal"><a href="#__codelineno-0-3520">3520</a></span>
<span class="normal"><a href="#__codelineno-0-3521">3521</a></span>
<span class="normal"><a href="#__codelineno-0-3522">3522</a></span>
<span class="normal"><a href="#__codelineno-0-3523">3523</a></span>
<span class="normal"><a href="#__codelineno-0-3524">3524</a></span>
<span class="normal"><a href="#__codelineno-0-3525">3525</a></span>
<span class="normal"><a href="#__codelineno-0-3526">3526</a></span>
<span class="normal"><a href="#__codelineno-0-3527">3527</a></span>
<span class="normal"><a href="#__codelineno-0-3528">3528</a></span>
<span class="normal"><a href="#__codelineno-0-3529">3529</a></span>
<span class="normal"><a href="#__codelineno-0-3530">3530</a></span>
<span class="normal"><a href="#__codelineno-0-3531">3531</a></span>
<span class="normal"><a href="#__codelineno-0-3532">3532</a></span>
<span class="normal"><a href="#__codelineno-0-3533">3533</a></span>
<span class="normal"><a href="#__codelineno-0-3534">3534</a></span>
<span class="normal"><a href="#__codelineno-0-3535">3535</a></span>
<span class="normal"><a href="#__codelineno-0-3536">3536</a></span>
<span class="normal"><a href="#__codelineno-0-3537">3537</a></span>
<span class="normal"><a href="#__codelineno-0-3538">3538</a></span>
<span class="normal"><a href="#__codelineno-0-3539">3539</a></span>
<span class="normal"><a href="#__codelineno-0-3540">3540</a></span>
<span class="normal"><a href="#__codelineno-0-3541">3541</a></span>
<span class="normal"><a href="#__codelineno-0-3542">3542</a></span>
<span class="normal"><a href="#__codelineno-0-3543">3543</a></span>
<span class="normal"><a href="#__codelineno-0-3544">3544</a></span>
<span class="normal"><a href="#__codelineno-0-3545">3545</a></span>
<span class="normal"><a href="#__codelineno-0-3546">3546</a></span>
<span class="normal"><a href="#__codelineno-0-3547">3547</a></span>
<span class="normal"><a href="#__codelineno-0-3548">3548</a></span>
<span class="normal"><a href="#__codelineno-0-3549">3549</a></span>
<span class="normal"><a href="#__codelineno-0-3550">3550</a></span>
<span class="normal"><a href="#__codelineno-0-3551">3551</a></span>
<span class="normal"><a href="#__codelineno-0-3552">3552</a></span>
<span class="normal"><a href="#__codelineno-0-3553">3553</a></span>
<span class="normal"><a href="#__codelineno-0-3554">3554</a></span>
<span class="normal"><a href="#__codelineno-0-3555">3555</a></span>
<span class="normal"><a href="#__codelineno-0-3556">3556</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3504"><a id="__codelineno-0-3504" name="__codelineno-0-3504"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_global_coord_xforms_um</span><span class="p">(</span>
</span><span id="__span-0-3505"><a id="__codelineno-0-3505" name="__codelineno-0-3505"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3506"><a id="__codelineno-0-3506" name="__codelineno-0-3506"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3507"><a id="__codelineno-0-3507" name="__codelineno-0-3507"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">]]:</span>
</span><span id="__span-0-3508"><a id="__codelineno-0-3508" name="__codelineno-0-3508"></a><span class="w">    </span><span class="sd">"""Load global registration transform for one tile.</span>
</span><span id="__span-0-3509"><a id="__codelineno-0-3509" name="__codelineno-0-3509"></a>
</span><span id="__span-0-3510"><a id="__codelineno-0-3510" name="__codelineno-0-3510"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3511"><a id="__codelineno-0-3511" name="__codelineno-0-3511"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3512"><a id="__codelineno-0-3512" name="__codelineno-0-3512"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-3513"><a id="__codelineno-0-3513" name="__codelineno-0-3513"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-3514"><a id="__codelineno-0-3514" name="__codelineno-0-3514"></a>
</span><span id="__span-0-3515"><a id="__codelineno-0-3515" name="__codelineno-0-3515"></a><span class="sd">    Returns</span>
</span><span id="__span-0-3516"><a id="__codelineno-0-3516" name="__codelineno-0-3516"></a><span class="sd">    -------</span>
</span><span id="__span-0-3517"><a id="__codelineno-0-3517" name="__codelineno-0-3517"></a><span class="sd">    affine_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-3518"><a id="__codelineno-0-3518" name="__codelineno-0-3518"></a><span class="sd">        Global affine registration transform for one tile.</span>
</span><span id="__span-0-3519"><a id="__codelineno-0-3519" name="__codelineno-0-3519"></a><span class="sd">    origin_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-3520"><a id="__codelineno-0-3520" name="__codelineno-0-3520"></a><span class="sd">        Global origin registration transform for one tile.</span>
</span><span id="__span-0-3521"><a id="__codelineno-0-3521" name="__codelineno-0-3521"></a><span class="sd">    spacing_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-3522"><a id="__codelineno-0-3522" name="__codelineno-0-3522"></a><span class="sd">        Global spacing registration transform for one tile.</span>
</span><span id="__span-0-3523"><a id="__codelineno-0-3523" name="__codelineno-0-3523"></a><span class="sd">    """</span>
</span><span id="__span-0-3524"><a id="__codelineno-0-3524" name="__codelineno-0-3524"></a>
</span><span id="__span-0-3525"><a id="__codelineno-0-3525" name="__codelineno-0-3525"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3526"><a id="__codelineno-0-3526" name="__codelineno-0-3526"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3527"><a id="__codelineno-0-3527" name="__codelineno-0-3527"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3528"><a id="__codelineno-0-3528" name="__codelineno-0-3528"></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-0-3529"><a id="__codelineno-0-3529" name="__codelineno-0-3529"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3530"><a id="__codelineno-0-3530" name="__codelineno-0-3530"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3531"><a id="__codelineno-0-3531" name="__codelineno-0-3531"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3532"><a id="__codelineno-0-3532" name="__codelineno-0-3532"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3533"><a id="__codelineno-0-3533" name="__codelineno-0-3533"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3534"><a id="__codelineno-0-3534" name="__codelineno-0-3534"></a>            <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span><span id="__span-0-3535"><a id="__codelineno-0-3535" name="__codelineno-0-3535"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3536"><a id="__codelineno-0-3536" name="__codelineno-0-3536"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3537"><a id="__codelineno-0-3537" name="__codelineno-0-3537"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3538"><a id="__codelineno-0-3538" name="__codelineno-0-3538"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3539"><a id="__codelineno-0-3539" name="__codelineno-0-3539"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3540"><a id="__codelineno-0-3540" name="__codelineno-0-3540"></a>
</span><span id="__span-0-3541"><a id="__codelineno-0-3541" name="__codelineno-0-3541"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3542"><a id="__codelineno-0-3542" name="__codelineno-0-3542"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3543"><a id="__codelineno-0-3543" name="__codelineno-0-3543"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-3544"><a id="__codelineno-0-3544" name="__codelineno-0-3544"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3545"><a id="__codelineno-0-3545" name="__codelineno-0-3545"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3546"><a id="__codelineno-0-3546" name="__codelineno-0-3546"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-3547"><a id="__codelineno-0-3547" name="__codelineno-0-3547"></a>        <span class="p">)</span>
</span><span id="__span-0-3548"><a id="__codelineno-0-3548" name="__codelineno-0-3548"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3549"><a id="__codelineno-0-3549" name="__codelineno-0-3549"></a>        <span class="n">affine_zyx_um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"affine_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-3550"><a id="__codelineno-0-3550" name="__codelineno-0-3550"></a>        <span class="n">origin_zyx_um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"origin_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-3551"><a id="__codelineno-0-3551" name="__codelineno-0-3551"></a>        <span class="n">spacing_zyx_um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"spacing_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-3552"><a id="__codelineno-0-3552" name="__codelineno-0-3552"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">affine_zyx_um</span><span class="p">,</span> <span class="n">origin_zyx_um</span><span class="p">,</span> <span class="n">spacing_zyx_um</span><span class="p">)</span>
</span><span id="__span-0-3553"><a id="__codelineno-0-3553" name="__codelineno-0-3553"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-3554"><a id="__codelineno-0-3554" name="__codelineno-0-3554"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-3555"><a id="__codelineno-0-3555" name="__codelineno-0-3555"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Global coordinate transforms not found"</span><span class="p">)</span>
</span><span id="__span-0-3556"><a id="__codelineno-0-3556" name="__codelineno-0-3556"></a>        <span class="k">return</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_fidicual_image"> <code class="highlight language-python"><span class="n">load_global_fidicual_image</span><span class="p">(</span><span class="n">return_future</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Load downsampled, fused fidicual image.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code> </td> <td> <div class="doc-md-description"> <p>Return future array.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>fused_image</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Downsampled, fused fidicual image.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code>affine_zyx_um</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Global affine registration transform for fused image.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code>origin_zyx_um</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Global origin registration transform for fused image.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code>spacing_zyx_um</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Global spacing registration transform for fused image.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3610">3610</a></span>
<span class="normal"><a href="#__codelineno-0-3611">3611</a></span>
<span class="normal"><a href="#__codelineno-0-3612">3612</a></span>
<span class="normal"><a href="#__codelineno-0-3613">3613</a></span>
<span class="normal"><a href="#__codelineno-0-3614">3614</a></span>
<span class="normal"><a href="#__codelineno-0-3615">3615</a></span>
<span class="normal"><a href="#__codelineno-0-3616">3616</a></span>
<span class="normal"><a href="#__codelineno-0-3617">3617</a></span>
<span class="normal"><a href="#__codelineno-0-3618">3618</a></span>
<span class="normal"><a href="#__codelineno-0-3619">3619</a></span>
<span class="normal"><a href="#__codelineno-0-3620">3620</a></span>
<span class="normal"><a href="#__codelineno-0-3621">3621</a></span>
<span class="normal"><a href="#__codelineno-0-3622">3622</a></span>
<span class="normal"><a href="#__codelineno-0-3623">3623</a></span>
<span class="normal"><a href="#__codelineno-0-3624">3624</a></span>
<span class="normal"><a href="#__codelineno-0-3625">3625</a></span>
<span class="normal"><a href="#__codelineno-0-3626">3626</a></span>
<span class="normal"><a href="#__codelineno-0-3627">3627</a></span>
<span class="normal"><a href="#__codelineno-0-3628">3628</a></span>
<span class="normal"><a href="#__codelineno-0-3629">3629</a></span>
<span class="normal"><a href="#__codelineno-0-3630">3630</a></span>
<span class="normal"><a href="#__codelineno-0-3631">3631</a></span>
<span class="normal"><a href="#__codelineno-0-3632">3632</a></span>
<span class="normal"><a href="#__codelineno-0-3633">3633</a></span>
<span class="normal"><a href="#__codelineno-0-3634">3634</a></span>
<span class="normal"><a href="#__codelineno-0-3635">3635</a></span>
<span class="normal"><a href="#__codelineno-0-3636">3636</a></span>
<span class="normal"><a href="#__codelineno-0-3637">3637</a></span>
<span class="normal"><a href="#__codelineno-0-3638">3638</a></span>
<span class="normal"><a href="#__codelineno-0-3639">3639</a></span>
<span class="normal"><a href="#__codelineno-0-3640">3640</a></span>
<span class="normal"><a href="#__codelineno-0-3641">3641</a></span>
<span class="normal"><a href="#__codelineno-0-3642">3642</a></span>
<span class="normal"><a href="#__codelineno-0-3643">3643</a></span>
<span class="normal"><a href="#__codelineno-0-3644">3644</a></span>
<span class="normal"><a href="#__codelineno-0-3645">3645</a></span>
<span class="normal"><a href="#__codelineno-0-3646">3646</a></span>
<span class="normal"><a href="#__codelineno-0-3647">3647</a></span>
<span class="normal"><a href="#__codelineno-0-3648">3648</a></span>
<span class="normal"><a href="#__codelineno-0-3649">3649</a></span>
<span class="normal"><a href="#__codelineno-0-3650">3650</a></span>
<span class="normal"><a href="#__codelineno-0-3651">3651</a></span>
<span class="normal"><a href="#__codelineno-0-3652">3652</a></span>
<span class="normal"><a href="#__codelineno-0-3653">3653</a></span>
<span class="normal"><a href="#__codelineno-0-3654">3654</a></span>
<span class="normal"><a href="#__codelineno-0-3655">3655</a></span>
<span class="normal"><a href="#__codelineno-0-3656">3656</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3610"><a id="__codelineno-0-3610" name="__codelineno-0-3610"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_global_fidicual_image</span><span class="p">(</span>
</span><span id="__span-0-3611"><a id="__codelineno-0-3611" name="__codelineno-0-3611"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3612"><a id="__codelineno-0-3612" name="__codelineno-0-3612"></a>    <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-3613"><a id="__codelineno-0-3613" name="__codelineno-0-3613"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">ArrayLike</span><span class="p">]]:</span>
</span><span id="__span-0-3614"><a id="__codelineno-0-3614" name="__codelineno-0-3614"></a><span class="w">    </span><span class="sd">"""Load downsampled, fused fidicual image.</span>
</span><span id="__span-0-3615"><a id="__codelineno-0-3615" name="__codelineno-0-3615"></a>
</span><span id="__span-0-3616"><a id="__codelineno-0-3616" name="__codelineno-0-3616"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3617"><a id="__codelineno-0-3617" name="__codelineno-0-3617"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3618"><a id="__codelineno-0-3618" name="__codelineno-0-3618"></a><span class="sd">    return_future : Optional[bool]</span>
</span><span id="__span-0-3619"><a id="__codelineno-0-3619" name="__codelineno-0-3619"></a><span class="sd">        Return future array.</span>
</span><span id="__span-0-3620"><a id="__codelineno-0-3620" name="__codelineno-0-3620"></a>
</span><span id="__span-0-3621"><a id="__codelineno-0-3621" name="__codelineno-0-3621"></a><span class="sd">    Returns</span>
</span><span id="__span-0-3622"><a id="__codelineno-0-3622" name="__codelineno-0-3622"></a><span class="sd">    -------</span>
</span><span id="__span-0-3623"><a id="__codelineno-0-3623" name="__codelineno-0-3623"></a><span class="sd">    fused_image : Optional[ArrayLike]</span>
</span><span id="__span-0-3624"><a id="__codelineno-0-3624" name="__codelineno-0-3624"></a><span class="sd">        Downsampled, fused fidicual image.</span>
</span><span id="__span-0-3625"><a id="__codelineno-0-3625" name="__codelineno-0-3625"></a><span class="sd">    affine_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-3626"><a id="__codelineno-0-3626" name="__codelineno-0-3626"></a><span class="sd">        Global affine registration transform for fused image.</span>
</span><span id="__span-0-3627"><a id="__codelineno-0-3627" name="__codelineno-0-3627"></a><span class="sd">    origin_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-3628"><a id="__codelineno-0-3628" name="__codelineno-0-3628"></a><span class="sd">        Global origin registration transform for fused image.</span>
</span><span id="__span-0-3629"><a id="__codelineno-0-3629" name="__codelineno-0-3629"></a><span class="sd">    spacing_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-3630"><a id="__codelineno-0-3630" name="__codelineno-0-3630"></a><span class="sd">        Global spacing registration transform for fused image.</span>
</span><span id="__span-0-3631"><a id="__codelineno-0-3631" name="__codelineno-0-3631"></a><span class="sd">    """</span>
</span><span id="__span-0-3632"><a id="__codelineno-0-3632" name="__codelineno-0-3632"></a>
</span><span id="__span-0-3633"><a id="__codelineno-0-3633" name="__codelineno-0-3633"></a>    <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3634"><a id="__codelineno-0-3634" name="__codelineno-0-3634"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused.zarr"</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-3635"><a id="__codelineno-0-3635" name="__codelineno-0-3635"></a>    <span class="p">)</span>
</span><span id="__span-0-3636"><a id="__codelineno-0-3636" name="__codelineno-0-3636"></a>
</span><span id="__span-0-3637"><a id="__codelineno-0-3637" name="__codelineno-0-3637"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3638"><a id="__codelineno-0-3638" name="__codelineno-0-3638"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Globally registered, fused image not found."</span><span class="p">)</span>
</span><span id="__span-0-3639"><a id="__codelineno-0-3639" name="__codelineno-0-3639"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3640"><a id="__codelineno-0-3640" name="__codelineno-0-3640"></a>
</span><span id="__span-0-3641"><a id="__codelineno-0-3641" name="__codelineno-0-3641"></a>    <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">current_local_zarr_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">))</span>
</span><span id="__span-0-3642"><a id="__codelineno-0-3642" name="__codelineno-0-3642"></a>
</span><span id="__span-0-3643"><a id="__codelineno-0-3643" name="__codelineno-0-3643"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3644"><a id="__codelineno-0-3644" name="__codelineno-0-3644"></a>        <span class="n">fused_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3645"><a id="__codelineno-0-3645" name="__codelineno-0-3645"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3646"><a id="__codelineno-0-3646" name="__codelineno-0-3646"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-3647"><a id="__codelineno-0-3647" name="__codelineno-0-3647"></a>            <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3648"><a id="__codelineno-0-3648" name="__codelineno-0-3648"></a>        <span class="p">)</span>
</span><span id="__span-0-3649"><a id="__codelineno-0-3649" name="__codelineno-0-3649"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3650"><a id="__codelineno-0-3650" name="__codelineno-0-3650"></a>        <span class="n">affine_zyx_um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"affine_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-3651"><a id="__codelineno-0-3651" name="__codelineno-0-3651"></a>        <span class="n">origin_zyx_um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"origin_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-3652"><a id="__codelineno-0-3652" name="__codelineno-0-3652"></a>        <span class="n">spacing_zyx_um</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"spacing_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-3653"><a id="__codelineno-0-3653" name="__codelineno-0-3653"></a>        <span class="k">return</span> <span class="n">fused_image</span><span class="p">,</span> <span class="n">affine_zyx_um</span><span class="p">,</span> <span class="n">origin_zyx_um</span><span class="p">,</span> <span class="n">spacing_zyx_um</span>
</span><span id="__span-0-3654"><a id="__codelineno-0-3654" name="__codelineno-0-3654"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-3655"><a id="__codelineno-0-3655" name="__codelineno-0-3655"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error loading globally registered, fused image."</span><span class="p">)</span>
</span><span id="__span-0-3656"><a id="__codelineno-0-3656" name="__codelineno-0-3656"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_global_filtered_decoded_spots"> <code class="highlight language-python"><span class="n">load_global_filtered_decoded_spots</span><span class="p">()</span></code> </h3> <div class="doc doc-contents"> <p>Load all decoded and filtered spots.</p> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>all_tiles_filtered</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class="doc-md-description"> <p>All decoded and filtered spots.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3797">3797</a></span>
<span class="normal"><a href="#__codelineno-0-3798">3798</a></span>
<span class="normal"><a href="#__codelineno-0-3799">3799</a></span>
<span class="normal"><a href="#__codelineno-0-3800">3800</a></span>
<span class="normal"><a href="#__codelineno-0-3801">3801</a></span>
<span class="normal"><a href="#__codelineno-0-3802">3802</a></span>
<span class="normal"><a href="#__codelineno-0-3803">3803</a></span>
<span class="normal"><a href="#__codelineno-0-3804">3804</a></span>
<span class="normal"><a href="#__codelineno-0-3805">3805</a></span>
<span class="normal"><a href="#__codelineno-0-3806">3806</a></span>
<span class="normal"><a href="#__codelineno-0-3807">3807</a></span>
<span class="normal"><a href="#__codelineno-0-3808">3808</a></span>
<span class="normal"><a href="#__codelineno-0-3809">3809</a></span>
<span class="normal"><a href="#__codelineno-0-3810">3810</a></span>
<span class="normal"><a href="#__codelineno-0-3811">3811</a></span>
<span class="normal"><a href="#__codelineno-0-3812">3812</a></span>
<span class="normal"><a href="#__codelineno-0-3813">3813</a></span>
<span class="normal"><a href="#__codelineno-0-3814">3814</a></span>
<span class="normal"><a href="#__codelineno-0-3815">3815</a></span>
<span class="normal"><a href="#__codelineno-0-3816">3816</a></span>
<span class="normal"><a href="#__codelineno-0-3817">3817</a></span>
<span class="normal"><a href="#__codelineno-0-3818">3818</a></span>
<span class="normal"><a href="#__codelineno-0-3819">3819</a></span>
<span class="normal"><a href="#__codelineno-0-3820">3820</a></span>
<span class="normal"><a href="#__codelineno-0-3821">3821</a></span>
<span class="normal"><a href="#__codelineno-0-3822">3822</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3797"><a id="__codelineno-0-3797" name="__codelineno-0-3797"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_global_filtered_decoded_spots</span><span class="p">(</span>
</span><span id="__span-0-3798"><a id="__codelineno-0-3798" name="__codelineno-0-3798"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3799"><a id="__codelineno-0-3799" name="__codelineno-0-3799"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="__span-0-3800"><a id="__codelineno-0-3800" name="__codelineno-0-3800"></a><span class="w">    </span><span class="sd">"""Load all decoded and filtered spots.</span>
</span><span id="__span-0-3801"><a id="__codelineno-0-3801" name="__codelineno-0-3801"></a>
</span><span id="__span-0-3802"><a id="__codelineno-0-3802" name="__codelineno-0-3802"></a><span class="sd">    Returns</span>
</span><span id="__span-0-3803"><a id="__codelineno-0-3803" name="__codelineno-0-3803"></a><span class="sd">    -------</span>
</span><span id="__span-0-3804"><a id="__codelineno-0-3804" name="__codelineno-0-3804"></a><span class="sd">    all_tiles_filtered : Optional[pd.DataFrame]</span>
</span><span id="__span-0-3805"><a id="__codelineno-0-3805" name="__codelineno-0-3805"></a><span class="sd">        All decoded and filtered spots.</span>
</span><span id="__span-0-3806"><a id="__codelineno-0-3806" name="__codelineno-0-3806"></a><span class="sd">    """</span>
</span><span id="__span-0-3807"><a id="__codelineno-0-3807" name="__codelineno-0-3807"></a>
</span><span id="__span-0-3808"><a id="__codelineno-0-3808" name="__codelineno-0-3808"></a>    <span class="n">current_global_filtered_decoded_dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-3809"><a id="__codelineno-0-3809" name="__codelineno-0-3809"></a>        <span class="s2">"all_tiles_filtered_decoded_features"</span>
</span><span id="__span-0-3810"><a id="__codelineno-0-3810" name="__codelineno-0-3810"></a>    <span class="p">)</span>
</span><span id="__span-0-3811"><a id="__codelineno-0-3811" name="__codelineno-0-3811"></a>    <span class="n">current_global_filtered_decoded_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-3812"><a id="__codelineno-0-3812" name="__codelineno-0-3812"></a>        <span class="n">current_global_filtered_decoded_dir_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"decoded_features.parquet"</span><span class="p">)</span>
</span><span id="__span-0-3813"><a id="__codelineno-0-3813" name="__codelineno-0-3813"></a>    <span class="p">)</span>
</span><span id="__span-0-3814"><a id="__codelineno-0-3814" name="__codelineno-0-3814"></a>
</span><span id="__span-0-3815"><a id="__codelineno-0-3815" name="__codelineno-0-3815"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">current_global_filtered_decoded_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3816"><a id="__codelineno-0-3816" name="__codelineno-0-3816"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Global, filtered, decoded spots not found."</span><span class="p">)</span>
</span><span id="__span-0-3817"><a id="__codelineno-0-3817" name="__codelineno-0-3817"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3818"><a id="__codelineno-0-3818" name="__codelineno-0-3818"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3819"><a id="__codelineno-0-3819" name="__codelineno-0-3819"></a>        <span class="n">all_tiles_filtered</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_parquet</span><span class="p">(</span>
</span><span id="__span-0-3820"><a id="__codelineno-0-3820" name="__codelineno-0-3820"></a>            <span class="n">current_global_filtered_decoded_path</span>
</span><span id="__span-0-3821"><a id="__codelineno-0-3821" name="__codelineno-0-3821"></a>        <span class="p">)</span>
</span><span id="__span-0-3822"><a id="__codelineno-0-3822" name="__codelineno-0-3822"></a>        <span class="k">return</span> <span class="n">all_tiles_filtered</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_bit_linker"> <code class="highlight language-python"><span class="n">load_local_bit_linker</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Load readout bits linked to fidicual round for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>bit_linker</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Sequence">Sequence</span>[<span title="int">int</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Readout bits linked to fidicual round for one tile.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1808">1808</a></span>
<span class="normal"><a href="#__codelineno-0-1809">1809</a></span>
<span class="normal"><a href="#__codelineno-0-1810">1810</a></span>
<span class="normal"><a href="#__codelineno-0-1811">1811</a></span>
<span class="normal"><a href="#__codelineno-0-1812">1812</a></span>
<span class="normal"><a href="#__codelineno-0-1813">1813</a></span>
<span class="normal"><a href="#__codelineno-0-1814">1814</a></span>
<span class="normal"><a href="#__codelineno-0-1815">1815</a></span>
<span class="normal"><a href="#__codelineno-0-1816">1816</a></span>
<span class="normal"><a href="#__codelineno-0-1817">1817</a></span>
<span class="normal"><a href="#__codelineno-0-1818">1818</a></span>
<span class="normal"><a href="#__codelineno-0-1819">1819</a></span>
<span class="normal"><a href="#__codelineno-0-1820">1820</a></span>
<span class="normal"><a href="#__codelineno-0-1821">1821</a></span>
<span class="normal"><a href="#__codelineno-0-1822">1822</a></span>
<span class="normal"><a href="#__codelineno-0-1823">1823</a></span>
<span class="normal"><a href="#__codelineno-0-1824">1824</a></span>
<span class="normal"><a href="#__codelineno-0-1825">1825</a></span>
<span class="normal"><a href="#__codelineno-0-1826">1826</a></span>
<span class="normal"><a href="#__codelineno-0-1827">1827</a></span>
<span class="normal"><a href="#__codelineno-0-1828">1828</a></span>
<span class="normal"><a href="#__codelineno-0-1829">1829</a></span>
<span class="normal"><a href="#__codelineno-0-1830">1830</a></span>
<span class="normal"><a href="#__codelineno-0-1831">1831</a></span>
<span class="normal"><a href="#__codelineno-0-1832">1832</a></span>
<span class="normal"><a href="#__codelineno-0-1833">1833</a></span>
<span class="normal"><a href="#__codelineno-0-1834">1834</a></span>
<span class="normal"><a href="#__codelineno-0-1835">1835</a></span>
<span class="normal"><a href="#__codelineno-0-1836">1836</a></span>
<span class="normal"><a href="#__codelineno-0-1837">1837</a></span>
<span class="normal"><a href="#__codelineno-0-1838">1838</a></span>
<span class="normal"><a href="#__codelineno-0-1839">1839</a></span>
<span class="normal"><a href="#__codelineno-0-1840">1840</a></span>
<span class="normal"><a href="#__codelineno-0-1841">1841</a></span>
<span class="normal"><a href="#__codelineno-0-1842">1842</a></span>
<span class="normal"><a href="#__codelineno-0-1843">1843</a></span>
<span class="normal"><a href="#__codelineno-0-1844">1844</a></span>
<span class="normal"><a href="#__codelineno-0-1845">1845</a></span>
<span class="normal"><a href="#__codelineno-0-1846">1846</a></span>
<span class="normal"><a href="#__codelineno-0-1847">1847</a></span>
<span class="normal"><a href="#__codelineno-0-1848">1848</a></span>
<span class="normal"><a href="#__codelineno-0-1849">1849</a></span>
<span class="normal"><a href="#__codelineno-0-1850">1850</a></span>
<span class="normal"><a href="#__codelineno-0-1851">1851</a></span>
<span class="normal"><a href="#__codelineno-0-1852">1852</a></span>
<span class="normal"><a href="#__codelineno-0-1853">1853</a></span>
<span class="normal"><a href="#__codelineno-0-1854">1854</a></span>
<span class="normal"><a href="#__codelineno-0-1855">1855</a></span>
<span class="normal"><a href="#__codelineno-0-1856">1856</a></span>
<span class="normal"><a href="#__codelineno-0-1857">1857</a></span>
<span class="normal"><a href="#__codelineno-0-1858">1858</a></span>
<span class="normal"><a href="#__codelineno-0-1859">1859</a></span>
<span class="normal"><a href="#__codelineno-0-1860">1860</a></span>
<span class="normal"><a href="#__codelineno-0-1861">1861</a></span>
<span class="normal"><a href="#__codelineno-0-1862">1862</a></span>
<span class="normal"><a href="#__codelineno-0-1863">1863</a></span>
<span class="normal"><a href="#__codelineno-0-1864">1864</a></span>
<span class="normal"><a href="#__codelineno-0-1865">1865</a></span>
<span class="normal"><a href="#__codelineno-0-1866">1866</a></span>
<span class="normal"><a href="#__codelineno-0-1867">1867</a></span>
<span class="normal"><a href="#__codelineno-0-1868">1868</a></span>
<span class="normal"><a href="#__codelineno-0-1869">1869</a></span>
<span class="normal"><a href="#__codelineno-0-1870">1870</a></span>
<span class="normal"><a href="#__codelineno-0-1871">1871</a></span>
<span class="normal"><a href="#__codelineno-0-1872">1872</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1808"><a id="__codelineno-0-1808" name="__codelineno-0-1808"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_local_bit_linker</span><span class="p">(</span>
</span><span id="__span-0-1809"><a id="__codelineno-0-1809" name="__codelineno-0-1809"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1810"><a id="__codelineno-0-1810" name="__codelineno-0-1810"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1811"><a id="__codelineno-0-1811" name="__codelineno-0-1811"></a>    <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1812"><a id="__codelineno-0-1812" name="__codelineno-0-1812"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
</span><span id="__span-0-1813"><a id="__codelineno-0-1813" name="__codelineno-0-1813"></a><span class="w">    </span><span class="sd">"""Load readout bits linked to fidicual round for one tile.</span>
</span><span id="__span-0-1814"><a id="__codelineno-0-1814" name="__codelineno-0-1814"></a>
</span><span id="__span-0-1815"><a id="__codelineno-0-1815" name="__codelineno-0-1815"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-1816"><a id="__codelineno-0-1816" name="__codelineno-0-1816"></a><span class="sd">    ----------</span>
</span><span id="__span-0-1817"><a id="__codelineno-0-1817" name="__codelineno-0-1817"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-1818"><a id="__codelineno-0-1818" name="__codelineno-0-1818"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-1819"><a id="__codelineno-0-1819" name="__codelineno-0-1819"></a><span class="sd">    round : Union[int, str]</span>
</span><span id="__span-0-1820"><a id="__codelineno-0-1820" name="__codelineno-0-1820"></a><span class="sd">        Round index or round id.</span>
</span><span id="__span-0-1821"><a id="__codelineno-0-1821" name="__codelineno-0-1821"></a>
</span><span id="__span-0-1822"><a id="__codelineno-0-1822" name="__codelineno-0-1822"></a><span class="sd">    Returns</span>
</span><span id="__span-0-1823"><a id="__codelineno-0-1823" name="__codelineno-0-1823"></a><span class="sd">    -------</span>
</span><span id="__span-0-1824"><a id="__codelineno-0-1824" name="__codelineno-0-1824"></a><span class="sd">    bit_linker : Optional[Sequence[int]]</span>
</span><span id="__span-0-1825"><a id="__codelineno-0-1825" name="__codelineno-0-1825"></a><span class="sd">        Readout bits linked to fidicual round for one tile.</span>
</span><span id="__span-0-1826"><a id="__codelineno-0-1826" name="__codelineno-0-1826"></a><span class="sd">    """</span>
</span><span id="__span-0-1827"><a id="__codelineno-0-1827" name="__codelineno-0-1827"></a>
</span><span id="__span-0-1828"><a id="__codelineno-0-1828" name="__codelineno-0-1828"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1829"><a id="__codelineno-0-1829" name="__codelineno-0-1829"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-1830"><a id="__codelineno-0-1830" name="__codelineno-0-1830"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-1831"><a id="__codelineno-0-1831" name="__codelineno-0-1831"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1832"><a id="__codelineno-0-1832" name="__codelineno-0-1832"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1833"><a id="__codelineno-0-1833" name="__codelineno-0-1833"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-1834"><a id="__codelineno-0-1834" name="__codelineno-0-1834"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1835"><a id="__codelineno-0-1835" name="__codelineno-0-1835"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-1836"><a id="__codelineno-0-1836" name="__codelineno-0-1836"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id."</span><span class="p">)</span>
</span><span id="__span-0-1837"><a id="__codelineno-0-1837" name="__codelineno-0-1837"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1838"><a id="__codelineno-0-1838" name="__codelineno-0-1838"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1839"><a id="__codelineno-0-1839" name="__codelineno-0-1839"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-1840"><a id="__codelineno-0-1840" name="__codelineno-0-1840"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1841"><a id="__codelineno-0-1841" name="__codelineno-0-1841"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1842"><a id="__codelineno-0-1842" name="__codelineno-0-1842"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1843"><a id="__codelineno-0-1843" name="__codelineno-0-1843"></a>
</span><span id="__span-0-1844"><a id="__codelineno-0-1844" name="__codelineno-0-1844"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1845"><a id="__codelineno-0-1845" name="__codelineno-0-1845"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1846"><a id="__codelineno-0-1846" name="__codelineno-0-1846"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-1847"><a id="__codelineno-0-1847" name="__codelineno-0-1847"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1848"><a id="__codelineno-0-1848" name="__codelineno-0-1848"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1849"><a id="__codelineno-0-1849" name="__codelineno-0-1849"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-1850"><a id="__codelineno-0-1850" name="__codelineno-0-1850"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1851"><a id="__codelineno-0-1851" name="__codelineno-0-1851"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-1852"><a id="__codelineno-0-1852" name="__codelineno-0-1852"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id."</span><span class="p">)</span>
</span><span id="__span-0-1853"><a id="__codelineno-0-1853" name="__codelineno-0-1853"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1854"><a id="__codelineno-0-1854" name="__codelineno-0-1854"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1855"><a id="__codelineno-0-1855" name="__codelineno-0-1855"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-1856"><a id="__codelineno-0-1856" name="__codelineno-0-1856"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1857"><a id="__codelineno-0-1857" name="__codelineno-0-1857"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1858"><a id="__codelineno-0-1858" name="__codelineno-0-1858"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1859"><a id="__codelineno-0-1859" name="__codelineno-0-1859"></a>
</span><span id="__span-0-1860"><a id="__codelineno-0-1860" name="__codelineno-0-1860"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1861"><a id="__codelineno-0-1861" name="__codelineno-0-1861"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1862"><a id="__codelineno-0-1862" name="__codelineno-0-1862"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1863"><a id="__codelineno-0-1863" name="__codelineno-0-1863"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1864"><a id="__codelineno-0-1864" name="__codelineno-0-1864"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1865"><a id="__codelineno-0-1865" name="__codelineno-0-1865"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1866"><a id="__codelineno-0-1866" name="__codelineno-0-1866"></a>        <span class="p">)</span>
</span><span id="__span-0-1867"><a id="__codelineno-0-1867" name="__codelineno-0-1867"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1868"><a id="__codelineno-0-1868" name="__codelineno-0-1868"></a>        <span class="k">return</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">"bits"</span><span class="p">][</span><span class="mi">1</span><span class="p">:]</span>
</span><span id="__span-0-1869"><a id="__codelineno-0-1869" name="__codelineno-0-1869"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1870"><a id="__codelineno-0-1870" name="__codelineno-0-1870"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-1871"><a id="__codelineno-0-1871" name="__codelineno-0-1871"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Bit linker attribute not found."</span><span class="p">)</span>
</span><span id="__span-0-1872"><a id="__codelineno-0-1872" name="__codelineno-0-1872"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_corrected_image"> <code class="highlight language-python"><span class="n">load_local_corrected_image</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Load gain and offset corrected image for fiducial OR readout bit for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class="doc-section-item"> <td> <code>bit</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Bit index or bit id.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code> </td> <td> <div class="doc-md-description"> <p>Return future array.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>corrected_image</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Gain and offset corrected image for fiducial OR readout bit for one tile.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2405">2405</a></span>
<span class="normal"><a href="#__codelineno-0-2406">2406</a></span>
<span class="normal"><a href="#__codelineno-0-2407">2407</a></span>
<span class="normal"><a href="#__codelineno-0-2408">2408</a></span>
<span class="normal"><a href="#__codelineno-0-2409">2409</a></span>
<span class="normal"><a href="#__codelineno-0-2410">2410</a></span>
<span class="normal"><a href="#__codelineno-0-2411">2411</a></span>
<span class="normal"><a href="#__codelineno-0-2412">2412</a></span>
<span class="normal"><a href="#__codelineno-0-2413">2413</a></span>
<span class="normal"><a href="#__codelineno-0-2414">2414</a></span>
<span class="normal"><a href="#__codelineno-0-2415">2415</a></span>
<span class="normal"><a href="#__codelineno-0-2416">2416</a></span>
<span class="normal"><a href="#__codelineno-0-2417">2417</a></span>
<span class="normal"><a href="#__codelineno-0-2418">2418</a></span>
<span class="normal"><a href="#__codelineno-0-2419">2419</a></span>
<span class="normal"><a href="#__codelineno-0-2420">2420</a></span>
<span class="normal"><a href="#__codelineno-0-2421">2421</a></span>
<span class="normal"><a href="#__codelineno-0-2422">2422</a></span>
<span class="normal"><a href="#__codelineno-0-2423">2423</a></span>
<span class="normal"><a href="#__codelineno-0-2424">2424</a></span>
<span class="normal"><a href="#__codelineno-0-2425">2425</a></span>
<span class="normal"><a href="#__codelineno-0-2426">2426</a></span>
<span class="normal"><a href="#__codelineno-0-2427">2427</a></span>
<span class="normal"><a href="#__codelineno-0-2428">2428</a></span>
<span class="normal"><a href="#__codelineno-0-2429">2429</a></span>
<span class="normal"><a href="#__codelineno-0-2430">2430</a></span>
<span class="normal"><a href="#__codelineno-0-2431">2431</a></span>
<span class="normal"><a href="#__codelineno-0-2432">2432</a></span>
<span class="normal"><a href="#__codelineno-0-2433">2433</a></span>
<span class="normal"><a href="#__codelineno-0-2434">2434</a></span>
<span class="normal"><a href="#__codelineno-0-2435">2435</a></span>
<span class="normal"><a href="#__codelineno-0-2436">2436</a></span>
<span class="normal"><a href="#__codelineno-0-2437">2437</a></span>
<span class="normal"><a href="#__codelineno-0-2438">2438</a></span>
<span class="normal"><a href="#__codelineno-0-2439">2439</a></span>
<span class="normal"><a href="#__codelineno-0-2440">2440</a></span>
<span class="normal"><a href="#__codelineno-0-2441">2441</a></span>
<span class="normal"><a href="#__codelineno-0-2442">2442</a></span>
<span class="normal"><a href="#__codelineno-0-2443">2443</a></span>
<span class="normal"><a href="#__codelineno-0-2444">2444</a></span>
<span class="normal"><a href="#__codelineno-0-2445">2445</a></span>
<span class="normal"><a href="#__codelineno-0-2446">2446</a></span>
<span class="normal"><a href="#__codelineno-0-2447">2447</a></span>
<span class="normal"><a href="#__codelineno-0-2448">2448</a></span>
<span class="normal"><a href="#__codelineno-0-2449">2449</a></span>
<span class="normal"><a href="#__codelineno-0-2450">2450</a></span>
<span class="normal"><a href="#__codelineno-0-2451">2451</a></span>
<span class="normal"><a href="#__codelineno-0-2452">2452</a></span>
<span class="normal"><a href="#__codelineno-0-2453">2453</a></span>
<span class="normal"><a href="#__codelineno-0-2454">2454</a></span>
<span class="normal"><a href="#__codelineno-0-2455">2455</a></span>
<span class="normal"><a href="#__codelineno-0-2456">2456</a></span>
<span class="normal"><a href="#__codelineno-0-2457">2457</a></span>
<span class="normal"><a href="#__codelineno-0-2458">2458</a></span>
<span class="normal"><a href="#__codelineno-0-2459">2459</a></span>
<span class="normal"><a href="#__codelineno-0-2460">2460</a></span>
<span class="normal"><a href="#__codelineno-0-2461">2461</a></span>
<span class="normal"><a href="#__codelineno-0-2462">2462</a></span>
<span class="normal"><a href="#__codelineno-0-2463">2463</a></span>
<span class="normal"><a href="#__codelineno-0-2464">2464</a></span>
<span class="normal"><a href="#__codelineno-0-2465">2465</a></span>
<span class="normal"><a href="#__codelineno-0-2466">2466</a></span>
<span class="normal"><a href="#__codelineno-0-2467">2467</a></span>
<span class="normal"><a href="#__codelineno-0-2468">2468</a></span>
<span class="normal"><a href="#__codelineno-0-2469">2469</a></span>
<span class="normal"><a href="#__codelineno-0-2470">2470</a></span>
<span class="normal"><a href="#__codelineno-0-2471">2471</a></span>
<span class="normal"><a href="#__codelineno-0-2472">2472</a></span>
<span class="normal"><a href="#__codelineno-0-2473">2473</a></span>
<span class="normal"><a href="#__codelineno-0-2474">2474</a></span>
<span class="normal"><a href="#__codelineno-0-2475">2475</a></span>
<span class="normal"><a href="#__codelineno-0-2476">2476</a></span>
<span class="normal"><a href="#__codelineno-0-2477">2477</a></span>
<span class="normal"><a href="#__codelineno-0-2478">2478</a></span>
<span class="normal"><a href="#__codelineno-0-2479">2479</a></span>
<span class="normal"><a href="#__codelineno-0-2480">2480</a></span>
<span class="normal"><a href="#__codelineno-0-2481">2481</a></span>
<span class="normal"><a href="#__codelineno-0-2482">2482</a></span>
<span class="normal"><a href="#__codelineno-0-2483">2483</a></span>
<span class="normal"><a href="#__codelineno-0-2484">2484</a></span>
<span class="normal"><a href="#__codelineno-0-2485">2485</a></span>
<span class="normal"><a href="#__codelineno-0-2486">2486</a></span>
<span class="normal"><a href="#__codelineno-0-2487">2487</a></span>
<span class="normal"><a href="#__codelineno-0-2488">2488</a></span>
<span class="normal"><a href="#__codelineno-0-2489">2489</a></span>
<span class="normal"><a href="#__codelineno-0-2490">2490</a></span>
<span class="normal"><a href="#__codelineno-0-2491">2491</a></span>
<span class="normal"><a href="#__codelineno-0-2492">2492</a></span>
<span class="normal"><a href="#__codelineno-0-2493">2493</a></span>
<span class="normal"><a href="#__codelineno-0-2494">2494</a></span>
<span class="normal"><a href="#__codelineno-0-2495">2495</a></span>
<span class="normal"><a href="#__codelineno-0-2496">2496</a></span>
<span class="normal"><a href="#__codelineno-0-2497">2497</a></span>
<span class="normal"><a href="#__codelineno-0-2498">2498</a></span>
<span class="normal"><a href="#__codelineno-0-2499">2499</a></span>
<span class="normal"><a href="#__codelineno-0-2500">2500</a></span>
<span class="normal"><a href="#__codelineno-0-2501">2501</a></span>
<span class="normal"><a href="#__codelineno-0-2502">2502</a></span>
<span class="normal"><a href="#__codelineno-0-2503">2503</a></span>
<span class="normal"><a href="#__codelineno-0-2504">2504</a></span>
<span class="normal"><a href="#__codelineno-0-2505">2505</a></span>
<span class="normal"><a href="#__codelineno-0-2506">2506</a></span>
<span class="normal"><a href="#__codelineno-0-2507">2507</a></span>
<span class="normal"><a href="#__codelineno-0-2508">2508</a></span>
<span class="normal"><a href="#__codelineno-0-2509">2509</a></span>
<span class="normal"><a href="#__codelineno-0-2510">2510</a></span>
<span class="normal"><a href="#__codelineno-0-2511">2511</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2405"><a id="__codelineno-0-2405" name="__codelineno-0-2405"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_local_corrected_image</span><span class="p">(</span>
</span><span id="__span-0-2406"><a id="__codelineno-0-2406" name="__codelineno-0-2406"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2407"><a id="__codelineno-0-2407" name="__codelineno-0-2407"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2408"><a id="__codelineno-0-2408" name="__codelineno-0-2408"></a>    <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2409"><a id="__codelineno-0-2409" name="__codelineno-0-2409"></a>    <span class="n">bit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2410"><a id="__codelineno-0-2410" name="__codelineno-0-2410"></a>    <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2411"><a id="__codelineno-0-2411" name="__codelineno-0-2411"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-2412"><a id="__codelineno-0-2412" name="__codelineno-0-2412"></a><span class="w">    </span><span class="sd">"""Load gain and offset corrected image for fiducial OR readout bit for one tile.</span>
</span><span id="__span-0-2413"><a id="__codelineno-0-2413" name="__codelineno-0-2413"></a>
</span><span id="__span-0-2414"><a id="__codelineno-0-2414" name="__codelineno-0-2414"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-2415"><a id="__codelineno-0-2415" name="__codelineno-0-2415"></a><span class="sd">    ----------</span>
</span><span id="__span-0-2416"><a id="__codelineno-0-2416" name="__codelineno-0-2416"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-2417"><a id="__codelineno-0-2417" name="__codelineno-0-2417"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-2418"><a id="__codelineno-0-2418" name="__codelineno-0-2418"></a><span class="sd">    round : Optional[Union[int, str]]</span>
</span><span id="__span-0-2419"><a id="__codelineno-0-2419" name="__codelineno-0-2419"></a><span class="sd">        Round index or round id.</span>
</span><span id="__span-0-2420"><a id="__codelineno-0-2420" name="__codelineno-0-2420"></a><span class="sd">    bit : Optional[Union[int, str]]</span>
</span><span id="__span-0-2421"><a id="__codelineno-0-2421" name="__codelineno-0-2421"></a><span class="sd">        Bit index or bit id.</span>
</span><span id="__span-0-2422"><a id="__codelineno-0-2422" name="__codelineno-0-2422"></a><span class="sd">    return_future : Optional[bool]</span>
</span><span id="__span-0-2423"><a id="__codelineno-0-2423" name="__codelineno-0-2423"></a><span class="sd">        Return future array.</span>
</span><span id="__span-0-2424"><a id="__codelineno-0-2424" name="__codelineno-0-2424"></a>
</span><span id="__span-0-2425"><a id="__codelineno-0-2425" name="__codelineno-0-2425"></a><span class="sd">    Returns</span>
</span><span id="__span-0-2426"><a id="__codelineno-0-2426" name="__codelineno-0-2426"></a><span class="sd">    -------</span>
</span><span id="__span-0-2427"><a id="__codelineno-0-2427" name="__codelineno-0-2427"></a><span class="sd">    corrected_image : Optional[ArrayLike]</span>
</span><span id="__span-0-2428"><a id="__codelineno-0-2428" name="__codelineno-0-2428"></a><span class="sd">        Gain and offset corrected image for fiducial OR readout bit for one tile.</span>
</span><span id="__span-0-2429"><a id="__codelineno-0-2429" name="__codelineno-0-2429"></a><span class="sd">    """</span>
</span><span id="__span-0-2430"><a id="__codelineno-0-2430" name="__codelineno-0-2430"></a>
</span><span id="__span-0-2431"><a id="__codelineno-0-2431" name="__codelineno-0-2431"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2432"><a id="__codelineno-0-2432" name="__codelineno-0-2432"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Provide either 'round' or 'bit', but not both"</span><span class="p">)</span>
</span><span id="__span-0-2433"><a id="__codelineno-0-2433" name="__codelineno-0-2433"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2434"><a id="__codelineno-0-2434" name="__codelineno-0-2434"></a>
</span><span id="__span-0-2435"><a id="__codelineno-0-2435" name="__codelineno-0-2435"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2436"><a id="__codelineno-0-2436" name="__codelineno-0-2436"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2437"><a id="__codelineno-0-2437" name="__codelineno-0-2437"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2438"><a id="__codelineno-0-2438" name="__codelineno-0-2438"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2439"><a id="__codelineno-0-2439" name="__codelineno-0-2439"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2440"><a id="__codelineno-0-2440" name="__codelineno-0-2440"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2441"><a id="__codelineno-0-2441" name="__codelineno-0-2441"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2442"><a id="__codelineno-0-2442" name="__codelineno-0-2442"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2443"><a id="__codelineno-0-2443" name="__codelineno-0-2443"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2444"><a id="__codelineno-0-2444" name="__codelineno-0-2444"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2445"><a id="__codelineno-0-2445" name="__codelineno-0-2445"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2446"><a id="__codelineno-0-2446" name="__codelineno-0-2446"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2447"><a id="__codelineno-0-2447" name="__codelineno-0-2447"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2448"><a id="__codelineno-0-2448" name="__codelineno-0-2448"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2449"><a id="__codelineno-0-2449" name="__codelineno-0-2449"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2450"><a id="__codelineno-0-2450" name="__codelineno-0-2450"></a>
</span><span id="__span-0-2451"><a id="__codelineno-0-2451" name="__codelineno-0-2451"></a>    <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-2452"><a id="__codelineno-0-2452" name="__codelineno-0-2452"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2453"><a id="__codelineno-0-2453" name="__codelineno-0-2453"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-2454"><a id="__codelineno-0-2454" name="__codelineno-0-2454"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-2455"><a id="__codelineno-0-2455" name="__codelineno-0-2455"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2456"><a id="__codelineno-0-2456" name="__codelineno-0-2456"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2457"><a id="__codelineno-0-2457" name="__codelineno-0-2457"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-2458"><a id="__codelineno-0-2458" name="__codelineno-0-2458"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2459"><a id="__codelineno-0-2459" name="__codelineno-0-2459"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-2460"><a id="__codelineno-0-2460" name="__codelineno-0-2460"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-2461"><a id="__codelineno-0-2461" name="__codelineno-0-2461"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2462"><a id="__codelineno-0-2462" name="__codelineno-0-2462"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2463"><a id="__codelineno-0-2463" name="__codelineno-0-2463"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-2464"><a id="__codelineno-0-2464" name="__codelineno-0-2464"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2465"><a id="__codelineno-0-2465" name="__codelineno-0-2465"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2466"><a id="__codelineno-0-2466" name="__codelineno-0-2466"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2467"><a id="__codelineno-0-2467" name="__codelineno-0-2467"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2468"><a id="__codelineno-0-2468" name="__codelineno-0-2468"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-2469"><a id="__codelineno-0-2469" name="__codelineno-0-2469"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2470"><a id="__codelineno-0-2470" name="__codelineno-0-2470"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2471"><a id="__codelineno-0-2471" name="__codelineno-0-2471"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"corrected_data"</span><span class="p">)</span>
</span><span id="__span-0-2472"><a id="__codelineno-0-2472" name="__codelineno-0-2472"></a>        <span class="p">)</span>
</span><span id="__span-0-2473"><a id="__codelineno-0-2473" name="__codelineno-0-2473"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2474"><a id="__codelineno-0-2474" name="__codelineno-0-2474"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2475"><a id="__codelineno-0-2475" name="__codelineno-0-2475"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2476"><a id="__codelineno-0-2476" name="__codelineno-0-2476"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2477"><a id="__codelineno-0-2477" name="__codelineno-0-2477"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2478"><a id="__codelineno-0-2478" name="__codelineno-0-2478"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2479"><a id="__codelineno-0-2479" name="__codelineno-0-2479"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2480"><a id="__codelineno-0-2480" name="__codelineno-0-2480"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2481"><a id="__codelineno-0-2481" name="__codelineno-0-2481"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2482"><a id="__codelineno-0-2482" name="__codelineno-0-2482"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2483"><a id="__codelineno-0-2483" name="__codelineno-0-2483"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2484"><a id="__codelineno-0-2484" name="__codelineno-0-2484"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2485"><a id="__codelineno-0-2485" name="__codelineno-0-2485"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2486"><a id="__codelineno-0-2486" name="__codelineno-0-2486"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2487"><a id="__codelineno-0-2487" name="__codelineno-0-2487"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2488"><a id="__codelineno-0-2488" name="__codelineno-0-2488"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2489"><a id="__codelineno-0-2489" name="__codelineno-0-2489"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2490"><a id="__codelineno-0-2490" name="__codelineno-0-2490"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2491"><a id="__codelineno-0-2491" name="__codelineno-0-2491"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2492"><a id="__codelineno-0-2492" name="__codelineno-0-2492"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2493"><a id="__codelineno-0-2493" name="__codelineno-0-2493"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"corrected_data"</span><span class="p">)</span>
</span><span id="__span-0-2494"><a id="__codelineno-0-2494" name="__codelineno-0-2494"></a>        <span class="p">)</span>
</span><span id="__span-0-2495"><a id="__codelineno-0-2495" name="__codelineno-0-2495"></a>
</span><span id="__span-0-2496"><a id="__codelineno-0-2496" name="__codelineno-0-2496"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-2497"><a id="__codelineno-0-2497" name="__codelineno-0-2497"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Corrected image not found."</span><span class="p">)</span>
</span><span id="__span-0-2498"><a id="__codelineno-0-2498" name="__codelineno-0-2498"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2499"><a id="__codelineno-0-2499" name="__codelineno-0-2499"></a>
</span><span id="__span-0-2500"><a id="__codelineno-0-2500" name="__codelineno-0-2500"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2501"><a id="__codelineno-0-2501" name="__codelineno-0-2501"></a>        <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-0-2502"><a id="__codelineno-0-2502" name="__codelineno-0-2502"></a>        <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"&lt;u2"</span>
</span><span id="__span-0-2503"><a id="__codelineno-0-2503" name="__codelineno-0-2503"></a>        <span class="n">corrected_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-2504"><a id="__codelineno-0-2504" name="__codelineno-0-2504"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-2505"><a id="__codelineno-0-2505" name="__codelineno-0-2505"></a>            <span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-2506"><a id="__codelineno-0-2506" name="__codelineno-0-2506"></a>            <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-2507"><a id="__codelineno-0-2507" name="__codelineno-0-2507"></a>        <span class="p">)</span>
</span><span id="__span-0-2508"><a id="__codelineno-0-2508" name="__codelineno-0-2508"></a>        <span class="k">return</span> <span class="n">corrected_image</span>
</span><span id="__span-0-2509"><a id="__codelineno-0-2509" name="__codelineno-0-2509"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">):</span>
</span><span id="__span-0-2510"><a id="__codelineno-0-2510" name="__codelineno-0-2510"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error loading corrected image."</span><span class="p">)</span>
</span><span id="__span-0-2511"><a id="__codelineno-0-2511" name="__codelineno-0-2511"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_decoded_spots"> <code class="highlight language-python"><span class="n">load_local_decoded_spots</span><span class="p">(</span><span class="n">tile</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Load decoded spots and features for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>tile_features</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class="doc-md-description"> <p>Decoded spots and features for one tile.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3716">3716</a></span>
<span class="normal"><a href="#__codelineno-0-3717">3717</a></span>
<span class="normal"><a href="#__codelineno-0-3718">3718</a></span>
<span class="normal"><a href="#__codelineno-0-3719">3719</a></span>
<span class="normal"><a href="#__codelineno-0-3720">3720</a></span>
<span class="normal"><a href="#__codelineno-0-3721">3721</a></span>
<span class="normal"><a href="#__codelineno-0-3722">3722</a></span>
<span class="normal"><a href="#__codelineno-0-3723">3723</a></span>
<span class="normal"><a href="#__codelineno-0-3724">3724</a></span>
<span class="normal"><a href="#__codelineno-0-3725">3725</a></span>
<span class="normal"><a href="#__codelineno-0-3726">3726</a></span>
<span class="normal"><a href="#__codelineno-0-3727">3727</a></span>
<span class="normal"><a href="#__codelineno-0-3728">3728</a></span>
<span class="normal"><a href="#__codelineno-0-3729">3729</a></span>
<span class="normal"><a href="#__codelineno-0-3730">3730</a></span>
<span class="normal"><a href="#__codelineno-0-3731">3731</a></span>
<span class="normal"><a href="#__codelineno-0-3732">3732</a></span>
<span class="normal"><a href="#__codelineno-0-3733">3733</a></span>
<span class="normal"><a href="#__codelineno-0-3734">3734</a></span>
<span class="normal"><a href="#__codelineno-0-3735">3735</a></span>
<span class="normal"><a href="#__codelineno-0-3736">3736</a></span>
<span class="normal"><a href="#__codelineno-0-3737">3737</a></span>
<span class="normal"><a href="#__codelineno-0-3738">3738</a></span>
<span class="normal"><a href="#__codelineno-0-3739">3739</a></span>
<span class="normal"><a href="#__codelineno-0-3740">3740</a></span>
<span class="normal"><a href="#__codelineno-0-3741">3741</a></span>
<span class="normal"><a href="#__codelineno-0-3742">3742</a></span>
<span class="normal"><a href="#__codelineno-0-3743">3743</a></span>
<span class="normal"><a href="#__codelineno-0-3744">3744</a></span>
<span class="normal"><a href="#__codelineno-0-3745">3745</a></span>
<span class="normal"><a href="#__codelineno-0-3746">3746</a></span>
<span class="normal"><a href="#__codelineno-0-3747">3747</a></span>
<span class="normal"><a href="#__codelineno-0-3748">3748</a></span>
<span class="normal"><a href="#__codelineno-0-3749">3749</a></span>
<span class="normal"><a href="#__codelineno-0-3750">3750</a></span>
<span class="normal"><a href="#__codelineno-0-3751">3751</a></span>
<span class="normal"><a href="#__codelineno-0-3752">3752</a></span>
<span class="normal"><a href="#__codelineno-0-3753">3753</a></span>
<span class="normal"><a href="#__codelineno-0-3754">3754</a></span>
<span class="normal"><a href="#__codelineno-0-3755">3755</a></span>
<span class="normal"><a href="#__codelineno-0-3756">3756</a></span>
<span class="normal"><a href="#__codelineno-0-3757">3757</a></span>
<span class="normal"><a href="#__codelineno-0-3758">3758</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3716"><a id="__codelineno-0-3716" name="__codelineno-0-3716"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_local_decoded_spots</span><span class="p">(</span>
</span><span id="__span-0-3717"><a id="__codelineno-0-3717" name="__codelineno-0-3717"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3718"><a id="__codelineno-0-3718" name="__codelineno-0-3718"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3719"><a id="__codelineno-0-3719" name="__codelineno-0-3719"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="__span-0-3720"><a id="__codelineno-0-3720" name="__codelineno-0-3720"></a><span class="w">    </span><span class="sd">"""Load decoded spots and features for one tile.</span>
</span><span id="__span-0-3721"><a id="__codelineno-0-3721" name="__codelineno-0-3721"></a>
</span><span id="__span-0-3722"><a id="__codelineno-0-3722" name="__codelineno-0-3722"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3723"><a id="__codelineno-0-3723" name="__codelineno-0-3723"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3724"><a id="__codelineno-0-3724" name="__codelineno-0-3724"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-3725"><a id="__codelineno-0-3725" name="__codelineno-0-3725"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-3726"><a id="__codelineno-0-3726" name="__codelineno-0-3726"></a>
</span><span id="__span-0-3727"><a id="__codelineno-0-3727" name="__codelineno-0-3727"></a><span class="sd">    Returns</span>
</span><span id="__span-0-3728"><a id="__codelineno-0-3728" name="__codelineno-0-3728"></a><span class="sd">    -------</span>
</span><span id="__span-0-3729"><a id="__codelineno-0-3729" name="__codelineno-0-3729"></a><span class="sd">    tile_features : Optional[pd.DataFrame]</span>
</span><span id="__span-0-3730"><a id="__codelineno-0-3730" name="__codelineno-0-3730"></a><span class="sd">        Decoded spots and features for one tile.</span>
</span><span id="__span-0-3731"><a id="__codelineno-0-3731" name="__codelineno-0-3731"></a><span class="sd">    """</span>
</span><span id="__span-0-3732"><a id="__codelineno-0-3732" name="__codelineno-0-3732"></a>
</span><span id="__span-0-3733"><a id="__codelineno-0-3733" name="__codelineno-0-3733"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3734"><a id="__codelineno-0-3734" name="__codelineno-0-3734"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3735"><a id="__codelineno-0-3735" name="__codelineno-0-3735"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3736"><a id="__codelineno-0-3736" name="__codelineno-0-3736"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3737"><a id="__codelineno-0-3737" name="__codelineno-0-3737"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3738"><a id="__codelineno-0-3738" name="__codelineno-0-3738"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3739"><a id="__codelineno-0-3739" name="__codelineno-0-3739"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3740"><a id="__codelineno-0-3740" name="__codelineno-0-3740"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3741"><a id="__codelineno-0-3741" name="__codelineno-0-3741"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3742"><a id="__codelineno-0-3742" name="__codelineno-0-3742"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3743"><a id="__codelineno-0-3743" name="__codelineno-0-3743"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3744"><a id="__codelineno-0-3744" name="__codelineno-0-3744"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3745"><a id="__codelineno-0-3745" name="__codelineno-0-3745"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3746"><a id="__codelineno-0-3746" name="__codelineno-0-3746"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3747"><a id="__codelineno-0-3747" name="__codelineno-0-3747"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3748"><a id="__codelineno-0-3748" name="__codelineno-0-3748"></a>
</span><span id="__span-0-3749"><a id="__codelineno-0-3749" name="__codelineno-0-3749"></a>    <span class="n">current_tile_features_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-3750"><a id="__codelineno-0-3750" name="__codelineno-0-3750"></a>        <span class="n">tile_id</span> <span class="o">+</span> <span class="s2">"_decoded_features.parquet"</span>
</span><span id="__span-0-3751"><a id="__codelineno-0-3751" name="__codelineno-0-3751"></a>    <span class="p">)</span>
</span><span id="__span-0-3752"><a id="__codelineno-0-3752" name="__codelineno-0-3752"></a>
</span><span id="__span-0-3753"><a id="__codelineno-0-3753" name="__codelineno-0-3753"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">current_tile_features_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3754"><a id="__codelineno-0-3754" name="__codelineno-0-3754"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Decoded spots not found."</span><span class="p">)</span>
</span><span id="__span-0-3755"><a id="__codelineno-0-3755" name="__codelineno-0-3755"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3756"><a id="__codelineno-0-3756" name="__codelineno-0-3756"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3757"><a id="__codelineno-0-3757" name="__codelineno-0-3757"></a>        <span class="n">tile_features</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_parquet</span><span class="p">(</span><span class="n">current_tile_features_path</span><span class="p">)</span>
</span><span id="__span-0-3758"><a id="__codelineno-0-3758" name="__codelineno-0-3758"></a>        <span class="k">return</span> <span class="n">tile_features</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_registered_image"> <code class="highlight language-python"><span class="n">load_local_registered_image</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Local registered, deconvolved image for fidiculial OR readout bit for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class="doc-section-item"> <td> <code>bit</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Bit index or bit id.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code> </td> <td> <div class="doc-md-description"> <p>Return future array.</p> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>registered_decon_image</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Registered, deconvolved image for fidiculial OR readout bit for one tile.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2991">2991</a></span>
<span class="normal"><a href="#__codelineno-0-2992">2992</a></span>
<span class="normal"><a href="#__codelineno-0-2993">2993</a></span>
<span class="normal"><a href="#__codelineno-0-2994">2994</a></span>
<span class="normal"><a href="#__codelineno-0-2995">2995</a></span>
<span class="normal"><a href="#__codelineno-0-2996">2996</a></span>
<span class="normal"><a href="#__codelineno-0-2997">2997</a></span>
<span class="normal"><a href="#__codelineno-0-2998">2998</a></span>
<span class="normal"><a href="#__codelineno-0-2999">2999</a></span>
<span class="normal"><a href="#__codelineno-0-3000">3000</a></span>
<span class="normal"><a href="#__codelineno-0-3001">3001</a></span>
<span class="normal"><a href="#__codelineno-0-3002">3002</a></span>
<span class="normal"><a href="#__codelineno-0-3003">3003</a></span>
<span class="normal"><a href="#__codelineno-0-3004">3004</a></span>
<span class="normal"><a href="#__codelineno-0-3005">3005</a></span>
<span class="normal"><a href="#__codelineno-0-3006">3006</a></span>
<span class="normal"><a href="#__codelineno-0-3007">3007</a></span>
<span class="normal"><a href="#__codelineno-0-3008">3008</a></span>
<span class="normal"><a href="#__codelineno-0-3009">3009</a></span>
<span class="normal"><a href="#__codelineno-0-3010">3010</a></span>
<span class="normal"><a href="#__codelineno-0-3011">3011</a></span>
<span class="normal"><a href="#__codelineno-0-3012">3012</a></span>
<span class="normal"><a href="#__codelineno-0-3013">3013</a></span>
<span class="normal"><a href="#__codelineno-0-3014">3014</a></span>
<span class="normal"><a href="#__codelineno-0-3015">3015</a></span>
<span class="normal"><a href="#__codelineno-0-3016">3016</a></span>
<span class="normal"><a href="#__codelineno-0-3017">3017</a></span>
<span class="normal"><a href="#__codelineno-0-3018">3018</a></span>
<span class="normal"><a href="#__codelineno-0-3019">3019</a></span>
<span class="normal"><a href="#__codelineno-0-3020">3020</a></span>
<span class="normal"><a href="#__codelineno-0-3021">3021</a></span>
<span class="normal"><a href="#__codelineno-0-3022">3022</a></span>
<span class="normal"><a href="#__codelineno-0-3023">3023</a></span>
<span class="normal"><a href="#__codelineno-0-3024">3024</a></span>
<span class="normal"><a href="#__codelineno-0-3025">3025</a></span>
<span class="normal"><a href="#__codelineno-0-3026">3026</a></span>
<span class="normal"><a href="#__codelineno-0-3027">3027</a></span>
<span class="normal"><a href="#__codelineno-0-3028">3028</a></span>
<span class="normal"><a href="#__codelineno-0-3029">3029</a></span>
<span class="normal"><a href="#__codelineno-0-3030">3030</a></span>
<span class="normal"><a href="#__codelineno-0-3031">3031</a></span>
<span class="normal"><a href="#__codelineno-0-3032">3032</a></span>
<span class="normal"><a href="#__codelineno-0-3033">3033</a></span>
<span class="normal"><a href="#__codelineno-0-3034">3034</a></span>
<span class="normal"><a href="#__codelineno-0-3035">3035</a></span>
<span class="normal"><a href="#__codelineno-0-3036">3036</a></span>
<span class="normal"><a href="#__codelineno-0-3037">3037</a></span>
<span class="normal"><a href="#__codelineno-0-3038">3038</a></span>
<span class="normal"><a href="#__codelineno-0-3039">3039</a></span>
<span class="normal"><a href="#__codelineno-0-3040">3040</a></span>
<span class="normal"><a href="#__codelineno-0-3041">3041</a></span>
<span class="normal"><a href="#__codelineno-0-3042">3042</a></span>
<span class="normal"><a href="#__codelineno-0-3043">3043</a></span>
<span class="normal"><a href="#__codelineno-0-3044">3044</a></span>
<span class="normal"><a href="#__codelineno-0-3045">3045</a></span>
<span class="normal"><a href="#__codelineno-0-3046">3046</a></span>
<span class="normal"><a href="#__codelineno-0-3047">3047</a></span>
<span class="normal"><a href="#__codelineno-0-3048">3048</a></span>
<span class="normal"><a href="#__codelineno-0-3049">3049</a></span>
<span class="normal"><a href="#__codelineno-0-3050">3050</a></span>
<span class="normal"><a href="#__codelineno-0-3051">3051</a></span>
<span class="normal"><a href="#__codelineno-0-3052">3052</a></span>
<span class="normal"><a href="#__codelineno-0-3053">3053</a></span>
<span class="normal"><a href="#__codelineno-0-3054">3054</a></span>
<span class="normal"><a href="#__codelineno-0-3055">3055</a></span>
<span class="normal"><a href="#__codelineno-0-3056">3056</a></span>
<span class="normal"><a href="#__codelineno-0-3057">3057</a></span>
<span class="normal"><a href="#__codelineno-0-3058">3058</a></span>
<span class="normal"><a href="#__codelineno-0-3059">3059</a></span>
<span class="normal"><a href="#__codelineno-0-3060">3060</a></span>
<span class="normal"><a href="#__codelineno-0-3061">3061</a></span>
<span class="normal"><a href="#__codelineno-0-3062">3062</a></span>
<span class="normal"><a href="#__codelineno-0-3063">3063</a></span>
<span class="normal"><a href="#__codelineno-0-3064">3064</a></span>
<span class="normal"><a href="#__codelineno-0-3065">3065</a></span>
<span class="normal"><a href="#__codelineno-0-3066">3066</a></span>
<span class="normal"><a href="#__codelineno-0-3067">3067</a></span>
<span class="normal"><a href="#__codelineno-0-3068">3068</a></span>
<span class="normal"><a href="#__codelineno-0-3069">3069</a></span>
<span class="normal"><a href="#__codelineno-0-3070">3070</a></span>
<span class="normal"><a href="#__codelineno-0-3071">3071</a></span>
<span class="normal"><a href="#__codelineno-0-3072">3072</a></span>
<span class="normal"><a href="#__codelineno-0-3073">3073</a></span>
<span class="normal"><a href="#__codelineno-0-3074">3074</a></span>
<span class="normal"><a href="#__codelineno-0-3075">3075</a></span>
<span class="normal"><a href="#__codelineno-0-3076">3076</a></span>
<span class="normal"><a href="#__codelineno-0-3077">3077</a></span>
<span class="normal"><a href="#__codelineno-0-3078">3078</a></span>
<span class="normal"><a href="#__codelineno-0-3079">3079</a></span>
<span class="normal"><a href="#__codelineno-0-3080">3080</a></span>
<span class="normal"><a href="#__codelineno-0-3081">3081</a></span>
<span class="normal"><a href="#__codelineno-0-3082">3082</a></span>
<span class="normal"><a href="#__codelineno-0-3083">3083</a></span>
<span class="normal"><a href="#__codelineno-0-3084">3084</a></span>
<span class="normal"><a href="#__codelineno-0-3085">3085</a></span>
<span class="normal"><a href="#__codelineno-0-3086">3086</a></span>
<span class="normal"><a href="#__codelineno-0-3087">3087</a></span>
<span class="normal"><a href="#__codelineno-0-3088">3088</a></span>
<span class="normal"><a href="#__codelineno-0-3089">3089</a></span>
<span class="normal"><a href="#__codelineno-0-3090">3090</a></span>
<span class="normal"><a href="#__codelineno-0-3091">3091</a></span>
<span class="normal"><a href="#__codelineno-0-3092">3092</a></span>
<span class="normal"><a href="#__codelineno-0-3093">3093</a></span>
<span class="normal"><a href="#__codelineno-0-3094">3094</a></span>
<span class="normal"><a href="#__codelineno-0-3095">3095</a></span>
<span class="normal"><a href="#__codelineno-0-3096">3096</a></span>
<span class="normal"><a href="#__codelineno-0-3097">3097</a></span>
<span class="normal"><a href="#__codelineno-0-3098">3098</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2991"><a id="__codelineno-0-2991" name="__codelineno-0-2991"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_local_registered_image</span><span class="p">(</span>
</span><span id="__span-0-2992"><a id="__codelineno-0-2992" name="__codelineno-0-2992"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2993"><a id="__codelineno-0-2993" name="__codelineno-0-2993"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2994"><a id="__codelineno-0-2994" name="__codelineno-0-2994"></a>    <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2995"><a id="__codelineno-0-2995" name="__codelineno-0-2995"></a>    <span class="n">bit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2996"><a id="__codelineno-0-2996" name="__codelineno-0-2996"></a>    <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2997"><a id="__codelineno-0-2997" name="__codelineno-0-2997"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-2998"><a id="__codelineno-0-2998" name="__codelineno-0-2998"></a><span class="w">    </span><span class="sd">"""Local registered, deconvolved image for fidiculial OR readout bit for one tile.</span>
</span><span id="__span-0-2999"><a id="__codelineno-0-2999" name="__codelineno-0-2999"></a>
</span><span id="__span-0-3000"><a id="__codelineno-0-3000" name="__codelineno-0-3000"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3001"><a id="__codelineno-0-3001" name="__codelineno-0-3001"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3002"><a id="__codelineno-0-3002" name="__codelineno-0-3002"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-3003"><a id="__codelineno-0-3003" name="__codelineno-0-3003"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-3004"><a id="__codelineno-0-3004" name="__codelineno-0-3004"></a><span class="sd">    round : Optional[Union[int, str]]</span>
</span><span id="__span-0-3005"><a id="__codelineno-0-3005" name="__codelineno-0-3005"></a><span class="sd">        Round index or round id.</span>
</span><span id="__span-0-3006"><a id="__codelineno-0-3006" name="__codelineno-0-3006"></a><span class="sd">    bit : Optional[Union[int, str]]</span>
</span><span id="__span-0-3007"><a id="__codelineno-0-3007" name="__codelineno-0-3007"></a><span class="sd">        Bit index or bit id.</span>
</span><span id="__span-0-3008"><a id="__codelineno-0-3008" name="__codelineno-0-3008"></a><span class="sd">    return_future : Optional[bool]</span>
</span><span id="__span-0-3009"><a id="__codelineno-0-3009" name="__codelineno-0-3009"></a><span class="sd">        Return future array.</span>
</span><span id="__span-0-3010"><a id="__codelineno-0-3010" name="__codelineno-0-3010"></a>
</span><span id="__span-0-3011"><a id="__codelineno-0-3011" name="__codelineno-0-3011"></a><span class="sd">    Returns</span>
</span><span id="__span-0-3012"><a id="__codelineno-0-3012" name="__codelineno-0-3012"></a><span class="sd">    -------</span>
</span><span id="__span-0-3013"><a id="__codelineno-0-3013" name="__codelineno-0-3013"></a><span class="sd">    registered_decon_image : Optional[ArrayLike]</span>
</span><span id="__span-0-3014"><a id="__codelineno-0-3014" name="__codelineno-0-3014"></a><span class="sd">        Registered, deconvolved image for fidiculial OR readout bit for one tile.</span>
</span><span id="__span-0-3015"><a id="__codelineno-0-3015" name="__codelineno-0-3015"></a><span class="sd">    """</span>
</span><span id="__span-0-3016"><a id="__codelineno-0-3016" name="__codelineno-0-3016"></a>
</span><span id="__span-0-3017"><a id="__codelineno-0-3017" name="__codelineno-0-3017"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-3018"><a id="__codelineno-0-3018" name="__codelineno-0-3018"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Provide either 'round' or 'bit', but not both"</span><span class="p">)</span>
</span><span id="__span-0-3019"><a id="__codelineno-0-3019" name="__codelineno-0-3019"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3020"><a id="__codelineno-0-3020" name="__codelineno-0-3020"></a>
</span><span id="__span-0-3021"><a id="__codelineno-0-3021" name="__codelineno-0-3021"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3022"><a id="__codelineno-0-3022" name="__codelineno-0-3022"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3023"><a id="__codelineno-0-3023" name="__codelineno-0-3023"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3024"><a id="__codelineno-0-3024" name="__codelineno-0-3024"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3025"><a id="__codelineno-0-3025" name="__codelineno-0-3025"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3026"><a id="__codelineno-0-3026" name="__codelineno-0-3026"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3027"><a id="__codelineno-0-3027" name="__codelineno-0-3027"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3028"><a id="__codelineno-0-3028" name="__codelineno-0-3028"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3029"><a id="__codelineno-0-3029" name="__codelineno-0-3029"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3030"><a id="__codelineno-0-3030" name="__codelineno-0-3030"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3031"><a id="__codelineno-0-3031" name="__codelineno-0-3031"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3032"><a id="__codelineno-0-3032" name="__codelineno-0-3032"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3033"><a id="__codelineno-0-3033" name="__codelineno-0-3033"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3034"><a id="__codelineno-0-3034" name="__codelineno-0-3034"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3035"><a id="__codelineno-0-3035" name="__codelineno-0-3035"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3036"><a id="__codelineno-0-3036" name="__codelineno-0-3036"></a>
</span><span id="__span-0-3037"><a id="__codelineno-0-3037" name="__codelineno-0-3037"></a>    <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-3038"><a id="__codelineno-0-3038" name="__codelineno-0-3038"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3039"><a id="__codelineno-0-3039" name="__codelineno-0-3039"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-3040"><a id="__codelineno-0-3040" name="__codelineno-0-3040"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-3041"><a id="__codelineno-0-3041" name="__codelineno-0-3041"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3042"><a id="__codelineno-0-3042" name="__codelineno-0-3042"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3043"><a id="__codelineno-0-3043" name="__codelineno-0-3043"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-3044"><a id="__codelineno-0-3044" name="__codelineno-0-3044"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3045"><a id="__codelineno-0-3045" name="__codelineno-0-3045"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-3046"><a id="__codelineno-0-3046" name="__codelineno-0-3046"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-3047"><a id="__codelineno-0-3047" name="__codelineno-0-3047"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3048"><a id="__codelineno-0-3048" name="__codelineno-0-3048"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3049"><a id="__codelineno-0-3049" name="__codelineno-0-3049"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-3050"><a id="__codelineno-0-3050" name="__codelineno-0-3050"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3051"><a id="__codelineno-0-3051" name="__codelineno-0-3051"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3052"><a id="__codelineno-0-3052" name="__codelineno-0-3052"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3053"><a id="__codelineno-0-3053" name="__codelineno-0-3053"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3054"><a id="__codelineno-0-3054" name="__codelineno-0-3054"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-3055"><a id="__codelineno-0-3055" name="__codelineno-0-3055"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3056"><a id="__codelineno-0-3056" name="__codelineno-0-3056"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3057"><a id="__codelineno-0-3057" name="__codelineno-0-3057"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_decon_data"</span><span class="p">)</span>
</span><span id="__span-0-3058"><a id="__codelineno-0-3058" name="__codelineno-0-3058"></a>        <span class="p">)</span>
</span><span id="__span-0-3059"><a id="__codelineno-0-3059" name="__codelineno-0-3059"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3060"><a id="__codelineno-0-3060" name="__codelineno-0-3060"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3061"><a id="__codelineno-0-3061" name="__codelineno-0-3061"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-3062"><a id="__codelineno-0-3062" name="__codelineno-0-3062"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-3063"><a id="__codelineno-0-3063" name="__codelineno-0-3063"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3064"><a id="__codelineno-0-3064" name="__codelineno-0-3064"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3065"><a id="__codelineno-0-3065" name="__codelineno-0-3065"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-3066"><a id="__codelineno-0-3066" name="__codelineno-0-3066"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3067"><a id="__codelineno-0-3067" name="__codelineno-0-3067"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-3068"><a id="__codelineno-0-3068" name="__codelineno-0-3068"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-3069"><a id="__codelineno-0-3069" name="__codelineno-0-3069"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3070"><a id="__codelineno-0-3070" name="__codelineno-0-3070"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3071"><a id="__codelineno-0-3071" name="__codelineno-0-3071"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-3072"><a id="__codelineno-0-3072" name="__codelineno-0-3072"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3073"><a id="__codelineno-0-3073" name="__codelineno-0-3073"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3074"><a id="__codelineno-0-3074" name="__codelineno-0-3074"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3075"><a id="__codelineno-0-3075" name="__codelineno-0-3075"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3076"><a id="__codelineno-0-3076" name="__codelineno-0-3076"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-3077"><a id="__codelineno-0-3077" name="__codelineno-0-3077"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3078"><a id="__codelineno-0-3078" name="__codelineno-0-3078"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3079"><a id="__codelineno-0-3079" name="__codelineno-0-3079"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_decon_data"</span><span class="p">)</span>
</span><span id="__span-0-3080"><a id="__codelineno-0-3080" name="__codelineno-0-3080"></a>        <span class="p">)</span>
</span><span id="__span-0-3081"><a id="__codelineno-0-3081" name="__codelineno-0-3081"></a>
</span><span id="__span-0-3082"><a id="__codelineno-0-3082" name="__codelineno-0-3082"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3083"><a id="__codelineno-0-3083" name="__codelineno-0-3083"></a>        <span class="c1">#print("Registered deconvolved image not found.")</span>
</span><span id="__span-0-3084"><a id="__codelineno-0-3084" name="__codelineno-0-3084"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3085"><a id="__codelineno-0-3085" name="__codelineno-0-3085"></a>
</span><span id="__span-0-3086"><a id="__codelineno-0-3086" name="__codelineno-0-3086"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3087"><a id="__codelineno-0-3087" name="__codelineno-0-3087"></a>        <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-0-3088"><a id="__codelineno-0-3088" name="__codelineno-0-3088"></a>        <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"&lt;u2"</span>
</span><span id="__span-0-3089"><a id="__codelineno-0-3089" name="__codelineno-0-3089"></a>        <span class="n">registered_decon_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3090"><a id="__codelineno-0-3090" name="__codelineno-0-3090"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3091"><a id="__codelineno-0-3091" name="__codelineno-0-3091"></a>            <span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-3092"><a id="__codelineno-0-3092" name="__codelineno-0-3092"></a>            <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3093"><a id="__codelineno-0-3093" name="__codelineno-0-3093"></a>        <span class="p">)</span>
</span><span id="__span-0-3094"><a id="__codelineno-0-3094" name="__codelineno-0-3094"></a>        <span class="k">return</span> <span class="n">registered_decon_image</span>
</span><span id="__span-0-3095"><a id="__codelineno-0-3095" name="__codelineno-0-3095"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-3096"><a id="__codelineno-0-3096" name="__codelineno-0-3096"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-3097"><a id="__codelineno-0-3097" name="__codelineno-0-3097"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error loading registered deconvolved image."</span><span class="p">)</span>
</span><span id="__span-0-3098"><a id="__codelineno-0-3098" name="__codelineno-0-3098"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_rigid_xform_xyz_px"> <code class="highlight language-python"><span class="n">load_local_rigid_xform_xyz_px</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Load calculated rigid registration transform for one round and tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>rigid_xform_xyz_px</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Local rigid registration transform for one round and tile.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2644">2644</a></span>
<span class="normal"><a href="#__codelineno-0-2645">2645</a></span>
<span class="normal"><a href="#__codelineno-0-2646">2646</a></span>
<span class="normal"><a href="#__codelineno-0-2647">2647</a></span>
<span class="normal"><a href="#__codelineno-0-2648">2648</a></span>
<span class="normal"><a href="#__codelineno-0-2649">2649</a></span>
<span class="normal"><a href="#__codelineno-0-2650">2650</a></span>
<span class="normal"><a href="#__codelineno-0-2651">2651</a></span>
<span class="normal"><a href="#__codelineno-0-2652">2652</a></span>
<span class="normal"><a href="#__codelineno-0-2653">2653</a></span>
<span class="normal"><a href="#__codelineno-0-2654">2654</a></span>
<span class="normal"><a href="#__codelineno-0-2655">2655</a></span>
<span class="normal"><a href="#__codelineno-0-2656">2656</a></span>
<span class="normal"><a href="#__codelineno-0-2657">2657</a></span>
<span class="normal"><a href="#__codelineno-0-2658">2658</a></span>
<span class="normal"><a href="#__codelineno-0-2659">2659</a></span>
<span class="normal"><a href="#__codelineno-0-2660">2660</a></span>
<span class="normal"><a href="#__codelineno-0-2661">2661</a></span>
<span class="normal"><a href="#__codelineno-0-2662">2662</a></span>
<span class="normal"><a href="#__codelineno-0-2663">2663</a></span>
<span class="normal"><a href="#__codelineno-0-2664">2664</a></span>
<span class="normal"><a href="#__codelineno-0-2665">2665</a></span>
<span class="normal"><a href="#__codelineno-0-2666">2666</a></span>
<span class="normal"><a href="#__codelineno-0-2667">2667</a></span>
<span class="normal"><a href="#__codelineno-0-2668">2668</a></span>
<span class="normal"><a href="#__codelineno-0-2669">2669</a></span>
<span class="normal"><a href="#__codelineno-0-2670">2670</a></span>
<span class="normal"><a href="#__codelineno-0-2671">2671</a></span>
<span class="normal"><a href="#__codelineno-0-2672">2672</a></span>
<span class="normal"><a href="#__codelineno-0-2673">2673</a></span>
<span class="normal"><a href="#__codelineno-0-2674">2674</a></span>
<span class="normal"><a href="#__codelineno-0-2675">2675</a></span>
<span class="normal"><a href="#__codelineno-0-2676">2676</a></span>
<span class="normal"><a href="#__codelineno-0-2677">2677</a></span>
<span class="normal"><a href="#__codelineno-0-2678">2678</a></span>
<span class="normal"><a href="#__codelineno-0-2679">2679</a></span>
<span class="normal"><a href="#__codelineno-0-2680">2680</a></span>
<span class="normal"><a href="#__codelineno-0-2681">2681</a></span>
<span class="normal"><a href="#__codelineno-0-2682">2682</a></span>
<span class="normal"><a href="#__codelineno-0-2683">2683</a></span>
<span class="normal"><a href="#__codelineno-0-2684">2684</a></span>
<span class="normal"><a href="#__codelineno-0-2685">2685</a></span>
<span class="normal"><a href="#__codelineno-0-2686">2686</a></span>
<span class="normal"><a href="#__codelineno-0-2687">2687</a></span>
<span class="normal"><a href="#__codelineno-0-2688">2688</a></span>
<span class="normal"><a href="#__codelineno-0-2689">2689</a></span>
<span class="normal"><a href="#__codelineno-0-2690">2690</a></span>
<span class="normal"><a href="#__codelineno-0-2691">2691</a></span>
<span class="normal"><a href="#__codelineno-0-2692">2692</a></span>
<span class="normal"><a href="#__codelineno-0-2693">2693</a></span>
<span class="normal"><a href="#__codelineno-0-2694">2694</a></span>
<span class="normal"><a href="#__codelineno-0-2695">2695</a></span>
<span class="normal"><a href="#__codelineno-0-2696">2696</a></span>
<span class="normal"><a href="#__codelineno-0-2697">2697</a></span>
<span class="normal"><a href="#__codelineno-0-2698">2698</a></span>
<span class="normal"><a href="#__codelineno-0-2699">2699</a></span>
<span class="normal"><a href="#__codelineno-0-2700">2700</a></span>
<span class="normal"><a href="#__codelineno-0-2701">2701</a></span>
<span class="normal"><a href="#__codelineno-0-2702">2702</a></span>
<span class="normal"><a href="#__codelineno-0-2703">2703</a></span>
<span class="normal"><a href="#__codelineno-0-2704">2704</a></span>
<span class="normal"><a href="#__codelineno-0-2705">2705</a></span>
<span class="normal"><a href="#__codelineno-0-2706">2706</a></span>
<span class="normal"><a href="#__codelineno-0-2707">2707</a></span>
<span class="normal"><a href="#__codelineno-0-2708">2708</a></span>
<span class="normal"><a href="#__codelineno-0-2709">2709</a></span>
<span class="normal"><a href="#__codelineno-0-2710">2710</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2644"><a id="__codelineno-0-2644" name="__codelineno-0-2644"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_local_rigid_xform_xyz_px</span><span class="p">(</span>
</span><span id="__span-0-2645"><a id="__codelineno-0-2645" name="__codelineno-0-2645"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2646"><a id="__codelineno-0-2646" name="__codelineno-0-2646"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2647"><a id="__codelineno-0-2647" name="__codelineno-0-2647"></a>    <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2648"><a id="__codelineno-0-2648" name="__codelineno-0-2648"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-2649"><a id="__codelineno-0-2649" name="__codelineno-0-2649"></a><span class="w">    </span><span class="sd">"""Load calculated rigid registration transform for one round and tile.</span>
</span><span id="__span-0-2650"><a id="__codelineno-0-2650" name="__codelineno-0-2650"></a>
</span><span id="__span-0-2651"><a id="__codelineno-0-2651" name="__codelineno-0-2651"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-2652"><a id="__codelineno-0-2652" name="__codelineno-0-2652"></a><span class="sd">    ----------</span>
</span><span id="__span-0-2653"><a id="__codelineno-0-2653" name="__codelineno-0-2653"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-2654"><a id="__codelineno-0-2654" name="__codelineno-0-2654"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-2655"><a id="__codelineno-0-2655" name="__codelineno-0-2655"></a><span class="sd">    round : Union[int, str]</span>
</span><span id="__span-0-2656"><a id="__codelineno-0-2656" name="__codelineno-0-2656"></a><span class="sd">        Round index or round id.</span>
</span><span id="__span-0-2657"><a id="__codelineno-0-2657" name="__codelineno-0-2657"></a>
</span><span id="__span-0-2658"><a id="__codelineno-0-2658" name="__codelineno-0-2658"></a><span class="sd">    Returns</span>
</span><span id="__span-0-2659"><a id="__codelineno-0-2659" name="__codelineno-0-2659"></a><span class="sd">    -------</span>
</span><span id="__span-0-2660"><a id="__codelineno-0-2660" name="__codelineno-0-2660"></a><span class="sd">    rigid_xform_xyz_px : Optional[ArrayLike]</span>
</span><span id="__span-0-2661"><a id="__codelineno-0-2661" name="__codelineno-0-2661"></a><span class="sd">        Local rigid registration transform for one round and tile.</span>
</span><span id="__span-0-2662"><a id="__codelineno-0-2662" name="__codelineno-0-2662"></a><span class="sd">    """</span>
</span><span id="__span-0-2663"><a id="__codelineno-0-2663" name="__codelineno-0-2663"></a>
</span><span id="__span-0-2664"><a id="__codelineno-0-2664" name="__codelineno-0-2664"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2665"><a id="__codelineno-0-2665" name="__codelineno-0-2665"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2666"><a id="__codelineno-0-2666" name="__codelineno-0-2666"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2667"><a id="__codelineno-0-2667" name="__codelineno-0-2667"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2668"><a id="__codelineno-0-2668" name="__codelineno-0-2668"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2669"><a id="__codelineno-0-2669" name="__codelineno-0-2669"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2670"><a id="__codelineno-0-2670" name="__codelineno-0-2670"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2671"><a id="__codelineno-0-2671" name="__codelineno-0-2671"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2672"><a id="__codelineno-0-2672" name="__codelineno-0-2672"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2673"><a id="__codelineno-0-2673" name="__codelineno-0-2673"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2674"><a id="__codelineno-0-2674" name="__codelineno-0-2674"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2675"><a id="__codelineno-0-2675" name="__codelineno-0-2675"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2676"><a id="__codelineno-0-2676" name="__codelineno-0-2676"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2677"><a id="__codelineno-0-2677" name="__codelineno-0-2677"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2678"><a id="__codelineno-0-2678" name="__codelineno-0-2678"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2679"><a id="__codelineno-0-2679" name="__codelineno-0-2679"></a>
</span><span id="__span-0-2680"><a id="__codelineno-0-2680" name="__codelineno-0-2680"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2681"><a id="__codelineno-0-2681" name="__codelineno-0-2681"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2682"><a id="__codelineno-0-2682" name="__codelineno-0-2682"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2683"><a id="__codelineno-0-2683" name="__codelineno-0-2683"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2684"><a id="__codelineno-0-2684" name="__codelineno-0-2684"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2685"><a id="__codelineno-0-2685" name="__codelineno-0-2685"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2686"><a id="__codelineno-0-2686" name="__codelineno-0-2686"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2687"><a id="__codelineno-0-2687" name="__codelineno-0-2687"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2688"><a id="__codelineno-0-2688" name="__codelineno-0-2688"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2689"><a id="__codelineno-0-2689" name="__codelineno-0-2689"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2690"><a id="__codelineno-0-2690" name="__codelineno-0-2690"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2691"><a id="__codelineno-0-2691" name="__codelineno-0-2691"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2692"><a id="__codelineno-0-2692" name="__codelineno-0-2692"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2693"><a id="__codelineno-0-2693" name="__codelineno-0-2693"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2694"><a id="__codelineno-0-2694" name="__codelineno-0-2694"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2695"><a id="__codelineno-0-2695" name="__codelineno-0-2695"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2696"><a id="__codelineno-0-2696" name="__codelineno-0-2696"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2697"><a id="__codelineno-0-2697" name="__codelineno-0-2697"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2698"><a id="__codelineno-0-2698" name="__codelineno-0-2698"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2699"><a id="__codelineno-0-2699" name="__codelineno-0-2699"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2700"><a id="__codelineno-0-2700" name="__codelineno-0-2700"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2701"><a id="__codelineno-0-2701" name="__codelineno-0-2701"></a>        <span class="p">)</span>
</span><span id="__span-0-2702"><a id="__codelineno-0-2702" name="__codelineno-0-2702"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2703"><a id="__codelineno-0-2703" name="__codelineno-0-2703"></a>        <span class="n">rigid_xform_xyz_px</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span>
</span><span id="__span-0-2704"><a id="__codelineno-0-2704" name="__codelineno-0-2704"></a>            <span class="n">attributes</span><span class="p">[</span><span class="s2">"rigid_xform_xyz_px"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span>
</span><span id="__span-0-2705"><a id="__codelineno-0-2705" name="__codelineno-0-2705"></a>        <span class="p">)</span>
</span><span id="__span-0-2706"><a id="__codelineno-0-2706" name="__codelineno-0-2706"></a>        <span class="k">return</span> <span class="n">rigid_xform_xyz_px</span>
</span><span id="__span-0-2707"><a id="__codelineno-0-2707" name="__codelineno-0-2707"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-2708"><a id="__codelineno-0-2708" name="__codelineno-0-2708"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-2709"><a id="__codelineno-0-2709" name="__codelineno-0-2709"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Rigid transform mapping back to first round not found."</span><span class="p">)</span>
</span><span id="__span-0-2710"><a id="__codelineno-0-2710" name="__codelineno-0-2710"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_round_linker"> <code class="highlight language-python"><span class="n">load_local_round_linker</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">bit</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Load fidicual round linked to readout bit for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>bit</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Bit index or bit id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>round_linker</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Sequence">Sequence</span>[<span title="int">int</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Fidicual round linked to readout bit for one tile.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1939">1939</a></span>
<span class="normal"><a href="#__codelineno-0-1940">1940</a></span>
<span class="normal"><a href="#__codelineno-0-1941">1941</a></span>
<span class="normal"><a href="#__codelineno-0-1942">1942</a></span>
<span class="normal"><a href="#__codelineno-0-1943">1943</a></span>
<span class="normal"><a href="#__codelineno-0-1944">1944</a></span>
<span class="normal"><a href="#__codelineno-0-1945">1945</a></span>
<span class="normal"><a href="#__codelineno-0-1946">1946</a></span>
<span class="normal"><a href="#__codelineno-0-1947">1947</a></span>
<span class="normal"><a href="#__codelineno-0-1948">1948</a></span>
<span class="normal"><a href="#__codelineno-0-1949">1949</a></span>
<span class="normal"><a href="#__codelineno-0-1950">1950</a></span>
<span class="normal"><a href="#__codelineno-0-1951">1951</a></span>
<span class="normal"><a href="#__codelineno-0-1952">1952</a></span>
<span class="normal"><a href="#__codelineno-0-1953">1953</a></span>
<span class="normal"><a href="#__codelineno-0-1954">1954</a></span>
<span class="normal"><a href="#__codelineno-0-1955">1955</a></span>
<span class="normal"><a href="#__codelineno-0-1956">1956</a></span>
<span class="normal"><a href="#__codelineno-0-1957">1957</a></span>
<span class="normal"><a href="#__codelineno-0-1958">1958</a></span>
<span class="normal"><a href="#__codelineno-0-1959">1959</a></span>
<span class="normal"><a href="#__codelineno-0-1960">1960</a></span>
<span class="normal"><a href="#__codelineno-0-1961">1961</a></span>
<span class="normal"><a href="#__codelineno-0-1962">1962</a></span>
<span class="normal"><a href="#__codelineno-0-1963">1963</a></span>
<span class="normal"><a href="#__codelineno-0-1964">1964</a></span>
<span class="normal"><a href="#__codelineno-0-1965">1965</a></span>
<span class="normal"><a href="#__codelineno-0-1966">1966</a></span>
<span class="normal"><a href="#__codelineno-0-1967">1967</a></span>
<span class="normal"><a href="#__codelineno-0-1968">1968</a></span>
<span class="normal"><a href="#__codelineno-0-1969">1969</a></span>
<span class="normal"><a href="#__codelineno-0-1970">1970</a></span>
<span class="normal"><a href="#__codelineno-0-1971">1971</a></span>
<span class="normal"><a href="#__codelineno-0-1972">1972</a></span>
<span class="normal"><a href="#__codelineno-0-1973">1973</a></span>
<span class="normal"><a href="#__codelineno-0-1974">1974</a></span>
<span class="normal"><a href="#__codelineno-0-1975">1975</a></span>
<span class="normal"><a href="#__codelineno-0-1976">1976</a></span>
<span class="normal"><a href="#__codelineno-0-1977">1977</a></span>
<span class="normal"><a href="#__codelineno-0-1978">1978</a></span>
<span class="normal"><a href="#__codelineno-0-1979">1979</a></span>
<span class="normal"><a href="#__codelineno-0-1980">1980</a></span>
<span class="normal"><a href="#__codelineno-0-1981">1981</a></span>
<span class="normal"><a href="#__codelineno-0-1982">1982</a></span>
<span class="normal"><a href="#__codelineno-0-1983">1983</a></span>
<span class="normal"><a href="#__codelineno-0-1984">1984</a></span>
<span class="normal"><a href="#__codelineno-0-1985">1985</a></span>
<span class="normal"><a href="#__codelineno-0-1986">1986</a></span>
<span class="normal"><a href="#__codelineno-0-1987">1987</a></span>
<span class="normal"><a href="#__codelineno-0-1988">1988</a></span>
<span class="normal"><a href="#__codelineno-0-1989">1989</a></span>
<span class="normal"><a href="#__codelineno-0-1990">1990</a></span>
<span class="normal"><a href="#__codelineno-0-1991">1991</a></span>
<span class="normal"><a href="#__codelineno-0-1992">1992</a></span>
<span class="normal"><a href="#__codelineno-0-1993">1993</a></span>
<span class="normal"><a href="#__codelineno-0-1994">1994</a></span>
<span class="normal"><a href="#__codelineno-0-1995">1995</a></span>
<span class="normal"><a href="#__codelineno-0-1996">1996</a></span>
<span class="normal"><a href="#__codelineno-0-1997">1997</a></span>
<span class="normal"><a href="#__codelineno-0-1998">1998</a></span>
<span class="normal"><a href="#__codelineno-0-1999">1999</a></span>
<span class="normal"><a href="#__codelineno-0-2000">2000</a></span>
<span class="normal"><a href="#__codelineno-0-2001">2001</a></span>
<span class="normal"><a href="#__codelineno-0-2002">2002</a></span>
<span class="normal"><a href="#__codelineno-0-2003">2003</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1939"><a id="__codelineno-0-1939" name="__codelineno-0-1939"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_local_round_linker</span><span class="p">(</span>
</span><span id="__span-0-1940"><a id="__codelineno-0-1940" name="__codelineno-0-1940"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1941"><a id="__codelineno-0-1941" name="__codelineno-0-1941"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1942"><a id="__codelineno-0-1942" name="__codelineno-0-1942"></a>    <span class="n">bit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1943"><a id="__codelineno-0-1943" name="__codelineno-0-1943"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]:</span>
</span><span id="__span-0-1944"><a id="__codelineno-0-1944" name="__codelineno-0-1944"></a><span class="w">    </span><span class="sd">"""Load fidicual round linked to readout bit for one tile.</span>
</span><span id="__span-0-1945"><a id="__codelineno-0-1945" name="__codelineno-0-1945"></a>
</span><span id="__span-0-1946"><a id="__codelineno-0-1946" name="__codelineno-0-1946"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-1947"><a id="__codelineno-0-1947" name="__codelineno-0-1947"></a><span class="sd">    ----------</span>
</span><span id="__span-0-1948"><a id="__codelineno-0-1948" name="__codelineno-0-1948"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-1949"><a id="__codelineno-0-1949" name="__codelineno-0-1949"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-1950"><a id="__codelineno-0-1950" name="__codelineno-0-1950"></a><span class="sd">    bit : Union[int, str]</span>
</span><span id="__span-0-1951"><a id="__codelineno-0-1951" name="__codelineno-0-1951"></a><span class="sd">        Bit index or bit id.</span>
</span><span id="__span-0-1952"><a id="__codelineno-0-1952" name="__codelineno-0-1952"></a>
</span><span id="__span-0-1953"><a id="__codelineno-0-1953" name="__codelineno-0-1953"></a><span class="sd">    Returns</span>
</span><span id="__span-0-1954"><a id="__codelineno-0-1954" name="__codelineno-0-1954"></a><span class="sd">    -------</span>
</span><span id="__span-0-1955"><a id="__codelineno-0-1955" name="__codelineno-0-1955"></a><span class="sd">    round_linker : Optional[Sequence[int]]</span>
</span><span id="__span-0-1956"><a id="__codelineno-0-1956" name="__codelineno-0-1956"></a><span class="sd">        Fidicual round linked to readout bit for one tile.</span>
</span><span id="__span-0-1957"><a id="__codelineno-0-1957" name="__codelineno-0-1957"></a><span class="sd">    """</span>
</span><span id="__span-0-1958"><a id="__codelineno-0-1958" name="__codelineno-0-1958"></a>
</span><span id="__span-0-1959"><a id="__codelineno-0-1959" name="__codelineno-0-1959"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1960"><a id="__codelineno-0-1960" name="__codelineno-0-1960"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-1961"><a id="__codelineno-0-1961" name="__codelineno-0-1961"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-1962"><a id="__codelineno-0-1962" name="__codelineno-0-1962"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1963"><a id="__codelineno-0-1963" name="__codelineno-0-1963"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1964"><a id="__codelineno-0-1964" name="__codelineno-0-1964"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-1965"><a id="__codelineno-0-1965" name="__codelineno-0-1965"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1966"><a id="__codelineno-0-1966" name="__codelineno-0-1966"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-1967"><a id="__codelineno-0-1967" name="__codelineno-0-1967"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id."</span><span class="p">)</span>
</span><span id="__span-0-1968"><a id="__codelineno-0-1968" name="__codelineno-0-1968"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1969"><a id="__codelineno-0-1969" name="__codelineno-0-1969"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1970"><a id="__codelineno-0-1970" name="__codelineno-0-1970"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-1971"><a id="__codelineno-0-1971" name="__codelineno-0-1971"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1972"><a id="__codelineno-0-1972" name="__codelineno-0-1972"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1973"><a id="__codelineno-0-1973" name="__codelineno-0-1973"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1974"><a id="__codelineno-0-1974" name="__codelineno-0-1974"></a>
</span><span id="__span-0-1975"><a id="__codelineno-0-1975" name="__codelineno-0-1975"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1976"><a id="__codelineno-0-1976" name="__codelineno-0-1976"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-1977"><a id="__codelineno-0-1977" name="__codelineno-0-1977"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-1978"><a id="__codelineno-0-1978" name="__codelineno-0-1978"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1979"><a id="__codelineno-0-1979" name="__codelineno-0-1979"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1980"><a id="__codelineno-0-1980" name="__codelineno-0-1980"></a>            <span class="n">bit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-1981"><a id="__codelineno-0-1981" name="__codelineno-0-1981"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1982"><a id="__codelineno-0-1982" name="__codelineno-0-1982"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-1983"><a id="__codelineno-0-1983" name="__codelineno-0-1983"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id."</span><span class="p">)</span>
</span><span id="__span-0-1984"><a id="__codelineno-0-1984" name="__codelineno-0-1984"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1985"><a id="__codelineno-0-1985" name="__codelineno-0-1985"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1986"><a id="__codelineno-0-1986" name="__codelineno-0-1986"></a>            <span class="n">bit_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-1987"><a id="__codelineno-0-1987" name="__codelineno-0-1987"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1988"><a id="__codelineno-0-1988" name="__codelineno-0-1988"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1989"><a id="__codelineno-0-1989" name="__codelineno-0-1989"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1990"><a id="__codelineno-0-1990" name="__codelineno-0-1990"></a>
</span><span id="__span-0-1991"><a id="__codelineno-0-1991" name="__codelineno-0-1991"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1992"><a id="__codelineno-0-1992" name="__codelineno-0-1992"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1993"><a id="__codelineno-0-1993" name="__codelineno-0-1993"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-1994"><a id="__codelineno-0-1994" name="__codelineno-0-1994"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1995"><a id="__codelineno-0-1995" name="__codelineno-0-1995"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1996"><a id="__codelineno-0-1996" name="__codelineno-0-1996"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1997"><a id="__codelineno-0-1997" name="__codelineno-0-1997"></a>        <span class="p">)</span>
</span><span id="__span-0-1998"><a id="__codelineno-0-1998" name="__codelineno-0-1998"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1999"><a id="__codelineno-0-1999" name="__codelineno-0-1999"></a>        <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"round_linker"</span><span class="p">])</span>
</span><span id="__span-0-2000"><a id="__codelineno-0-2000" name="__codelineno-0-2000"></a>    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="__span-0-2001"><a id="__codelineno-0-2001" name="__codelineno-0-2001"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">bit_id</span><span class="p">)</span>
</span><span id="__span-0-2002"><a id="__codelineno-0-2002" name="__codelineno-0-2002"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Round linker attribute not found."</span><span class="p">)</span>
</span><span id="__span-0-2003"><a id="__codelineno-0-2003" name="__codelineno-0-2003"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_stage_position_zyx_um"> <code class="highlight language-python"><span class="n">load_local_stage_position_zyx_um</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Load tile stage position for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>stage_zyx_um</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile stage position for one tile.</p> </div> </td> </tr> <tr class="doc-section-item"> <td><code>affine_zyx_um</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Affine transformation between stage and camera</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2070">2070</a></span>
<span class="normal"><a href="#__codelineno-0-2071">2071</a></span>
<span class="normal"><a href="#__codelineno-0-2072">2072</a></span>
<span class="normal"><a href="#__codelineno-0-2073">2073</a></span>
<span class="normal"><a href="#__codelineno-0-2074">2074</a></span>
<span class="normal"><a href="#__codelineno-0-2075">2075</a></span>
<span class="normal"><a href="#__codelineno-0-2076">2076</a></span>
<span class="normal"><a href="#__codelineno-0-2077">2077</a></span>
<span class="normal"><a href="#__codelineno-0-2078">2078</a></span>
<span class="normal"><a href="#__codelineno-0-2079">2079</a></span>
<span class="normal"><a href="#__codelineno-0-2080">2080</a></span>
<span class="normal"><a href="#__codelineno-0-2081">2081</a></span>
<span class="normal"><a href="#__codelineno-0-2082">2082</a></span>
<span class="normal"><a href="#__codelineno-0-2083">2083</a></span>
<span class="normal"><a href="#__codelineno-0-2084">2084</a></span>
<span class="normal"><a href="#__codelineno-0-2085">2085</a></span>
<span class="normal"><a href="#__codelineno-0-2086">2086</a></span>
<span class="normal"><a href="#__codelineno-0-2087">2087</a></span>
<span class="normal"><a href="#__codelineno-0-2088">2088</a></span>
<span class="normal"><a href="#__codelineno-0-2089">2089</a></span>
<span class="normal"><a href="#__codelineno-0-2090">2090</a></span>
<span class="normal"><a href="#__codelineno-0-2091">2091</a></span>
<span class="normal"><a href="#__codelineno-0-2092">2092</a></span>
<span class="normal"><a href="#__codelineno-0-2093">2093</a></span>
<span class="normal"><a href="#__codelineno-0-2094">2094</a></span>
<span class="normal"><a href="#__codelineno-0-2095">2095</a></span>
<span class="normal"><a href="#__codelineno-0-2096">2096</a></span>
<span class="normal"><a href="#__codelineno-0-2097">2097</a></span>
<span class="normal"><a href="#__codelineno-0-2098">2098</a></span>
<span class="normal"><a href="#__codelineno-0-2099">2099</a></span>
<span class="normal"><a href="#__codelineno-0-2100">2100</a></span>
<span class="normal"><a href="#__codelineno-0-2101">2101</a></span>
<span class="normal"><a href="#__codelineno-0-2102">2102</a></span>
<span class="normal"><a href="#__codelineno-0-2103">2103</a></span>
<span class="normal"><a href="#__codelineno-0-2104">2104</a></span>
<span class="normal"><a href="#__codelineno-0-2105">2105</a></span>
<span class="normal"><a href="#__codelineno-0-2106">2106</a></span>
<span class="normal"><a href="#__codelineno-0-2107">2107</a></span>
<span class="normal"><a href="#__codelineno-0-2108">2108</a></span>
<span class="normal"><a href="#__codelineno-0-2109">2109</a></span>
<span class="normal"><a href="#__codelineno-0-2110">2110</a></span>
<span class="normal"><a href="#__codelineno-0-2111">2111</a></span>
<span class="normal"><a href="#__codelineno-0-2112">2112</a></span>
<span class="normal"><a href="#__codelineno-0-2113">2113</a></span>
<span class="normal"><a href="#__codelineno-0-2114">2114</a></span>
<span class="normal"><a href="#__codelineno-0-2115">2115</a></span>
<span class="normal"><a href="#__codelineno-0-2116">2116</a></span>
<span class="normal"><a href="#__codelineno-0-2117">2117</a></span>
<span class="normal"><a href="#__codelineno-0-2118">2118</a></span>
<span class="normal"><a href="#__codelineno-0-2119">2119</a></span>
<span class="normal"><a href="#__codelineno-0-2120">2120</a></span>
<span class="normal"><a href="#__codelineno-0-2121">2121</a></span>
<span class="normal"><a href="#__codelineno-0-2122">2122</a></span>
<span class="normal"><a href="#__codelineno-0-2123">2123</a></span>
<span class="normal"><a href="#__codelineno-0-2124">2124</a></span>
<span class="normal"><a href="#__codelineno-0-2125">2125</a></span>
<span class="normal"><a href="#__codelineno-0-2126">2126</a></span>
<span class="normal"><a href="#__codelineno-0-2127">2127</a></span>
<span class="normal"><a href="#__codelineno-0-2128">2128</a></span>
<span class="normal"><a href="#__codelineno-0-2129">2129</a></span>
<span class="normal"><a href="#__codelineno-0-2130">2130</a></span>
<span class="normal"><a href="#__codelineno-0-2131">2131</a></span>
<span class="normal"><a href="#__codelineno-0-2132">2132</a></span>
<span class="normal"><a href="#__codelineno-0-2133">2133</a></span>
<span class="normal"><a href="#__codelineno-0-2134">2134</a></span>
<span class="normal"><a href="#__codelineno-0-2135">2135</a></span>
<span class="normal"><a href="#__codelineno-0-2136">2136</a></span>
<span class="normal"><a href="#__codelineno-0-2137">2137</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2070"><a id="__codelineno-0-2070" name="__codelineno-0-2070"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_local_stage_position_zyx_um</span><span class="p">(</span>
</span><span id="__span-0-2071"><a id="__codelineno-0-2071" name="__codelineno-0-2071"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2072"><a id="__codelineno-0-2072" name="__codelineno-0-2072"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2073"><a id="__codelineno-0-2073" name="__codelineno-0-2073"></a>    <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2074"><a id="__codelineno-0-2074" name="__codelineno-0-2074"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-2075"><a id="__codelineno-0-2075" name="__codelineno-0-2075"></a><span class="w">    </span><span class="sd">"""Load tile stage position for one tile.</span>
</span><span id="__span-0-2076"><a id="__codelineno-0-2076" name="__codelineno-0-2076"></a>
</span><span id="__span-0-2077"><a id="__codelineno-0-2077" name="__codelineno-0-2077"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-2078"><a id="__codelineno-0-2078" name="__codelineno-0-2078"></a><span class="sd">    ----------</span>
</span><span id="__span-0-2079"><a id="__codelineno-0-2079" name="__codelineno-0-2079"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-2080"><a id="__codelineno-0-2080" name="__codelineno-0-2080"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-2081"><a id="__codelineno-0-2081" name="__codelineno-0-2081"></a><span class="sd">    round : Union[int, str]</span>
</span><span id="__span-0-2082"><a id="__codelineno-0-2082" name="__codelineno-0-2082"></a><span class="sd">        Round index or round id.</span>
</span><span id="__span-0-2083"><a id="__codelineno-0-2083" name="__codelineno-0-2083"></a>
</span><span id="__span-0-2084"><a id="__codelineno-0-2084" name="__codelineno-0-2084"></a><span class="sd">    Returns</span>
</span><span id="__span-0-2085"><a id="__codelineno-0-2085" name="__codelineno-0-2085"></a><span class="sd">    -------</span>
</span><span id="__span-0-2086"><a id="__codelineno-0-2086" name="__codelineno-0-2086"></a><span class="sd">    stage_zyx_um : Optional[ArrayLike]</span>
</span><span id="__span-0-2087"><a id="__codelineno-0-2087" name="__codelineno-0-2087"></a><span class="sd">        Tile stage position for one tile.</span>
</span><span id="__span-0-2088"><a id="__codelineno-0-2088" name="__codelineno-0-2088"></a><span class="sd">    affine_zyx_um: Optional[ArrayLike]</span>
</span><span id="__span-0-2089"><a id="__codelineno-0-2089" name="__codelineno-0-2089"></a><span class="sd">        Affine transformation between stage and camera</span>
</span><span id="__span-0-2090"><a id="__codelineno-0-2090" name="__codelineno-0-2090"></a><span class="sd">    """</span>
</span><span id="__span-0-2091"><a id="__codelineno-0-2091" name="__codelineno-0-2091"></a>
</span><span id="__span-0-2092"><a id="__codelineno-0-2092" name="__codelineno-0-2092"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2093"><a id="__codelineno-0-2093" name="__codelineno-0-2093"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2094"><a id="__codelineno-0-2094" name="__codelineno-0-2094"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2095"><a id="__codelineno-0-2095" name="__codelineno-0-2095"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2096"><a id="__codelineno-0-2096" name="__codelineno-0-2096"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2097"><a id="__codelineno-0-2097" name="__codelineno-0-2097"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2098"><a id="__codelineno-0-2098" name="__codelineno-0-2098"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2099"><a id="__codelineno-0-2099" name="__codelineno-0-2099"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2100"><a id="__codelineno-0-2100" name="__codelineno-0-2100"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id."</span><span class="p">)</span>
</span><span id="__span-0-2101"><a id="__codelineno-0-2101" name="__codelineno-0-2101"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2102"><a id="__codelineno-0-2102" name="__codelineno-0-2102"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2103"><a id="__codelineno-0-2103" name="__codelineno-0-2103"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2104"><a id="__codelineno-0-2104" name="__codelineno-0-2104"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2105"><a id="__codelineno-0-2105" name="__codelineno-0-2105"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2106"><a id="__codelineno-0-2106" name="__codelineno-0-2106"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2107"><a id="__codelineno-0-2107" name="__codelineno-0-2107"></a>
</span><span id="__span-0-2108"><a id="__codelineno-0-2108" name="__codelineno-0-2108"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2109"><a id="__codelineno-0-2109" name="__codelineno-0-2109"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2110"><a id="__codelineno-0-2110" name="__codelineno-0-2110"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2111"><a id="__codelineno-0-2111" name="__codelineno-0-2111"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2112"><a id="__codelineno-0-2112" name="__codelineno-0-2112"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2113"><a id="__codelineno-0-2113" name="__codelineno-0-2113"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2114"><a id="__codelineno-0-2114" name="__codelineno-0-2114"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2115"><a id="__codelineno-0-2115" name="__codelineno-0-2115"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2116"><a id="__codelineno-0-2116" name="__codelineno-0-2116"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id."</span><span class="p">)</span>
</span><span id="__span-0-2117"><a id="__codelineno-0-2117" name="__codelineno-0-2117"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2118"><a id="__codelineno-0-2118" name="__codelineno-0-2118"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2119"><a id="__codelineno-0-2119" name="__codelineno-0-2119"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2120"><a id="__codelineno-0-2120" name="__codelineno-0-2120"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2121"><a id="__codelineno-0-2121" name="__codelineno-0-2121"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2122"><a id="__codelineno-0-2122" name="__codelineno-0-2122"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2123"><a id="__codelineno-0-2123" name="__codelineno-0-2123"></a>
</span><span id="__span-0-2124"><a id="__codelineno-0-2124" name="__codelineno-0-2124"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2125"><a id="__codelineno-0-2125" name="__codelineno-0-2125"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2126"><a id="__codelineno-0-2126" name="__codelineno-0-2126"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2127"><a id="__codelineno-0-2127" name="__codelineno-0-2127"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2128"><a id="__codelineno-0-2128" name="__codelineno-0-2128"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2129"><a id="__codelineno-0-2129" name="__codelineno-0-2129"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2130"><a id="__codelineno-0-2130" name="__codelineno-0-2130"></a>        <span class="p">)</span>
</span><span id="__span-0-2131"><a id="__codelineno-0-2131" name="__codelineno-0-2131"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2132"><a id="__codelineno-0-2132" name="__codelineno-0-2132"></a>        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"stage_zyx_um"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">),</span>\
</span><span id="__span-0-2133"><a id="__codelineno-0-2133" name="__codelineno-0-2133"></a>            <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">attributes</span><span class="p">[</span><span class="s2">"affine_zyx_px"</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="__span-0-2134"><a id="__codelineno-0-2134" name="__codelineno-0-2134"></a>    <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
</span><span id="__span-0-2135"><a id="__codelineno-0-2135" name="__codelineno-0-2135"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-2136"><a id="__codelineno-0-2136" name="__codelineno-0-2136"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Stage position attribute not found."</span><span class="p">)</span>
</span><span id="__span-0-2137"><a id="__codelineno-0-2137" name="__codelineno-0-2137"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_ufish_image"> <code class="highlight language-python"><span class="n">load_local_ufish_image</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">bit</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Load readout bit U-FISH prediction image for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>bit</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Bit index or bit id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code> </td> <td> <div class="doc-md-description"> </div> </td> <td> <code>True</code> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>registered_ufish_image</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>U-FISH prediction image for one tile.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3220">3220</a></span>
<span class="normal"><a href="#__codelineno-0-3221">3221</a></span>
<span class="normal"><a href="#__codelineno-0-3222">3222</a></span>
<span class="normal"><a href="#__codelineno-0-3223">3223</a></span>
<span class="normal"><a href="#__codelineno-0-3224">3224</a></span>
<span class="normal"><a href="#__codelineno-0-3225">3225</a></span>
<span class="normal"><a href="#__codelineno-0-3226">3226</a></span>
<span class="normal"><a href="#__codelineno-0-3227">3227</a></span>
<span class="normal"><a href="#__codelineno-0-3228">3228</a></span>
<span class="normal"><a href="#__codelineno-0-3229">3229</a></span>
<span class="normal"><a href="#__codelineno-0-3230">3230</a></span>
<span class="normal"><a href="#__codelineno-0-3231">3231</a></span>
<span class="normal"><a href="#__codelineno-0-3232">3232</a></span>
<span class="normal"><a href="#__codelineno-0-3233">3233</a></span>
<span class="normal"><a href="#__codelineno-0-3234">3234</a></span>
<span class="normal"><a href="#__codelineno-0-3235">3235</a></span>
<span class="normal"><a href="#__codelineno-0-3236">3236</a></span>
<span class="normal"><a href="#__codelineno-0-3237">3237</a></span>
<span class="normal"><a href="#__codelineno-0-3238">3238</a></span>
<span class="normal"><a href="#__codelineno-0-3239">3239</a></span>
<span class="normal"><a href="#__codelineno-0-3240">3240</a></span>
<span class="normal"><a href="#__codelineno-0-3241">3241</a></span>
<span class="normal"><a href="#__codelineno-0-3242">3242</a></span>
<span class="normal"><a href="#__codelineno-0-3243">3243</a></span>
<span class="normal"><a href="#__codelineno-0-3244">3244</a></span>
<span class="normal"><a href="#__codelineno-0-3245">3245</a></span>
<span class="normal"><a href="#__codelineno-0-3246">3246</a></span>
<span class="normal"><a href="#__codelineno-0-3247">3247</a></span>
<span class="normal"><a href="#__codelineno-0-3248">3248</a></span>
<span class="normal"><a href="#__codelineno-0-3249">3249</a></span>
<span class="normal"><a href="#__codelineno-0-3250">3250</a></span>
<span class="normal"><a href="#__codelineno-0-3251">3251</a></span>
<span class="normal"><a href="#__codelineno-0-3252">3252</a></span>
<span class="normal"><a href="#__codelineno-0-3253">3253</a></span>
<span class="normal"><a href="#__codelineno-0-3254">3254</a></span>
<span class="normal"><a href="#__codelineno-0-3255">3255</a></span>
<span class="normal"><a href="#__codelineno-0-3256">3256</a></span>
<span class="normal"><a href="#__codelineno-0-3257">3257</a></span>
<span class="normal"><a href="#__codelineno-0-3258">3258</a></span>
<span class="normal"><a href="#__codelineno-0-3259">3259</a></span>
<span class="normal"><a href="#__codelineno-0-3260">3260</a></span>
<span class="normal"><a href="#__codelineno-0-3261">3261</a></span>
<span class="normal"><a href="#__codelineno-0-3262">3262</a></span>
<span class="normal"><a href="#__codelineno-0-3263">3263</a></span>
<span class="normal"><a href="#__codelineno-0-3264">3264</a></span>
<span class="normal"><a href="#__codelineno-0-3265">3265</a></span>
<span class="normal"><a href="#__codelineno-0-3266">3266</a></span>
<span class="normal"><a href="#__codelineno-0-3267">3267</a></span>
<span class="normal"><a href="#__codelineno-0-3268">3268</a></span>
<span class="normal"><a href="#__codelineno-0-3269">3269</a></span>
<span class="normal"><a href="#__codelineno-0-3270">3270</a></span>
<span class="normal"><a href="#__codelineno-0-3271">3271</a></span>
<span class="normal"><a href="#__codelineno-0-3272">3272</a></span>
<span class="normal"><a href="#__codelineno-0-3273">3273</a></span>
<span class="normal"><a href="#__codelineno-0-3274">3274</a></span>
<span class="normal"><a href="#__codelineno-0-3275">3275</a></span>
<span class="normal"><a href="#__codelineno-0-3276">3276</a></span>
<span class="normal"><a href="#__codelineno-0-3277">3277</a></span>
<span class="normal"><a href="#__codelineno-0-3278">3278</a></span>
<span class="normal"><a href="#__codelineno-0-3279">3279</a></span>
<span class="normal"><a href="#__codelineno-0-3280">3280</a></span>
<span class="normal"><a href="#__codelineno-0-3281">3281</a></span>
<span class="normal"><a href="#__codelineno-0-3282">3282</a></span>
<span class="normal"><a href="#__codelineno-0-3283">3283</a></span>
<span class="normal"><a href="#__codelineno-0-3284">3284</a></span>
<span class="normal"><a href="#__codelineno-0-3285">3285</a></span>
<span class="normal"><a href="#__codelineno-0-3286">3286</a></span>
<span class="normal"><a href="#__codelineno-0-3287">3287</a></span>
<span class="normal"><a href="#__codelineno-0-3288">3288</a></span>
<span class="normal"><a href="#__codelineno-0-3289">3289</a></span>
<span class="normal"><a href="#__codelineno-0-3290">3290</a></span>
<span class="normal"><a href="#__codelineno-0-3291">3291</a></span>
<span class="normal"><a href="#__codelineno-0-3292">3292</a></span>
<span class="normal"><a href="#__codelineno-0-3293">3293</a></span>
<span class="normal"><a href="#__codelineno-0-3294">3294</a></span>
<span class="normal"><a href="#__codelineno-0-3295">3295</a></span>
<span class="normal"><a href="#__codelineno-0-3296">3296</a></span>
<span class="normal"><a href="#__codelineno-0-3297">3297</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3220"><a id="__codelineno-0-3220" name="__codelineno-0-3220"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_local_ufish_image</span><span class="p">(</span>
</span><span id="__span-0-3221"><a id="__codelineno-0-3221" name="__codelineno-0-3221"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3222"><a id="__codelineno-0-3222" name="__codelineno-0-3222"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3223"><a id="__codelineno-0-3223" name="__codelineno-0-3223"></a>    <span class="n">bit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3224"><a id="__codelineno-0-3224" name="__codelineno-0-3224"></a>    <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-3225"><a id="__codelineno-0-3225" name="__codelineno-0-3225"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-3226"><a id="__codelineno-0-3226" name="__codelineno-0-3226"></a><span class="w">    </span><span class="sd">"""Load readout bit U-FISH prediction image for one tile.</span>
</span><span id="__span-0-3227"><a id="__codelineno-0-3227" name="__codelineno-0-3227"></a>
</span><span id="__span-0-3228"><a id="__codelineno-0-3228" name="__codelineno-0-3228"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3229"><a id="__codelineno-0-3229" name="__codelineno-0-3229"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3230"><a id="__codelineno-0-3230" name="__codelineno-0-3230"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-3231"><a id="__codelineno-0-3231" name="__codelineno-0-3231"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-3232"><a id="__codelineno-0-3232" name="__codelineno-0-3232"></a><span class="sd">    bit : Union[int, str]</span>
</span><span id="__span-0-3233"><a id="__codelineno-0-3233" name="__codelineno-0-3233"></a><span class="sd">        Bit index or bit id.</span>
</span><span id="__span-0-3234"><a id="__codelineno-0-3234" name="__codelineno-0-3234"></a><span class="sd">    return_future : Optional[bool]</span>
</span><span id="__span-0-3235"><a id="__codelineno-0-3235" name="__codelineno-0-3235"></a>
</span><span id="__span-0-3236"><a id="__codelineno-0-3236" name="__codelineno-0-3236"></a><span class="sd">    Returns</span>
</span><span id="__span-0-3237"><a id="__codelineno-0-3237" name="__codelineno-0-3237"></a><span class="sd">    -------</span>
</span><span id="__span-0-3238"><a id="__codelineno-0-3238" name="__codelineno-0-3238"></a><span class="sd">    registered_ufish_image : Optional[ArrayLike]</span>
</span><span id="__span-0-3239"><a id="__codelineno-0-3239" name="__codelineno-0-3239"></a><span class="sd">        U-FISH prediction image for one tile.</span>
</span><span id="__span-0-3240"><a id="__codelineno-0-3240" name="__codelineno-0-3240"></a><span class="sd">    """</span>
</span><span id="__span-0-3241"><a id="__codelineno-0-3241" name="__codelineno-0-3241"></a>
</span><span id="__span-0-3242"><a id="__codelineno-0-3242" name="__codelineno-0-3242"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3243"><a id="__codelineno-0-3243" name="__codelineno-0-3243"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3244"><a id="__codelineno-0-3244" name="__codelineno-0-3244"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3245"><a id="__codelineno-0-3245" name="__codelineno-0-3245"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3246"><a id="__codelineno-0-3246" name="__codelineno-0-3246"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3247"><a id="__codelineno-0-3247" name="__codelineno-0-3247"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3248"><a id="__codelineno-0-3248" name="__codelineno-0-3248"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3249"><a id="__codelineno-0-3249" name="__codelineno-0-3249"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3250"><a id="__codelineno-0-3250" name="__codelineno-0-3250"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3251"><a id="__codelineno-0-3251" name="__codelineno-0-3251"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3252"><a id="__codelineno-0-3252" name="__codelineno-0-3252"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3253"><a id="__codelineno-0-3253" name="__codelineno-0-3253"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3254"><a id="__codelineno-0-3254" name="__codelineno-0-3254"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3255"><a id="__codelineno-0-3255" name="__codelineno-0-3255"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3256"><a id="__codelineno-0-3256" name="__codelineno-0-3256"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3257"><a id="__codelineno-0-3257" name="__codelineno-0-3257"></a>
</span><span id="__span-0-3258"><a id="__codelineno-0-3258" name="__codelineno-0-3258"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3259"><a id="__codelineno-0-3259" name="__codelineno-0-3259"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-3260"><a id="__codelineno-0-3260" name="__codelineno-0-3260"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-3261"><a id="__codelineno-0-3261" name="__codelineno-0-3261"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3262"><a id="__codelineno-0-3262" name="__codelineno-0-3262"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3263"><a id="__codelineno-0-3263" name="__codelineno-0-3263"></a>            <span class="n">bit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-3264"><a id="__codelineno-0-3264" name="__codelineno-0-3264"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3265"><a id="__codelineno-0-3265" name="__codelineno-0-3265"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-3266"><a id="__codelineno-0-3266" name="__codelineno-0-3266"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-3267"><a id="__codelineno-0-3267" name="__codelineno-0-3267"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3268"><a id="__codelineno-0-3268" name="__codelineno-0-3268"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3269"><a id="__codelineno-0-3269" name="__codelineno-0-3269"></a>            <span class="n">bit_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-3270"><a id="__codelineno-0-3270" name="__codelineno-0-3270"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3271"><a id="__codelineno-0-3271" name="__codelineno-0-3271"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3272"><a id="__codelineno-0-3272" name="__codelineno-0-3272"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3273"><a id="__codelineno-0-3273" name="__codelineno-0-3273"></a>
</span><span id="__span-0-3274"><a id="__codelineno-0-3274" name="__codelineno-0-3274"></a>    <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3275"><a id="__codelineno-0-3275" name="__codelineno-0-3275"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-3276"><a id="__codelineno-0-3276" name="__codelineno-0-3276"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3277"><a id="__codelineno-0-3277" name="__codelineno-0-3277"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3278"><a id="__codelineno-0-3278" name="__codelineno-0-3278"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_ufish_data"</span><span class="p">)</span>
</span><span id="__span-0-3279"><a id="__codelineno-0-3279" name="__codelineno-0-3279"></a>    <span class="p">)</span>
</span><span id="__span-0-3280"><a id="__codelineno-0-3280" name="__codelineno-0-3280"></a>
</span><span id="__span-0-3281"><a id="__codelineno-0-3281" name="__codelineno-0-3281"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">Path</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3282"><a id="__codelineno-0-3282" name="__codelineno-0-3282"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"U-FISH prediction image not found."</span><span class="p">)</span>
</span><span id="__span-0-3283"><a id="__codelineno-0-3283" name="__codelineno-0-3283"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3284"><a id="__codelineno-0-3284" name="__codelineno-0-3284"></a>
</span><span id="__span-0-3285"><a id="__codelineno-0-3285" name="__codelineno-0-3285"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3286"><a id="__codelineno-0-3286" name="__codelineno-0-3286"></a>        <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-0-3287"><a id="__codelineno-0-3287" name="__codelineno-0-3287"></a>        <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"&lt;f4"</span>
</span><span id="__span-0-3288"><a id="__codelineno-0-3288" name="__codelineno-0-3288"></a>        <span class="n">registered_ufish_image</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3289"><a id="__codelineno-0-3289" name="__codelineno-0-3289"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3290"><a id="__codelineno-0-3290" name="__codelineno-0-3290"></a>            <span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-3291"><a id="__codelineno-0-3291" name="__codelineno-0-3291"></a>            <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3292"><a id="__codelineno-0-3292" name="__codelineno-0-3292"></a>        <span class="p">)</span>
</span><span id="__span-0-3293"><a id="__codelineno-0-3293" name="__codelineno-0-3293"></a>        <span class="k">return</span> <span class="n">registered_ufish_image</span>
</span><span id="__span-0-3294"><a id="__codelineno-0-3294" name="__codelineno-0-3294"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-3295"><a id="__codelineno-0-3295" name="__codelineno-0-3295"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-3296"><a id="__codelineno-0-3296" name="__codelineno-0-3296"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error loading U-FISH image."</span><span class="p">)</span>
</span><span id="__span-0-3297"><a id="__codelineno-0-3297" name="__codelineno-0-3297"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_ufish_spots"> <code class="highlight language-python"><span class="n">load_local_ufish_spots</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">bit</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Load U-FISH spot localizations and features for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>bit</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Bit index or bit id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>ufish_localizations</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="pandas.DataFrame">DataFrame</span>]</code> </td> <td> <div class="doc-md-description"> <p>U-FISH localizations and features for one tile.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3371">3371</a></span>
<span class="normal"><a href="#__codelineno-0-3372">3372</a></span>
<span class="normal"><a href="#__codelineno-0-3373">3373</a></span>
<span class="normal"><a href="#__codelineno-0-3374">3374</a></span>
<span class="normal"><a href="#__codelineno-0-3375">3375</a></span>
<span class="normal"><a href="#__codelineno-0-3376">3376</a></span>
<span class="normal"><a href="#__codelineno-0-3377">3377</a></span>
<span class="normal"><a href="#__codelineno-0-3378">3378</a></span>
<span class="normal"><a href="#__codelineno-0-3379">3379</a></span>
<span class="normal"><a href="#__codelineno-0-3380">3380</a></span>
<span class="normal"><a href="#__codelineno-0-3381">3381</a></span>
<span class="normal"><a href="#__codelineno-0-3382">3382</a></span>
<span class="normal"><a href="#__codelineno-0-3383">3383</a></span>
<span class="normal"><a href="#__codelineno-0-3384">3384</a></span>
<span class="normal"><a href="#__codelineno-0-3385">3385</a></span>
<span class="normal"><a href="#__codelineno-0-3386">3386</a></span>
<span class="normal"><a href="#__codelineno-0-3387">3387</a></span>
<span class="normal"><a href="#__codelineno-0-3388">3388</a></span>
<span class="normal"><a href="#__codelineno-0-3389">3389</a></span>
<span class="normal"><a href="#__codelineno-0-3390">3390</a></span>
<span class="normal"><a href="#__codelineno-0-3391">3391</a></span>
<span class="normal"><a href="#__codelineno-0-3392">3392</a></span>
<span class="normal"><a href="#__codelineno-0-3393">3393</a></span>
<span class="normal"><a href="#__codelineno-0-3394">3394</a></span>
<span class="normal"><a href="#__codelineno-0-3395">3395</a></span>
<span class="normal"><a href="#__codelineno-0-3396">3396</a></span>
<span class="normal"><a href="#__codelineno-0-3397">3397</a></span>
<span class="normal"><a href="#__codelineno-0-3398">3398</a></span>
<span class="normal"><a href="#__codelineno-0-3399">3399</a></span>
<span class="normal"><a href="#__codelineno-0-3400">3400</a></span>
<span class="normal"><a href="#__codelineno-0-3401">3401</a></span>
<span class="normal"><a href="#__codelineno-0-3402">3402</a></span>
<span class="normal"><a href="#__codelineno-0-3403">3403</a></span>
<span class="normal"><a href="#__codelineno-0-3404">3404</a></span>
<span class="normal"><a href="#__codelineno-0-3405">3405</a></span>
<span class="normal"><a href="#__codelineno-0-3406">3406</a></span>
<span class="normal"><a href="#__codelineno-0-3407">3407</a></span>
<span class="normal"><a href="#__codelineno-0-3408">3408</a></span>
<span class="normal"><a href="#__codelineno-0-3409">3409</a></span>
<span class="normal"><a href="#__codelineno-0-3410">3410</a></span>
<span class="normal"><a href="#__codelineno-0-3411">3411</a></span>
<span class="normal"><a href="#__codelineno-0-3412">3412</a></span>
<span class="normal"><a href="#__codelineno-0-3413">3413</a></span>
<span class="normal"><a href="#__codelineno-0-3414">3414</a></span>
<span class="normal"><a href="#__codelineno-0-3415">3415</a></span>
<span class="normal"><a href="#__codelineno-0-3416">3416</a></span>
<span class="normal"><a href="#__codelineno-0-3417">3417</a></span>
<span class="normal"><a href="#__codelineno-0-3418">3418</a></span>
<span class="normal"><a href="#__codelineno-0-3419">3419</a></span>
<span class="normal"><a href="#__codelineno-0-3420">3420</a></span>
<span class="normal"><a href="#__codelineno-0-3421">3421</a></span>
<span class="normal"><a href="#__codelineno-0-3422">3422</a></span>
<span class="normal"><a href="#__codelineno-0-3423">3423</a></span>
<span class="normal"><a href="#__codelineno-0-3424">3424</a></span>
<span class="normal"><a href="#__codelineno-0-3425">3425</a></span>
<span class="normal"><a href="#__codelineno-0-3426">3426</a></span>
<span class="normal"><a href="#__codelineno-0-3427">3427</a></span>
<span class="normal"><a href="#__codelineno-0-3428">3428</a></span>
<span class="normal"><a href="#__codelineno-0-3429">3429</a></span>
<span class="normal"><a href="#__codelineno-0-3430">3430</a></span>
<span class="normal"><a href="#__codelineno-0-3431">3431</a></span>
<span class="normal"><a href="#__codelineno-0-3432">3432</a></span>
<span class="normal"><a href="#__codelineno-0-3433">3433</a></span>
<span class="normal"><a href="#__codelineno-0-3434">3434</a></span>
<span class="normal"><a href="#__codelineno-0-3435">3435</a></span>
<span class="normal"><a href="#__codelineno-0-3436">3436</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3371"><a id="__codelineno-0-3371" name="__codelineno-0-3371"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_local_ufish_spots</span><span class="p">(</span>
</span><span id="__span-0-3372"><a id="__codelineno-0-3372" name="__codelineno-0-3372"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3373"><a id="__codelineno-0-3373" name="__codelineno-0-3373"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3374"><a id="__codelineno-0-3374" name="__codelineno-0-3374"></a>    <span class="n">bit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3375"><a id="__codelineno-0-3375" name="__codelineno-0-3375"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
</span><span id="__span-0-3376"><a id="__codelineno-0-3376" name="__codelineno-0-3376"></a><span class="w">    </span><span class="sd">"""Load U-FISH spot localizations and features for one tile.</span>
</span><span id="__span-0-3377"><a id="__codelineno-0-3377" name="__codelineno-0-3377"></a>
</span><span id="__span-0-3378"><a id="__codelineno-0-3378" name="__codelineno-0-3378"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3379"><a id="__codelineno-0-3379" name="__codelineno-0-3379"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3380"><a id="__codelineno-0-3380" name="__codelineno-0-3380"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-3381"><a id="__codelineno-0-3381" name="__codelineno-0-3381"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-3382"><a id="__codelineno-0-3382" name="__codelineno-0-3382"></a><span class="sd">    bit : Union[int, str]</span>
</span><span id="__span-0-3383"><a id="__codelineno-0-3383" name="__codelineno-0-3383"></a><span class="sd">        Bit index or bit id.</span>
</span><span id="__span-0-3384"><a id="__codelineno-0-3384" name="__codelineno-0-3384"></a>
</span><span id="__span-0-3385"><a id="__codelineno-0-3385" name="__codelineno-0-3385"></a><span class="sd">    Returns</span>
</span><span id="__span-0-3386"><a id="__codelineno-0-3386" name="__codelineno-0-3386"></a><span class="sd">    -------</span>
</span><span id="__span-0-3387"><a id="__codelineno-0-3387" name="__codelineno-0-3387"></a><span class="sd">    ufish_localizations : Optional[pd.DataFrame]</span>
</span><span id="__span-0-3388"><a id="__codelineno-0-3388" name="__codelineno-0-3388"></a><span class="sd">        U-FISH localizations and features for one tile.</span>
</span><span id="__span-0-3389"><a id="__codelineno-0-3389" name="__codelineno-0-3389"></a><span class="sd">    """</span>
</span><span id="__span-0-3390"><a id="__codelineno-0-3390" name="__codelineno-0-3390"></a>
</span><span id="__span-0-3391"><a id="__codelineno-0-3391" name="__codelineno-0-3391"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3392"><a id="__codelineno-0-3392" name="__codelineno-0-3392"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3393"><a id="__codelineno-0-3393" name="__codelineno-0-3393"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3394"><a id="__codelineno-0-3394" name="__codelineno-0-3394"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3395"><a id="__codelineno-0-3395" name="__codelineno-0-3395"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3396"><a id="__codelineno-0-3396" name="__codelineno-0-3396"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3397"><a id="__codelineno-0-3397" name="__codelineno-0-3397"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3398"><a id="__codelineno-0-3398" name="__codelineno-0-3398"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3399"><a id="__codelineno-0-3399" name="__codelineno-0-3399"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3400"><a id="__codelineno-0-3400" name="__codelineno-0-3400"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3401"><a id="__codelineno-0-3401" name="__codelineno-0-3401"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3402"><a id="__codelineno-0-3402" name="__codelineno-0-3402"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3403"><a id="__codelineno-0-3403" name="__codelineno-0-3403"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3404"><a id="__codelineno-0-3404" name="__codelineno-0-3404"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3405"><a id="__codelineno-0-3405" name="__codelineno-0-3405"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3406"><a id="__codelineno-0-3406" name="__codelineno-0-3406"></a>
</span><span id="__span-0-3407"><a id="__codelineno-0-3407" name="__codelineno-0-3407"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3408"><a id="__codelineno-0-3408" name="__codelineno-0-3408"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-3409"><a id="__codelineno-0-3409" name="__codelineno-0-3409"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-3410"><a id="__codelineno-0-3410" name="__codelineno-0-3410"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3411"><a id="__codelineno-0-3411" name="__codelineno-0-3411"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3412"><a id="__codelineno-0-3412" name="__codelineno-0-3412"></a>            <span class="n">bit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-3413"><a id="__codelineno-0-3413" name="__codelineno-0-3413"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3414"><a id="__codelineno-0-3414" name="__codelineno-0-3414"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-3415"><a id="__codelineno-0-3415" name="__codelineno-0-3415"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-3416"><a id="__codelineno-0-3416" name="__codelineno-0-3416"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3417"><a id="__codelineno-0-3417" name="__codelineno-0-3417"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3418"><a id="__codelineno-0-3418" name="__codelineno-0-3418"></a>            <span class="n">bit_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-3419"><a id="__codelineno-0-3419" name="__codelineno-0-3419"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3420"><a id="__codelineno-0-3420" name="__codelineno-0-3420"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3421"><a id="__codelineno-0-3421" name="__codelineno-0-3421"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3422"><a id="__codelineno-0-3422" name="__codelineno-0-3422"></a>
</span><span id="__span-0-3423"><a id="__codelineno-0-3423" name="__codelineno-0-3423"></a>    <span class="n">current_ufish_localizations_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-3424"><a id="__codelineno-0-3424" name="__codelineno-0-3424"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span>
</span><span id="__span-0-3425"><a id="__codelineno-0-3425" name="__codelineno-0-3425"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3426"><a id="__codelineno-0-3426" name="__codelineno-0-3426"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".parquet"</span><span class="p">)</span>
</span><span id="__span-0-3427"><a id="__codelineno-0-3427" name="__codelineno-0-3427"></a>    <span class="p">)</span>
</span><span id="__span-0-3428"><a id="__codelineno-0-3428" name="__codelineno-0-3428"></a>
</span><span id="__span-0-3429"><a id="__codelineno-0-3429" name="__codelineno-0-3429"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">current_ufish_localizations_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3430"><a id="__codelineno-0-3430" name="__codelineno-0-3430"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"U-FISH localizations not found."</span><span class="p">)</span>
</span><span id="__span-0-3431"><a id="__codelineno-0-3431" name="__codelineno-0-3431"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3432"><a id="__codelineno-0-3432" name="__codelineno-0-3432"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3433"><a id="__codelineno-0-3433" name="__codelineno-0-3433"></a>        <span class="n">ufish_localizations</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_parquet</span><span class="p">(</span>
</span><span id="__span-0-3434"><a id="__codelineno-0-3434" name="__codelineno-0-3434"></a>            <span class="n">current_ufish_localizations_path</span>
</span><span id="__span-0-3435"><a id="__codelineno-0-3435" name="__codelineno-0-3435"></a>        <span class="p">)</span>
</span><span id="__span-0-3436"><a id="__codelineno-0-3436" name="__codelineno-0-3436"></a>        <span class="k">return</span> <span class="n">ufish_localizations</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.load_local_wavelengths_um"> <code class="highlight language-python"><span class="n">load_local_wavelengths_um</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bit</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Load wavelengths for fidicual OR readout bit for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class="doc-section-item"> <td> <code>bit</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Bit index or bit id.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>wavelengths_um</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Wavelengths for fidicual OR readout bit for one tile.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2208">2208</a></span>
<span class="normal"><a href="#__codelineno-0-2209">2209</a></span>
<span class="normal"><a href="#__codelineno-0-2210">2210</a></span>
<span class="normal"><a href="#__codelineno-0-2211">2211</a></span>
<span class="normal"><a href="#__codelineno-0-2212">2212</a></span>
<span class="normal"><a href="#__codelineno-0-2213">2213</a></span>
<span class="normal"><a href="#__codelineno-0-2214">2214</a></span>
<span class="normal"><a href="#__codelineno-0-2215">2215</a></span>
<span class="normal"><a href="#__codelineno-0-2216">2216</a></span>
<span class="normal"><a href="#__codelineno-0-2217">2217</a></span>
<span class="normal"><a href="#__codelineno-0-2218">2218</a></span>
<span class="normal"><a href="#__codelineno-0-2219">2219</a></span>
<span class="normal"><a href="#__codelineno-0-2220">2220</a></span>
<span class="normal"><a href="#__codelineno-0-2221">2221</a></span>
<span class="normal"><a href="#__codelineno-0-2222">2222</a></span>
<span class="normal"><a href="#__codelineno-0-2223">2223</a></span>
<span class="normal"><a href="#__codelineno-0-2224">2224</a></span>
<span class="normal"><a href="#__codelineno-0-2225">2225</a></span>
<span class="normal"><a href="#__codelineno-0-2226">2226</a></span>
<span class="normal"><a href="#__codelineno-0-2227">2227</a></span>
<span class="normal"><a href="#__codelineno-0-2228">2228</a></span>
<span class="normal"><a href="#__codelineno-0-2229">2229</a></span>
<span class="normal"><a href="#__codelineno-0-2230">2230</a></span>
<span class="normal"><a href="#__codelineno-0-2231">2231</a></span>
<span class="normal"><a href="#__codelineno-0-2232">2232</a></span>
<span class="normal"><a href="#__codelineno-0-2233">2233</a></span>
<span class="normal"><a href="#__codelineno-0-2234">2234</a></span>
<span class="normal"><a href="#__codelineno-0-2235">2235</a></span>
<span class="normal"><a href="#__codelineno-0-2236">2236</a></span>
<span class="normal"><a href="#__codelineno-0-2237">2237</a></span>
<span class="normal"><a href="#__codelineno-0-2238">2238</a></span>
<span class="normal"><a href="#__codelineno-0-2239">2239</a></span>
<span class="normal"><a href="#__codelineno-0-2240">2240</a></span>
<span class="normal"><a href="#__codelineno-0-2241">2241</a></span>
<span class="normal"><a href="#__codelineno-0-2242">2242</a></span>
<span class="normal"><a href="#__codelineno-0-2243">2243</a></span>
<span class="normal"><a href="#__codelineno-0-2244">2244</a></span>
<span class="normal"><a href="#__codelineno-0-2245">2245</a></span>
<span class="normal"><a href="#__codelineno-0-2246">2246</a></span>
<span class="normal"><a href="#__codelineno-0-2247">2247</a></span>
<span class="normal"><a href="#__codelineno-0-2248">2248</a></span>
<span class="normal"><a href="#__codelineno-0-2249">2249</a></span>
<span class="normal"><a href="#__codelineno-0-2250">2250</a></span>
<span class="normal"><a href="#__codelineno-0-2251">2251</a></span>
<span class="normal"><a href="#__codelineno-0-2252">2252</a></span>
<span class="normal"><a href="#__codelineno-0-2253">2253</a></span>
<span class="normal"><a href="#__codelineno-0-2254">2254</a></span>
<span class="normal"><a href="#__codelineno-0-2255">2255</a></span>
<span class="normal"><a href="#__codelineno-0-2256">2256</a></span>
<span class="normal"><a href="#__codelineno-0-2257">2257</a></span>
<span class="normal"><a href="#__codelineno-0-2258">2258</a></span>
<span class="normal"><a href="#__codelineno-0-2259">2259</a></span>
<span class="normal"><a href="#__codelineno-0-2260">2260</a></span>
<span class="normal"><a href="#__codelineno-0-2261">2261</a></span>
<span class="normal"><a href="#__codelineno-0-2262">2262</a></span>
<span class="normal"><a href="#__codelineno-0-2263">2263</a></span>
<span class="normal"><a href="#__codelineno-0-2264">2264</a></span>
<span class="normal"><a href="#__codelineno-0-2265">2265</a></span>
<span class="normal"><a href="#__codelineno-0-2266">2266</a></span>
<span class="normal"><a href="#__codelineno-0-2267">2267</a></span>
<span class="normal"><a href="#__codelineno-0-2268">2268</a></span>
<span class="normal"><a href="#__codelineno-0-2269">2269</a></span>
<span class="normal"><a href="#__codelineno-0-2270">2270</a></span>
<span class="normal"><a href="#__codelineno-0-2271">2271</a></span>
<span class="normal"><a href="#__codelineno-0-2272">2272</a></span>
<span class="normal"><a href="#__codelineno-0-2273">2273</a></span>
<span class="normal"><a href="#__codelineno-0-2274">2274</a></span>
<span class="normal"><a href="#__codelineno-0-2275">2275</a></span>
<span class="normal"><a href="#__codelineno-0-2276">2276</a></span>
<span class="normal"><a href="#__codelineno-0-2277">2277</a></span>
<span class="normal"><a href="#__codelineno-0-2278">2278</a></span>
<span class="normal"><a href="#__codelineno-0-2279">2279</a></span>
<span class="normal"><a href="#__codelineno-0-2280">2280</a></span>
<span class="normal"><a href="#__codelineno-0-2281">2281</a></span>
<span class="normal"><a href="#__codelineno-0-2282">2282</a></span>
<span class="normal"><a href="#__codelineno-0-2283">2283</a></span>
<span class="normal"><a href="#__codelineno-0-2284">2284</a></span>
<span class="normal"><a href="#__codelineno-0-2285">2285</a></span>
<span class="normal"><a href="#__codelineno-0-2286">2286</a></span>
<span class="normal"><a href="#__codelineno-0-2287">2287</a></span>
<span class="normal"><a href="#__codelineno-0-2288">2288</a></span>
<span class="normal"><a href="#__codelineno-0-2289">2289</a></span>
<span class="normal"><a href="#__codelineno-0-2290">2290</a></span>
<span class="normal"><a href="#__codelineno-0-2291">2291</a></span>
<span class="normal"><a href="#__codelineno-0-2292">2292</a></span>
<span class="normal"><a href="#__codelineno-0-2293">2293</a></span>
<span class="normal"><a href="#__codelineno-0-2294">2294</a></span>
<span class="normal"><a href="#__codelineno-0-2295">2295</a></span>
<span class="normal"><a href="#__codelineno-0-2296">2296</a></span>
<span class="normal"><a href="#__codelineno-0-2297">2297</a></span>
<span class="normal"><a href="#__codelineno-0-2298">2298</a></span>
<span class="normal"><a href="#__codelineno-0-2299">2299</a></span>
<span class="normal"><a href="#__codelineno-0-2300">2300</a></span>
<span class="normal"><a href="#__codelineno-0-2301">2301</a></span>
<span class="normal"><a href="#__codelineno-0-2302">2302</a></span>
<span class="normal"><a href="#__codelineno-0-2303">2303</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2208"><a id="__codelineno-0-2208" name="__codelineno-0-2208"></a><span class="k">def</span><span class="w"> </span><span class="nf">load_local_wavelengths_um</span><span class="p">(</span>
</span><span id="__span-0-2209"><a id="__codelineno-0-2209" name="__codelineno-0-2209"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2210"><a id="__codelineno-0-2210" name="__codelineno-0-2210"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2211"><a id="__codelineno-0-2211" name="__codelineno-0-2211"></a>    <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2212"><a id="__codelineno-0-2212" name="__codelineno-0-2212"></a>    <span class="n">bit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2213"><a id="__codelineno-0-2213" name="__codelineno-0-2213"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
</span><span id="__span-0-2214"><a id="__codelineno-0-2214" name="__codelineno-0-2214"></a><span class="w">    </span><span class="sd">"""Load wavelengths for fidicual OR readout bit for one tile.</span>
</span><span id="__span-0-2215"><a id="__codelineno-0-2215" name="__codelineno-0-2215"></a>
</span><span id="__span-0-2216"><a id="__codelineno-0-2216" name="__codelineno-0-2216"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-2217"><a id="__codelineno-0-2217" name="__codelineno-0-2217"></a><span class="sd">    ----------</span>
</span><span id="__span-0-2218"><a id="__codelineno-0-2218" name="__codelineno-0-2218"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-2219"><a id="__codelineno-0-2219" name="__codelineno-0-2219"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-2220"><a id="__codelineno-0-2220" name="__codelineno-0-2220"></a><span class="sd">    round : Optional[Union[int, str]]   </span>
</span><span id="__span-0-2221"><a id="__codelineno-0-2221" name="__codelineno-0-2221"></a><span class="sd">        Round index or round id.</span>
</span><span id="__span-0-2222"><a id="__codelineno-0-2222" name="__codelineno-0-2222"></a><span class="sd">    bit : Optional[Union[int, str]]</span>
</span><span id="__span-0-2223"><a id="__codelineno-0-2223" name="__codelineno-0-2223"></a><span class="sd">        Bit index or bit id.</span>
</span><span id="__span-0-2224"><a id="__codelineno-0-2224" name="__codelineno-0-2224"></a>
</span><span id="__span-0-2225"><a id="__codelineno-0-2225" name="__codelineno-0-2225"></a><span class="sd">    Returns</span>
</span><span id="__span-0-2226"><a id="__codelineno-0-2226" name="__codelineno-0-2226"></a><span class="sd">    -------</span>
</span><span id="__span-0-2227"><a id="__codelineno-0-2227" name="__codelineno-0-2227"></a><span class="sd">    wavelengths_um : Optional[tuple[float, float]]</span>
</span><span id="__span-0-2228"><a id="__codelineno-0-2228" name="__codelineno-0-2228"></a><span class="sd">        Wavelengths for fidicual OR readout bit for one tile.</span>
</span><span id="__span-0-2229"><a id="__codelineno-0-2229" name="__codelineno-0-2229"></a><span class="sd">    """</span>
</span><span id="__span-0-2230"><a id="__codelineno-0-2230" name="__codelineno-0-2230"></a>
</span><span id="__span-0-2231"><a id="__codelineno-0-2231" name="__codelineno-0-2231"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2232"><a id="__codelineno-0-2232" name="__codelineno-0-2232"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Provide either 'round' or 'bit', but not both"</span><span class="p">)</span>
</span><span id="__span-0-2233"><a id="__codelineno-0-2233" name="__codelineno-0-2233"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2234"><a id="__codelineno-0-2234" name="__codelineno-0-2234"></a>
</span><span id="__span-0-2235"><a id="__codelineno-0-2235" name="__codelineno-0-2235"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2236"><a id="__codelineno-0-2236" name="__codelineno-0-2236"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2237"><a id="__codelineno-0-2237" name="__codelineno-0-2237"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2238"><a id="__codelineno-0-2238" name="__codelineno-0-2238"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2239"><a id="__codelineno-0-2239" name="__codelineno-0-2239"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2240"><a id="__codelineno-0-2240" name="__codelineno-0-2240"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2241"><a id="__codelineno-0-2241" name="__codelineno-0-2241"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2242"><a id="__codelineno-0-2242" name="__codelineno-0-2242"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2243"><a id="__codelineno-0-2243" name="__codelineno-0-2243"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2244"><a id="__codelineno-0-2244" name="__codelineno-0-2244"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2245"><a id="__codelineno-0-2245" name="__codelineno-0-2245"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2246"><a id="__codelineno-0-2246" name="__codelineno-0-2246"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2247"><a id="__codelineno-0-2247" name="__codelineno-0-2247"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2248"><a id="__codelineno-0-2248" name="__codelineno-0-2248"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2249"><a id="__codelineno-0-2249" name="__codelineno-0-2249"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2250"><a id="__codelineno-0-2250" name="__codelineno-0-2250"></a>
</span><span id="__span-0-2251"><a id="__codelineno-0-2251" name="__codelineno-0-2251"></a>    <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-2252"><a id="__codelineno-0-2252" name="__codelineno-0-2252"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2253"><a id="__codelineno-0-2253" name="__codelineno-0-2253"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-2254"><a id="__codelineno-0-2254" name="__codelineno-0-2254"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-2255"><a id="__codelineno-0-2255" name="__codelineno-0-2255"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2256"><a id="__codelineno-0-2256" name="__codelineno-0-2256"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2257"><a id="__codelineno-0-2257" name="__codelineno-0-2257"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-2258"><a id="__codelineno-0-2258" name="__codelineno-0-2258"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2259"><a id="__codelineno-0-2259" name="__codelineno-0-2259"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-2260"><a id="__codelineno-0-2260" name="__codelineno-0-2260"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-2261"><a id="__codelineno-0-2261" name="__codelineno-0-2261"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2262"><a id="__codelineno-0-2262" name="__codelineno-0-2262"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2263"><a id="__codelineno-0-2263" name="__codelineno-0-2263"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-2264"><a id="__codelineno-0-2264" name="__codelineno-0-2264"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2265"><a id="__codelineno-0-2265" name="__codelineno-0-2265"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2266"><a id="__codelineno-0-2266" name="__codelineno-0-2266"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2267"><a id="__codelineno-0-2267" name="__codelineno-0-2267"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2268"><a id="__codelineno-0-2268" name="__codelineno-0-2268"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-2269"><a id="__codelineno-0-2269" name="__codelineno-0-2269"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2270"><a id="__codelineno-0-2270" name="__codelineno-0-2270"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2271"><a id="__codelineno-0-2271" name="__codelineno-0-2271"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2272"><a id="__codelineno-0-2272" name="__codelineno-0-2272"></a>        <span class="p">)</span>
</span><span id="__span-0-2273"><a id="__codelineno-0-2273" name="__codelineno-0-2273"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2274"><a id="__codelineno-0-2274" name="__codelineno-0-2274"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2275"><a id="__codelineno-0-2275" name="__codelineno-0-2275"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2276"><a id="__codelineno-0-2276" name="__codelineno-0-2276"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2277"><a id="__codelineno-0-2277" name="__codelineno-0-2277"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2278"><a id="__codelineno-0-2278" name="__codelineno-0-2278"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2279"><a id="__codelineno-0-2279" name="__codelineno-0-2279"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2280"><a id="__codelineno-0-2280" name="__codelineno-0-2280"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2281"><a id="__codelineno-0-2281" name="__codelineno-0-2281"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2282"><a id="__codelineno-0-2282" name="__codelineno-0-2282"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2283"><a id="__codelineno-0-2283" name="__codelineno-0-2283"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2284"><a id="__codelineno-0-2284" name="__codelineno-0-2284"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2285"><a id="__codelineno-0-2285" name="__codelineno-0-2285"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2286"><a id="__codelineno-0-2286" name="__codelineno-0-2286"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2287"><a id="__codelineno-0-2287" name="__codelineno-0-2287"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2288"><a id="__codelineno-0-2288" name="__codelineno-0-2288"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2289"><a id="__codelineno-0-2289" name="__codelineno-0-2289"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2290"><a id="__codelineno-0-2290" name="__codelineno-0-2290"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2291"><a id="__codelineno-0-2291" name="__codelineno-0-2291"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2292"><a id="__codelineno-0-2292" name="__codelineno-0-2292"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2293"><a id="__codelineno-0-2293" name="__codelineno-0-2293"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2294"><a id="__codelineno-0-2294" name="__codelineno-0-2294"></a>        <span class="p">)</span>
</span><span id="__span-0-2295"><a id="__codelineno-0-2295" name="__codelineno-0-2295"></a>
</span><span id="__span-0-2296"><a id="__codelineno-0-2296" name="__codelineno-0-2296"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2297"><a id="__codelineno-0-2297" name="__codelineno-0-2297"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2298"><a id="__codelineno-0-2298" name="__codelineno-0-2298"></a>        <span class="n">ex_wavelength_um</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">"excitation_um"</span><span class="p">]</span>
</span><span id="__span-0-2299"><a id="__codelineno-0-2299" name="__codelineno-0-2299"></a>        <span class="n">em_wavelength_um</span> <span class="o">=</span> <span class="n">attributes</span><span class="p">[</span><span class="s2">"emission_um"</span><span class="p">]</span>
</span><span id="__span-0-2300"><a id="__codelineno-0-2300" name="__codelineno-0-2300"></a>        <span class="k">return</span> <span class="p">(</span><span class="n">ex_wavelength_um</span><span class="p">,</span> <span class="n">em_wavelength_um</span><span class="p">)</span>
</span><span id="__span-0-2301"><a id="__codelineno-0-2301" name="__codelineno-0-2301"></a>    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
</span><span id="__span-0-2302"><a id="__codelineno-0-2302" name="__codelineno-0-2302"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Wavelength attributes not found."</span><span class="p">)</span>
</span><span id="__span-0-2303"><a id="__codelineno-0-2303" name="__codelineno-0-2303"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.reformat_baysor_3D_oultines"> <code class="highlight language-python"><span class="n">reformat_baysor_3D_oultines</span><span class="p">()</span></code> </h3> <div class="doc doc-contents"> <p>Reformat baysor 3D json file into ImageJ ROIs.</p> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-4024">4024</a></span>
<span class="normal"><a href="#__codelineno-0-4025">4025</a></span>
<span class="normal"><a href="#__codelineno-0-4026">4026</a></span>
<span class="normal"><a href="#__codelineno-0-4027">4027</a></span>
<span class="normal"><a href="#__codelineno-0-4028">4028</a></span>
<span class="normal"><a href="#__codelineno-0-4029">4029</a></span>
<span class="normal"><a href="#__codelineno-0-4030">4030</a></span>
<span class="normal"><a href="#__codelineno-0-4031">4031</a></span>
<span class="normal"><a href="#__codelineno-0-4032">4032</a></span>
<span class="normal"><a href="#__codelineno-0-4033">4033</a></span>
<span class="normal"><a href="#__codelineno-0-4034">4034</a></span>
<span class="normal"><a href="#__codelineno-0-4035">4035</a></span>
<span class="normal"><a href="#__codelineno-0-4036">4036</a></span>
<span class="normal"><a href="#__codelineno-0-4037">4037</a></span>
<span class="normal"><a href="#__codelineno-0-4038">4038</a></span>
<span class="normal"><a href="#__codelineno-0-4039">4039</a></span>
<span class="normal"><a href="#__codelineno-0-4040">4040</a></span>
<span class="normal"><a href="#__codelineno-0-4041">4041</a></span>
<span class="normal"><a href="#__codelineno-0-4042">4042</a></span>
<span class="normal"><a href="#__codelineno-0-4043">4043</a></span>
<span class="normal"><a href="#__codelineno-0-4044">4044</a></span>
<span class="normal"><a href="#__codelineno-0-4045">4045</a></span>
<span class="normal"><a href="#__codelineno-0-4046">4046</a></span>
<span class="normal"><a href="#__codelineno-0-4047">4047</a></span>
<span class="normal"><a href="#__codelineno-0-4048">4048</a></span>
<span class="normal"><a href="#__codelineno-0-4049">4049</a></span>
<span class="normal"><a href="#__codelineno-0-4050">4050</a></span>
<span class="normal"><a href="#__codelineno-0-4051">4051</a></span>
<span class="normal"><a href="#__codelineno-0-4052">4052</a></span>
<span class="normal"><a href="#__codelineno-0-4053">4053</a></span>
<span class="normal"><a href="#__codelineno-0-4054">4054</a></span>
<span class="normal"><a href="#__codelineno-0-4055">4055</a></span>
<span class="normal"><a href="#__codelineno-0-4056">4056</a></span>
<span class="normal"><a href="#__codelineno-0-4057">4057</a></span>
<span class="normal"><a href="#__codelineno-0-4058">4058</a></span>
<span class="normal"><a href="#__codelineno-0-4059">4059</a></span>
<span class="normal"><a href="#__codelineno-0-4060">4060</a></span>
<span class="normal"><a href="#__codelineno-0-4061">4061</a></span>
<span class="normal"><a href="#__codelineno-0-4062">4062</a></span>
<span class="normal"><a href="#__codelineno-0-4063">4063</a></span>
<span class="normal"><a href="#__codelineno-0-4064">4064</a></span>
<span class="normal"><a href="#__codelineno-0-4065">4065</a></span>
<span class="normal"><a href="#__codelineno-0-4066">4066</a></span>
<span class="normal"><a href="#__codelineno-0-4067">4067</a></span>
<span class="normal"><a href="#__codelineno-0-4068">4068</a></span>
<span class="normal"><a href="#__codelineno-0-4069">4069</a></span>
<span class="normal"><a href="#__codelineno-0-4070">4070</a></span>
<span class="normal"><a href="#__codelineno-0-4071">4071</a></span>
<span class="normal"><a href="#__codelineno-0-4072">4072</a></span>
<span class="normal"><a href="#__codelineno-0-4073">4073</a></span>
<span class="normal"><a href="#__codelineno-0-4074">4074</a></span>
<span class="normal"><a href="#__codelineno-0-4075">4075</a></span>
<span class="normal"><a href="#__codelineno-0-4076">4076</a></span>
<span class="normal"><a href="#__codelineno-0-4077">4077</a></span>
<span class="normal"><a href="#__codelineno-0-4078">4078</a></span>
<span class="normal"><a href="#__codelineno-0-4079">4079</a></span>
<span class="normal"><a href="#__codelineno-0-4080">4080</a></span>
<span class="normal"><a href="#__codelineno-0-4081">4081</a></span>
<span class="normal"><a href="#__codelineno-0-4082">4082</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-4024"><a id="__codelineno-0-4024" name="__codelineno-0-4024"></a><span class="k">def</span><span class="w"> </span><span class="nf">reformat_baysor_3D_oultines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-4025"><a id="__codelineno-0-4025" name="__codelineno-0-4025"></a><span class="w">    </span><span class="sd">"""Reformat baysor 3D json file into ImageJ ROIs."""</span>
</span><span id="__span-0-4026"><a id="__codelineno-0-4026" name="__codelineno-0-4026"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="__span-0-4027"><a id="__codelineno-0-4027" name="__codelineno-0-4027"></a>
</span><span id="__span-0-4028"><a id="__codelineno-0-4028" name="__codelineno-0-4028"></a>    <span class="c1"># Load the JSON file</span>
</span><span id="__span-0-4029"><a id="__codelineno-0-4029" name="__codelineno-0-4029"></a>    <span class="n">baysor_output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"baysor"</span><span class="p">)</span>
</span><span id="__span-0-4030"><a id="__codelineno-0-4030" name="__codelineno-0-4030"></a>    <span class="n">baysor_segmentation</span> <span class="o">=</span> <span class="n">baysor_output_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"segmentation_polygons_3d.json"</span><span class="p">)</span>
</span><span id="__span-0-4031"><a id="__codelineno-0-4031" name="__codelineno-0-4031"></a>    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">baysor_segmentation</span><span class="p">,</span> <span class="s1">'r'</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
</span><span id="__span-0-4032"><a id="__codelineno-0-4032" name="__codelineno-0-4032"></a>        <span class="n">data</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</span><span id="__span-0-4033"><a id="__codelineno-0-4033" name="__codelineno-0-4033"></a>
</span><span id="__span-0-4034"><a id="__codelineno-0-4034" name="__codelineno-0-4034"></a>
</span><span id="__span-0-4035"><a id="__codelineno-0-4035" name="__codelineno-0-4035"></a>    <span class="c1"># Dictionary to group polygons by cell ID</span>
</span><span id="__span-0-4036"><a id="__codelineno-0-4036" name="__codelineno-0-4036"></a>    <span class="n">cell_polygons</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
</span><span id="__span-0-4037"><a id="__codelineno-0-4037" name="__codelineno-0-4037"></a>
</span><span id="__span-0-4038"><a id="__codelineno-0-4038" name="__codelineno-0-4038"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">parse_z_range</span><span class="p">(</span><span class="n">z_range</span><span class="p">):</span>
</span><span id="__span-0-4039"><a id="__codelineno-0-4039" name="__codelineno-0-4039"></a>        <span class="n">cleaned_range</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">"[^\d.,-]"</span><span class="p">,</span> <span class="s2">""</span><span class="p">,</span> <span class="n">z_range</span><span class="p">)</span>  <span class="c1"># Remove non-numeric, non-period, non-comma, non-dash characters</span>
</span><span id="__span-0-4040"><a id="__codelineno-0-4040" name="__codelineno-0-4040"></a>        <span class="k">return</span> <span class="nb">map</span><span class="p">(</span><span class="nb">float</span><span class="p">,</span> <span class="n">cleaned_range</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">","</span><span class="p">))</span>
</span><span id="__span-0-4041"><a id="__codelineno-0-4041" name="__codelineno-0-4041"></a>
</span><span id="__span-0-4042"><a id="__codelineno-0-4042" name="__codelineno-0-4042"></a>    <span class="c1"># Iterate through each z-plane and corresponding polygons</span>
</span><span id="__span-0-4043"><a id="__codelineno-0-4043" name="__codelineno-0-4043"></a>    <span class="k">for</span> <span class="n">z_range</span><span class="p">,</span> <span class="n">details</span> <span class="ow">in</span> <span class="n">data</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-4044"><a id="__codelineno-0-4044" name="__codelineno-0-4044"></a>        <span class="n">z_start</span><span class="p">,</span> <span class="n">z_end</span> <span class="o">=</span> <span class="n">parse_z_range</span><span class="p">(</span><span class="n">z_range</span><span class="p">)</span>
</span><span id="__span-0-4045"><a id="__codelineno-0-4045" name="__codelineno-0-4045"></a>
</span><span id="__span-0-4046"><a id="__codelineno-0-4046" name="__codelineno-0-4046"></a>        <span class="k">for</span> <span class="n">geometry</span> <span class="ow">in</span> <span class="n">details</span><span class="p">[</span><span class="s2">"geometries"</span><span class="p">]:</span>
</span><span id="__span-0-4047"><a id="__codelineno-0-4047" name="__codelineno-0-4047"></a>            <span class="n">coordinates</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">"coordinates"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Assuming the outer ring of the polygon</span>
</span><span id="__span-0-4048"><a id="__codelineno-0-4048" name="__codelineno-0-4048"></a>            <span class="n">cell_id</span> <span class="o">=</span> <span class="n">geometry</span><span class="p">[</span><span class="s2">"cell"</span><span class="p">]</span>  <span class="c1"># Get the cell ID</span>
</span><span id="__span-0-4049"><a id="__codelineno-0-4049" name="__codelineno-0-4049"></a>
</span><span id="__span-0-4050"><a id="__codelineno-0-4050" name="__codelineno-0-4050"></a>            <span class="c1"># Store the polygon with its z-range</span>
</span><span id="__span-0-4051"><a id="__codelineno-0-4051" name="__codelineno-0-4051"></a>            <span class="n">cell_polygons</span><span class="p">[</span><span class="n">cell_id</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">({</span>
</span><span id="__span-0-4052"><a id="__codelineno-0-4052" name="__codelineno-0-4052"></a>                <span class="s2">"z_start"</span><span class="p">:</span> <span class="n">z_start</span><span class="p">,</span>
</span><span id="__span-0-4053"><a id="__codelineno-0-4053" name="__codelineno-0-4053"></a>                <span class="s2">"z_end"</span><span class="p">:</span> <span class="n">z_end</span><span class="p">,</span>
</span><span id="__span-0-4054"><a id="__codelineno-0-4054" name="__codelineno-0-4054"></a>                <span class="s2">"coordinates"</span><span class="p">:</span> <span class="n">coordinates</span>
</span><span id="__span-0-4055"><a id="__codelineno-0-4055" name="__codelineno-0-4055"></a>            <span class="p">})</span>
</span><span id="__span-0-4056"><a id="__codelineno-0-4056" name="__codelineno-0-4056"></a>
</span><span id="__span-0-4057"><a id="__codelineno-0-4057" name="__codelineno-0-4057"></a>    <span class="n">rois</span> <span class="o">=</span> <span class="p">[]</span>
</span><span id="__span-0-4058"><a id="__codelineno-0-4058" name="__codelineno-0-4058"></a>
</span><span id="__span-0-4059"><a id="__codelineno-0-4059" name="__codelineno-0-4059"></a>    <span class="c1"># Process each cell ID to create 3D ROIs</span>
</span><span id="__span-0-4060"><a id="__codelineno-0-4060" name="__codelineno-0-4060"></a>    <span class="k">for</span> <span class="n">cell_id</span><span class="p">,</span> <span class="n">polygons</span> <span class="ow">in</span> <span class="n">cell_polygons</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
</span><span id="__span-0-4061"><a id="__codelineno-0-4061" name="__codelineno-0-4061"></a>        <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">polygon</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">polygons</span><span class="p">):</span>
</span><span id="__span-0-4062"><a id="__codelineno-0-4062" name="__codelineno-0-4062"></a>            <span class="n">x_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">[</span><span class="s2">"coordinates"</span><span class="p">]]</span>
</span><span id="__span-0-4063"><a id="__codelineno-0-4063" name="__codelineno-0-4063"></a>            <span class="n">y_coords</span> <span class="o">=</span> <span class="p">[</span><span class="n">point</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">point</span> <span class="ow">in</span> <span class="n">polygon</span><span class="p">[</span><span class="s2">"coordinates"</span><span class="p">]]</span>
</span><span id="__span-0-4064"><a id="__codelineno-0-4064" name="__codelineno-0-4064"></a>
</span><span id="__span-0-4065"><a id="__codelineno-0-4065" name="__codelineno-0-4065"></a>
</span><span id="__span-0-4066"><a id="__codelineno-0-4066" name="__codelineno-0-4066"></a>            <span class="n">z_start</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">[</span><span class="s2">"z_start"</span><span class="p">]</span>
</span><span id="__span-0-4067"><a id="__codelineno-0-4067" name="__codelineno-0-4067"></a>            <span class="n">z_end</span> <span class="o">=</span> <span class="n">polygon</span><span class="p">[</span><span class="s2">"z_end"</span><span class="p">]</span>
</span><span id="__span-0-4068"><a id="__codelineno-0-4068" name="__codelineno-0-4068"></a>
</span><span id="__span-0-4069"><a id="__codelineno-0-4069" name="__codelineno-0-4069"></a>            <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-4070"><a id="__codelineno-0-4070" name="__codelineno-0-4070"></a>                <span class="c1"># Create an ImageJRoi object for the polygon using frompoints</span>
</span><span id="__span-0-4071"><a id="__codelineno-0-4071" name="__codelineno-0-4071"></a>                <span class="n">coords</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span><span class="p">))</span>  <span class="c1"># List of (x, y) tuples</span>
</span><span id="__span-0-4072"><a id="__codelineno-0-4072" name="__codelineno-0-4072"></a>                <span class="n">roi</span> <span class="o">=</span> <span class="n">ImagejRoi</span><span class="o">.</span><span class="n">frompoints</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
</span><span id="__span-0-4073"><a id="__codelineno-0-4073" name="__codelineno-0-4073"></a>                <span class="n">roi</span><span class="o">.</span><span class="n">roitype</span> <span class="o">=</span> <span class="n">ROI_TYPE</span><span class="o">.</span><span class="n">POLYGON</span>  <span class="c1"># Set the ROI type to Polygon</span>
</span><span id="__span-0-4074"><a id="__codelineno-0-4074" name="__codelineno-0-4074"></a>                <span class="n">roi</span><span class="o">.</span><span class="n">coordinates</span> <span class="o">=</span> <span class="n">coords</span>  <span class="c1"># Explicitly assign coordinates to the ROI</span>
</span><span id="__span-0-4075"><a id="__codelineno-0-4075" name="__codelineno-0-4075"></a>                <span class="n">roi</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">"cell_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">cell_id</span><span class="p">)</span><span class="si">}</span><span class="s2">_zstart_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">z_start</span><span class="p">)</span><span class="si">}</span><span class="s2">_zend_</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">z_end</span><span class="p">)</span><span class="si">}</span><span class="s2">"</span>  <span class="c1"># Ensure unique name</span>
</span><span id="__span-0-4076"><a id="__codelineno-0-4076" name="__codelineno-0-4076"></a>                <span class="n">rois</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">roi</span><span class="p">)</span>
</span><span id="__span-0-4077"><a id="__codelineno-0-4077" name="__codelineno-0-4077"></a>            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-4078"><a id="__codelineno-0-4078" name="__codelineno-0-4078"></a>                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">"Error while creating ROI for cell ID </span><span class="si">{</span><span class="n">cell_id</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">"</span><span class="p">)</span>
</span><span id="__span-0-4079"><a id="__codelineno-0-4079" name="__codelineno-0-4079"></a>
</span><span id="__span-0-4080"><a id="__codelineno-0-4080" name="__codelineno-0-4080"></a>    <span class="c1"># Write all ROIs to a ZIP file   </span>
</span><span id="__span-0-4081"><a id="__codelineno-0-4081" name="__codelineno-0-4081"></a>    <span class="n">output_file</span> <span class="o">=</span> <span class="n">baysor_output_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="sa">r</span><span class="s2">"3d_cell_rois.zip"</span><span class="p">)</span>
</span><span id="__span-0-4082"><a id="__codelineno-0-4082" name="__codelineno-0-4082"></a>    <span class="n">roiwrite</span><span class="p">(</span><span class="n">output_file</span><span class="p">,</span> <span class="n">rois</span><span class="p">,</span><span class="n">mode</span><span class="o">=</span><span class="s1">'w'</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.reprocess_and_save_filtered_spots_with_baysor_outlines"> <code class="highlight language-python"><span class="n">reprocess_and_save_filtered_spots_with_baysor_outlines</span><span class="p">()</span></code> </h3> <div class="doc doc-contents"> <p>Reprocess filtered spots using baysor cell outlines, then save.</p> <p>Loads the 3D cell outlines from Baysor, checks all points to see what (if any) cell outline that the spot falls within, and then saves the data back to the datastore.</p> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-4140">4140</a></span>
<span class="normal"><a href="#__codelineno-0-4141">4141</a></span>
<span class="normal"><a href="#__codelineno-0-4142">4142</a></span>
<span class="normal"><a href="#__codelineno-0-4143">4143</a></span>
<span class="normal"><a href="#__codelineno-0-4144">4144</a></span>
<span class="normal"><a href="#__codelineno-0-4145">4145</a></span>
<span class="normal"><a href="#__codelineno-0-4146">4146</a></span>
<span class="normal"><a href="#__codelineno-0-4147">4147</a></span>
<span class="normal"><a href="#__codelineno-0-4148">4148</a></span>
<span class="normal"><a href="#__codelineno-0-4149">4149</a></span>
<span class="normal"><a href="#__codelineno-0-4150">4150</a></span>
<span class="normal"><a href="#__codelineno-0-4151">4151</a></span>
<span class="normal"><a href="#__codelineno-0-4152">4152</a></span>
<span class="normal"><a href="#__codelineno-0-4153">4153</a></span>
<span class="normal"><a href="#__codelineno-0-4154">4154</a></span>
<span class="normal"><a href="#__codelineno-0-4155">4155</a></span>
<span class="normal"><a href="#__codelineno-0-4156">4156</a></span>
<span class="normal"><a href="#__codelineno-0-4157">4157</a></span>
<span class="normal"><a href="#__codelineno-0-4158">4158</a></span>
<span class="normal"><a href="#__codelineno-0-4159">4159</a></span>
<span class="normal"><a href="#__codelineno-0-4160">4160</a></span>
<span class="normal"><a href="#__codelineno-0-4161">4161</a></span>
<span class="normal"><a href="#__codelineno-0-4162">4162</a></span>
<span class="normal"><a href="#__codelineno-0-4163">4163</a></span>
<span class="normal"><a href="#__codelineno-0-4164">4164</a></span>
<span class="normal"><a href="#__codelineno-0-4165">4165</a></span>
<span class="normal"><a href="#__codelineno-0-4166">4166</a></span>
<span class="normal"><a href="#__codelineno-0-4167">4167</a></span>
<span class="normal"><a href="#__codelineno-0-4168">4168</a></span>
<span class="normal"><a href="#__codelineno-0-4169">4169</a></span>
<span class="normal"><a href="#__codelineno-0-4170">4170</a></span>
<span class="normal"><a href="#__codelineno-0-4171">4171</a></span>
<span class="normal"><a href="#__codelineno-0-4172">4172</a></span>
<span class="normal"><a href="#__codelineno-0-4173">4173</a></span>
<span class="normal"><a href="#__codelineno-0-4174">4174</a></span>
<span class="normal"><a href="#__codelineno-0-4175">4175</a></span>
<span class="normal"><a href="#__codelineno-0-4176">4176</a></span>
<span class="normal"><a href="#__codelineno-0-4177">4177</a></span>
<span class="normal"><a href="#__codelineno-0-4178">4178</a></span>
<span class="normal"><a href="#__codelineno-0-4179">4179</a></span>
<span class="normal"><a href="#__codelineno-0-4180">4180</a></span>
<span class="normal"><a href="#__codelineno-0-4181">4181</a></span>
<span class="normal"><a href="#__codelineno-0-4182">4182</a></span>
<span class="normal"><a href="#__codelineno-0-4183">4183</a></span>
<span class="normal"><a href="#__codelineno-0-4184">4184</a></span>
<span class="normal"><a href="#__codelineno-0-4185">4185</a></span>
<span class="normal"><a href="#__codelineno-0-4186">4186</a></span>
<span class="normal"><a href="#__codelineno-0-4187">4187</a></span>
<span class="normal"><a href="#__codelineno-0-4188">4188</a></span>
<span class="normal"><a href="#__codelineno-0-4189">4189</a></span>
<span class="normal"><a href="#__codelineno-0-4190">4190</a></span>
<span class="normal"><a href="#__codelineno-0-4191">4191</a></span>
<span class="normal"><a href="#__codelineno-0-4192">4192</a></span>
<span class="normal"><a href="#__codelineno-0-4193">4193</a></span>
<span class="normal"><a href="#__codelineno-0-4194">4194</a></span>
<span class="normal"><a href="#__codelineno-0-4195">4195</a></span>
<span class="normal"><a href="#__codelineno-0-4196">4196</a></span>
<span class="normal"><a href="#__codelineno-0-4197">4197</a></span>
<span class="normal"><a href="#__codelineno-0-4198">4198</a></span>
<span class="normal"><a href="#__codelineno-0-4199">4199</a></span>
<span class="normal"><a href="#__codelineno-0-4200">4200</a></span>
<span class="normal"><a href="#__codelineno-0-4201">4201</a></span>
<span class="normal"><a href="#__codelineno-0-4202">4202</a></span>
<span class="normal"><a href="#__codelineno-0-4203">4203</a></span>
<span class="normal"><a href="#__codelineno-0-4204">4204</a></span>
<span class="normal"><a href="#__codelineno-0-4205">4205</a></span>
<span class="normal"><a href="#__codelineno-0-4206">4206</a></span>
<span class="normal"><a href="#__codelineno-0-4207">4207</a></span>
<span class="normal"><a href="#__codelineno-0-4208">4208</a></span>
<span class="normal"><a href="#__codelineno-0-4209">4209</a></span>
<span class="normal"><a href="#__codelineno-0-4210">4210</a></span>
<span class="normal"><a href="#__codelineno-0-4211">4211</a></span>
<span class="normal"><a href="#__codelineno-0-4212">4212</a></span>
<span class="normal"><a href="#__codelineno-0-4213">4213</a></span>
<span class="normal"><a href="#__codelineno-0-4214">4214</a></span>
<span class="normal"><a href="#__codelineno-0-4215">4215</a></span>
<span class="normal"><a href="#__codelineno-0-4216">4216</a></span>
<span class="normal"><a href="#__codelineno-0-4217">4217</a></span>
<span class="normal"><a href="#__codelineno-0-4218">4218</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-4140"><a id="__codelineno-0-4140" name="__codelineno-0-4140"></a><span class="k">def</span><span class="w"> </span><span class="nf">reprocess_and_save_filtered_spots_with_baysor_outlines</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-4141"><a id="__codelineno-0-4141" name="__codelineno-0-4141"></a><span class="w">    </span><span class="sd">"""Reprocess filtered spots using baysor cell outlines, then save.</span>
</span><span id="__span-0-4142"><a id="__codelineno-0-4142" name="__codelineno-0-4142"></a>
</span><span id="__span-0-4143"><a id="__codelineno-0-4143" name="__codelineno-0-4143"></a><span class="sd">    Loads the 3D cell outlines from Baysor, checks all points to see what </span>
</span><span id="__span-0-4144"><a id="__codelineno-0-4144" name="__codelineno-0-4144"></a><span class="sd">    (if any) cell outline that the spot falls within, and then saves the</span>
</span><span id="__span-0-4145"><a id="__codelineno-0-4145" name="__codelineno-0-4145"></a><span class="sd">    data back to the datastore.</span>
</span><span id="__span-0-4146"><a id="__codelineno-0-4146" name="__codelineno-0-4146"></a><span class="sd">    """</span>
</span><span id="__span-0-4147"><a id="__codelineno-0-4147" name="__codelineno-0-4147"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">rtree</span><span class="w"> </span><span class="kn">import</span> <span class="n">index</span>
</span><span id="__span-0-4148"><a id="__codelineno-0-4148" name="__codelineno-0-4148"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">re</span>
</span><span id="__span-0-4149"><a id="__codelineno-0-4149" name="__codelineno-0-4149"></a>
</span><span id="__span-0-4150"><a id="__codelineno-0-4150" name="__codelineno-0-4150"></a>    <span class="n">rois</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_global_baysor_outlines</span><span class="p">()</span>
</span><span id="__span-0-4151"><a id="__codelineno-0-4151" name="__codelineno-0-4151"></a>    <span class="n">filtered_spots_df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_global_filtered_decoded_spots</span><span class="p">()</span>
</span><span id="__span-0-4152"><a id="__codelineno-0-4152" name="__codelineno-0-4152"></a>
</span><span id="__span-0-4153"><a id="__codelineno-0-4153" name="__codelineno-0-4153"></a>    <span class="n">parsed_spots_df</span> <span class="o">=</span> <span class="n">filtered_spots_df</span><span class="p">[</span>
</span><span id="__span-0-4154"><a id="__codelineno-0-4154" name="__codelineno-0-4154"></a>            <span class="p">[</span>
</span><span id="__span-0-4155"><a id="__codelineno-0-4155" name="__codelineno-0-4155"></a>                <span class="s2">"gene_id"</span><span class="p">,</span>
</span><span id="__span-0-4156"><a id="__codelineno-0-4156" name="__codelineno-0-4156"></a>                <span class="s2">"global_z"</span><span class="p">,</span>
</span><span id="__span-0-4157"><a id="__codelineno-0-4157" name="__codelineno-0-4157"></a>                <span class="s2">"global_y"</span><span class="p">,</span>
</span><span id="__span-0-4158"><a id="__codelineno-0-4158" name="__codelineno-0-4158"></a>                <span class="s2">"global_x"</span><span class="p">,</span>
</span><span id="__span-0-4159"><a id="__codelineno-0-4159" name="__codelineno-0-4159"></a>                <span class="s2">"cell_id"</span><span class="p">,</span>
</span><span id="__span-0-4160"><a id="__codelineno-0-4160" name="__codelineno-0-4160"></a>                <span class="s2">"tile_idx"</span><span class="p">,</span>
</span><span id="__span-0-4161"><a id="__codelineno-0-4161" name="__codelineno-0-4161"></a>            <span class="p">]</span>
</span><span id="__span-0-4162"><a id="__codelineno-0-4162" name="__codelineno-0-4162"></a>    <span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-0-4163"><a id="__codelineno-0-4163" name="__codelineno-0-4163"></a>    <span class="n">parsed_spots_df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span>
</span><span id="__span-0-4164"><a id="__codelineno-0-4164" name="__codelineno-0-4164"></a>        <span class="n">columns</span><span class="o">=</span><span class="p">{</span>
</span><span id="__span-0-4165"><a id="__codelineno-0-4165" name="__codelineno-0-4165"></a>            <span class="s2">"global_x"</span><span class="p">:</span> <span class="s2">"x"</span><span class="p">,</span>
</span><span id="__span-0-4166"><a id="__codelineno-0-4166" name="__codelineno-0-4166"></a>            <span class="s2">"global_y"</span><span class="p">:</span> <span class="s2">"y"</span><span class="p">,</span>
</span><span id="__span-0-4167"><a id="__codelineno-0-4167" name="__codelineno-0-4167"></a>            <span class="s2">"global_z"</span><span class="p">:</span> <span class="s2">"z"</span><span class="p">,</span>
</span><span id="__span-0-4168"><a id="__codelineno-0-4168" name="__codelineno-0-4168"></a>            <span class="s2">"gene_id"</span> <span class="p">:</span> <span class="s2">"gene"</span><span class="p">,</span>
</span><span id="__span-0-4169"><a id="__codelineno-0-4169" name="__codelineno-0-4169"></a>            <span class="s2">"cell_id"</span> <span class="p">:</span> <span class="s2">"cell"</span><span class="p">,</span>
</span><span id="__span-0-4170"><a id="__codelineno-0-4170" name="__codelineno-0-4170"></a>        <span class="p">},</span>
</span><span id="__span-0-4171"><a id="__codelineno-0-4171" name="__codelineno-0-4171"></a>        <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-4172"><a id="__codelineno-0-4172" name="__codelineno-0-4172"></a>    <span class="p">)</span>
</span><span id="__span-0-4173"><a id="__codelineno-0-4173" name="__codelineno-0-4173"></a>    <span class="n">parsed_spots_df</span><span class="p">[</span><span class="s2">"transcript_id"</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">util</span><span class="o">.</span><span class="n">hash_pandas_object</span><span class="p">(</span>
</span><span id="__span-0-4174"><a id="__codelineno-0-4174" name="__codelineno-0-4174"></a>        <span class="n">parsed_spots_df</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span>
</span><span id="__span-0-4175"><a id="__codelineno-0-4175" name="__codelineno-0-4175"></a>    <span class="p">)</span>
</span><span id="__span-0-4176"><a id="__codelineno-0-4176" name="__codelineno-0-4176"></a>
</span><span id="__span-0-4177"><a id="__codelineno-0-4177" name="__codelineno-0-4177"></a>    <span class="n">parsed_spots_df</span><span class="p">[</span><span class="s2">"assignment_confidence"</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.0</span>
</span><span id="__span-0-4178"><a id="__codelineno-0-4178" name="__codelineno-0-4178"></a>
</span><span id="__span-0-4179"><a id="__codelineno-0-4179" name="__codelineno-0-4179"></a>    <span class="c1"># Create spatial index for ROIs</span>
</span><span id="__span-0-4180"><a id="__codelineno-0-4180" name="__codelineno-0-4180"></a>    <span class="n">roi_index</span> <span class="o">=</span> <span class="n">index</span><span class="o">.</span><span class="n">Index</span><span class="p">()</span>
</span><span id="__span-0-4181"><a id="__codelineno-0-4181" name="__codelineno-0-4181"></a>    <span class="n">roi_map</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># Map index IDs to ROIs</span>
</span><span id="__span-0-4182"><a id="__codelineno-0-4182" name="__codelineno-0-4182"></a>
</span><span id="__span-0-4183"><a id="__codelineno-0-4183" name="__codelineno-0-4183"></a>    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">roi</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">rois</span><span class="p">):</span>
</span><span id="__span-0-4184"><a id="__codelineno-0-4184" name="__codelineno-0-4184"></a>        <span class="c1"># Ensure roi.coordinates contains the polygon points</span>
</span><span id="__span-0-4185"><a id="__codelineno-0-4185" name="__codelineno-0-4185"></a>        <span class="n">coords</span> <span class="o">=</span> <span class="n">roi</span><span class="o">.</span><span class="n">coordinates</span><span class="p">()</span>
</span><span id="__span-0-4186"><a id="__codelineno-0-4186" name="__codelineno-0-4186"></a>
</span><span id="__span-0-4187"><a id="__codelineno-0-4187" name="__codelineno-0-4187"></a>        <span class="c1"># Insert the polygon bounds into the spatial index</span>
</span><span id="__span-0-4188"><a id="__codelineno-0-4188" name="__codelineno-0-4188"></a>        <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">coords</span><span class="p">)</span>
</span><span id="__span-0-4189"><a id="__codelineno-0-4189" name="__codelineno-0-4189"></a>        <span class="n">roi_index</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">polygon</span><span class="o">.</span><span class="n">bounds</span><span class="p">)</span>  <span class="c1"># Use polygon bounds for indexing</span>
</span><span id="__span-0-4190"><a id="__codelineno-0-4190" name="__codelineno-0-4190"></a>        <span class="n">roi_map</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">roi</span>
</span><span id="__span-0-4191"><a id="__codelineno-0-4191" name="__codelineno-0-4191"></a>
</span><span id="__span-0-4192"><a id="__codelineno-0-4192" name="__codelineno-0-4192"></a>    <span class="c1"># Function to check a single point</span>
</span><span id="__span-0-4193"><a id="__codelineno-0-4193" name="__codelineno-0-4193"></a>    <span class="k">def</span><span class="w"> </span><span class="nf">point_in_roi</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
</span><span id="__span-0-4194"><a id="__codelineno-0-4194" name="__codelineno-0-4194"></a>        <span class="n">point</span> <span class="o">=</span> <span class="n">Point</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s2">"x"</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s2">"y"</span><span class="p">])</span>
</span><span id="__span-0-4195"><a id="__codelineno-0-4195" name="__codelineno-0-4195"></a>        <span class="n">candidate_indices</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">roi_index</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span><span class="n">point</span><span class="o">.</span><span class="n">bounds</span><span class="p">))</span>  <span class="c1"># Search spatial index</span>
</span><span id="__span-0-4196"><a id="__codelineno-0-4196" name="__codelineno-0-4196"></a>        <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">candidate_indices</span><span class="p">:</span>
</span><span id="__span-0-4197"><a id="__codelineno-0-4197" name="__codelineno-0-4197"></a>            <span class="n">roi</span> <span class="o">=</span> <span class="n">roi_map</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
</span><span id="__span-0-4198"><a id="__codelineno-0-4198" name="__codelineno-0-4198"></a>            <span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="sa">r</span><span class="s2">"zstart_([-\d.]+)_zend_([-\d.]+)"</span><span class="p">,</span> <span class="n">roi</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
</span><span id="__span-0-4199"><a id="__codelineno-0-4199" name="__codelineno-0-4199"></a>            <span class="k">if</span> <span class="n">match</span><span class="p">:</span>
</span><span id="__span-0-4200"><a id="__codelineno-0-4200" name="__codelineno-0-4200"></a>                <span class="n">z_start</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
</span><span id="__span-0-4201"><a id="__codelineno-0-4201" name="__codelineno-0-4201"></a>                <span class="n">z_end</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">match</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</span><span id="__span-0-4202"><a id="__codelineno-0-4202" name="__codelineno-0-4202"></a>                <span class="k">if</span> <span class="n">z_start</span> <span class="o">&lt;=</span> <span class="n">row</span><span class="p">[</span><span class="s2">"z"</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">z_end</span><span class="p">:</span>
</span><span id="__span-0-4203"><a id="__codelineno-0-4203" name="__codelineno-0-4203"></a>                    <span class="n">polygon</span> <span class="o">=</span> <span class="n">Polygon</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">coordinates</span><span class="p">())</span>
</span><span id="__span-0-4204"><a id="__codelineno-0-4204" name="__codelineno-0-4204"></a>                    <span class="k">if</span> <span class="n">polygon</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="n">point</span><span class="p">):</span>
</span><span id="__span-0-4205"><a id="__codelineno-0-4205" name="__codelineno-0-4205"></a>                        <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">roi</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">"_"</span><span class="p">)[</span><span class="mi">1</span><span class="p">])</span> 
</span><span id="__span-0-4206"><a id="__codelineno-0-4206" name="__codelineno-0-4206"></a>        <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span id="__span-0-4207"><a id="__codelineno-0-4207" name="__codelineno-0-4207"></a>
</span><span id="__span-0-4208"><a id="__codelineno-0-4208" name="__codelineno-0-4208"></a>    <span class="c1"># Apply optimized spatial lookup</span>
</span><span id="__span-0-4209"><a id="__codelineno-0-4209" name="__codelineno-0-4209"></a>    <span class="n">parsed_spots_df</span><span class="p">[</span><span class="s2">"cell"</span><span class="p">]</span> <span class="o">=</span> <span class="n">parsed_spots_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">point_in_roi</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-0-4210"><a id="__codelineno-0-4210" name="__codelineno-0-4210"></a>    <span class="n">parsed_spots_df</span> <span class="o">=</span> <span class="n">parsed_spots_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">parsed_spots_df</span><span class="p">[</span><span class="s2">"cell"</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="__span-0-4211"><a id="__codelineno-0-4211" name="__codelineno-0-4211"></a>
</span><span id="__span-0-4212"><a id="__codelineno-0-4212" name="__codelineno-0-4212"></a>    <span class="n">current_global_filtered_decoded_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-4213"><a id="__codelineno-0-4213" name="__codelineno-0-4213"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> 
</span><span id="__span-0-4214"><a id="__codelineno-0-4214" name="__codelineno-0-4214"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"all_tiles_filtered_decoded_features"</span><span class="p">)</span>
</span><span id="__span-0-4215"><a id="__codelineno-0-4215" name="__codelineno-0-4215"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"refined_transcripts.parquet"</span><span class="p">)</span>
</span><span id="__span-0-4216"><a id="__codelineno-0-4216" name="__codelineno-0-4216"></a>    <span class="p">)</span>
</span><span id="__span-0-4217"><a id="__codelineno-0-4217" name="__codelineno-0-4217"></a>
</span><span id="__span-0-4218"><a id="__codelineno-0-4218" name="__codelineno-0-4218"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_parquet</span><span class="p">(</span><span class="n">parsed_spots_df</span><span class="p">,</span> <span class="n">current_global_filtered_decoded_path</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.run_baysor"> <code class="highlight language-python"><span class="n">run_baysor</span><span class="p">()</span></code> </h3> <div class="doc doc-contents"> <p>Run Baysor"</p> <p>Assumes that spots are prepped for Baysor and the Baysor path and options are set. Reformats ROIs into ImageJ style ROIs for later use.</p> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3980">3980</a></span>
<span class="normal"><a href="#__codelineno-0-3981">3981</a></span>
<span class="normal"><a href="#__codelineno-0-3982">3982</a></span>
<span class="normal"><a href="#__codelineno-0-3983">3983</a></span>
<span class="normal"><a href="#__codelineno-0-3984">3984</a></span>
<span class="normal"><a href="#__codelineno-0-3985">3985</a></span>
<span class="normal"><a href="#__codelineno-0-3986">3986</a></span>
<span class="normal"><a href="#__codelineno-0-3987">3987</a></span>
<span class="normal"><a href="#__codelineno-0-3988">3988</a></span>
<span class="normal"><a href="#__codelineno-0-3989">3989</a></span>
<span class="normal"><a href="#__codelineno-0-3990">3990</a></span>
<span class="normal"><a href="#__codelineno-0-3991">3991</a></span>
<span class="normal"><a href="#__codelineno-0-3992">3992</a></span>
<span class="normal"><a href="#__codelineno-0-3993">3993</a></span>
<span class="normal"><a href="#__codelineno-0-3994">3994</a></span>
<span class="normal"><a href="#__codelineno-0-3995">3995</a></span>
<span class="normal"><a href="#__codelineno-0-3996">3996</a></span>
<span class="normal"><a href="#__codelineno-0-3997">3997</a></span>
<span class="normal"><a href="#__codelineno-0-3998">3998</a></span>
<span class="normal"><a href="#__codelineno-0-3999">3999</a></span>
<span class="normal"><a href="#__codelineno-0-4000">4000</a></span>
<span class="normal"><a href="#__codelineno-0-4001">4001</a></span>
<span class="normal"><a href="#__codelineno-0-4002">4002</a></span>
<span class="normal"><a href="#__codelineno-0-4003">4003</a></span>
<span class="normal"><a href="#__codelineno-0-4004">4004</a></span>
<span class="normal"><a href="#__codelineno-0-4005">4005</a></span>
<span class="normal"><a href="#__codelineno-0-4006">4006</a></span>
<span class="normal"><a href="#__codelineno-0-4007">4007</a></span>
<span class="normal"><a href="#__codelineno-0-4008">4008</a></span>
<span class="normal"><a href="#__codelineno-0-4009">4009</a></span>
<span class="normal"><a href="#__codelineno-0-4010">4010</a></span>
<span class="normal"><a href="#__codelineno-0-4011">4011</a></span>
<span class="normal"><a href="#__codelineno-0-4012">4012</a></span>
<span class="normal"><a href="#__codelineno-0-4013">4013</a></span>
<span class="normal"><a href="#__codelineno-0-4014">4014</a></span>
<span class="normal"><a href="#__codelineno-0-4015">4015</a></span>
<span class="normal"><a href="#__codelineno-0-4016">4016</a></span>
<span class="normal"><a href="#__codelineno-0-4017">4017</a></span>
<span class="normal"><a href="#__codelineno-0-4018">4018</a></span>
<span class="normal"><a href="#__codelineno-0-4019">4019</a></span>
<span class="normal"><a href="#__codelineno-0-4020">4020</a></span>
<span class="normal"><a href="#__codelineno-0-4021">4021</a></span>
<span class="normal"><a href="#__codelineno-0-4022">4022</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3980"><a id="__codelineno-0-3980" name="__codelineno-0-3980"></a><span class="k">def</span><span class="w"> </span><span class="nf">run_baysor</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span id="__span-0-3981"><a id="__codelineno-0-3981" name="__codelineno-0-3981"></a><span class="w">    </span><span class="sd">"""Run Baysor"</span>
</span><span id="__span-0-3982"><a id="__codelineno-0-3982" name="__codelineno-0-3982"></a>
</span><span id="__span-0-3983"><a id="__codelineno-0-3983" name="__codelineno-0-3983"></a><span class="sd">    Assumes that spots are prepped for Baysor and the Baysor path and options are set.</span>
</span><span id="__span-0-3984"><a id="__codelineno-0-3984" name="__codelineno-0-3984"></a><span class="sd">    Reformats ROIs into ImageJ style ROIs for later use.</span>
</span><span id="__span-0-3985"><a id="__codelineno-0-3985" name="__codelineno-0-3985"></a><span class="sd">    """</span>
</span><span id="__span-0-3986"><a id="__codelineno-0-3986" name="__codelineno-0-3986"></a>
</span><span id="__span-0-3987"><a id="__codelineno-0-3987" name="__codelineno-0-3987"></a>    <span class="kn">import</span><span class="w"> </span><span class="nn">subprocess</span>
</span><span id="__span-0-3988"><a id="__codelineno-0-3988" name="__codelineno-0-3988"></a>
</span><span id="__span-0-3989"><a id="__codelineno-0-3989" name="__codelineno-0-3989"></a>    <span class="n">baysor_input_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"all_tiles_filtered_decoded_features"</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"transcripts.parquet"</span><span class="p">)</span>
</span><span id="__span-0-3990"><a id="__codelineno-0-3990" name="__codelineno-0-3990"></a>    <span class="n">baysor_output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"baysor"</span><span class="p">)</span>
</span><span id="__span-0-3991"><a id="__codelineno-0-3991" name="__codelineno-0-3991"></a>    <span class="n">baysor_output_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-3992"><a id="__codelineno-0-3992" name="__codelineno-0-3992"></a>
</span><span id="__span-0-3993"><a id="__codelineno-0-3993" name="__codelineno-0-3993"></a>    <span class="n">julia_threading</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"JULIA_NUM_THREADS="</span><span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_julia_threads</span><span class="p">)</span><span class="o">+</span> <span class="s2">" "</span>
</span><span id="__span-0-3994"><a id="__codelineno-0-3994" name="__codelineno-0-3994"></a>    <span class="n">preview_baysor_options</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"preview -c "</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span><span class="p">)</span>
</span><span id="__span-0-3995"><a id="__codelineno-0-3995" name="__codelineno-0-3995"></a>    <span class="n">command</span> <span class="o">=</span> <span class="n">julia_threading</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="n">preview_baysor_options</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span>\
</span><span id="__span-0-3996"><a id="__codelineno-0-3996" name="__codelineno-0-3996"></a>        <span class="nb">str</span><span class="p">(</span><span class="n">baysor_input_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" -o "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">baysor_output_path</span><span class="p">)</span>
</span><span id="__span-0-3997"><a id="__codelineno-0-3997" name="__codelineno-0-3997"></a>
</span><span id="__span-0-3998"><a id="__codelineno-0-3998" name="__codelineno-0-3998"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3999"><a id="__codelineno-0-3999" name="__codelineno-0-3999"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-4000"><a id="__codelineno-0-4000" name="__codelineno-0-4000"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor finished with return code:"</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">)</span>
</span><span id="__span-0-4001"><a id="__codelineno-0-4001" name="__codelineno-0-4001"></a>    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-4002"><a id="__codelineno-0-4002" name="__codelineno-0-4002"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor failed with:"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-4003"><a id="__codelineno-0-4003" name="__codelineno-0-4003"></a>
</span><span id="__span-0-4004"><a id="__codelineno-0-4004" name="__codelineno-0-4004"></a>    <span class="c1"># first try to run Baysor assuming that prior segmentations are present               </span>
</span><span id="__span-0-4005"><a id="__codelineno-0-4005" name="__codelineno-0-4005"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-4006"><a id="__codelineno-0-4006" name="__codelineno-0-4006"></a>        <span class="n">run_baysor_options</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"run -p -c "</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span><span class="p">)</span>
</span><span id="__span-0-4007"><a id="__codelineno-0-4007" name="__codelineno-0-4007"></a>        <span class="n">command</span> <span class="o">=</span> <span class="n">julia_threading</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="n">run_baysor_options</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span>\
</span><span id="__span-0-4008"><a id="__codelineno-0-4008" name="__codelineno-0-4008"></a>            <span class="nb">str</span><span class="p">(</span><span class="n">baysor_input_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" -o "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">baysor_output_path</span><span class="p">)</span> <span class="o">+</span> \
</span><span id="__span-0-4009"><a id="__codelineno-0-4009" name="__codelineno-0-4009"></a>            <span class="s2">" --polygon-format GeometryCollectionLegacy --count-matrix-format tsv :cell_id"</span>
</span><span id="__span-0-4010"><a id="__codelineno-0-4010" name="__codelineno-0-4010"></a>        <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-4011"><a id="__codelineno-0-4011" name="__codelineno-0-4011"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor finished with return code:"</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">)</span>
</span><span id="__span-0-4012"><a id="__codelineno-0-4012" name="__codelineno-0-4012"></a>    <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span><span class="p">:</span>
</span><span id="__span-0-4013"><a id="__codelineno-0-4013" name="__codelineno-0-4013"></a>        <span class="c1"># then fall back and run without prior segmentations.</span>
</span><span id="__span-0-4014"><a id="__codelineno-0-4014" name="__codelineno-0-4014"></a>        <span class="c1"># IMPORTANT: the .toml file has to be defined correctly for this to work!</span>
</span><span id="__span-0-4015"><a id="__codelineno-0-4015" name="__codelineno-0-4015"></a>        <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-4016"><a id="__codelineno-0-4016" name="__codelineno-0-4016"></a>            <span class="n">run_baysor_options</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">"run -p -c "</span> <span class="o">+</span><span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_options</span><span class="p">)</span>
</span><span id="__span-0-4017"><a id="__codelineno-0-4017" name="__codelineno-0-4017"></a>            <span class="n">command</span> <span class="o">=</span> <span class="n">julia_threading</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_baysor_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span> <span class="n">run_baysor_options</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">+</span>\
</span><span id="__span-0-4018"><a id="__codelineno-0-4018" name="__codelineno-0-4018"></a>                <span class="nb">str</span><span class="p">(</span><span class="n">baysor_input_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" -o "</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">baysor_output_path</span><span class="p">)</span> <span class="o">+</span> <span class="s2">" --count-matrix-format tsv"</span>
</span><span id="__span-0-4019"><a id="__codelineno-0-4019" name="__codelineno-0-4019"></a>            <span class="n">result</span> <span class="o">=</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">,</span> <span class="n">shell</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="__span-0-4020"><a id="__codelineno-0-4020" name="__codelineno-0-4020"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor finished with return code:"</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">returncode</span><span class="p">)</span>
</span><span id="__span-0-4021"><a id="__codelineno-0-4021" name="__codelineno-0-4021"></a>        <span class="k">except</span> <span class="n">subprocess</span><span class="o">.</span><span class="n">CalledProcessError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-4022"><a id="__codelineno-0-4022" name="__codelineno-0-4022"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Baysor failed with:"</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_coord_of_xform_px"> <code class="highlight language-python"><span class="n">save_coord_of_xform_px</span><span class="p">(</span><span class="n">of_xform_px</span><span class="p">,</span> <span class="n">tile</span><span class="p">,</span> <span class="n">block_size</span><span class="p">,</span> <span class="n">block_stride</span><span class="p">,</span> <span class="nb">round</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save fidicual optical flow matrix for one round and tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>of_xform_px</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Local fidicual optical flow matrix for one round and tile.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>block_size</code> </td> <td> <code><span title="typing.Sequence">Sequence</span>[<span title="float">float</span>]</code> </td> <td> <div class="doc-md-description"> <p>Block size for pixel warp</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>block_stride</code> </td> <td> <code><span title="typing.Sequence">Sequence</span>[<span title="float">float</span>]</code> </td> <td> <div class="doc-md-description"> <p>Block stride for pixel warp</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code> </td> <td> <div class="doc-md-description"> <p>Return future array.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2890">2890</a></span>
<span class="normal"><a href="#__codelineno-0-2891">2891</a></span>
<span class="normal"><a href="#__codelineno-0-2892">2892</a></span>
<span class="normal"><a href="#__codelineno-0-2893">2893</a></span>
<span class="normal"><a href="#__codelineno-0-2894">2894</a></span>
<span class="normal"><a href="#__codelineno-0-2895">2895</a></span>
<span class="normal"><a href="#__codelineno-0-2896">2896</a></span>
<span class="normal"><a href="#__codelineno-0-2897">2897</a></span>
<span class="normal"><a href="#__codelineno-0-2898">2898</a></span>
<span class="normal"><a href="#__codelineno-0-2899">2899</a></span>
<span class="normal"><a href="#__codelineno-0-2900">2900</a></span>
<span class="normal"><a href="#__codelineno-0-2901">2901</a></span>
<span class="normal"><a href="#__codelineno-0-2902">2902</a></span>
<span class="normal"><a href="#__codelineno-0-2903">2903</a></span>
<span class="normal"><a href="#__codelineno-0-2904">2904</a></span>
<span class="normal"><a href="#__codelineno-0-2905">2905</a></span>
<span class="normal"><a href="#__codelineno-0-2906">2906</a></span>
<span class="normal"><a href="#__codelineno-0-2907">2907</a></span>
<span class="normal"><a href="#__codelineno-0-2908">2908</a></span>
<span class="normal"><a href="#__codelineno-0-2909">2909</a></span>
<span class="normal"><a href="#__codelineno-0-2910">2910</a></span>
<span class="normal"><a href="#__codelineno-0-2911">2911</a></span>
<span class="normal"><a href="#__codelineno-0-2912">2912</a></span>
<span class="normal"><a href="#__codelineno-0-2913">2913</a></span>
<span class="normal"><a href="#__codelineno-0-2914">2914</a></span>
<span class="normal"><a href="#__codelineno-0-2915">2915</a></span>
<span class="normal"><a href="#__codelineno-0-2916">2916</a></span>
<span class="normal"><a href="#__codelineno-0-2917">2917</a></span>
<span class="normal"><a href="#__codelineno-0-2918">2918</a></span>
<span class="normal"><a href="#__codelineno-0-2919">2919</a></span>
<span class="normal"><a href="#__codelineno-0-2920">2920</a></span>
<span class="normal"><a href="#__codelineno-0-2921">2921</a></span>
<span class="normal"><a href="#__codelineno-0-2922">2922</a></span>
<span class="normal"><a href="#__codelineno-0-2923">2923</a></span>
<span class="normal"><a href="#__codelineno-0-2924">2924</a></span>
<span class="normal"><a href="#__codelineno-0-2925">2925</a></span>
<span class="normal"><a href="#__codelineno-0-2926">2926</a></span>
<span class="normal"><a href="#__codelineno-0-2927">2927</a></span>
<span class="normal"><a href="#__codelineno-0-2928">2928</a></span>
<span class="normal"><a href="#__codelineno-0-2929">2929</a></span>
<span class="normal"><a href="#__codelineno-0-2930">2930</a></span>
<span class="normal"><a href="#__codelineno-0-2931">2931</a></span>
<span class="normal"><a href="#__codelineno-0-2932">2932</a></span>
<span class="normal"><a href="#__codelineno-0-2933">2933</a></span>
<span class="normal"><a href="#__codelineno-0-2934">2934</a></span>
<span class="normal"><a href="#__codelineno-0-2935">2935</a></span>
<span class="normal"><a href="#__codelineno-0-2936">2936</a></span>
<span class="normal"><a href="#__codelineno-0-2937">2937</a></span>
<span class="normal"><a href="#__codelineno-0-2938">2938</a></span>
<span class="normal"><a href="#__codelineno-0-2939">2939</a></span>
<span class="normal"><a href="#__codelineno-0-2940">2940</a></span>
<span class="normal"><a href="#__codelineno-0-2941">2941</a></span>
<span class="normal"><a href="#__codelineno-0-2942">2942</a></span>
<span class="normal"><a href="#__codelineno-0-2943">2943</a></span>
<span class="normal"><a href="#__codelineno-0-2944">2944</a></span>
<span class="normal"><a href="#__codelineno-0-2945">2945</a></span>
<span class="normal"><a href="#__codelineno-0-2946">2946</a></span>
<span class="normal"><a href="#__codelineno-0-2947">2947</a></span>
<span class="normal"><a href="#__codelineno-0-2948">2948</a></span>
<span class="normal"><a href="#__codelineno-0-2949">2949</a></span>
<span class="normal"><a href="#__codelineno-0-2950">2950</a></span>
<span class="normal"><a href="#__codelineno-0-2951">2951</a></span>
<span class="normal"><a href="#__codelineno-0-2952">2952</a></span>
<span class="normal"><a href="#__codelineno-0-2953">2953</a></span>
<span class="normal"><a href="#__codelineno-0-2954">2954</a></span>
<span class="normal"><a href="#__codelineno-0-2955">2955</a></span>
<span class="normal"><a href="#__codelineno-0-2956">2956</a></span>
<span class="normal"><a href="#__codelineno-0-2957">2957</a></span>
<span class="normal"><a href="#__codelineno-0-2958">2958</a></span>
<span class="normal"><a href="#__codelineno-0-2959">2959</a></span>
<span class="normal"><a href="#__codelineno-0-2960">2960</a></span>
<span class="normal"><a href="#__codelineno-0-2961">2961</a></span>
<span class="normal"><a href="#__codelineno-0-2962">2962</a></span>
<span class="normal"><a href="#__codelineno-0-2963">2963</a></span>
<span class="normal"><a href="#__codelineno-0-2964">2964</a></span>
<span class="normal"><a href="#__codelineno-0-2965">2965</a></span>
<span class="normal"><a href="#__codelineno-0-2966">2966</a></span>
<span class="normal"><a href="#__codelineno-0-2967">2967</a></span>
<span class="normal"><a href="#__codelineno-0-2968">2968</a></span>
<span class="normal"><a href="#__codelineno-0-2969">2969</a></span>
<span class="normal"><a href="#__codelineno-0-2970">2970</a></span>
<span class="normal"><a href="#__codelineno-0-2971">2971</a></span>
<span class="normal"><a href="#__codelineno-0-2972">2972</a></span>
<span class="normal"><a href="#__codelineno-0-2973">2973</a></span>
<span class="normal"><a href="#__codelineno-0-2974">2974</a></span>
<span class="normal"><a href="#__codelineno-0-2975">2975</a></span>
<span class="normal"><a href="#__codelineno-0-2976">2976</a></span>
<span class="normal"><a href="#__codelineno-0-2977">2977</a></span>
<span class="normal"><a href="#__codelineno-0-2978">2978</a></span>
<span class="normal"><a href="#__codelineno-0-2979">2979</a></span>
<span class="normal"><a href="#__codelineno-0-2980">2980</a></span>
<span class="normal"><a href="#__codelineno-0-2981">2981</a></span>
<span class="normal"><a href="#__codelineno-0-2982">2982</a></span>
<span class="normal"><a href="#__codelineno-0-2983">2983</a></span>
<span class="normal"><a href="#__codelineno-0-2984">2984</a></span>
<span class="normal"><a href="#__codelineno-0-2985">2985</a></span>
<span class="normal"><a href="#__codelineno-0-2986">2986</a></span>
<span class="normal"><a href="#__codelineno-0-2987">2987</a></span>
<span class="normal"><a href="#__codelineno-0-2988">2988</a></span>
<span class="normal"><a href="#__codelineno-0-2989">2989</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2890"><a id="__codelineno-0-2890" name="__codelineno-0-2890"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_coord_of_xform_px</span><span class="p">(</span>
</span><span id="__span-0-2891"><a id="__codelineno-0-2891" name="__codelineno-0-2891"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2892"><a id="__codelineno-0-2892" name="__codelineno-0-2892"></a>    <span class="n">of_xform_px</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-2893"><a id="__codelineno-0-2893" name="__codelineno-0-2893"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2894"><a id="__codelineno-0-2894" name="__codelineno-0-2894"></a>    <span class="n">block_size</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-2895"><a id="__codelineno-0-2895" name="__codelineno-0-2895"></a>    <span class="n">block_stride</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-2896"><a id="__codelineno-0-2896" name="__codelineno-0-2896"></a>    <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2897"><a id="__codelineno-0-2897" name="__codelineno-0-2897"></a>    <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2898"><a id="__codelineno-0-2898" name="__codelineno-0-2898"></a><span class="p">):</span>
</span><span id="__span-0-2899"><a id="__codelineno-0-2899" name="__codelineno-0-2899"></a><span class="w">    </span><span class="sd">"""Save fidicual optical flow matrix for one round and tile.</span>
</span><span id="__span-0-2900"><a id="__codelineno-0-2900" name="__codelineno-0-2900"></a>
</span><span id="__span-0-2901"><a id="__codelineno-0-2901" name="__codelineno-0-2901"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-2902"><a id="__codelineno-0-2902" name="__codelineno-0-2902"></a><span class="sd">    ----------</span>
</span><span id="__span-0-2903"><a id="__codelineno-0-2903" name="__codelineno-0-2903"></a><span class="sd">    of_xform_px : ArrayLike</span>
</span><span id="__span-0-2904"><a id="__codelineno-0-2904" name="__codelineno-0-2904"></a><span class="sd">        Local fidicual optical flow matrix for one round and tile.</span>
</span><span id="__span-0-2905"><a id="__codelineno-0-2905" name="__codelineno-0-2905"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-2906"><a id="__codelineno-0-2906" name="__codelineno-0-2906"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-2907"><a id="__codelineno-0-2907" name="__codelineno-0-2907"></a><span class="sd">    block_size : Sequence[float]</span>
</span><span id="__span-0-2908"><a id="__codelineno-0-2908" name="__codelineno-0-2908"></a><span class="sd">        Block size for pixel warp</span>
</span><span id="__span-0-2909"><a id="__codelineno-0-2909" name="__codelineno-0-2909"></a><span class="sd">    block_stride: Sequence[float]</span>
</span><span id="__span-0-2910"><a id="__codelineno-0-2910" name="__codelineno-0-2910"></a><span class="sd">        Block stride for pixel warp</span>
</span><span id="__span-0-2911"><a id="__codelineno-0-2911" name="__codelineno-0-2911"></a><span class="sd">    round : Union[int, str] </span>
</span><span id="__span-0-2912"><a id="__codelineno-0-2912" name="__codelineno-0-2912"></a><span class="sd">        Round index or round id.</span>
</span><span id="__span-0-2913"><a id="__codelineno-0-2913" name="__codelineno-0-2913"></a><span class="sd">    return_future : Optional[bool]</span>
</span><span id="__span-0-2914"><a id="__codelineno-0-2914" name="__codelineno-0-2914"></a><span class="sd">        Return future array.</span>
</span><span id="__span-0-2915"><a id="__codelineno-0-2915" name="__codelineno-0-2915"></a><span class="sd">    """</span>
</span><span id="__span-0-2916"><a id="__codelineno-0-2916" name="__codelineno-0-2916"></a>
</span><span id="__span-0-2917"><a id="__codelineno-0-2917" name="__codelineno-0-2917"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2918"><a id="__codelineno-0-2918" name="__codelineno-0-2918"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2919"><a id="__codelineno-0-2919" name="__codelineno-0-2919"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2920"><a id="__codelineno-0-2920" name="__codelineno-0-2920"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2921"><a id="__codelineno-0-2921" name="__codelineno-0-2921"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2922"><a id="__codelineno-0-2922" name="__codelineno-0-2922"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2923"><a id="__codelineno-0-2923" name="__codelineno-0-2923"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2924"><a id="__codelineno-0-2924" name="__codelineno-0-2924"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2925"><a id="__codelineno-0-2925" name="__codelineno-0-2925"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2926"><a id="__codelineno-0-2926" name="__codelineno-0-2926"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2927"><a id="__codelineno-0-2927" name="__codelineno-0-2927"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2928"><a id="__codelineno-0-2928" name="__codelineno-0-2928"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2929"><a id="__codelineno-0-2929" name="__codelineno-0-2929"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2930"><a id="__codelineno-0-2930" name="__codelineno-0-2930"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2931"><a id="__codelineno-0-2931" name="__codelineno-0-2931"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2932"><a id="__codelineno-0-2932" name="__codelineno-0-2932"></a>
</span><span id="__span-0-2933"><a id="__codelineno-0-2933" name="__codelineno-0-2933"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2934"><a id="__codelineno-0-2934" name="__codelineno-0-2934"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2935"><a id="__codelineno-0-2935" name="__codelineno-0-2935"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2936"><a id="__codelineno-0-2936" name="__codelineno-0-2936"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2937"><a id="__codelineno-0-2937" name="__codelineno-0-2937"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2938"><a id="__codelineno-0-2938" name="__codelineno-0-2938"></a>            <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2939"><a id="__codelineno-0-2939" name="__codelineno-0-2939"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2940"><a id="__codelineno-0-2940" name="__codelineno-0-2940"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2941"><a id="__codelineno-0-2941" name="__codelineno-0-2941"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2942"><a id="__codelineno-0-2942" name="__codelineno-0-2942"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2943"><a id="__codelineno-0-2943" name="__codelineno-0-2943"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2944"><a id="__codelineno-0-2944" name="__codelineno-0-2944"></a>            <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2945"><a id="__codelineno-0-2945" name="__codelineno-0-2945"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2946"><a id="__codelineno-0-2946" name="__codelineno-0-2946"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2947"><a id="__codelineno-0-2947" name="__codelineno-0-2947"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2948"><a id="__codelineno-0-2948" name="__codelineno-0-2948"></a>    <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2949"><a id="__codelineno-0-2949" name="__codelineno-0-2949"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2950"><a id="__codelineno-0-2950" name="__codelineno-0-2950"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2951"><a id="__codelineno-0-2951" name="__codelineno-0-2951"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2952"><a id="__codelineno-0-2952" name="__codelineno-0-2952"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"opticalflow_xform_px"</span><span class="p">)</span>
</span><span id="__span-0-2953"><a id="__codelineno-0-2953" name="__codelineno-0-2953"></a>    <span class="p">)</span>
</span><span id="__span-0-2954"><a id="__codelineno-0-2954" name="__codelineno-0-2954"></a>    <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2955"><a id="__codelineno-0-2955" name="__codelineno-0-2955"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2956"><a id="__codelineno-0-2956" name="__codelineno-0-2956"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2957"><a id="__codelineno-0-2957" name="__codelineno-0-2957"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2958"><a id="__codelineno-0-2958" name="__codelineno-0-2958"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2959"><a id="__codelineno-0-2959" name="__codelineno-0-2959"></a>    <span class="p">)</span>
</span><span id="__span-0-2960"><a id="__codelineno-0-2960" name="__codelineno-0-2960"></a>
</span><span id="__span-0-2961"><a id="__codelineno-0-2961" name="__codelineno-0-2961"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2962"><a id="__codelineno-0-2962" name="__codelineno-0-2962"></a>        <span class="n">compressor</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-2963"><a id="__codelineno-0-2963" name="__codelineno-0-2963"></a>            <span class="s2">"id"</span><span class="p">:</span> <span class="s2">"blosc"</span><span class="p">,</span>
</span><span id="__span-0-2964"><a id="__codelineno-0-2964" name="__codelineno-0-2964"></a>            <span class="s2">"cname"</span><span class="p">:</span> <span class="s2">"zstd"</span><span class="p">,</span>
</span><span id="__span-0-2965"><a id="__codelineno-0-2965" name="__codelineno-0-2965"></a>            <span class="s2">"clevel"</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>
</span><span id="__span-0-2966"><a id="__codelineno-0-2966" name="__codelineno-0-2966"></a>            <span class="s2">"shuffle"</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
</span><span id="__span-0-2967"><a id="__codelineno-0-2967" name="__codelineno-0-2967"></a>        <span class="p">}</span>
</span><span id="__span-0-2968"><a id="__codelineno-0-2968" name="__codelineno-0-2968"></a>        <span class="n">spec_of</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-2969"><a id="__codelineno-0-2969" name="__codelineno-0-2969"></a>            <span class="s2">"driver"</span><span class="p">:</span> <span class="s2">"zarr"</span><span class="p">,</span>
</span><span id="__span-0-2970"><a id="__codelineno-0-2970" name="__codelineno-0-2970"></a>            <span class="s2">"kvstore"</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2971"><a id="__codelineno-0-2971" name="__codelineno-0-2971"></a>            <span class="s2">"metadata"</span><span class="p">:</span> <span class="p">{</span><span class="s2">"compressor"</span><span class="p">:</span> <span class="n">compressor</span><span class="p">},</span>
</span><span id="__span-0-2972"><a id="__codelineno-0-2972" name="__codelineno-0-2972"></a>            <span class="s2">"open"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2973"><a id="__codelineno-0-2973" name="__codelineno-0-2973"></a>            <span class="s2">"assume_metadata"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2974"><a id="__codelineno-0-2974" name="__codelineno-0-2974"></a>            <span class="s2">"create"</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2975"><a id="__codelineno-0-2975" name="__codelineno-0-2975"></a>            <span class="s2">"delete_existing"</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2976"><a id="__codelineno-0-2976" name="__codelineno-0-2976"></a>        <span class="p">}</span>
</span><span id="__span-0-2977"><a id="__codelineno-0-2977" name="__codelineno-0-2977"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-2978"><a id="__codelineno-0-2978" name="__codelineno-0-2978"></a>            <span class="n">of_xform_px</span><span class="p">,</span>
</span><span id="__span-0-2979"><a id="__codelineno-0-2979" name="__codelineno-0-2979"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-2980"><a id="__codelineno-0-2980" name="__codelineno-0-2980"></a>            <span class="n">spec_of</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-2981"><a id="__codelineno-0-2981" name="__codelineno-0-2981"></a>            <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-2982"><a id="__codelineno-0-2982" name="__codelineno-0-2982"></a>        <span class="p">)</span>
</span><span id="__span-0-2983"><a id="__codelineno-0-2983" name="__codelineno-0-2983"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2984"><a id="__codelineno-0-2984" name="__codelineno-0-2984"></a>        <span class="n">attributes</span><span class="p">[</span><span class="s2">"block_size"</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_size</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-2985"><a id="__codelineno-0-2985" name="__codelineno-0-2985"></a>        <span class="n">attributes</span><span class="p">[</span><span class="s2">"block_stride"</span><span class="p">]</span> <span class="o">=</span> <span class="n">block_stride</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-2986"><a id="__codelineno-0-2986" name="__codelineno-0-2986"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2987"><a id="__codelineno-0-2987" name="__codelineno-0-2987"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">):</span>
</span><span id="__span-0-2988"><a id="__codelineno-0-2988" name="__codelineno-0-2988"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving optical flow transform."</span><span class="p">)</span>
</span><span id="__span-0-2989"><a id="__codelineno-0-2989" name="__codelineno-0-2989"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_cellpose_segmentation_image"> <code class="highlight language-python"><span class="n">save_global_cellpose_segmentation_image</span><span class="p">(</span><span class="n">cellpose_image</span><span class="p">,</span> <span class="n">downsampling</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save Cellpose max projection, downsampled segmentation image.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>cellpose_image</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Cellpose max projection, downsampled segmentation image.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>downsampling</code> </td> <td> <code><span title="typing.Sequence">Sequence</span>[<span title="float">float</span>]</code> </td> <td> <div class="doc-md-description"> <p>Downsample factors.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code> </td> <td> <div class="doc-md-description"> <p>Return future array.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3912">3912</a></span>
<span class="normal"><a href="#__codelineno-0-3913">3913</a></span>
<span class="normal"><a href="#__codelineno-0-3914">3914</a></span>
<span class="normal"><a href="#__codelineno-0-3915">3915</a></span>
<span class="normal"><a href="#__codelineno-0-3916">3916</a></span>
<span class="normal"><a href="#__codelineno-0-3917">3917</a></span>
<span class="normal"><a href="#__codelineno-0-3918">3918</a></span>
<span class="normal"><a href="#__codelineno-0-3919">3919</a></span>
<span class="normal"><a href="#__codelineno-0-3920">3920</a></span>
<span class="normal"><a href="#__codelineno-0-3921">3921</a></span>
<span class="normal"><a href="#__codelineno-0-3922">3922</a></span>
<span class="normal"><a href="#__codelineno-0-3923">3923</a></span>
<span class="normal"><a href="#__codelineno-0-3924">3924</a></span>
<span class="normal"><a href="#__codelineno-0-3925">3925</a></span>
<span class="normal"><a href="#__codelineno-0-3926">3926</a></span>
<span class="normal"><a href="#__codelineno-0-3927">3927</a></span>
<span class="normal"><a href="#__codelineno-0-3928">3928</a></span>
<span class="normal"><a href="#__codelineno-0-3929">3929</a></span>
<span class="normal"><a href="#__codelineno-0-3930">3930</a></span>
<span class="normal"><a href="#__codelineno-0-3931">3931</a></span>
<span class="normal"><a href="#__codelineno-0-3932">3932</a></span>
<span class="normal"><a href="#__codelineno-0-3933">3933</a></span>
<span class="normal"><a href="#__codelineno-0-3934">3934</a></span>
<span class="normal"><a href="#__codelineno-0-3935">3935</a></span>
<span class="normal"><a href="#__codelineno-0-3936">3936</a></span>
<span class="normal"><a href="#__codelineno-0-3937">3937</a></span>
<span class="normal"><a href="#__codelineno-0-3938">3938</a></span>
<span class="normal"><a href="#__codelineno-0-3939">3939</a></span>
<span class="normal"><a href="#__codelineno-0-3940">3940</a></span>
<span class="normal"><a href="#__codelineno-0-3941">3941</a></span>
<span class="normal"><a href="#__codelineno-0-3942">3942</a></span>
<span class="normal"><a href="#__codelineno-0-3943">3943</a></span>
<span class="normal"><a href="#__codelineno-0-3944">3944</a></span>
<span class="normal"><a href="#__codelineno-0-3945">3945</a></span>
<span class="normal"><a href="#__codelineno-0-3946">3946</a></span>
<span class="normal"><a href="#__codelineno-0-3947">3947</a></span>
<span class="normal"><a href="#__codelineno-0-3948">3948</a></span>
<span class="normal"><a href="#__codelineno-0-3949">3949</a></span>
<span class="normal"><a href="#__codelineno-0-3950">3950</a></span>
<span class="normal"><a href="#__codelineno-0-3951">3951</a></span>
<span class="normal"><a href="#__codelineno-0-3952">3952</a></span>
<span class="normal"><a href="#__codelineno-0-3953">3953</a></span>
<span class="normal"><a href="#__codelineno-0-3954">3954</a></span>
<span class="normal"><a href="#__codelineno-0-3955">3955</a></span>
<span class="normal"><a href="#__codelineno-0-3956">3956</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3912"><a id="__codelineno-0-3912" name="__codelineno-0-3912"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_global_cellpose_segmentation_image</span><span class="p">(</span>
</span><span id="__span-0-3913"><a id="__codelineno-0-3913" name="__codelineno-0-3913"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3914"><a id="__codelineno-0-3914" name="__codelineno-0-3914"></a>    <span class="n">cellpose_image</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3915"><a id="__codelineno-0-3915" name="__codelineno-0-3915"></a>    <span class="n">downsampling</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-3916"><a id="__codelineno-0-3916" name="__codelineno-0-3916"></a>    <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-3917"><a id="__codelineno-0-3917" name="__codelineno-0-3917"></a><span class="p">):</span>
</span><span id="__span-0-3918"><a id="__codelineno-0-3918" name="__codelineno-0-3918"></a><span class="w">    </span><span class="sd">"""Save Cellpose max projection, downsampled segmentation image.</span>
</span><span id="__span-0-3919"><a id="__codelineno-0-3919" name="__codelineno-0-3919"></a>
</span><span id="__span-0-3920"><a id="__codelineno-0-3920" name="__codelineno-0-3920"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3921"><a id="__codelineno-0-3921" name="__codelineno-0-3921"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3922"><a id="__codelineno-0-3922" name="__codelineno-0-3922"></a><span class="sd">    cellpose_image : ArrayLike</span>
</span><span id="__span-0-3923"><a id="__codelineno-0-3923" name="__codelineno-0-3923"></a><span class="sd">        Cellpose max projection, downsampled segmentation image.</span>
</span><span id="__span-0-3924"><a id="__codelineno-0-3924" name="__codelineno-0-3924"></a><span class="sd">    downsampling : Sequence[float]</span>
</span><span id="__span-0-3925"><a id="__codelineno-0-3925" name="__codelineno-0-3925"></a><span class="sd">        Downsample factors.</span>
</span><span id="__span-0-3926"><a id="__codelineno-0-3926" name="__codelineno-0-3926"></a><span class="sd">    return_future : Optional[bool]</span>
</span><span id="__span-0-3927"><a id="__codelineno-0-3927" name="__codelineno-0-3927"></a><span class="sd">        Return future array.</span>
</span><span id="__span-0-3928"><a id="__codelineno-0-3928" name="__codelineno-0-3928"></a><span class="sd">    """</span>
</span><span id="__span-0-3929"><a id="__codelineno-0-3929" name="__codelineno-0-3929"></a>
</span><span id="__span-0-3930"><a id="__codelineno-0-3930" name="__codelineno-0-3930"></a>    <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3931"><a id="__codelineno-0-3931" name="__codelineno-0-3931"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-3932"><a id="__codelineno-0-3932" name="__codelineno-0-3932"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose"</span><span class="p">)</span>
</span><span id="__span-0-3933"><a id="__codelineno-0-3933" name="__codelineno-0-3933"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose.zarr"</span><span class="p">)</span>
</span><span id="__span-0-3934"><a id="__codelineno-0-3934" name="__codelineno-0-3934"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"masks_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-3935"><a id="__codelineno-0-3935" name="__codelineno-0-3935"></a>    <span class="p">)</span>
</span><span id="__span-0-3936"><a id="__codelineno-0-3936" name="__codelineno-0-3936"></a>    <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3937"><a id="__codelineno-0-3937" name="__codelineno-0-3937"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_segmentation_root_path</span>
</span><span id="__span-0-3938"><a id="__codelineno-0-3938" name="__codelineno-0-3938"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose"</span><span class="p">)</span>
</span><span id="__span-0-3939"><a id="__codelineno-0-3939" name="__codelineno-0-3939"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"cellpose.zarr"</span><span class="p">)</span>
</span><span id="__span-0-3940"><a id="__codelineno-0-3940" name="__codelineno-0-3940"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"masks_polyDT_iso_zyx"</span><span class="p">)</span>
</span><span id="__span-0-3941"><a id="__codelineno-0-3941" name="__codelineno-0-3941"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-3942"><a id="__codelineno-0-3942" name="__codelineno-0-3942"></a>    <span class="p">)</span>
</span><span id="__span-0-3943"><a id="__codelineno-0-3943" name="__codelineno-0-3943"></a>
</span><span id="__span-0-3944"><a id="__codelineno-0-3944" name="__codelineno-0-3944"></a>    <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span><span class="s2">"downsampling"</span><span class="p">:</span> <span class="n">downsampling</span><span class="p">}</span>
</span><span id="__span-0-3945"><a id="__codelineno-0-3945" name="__codelineno-0-3945"></a>
</span><span id="__span-0-3946"><a id="__codelineno-0-3946" name="__codelineno-0-3946"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3947"><a id="__codelineno-0-3947" name="__codelineno-0-3947"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3948"><a id="__codelineno-0-3948" name="__codelineno-0-3948"></a>            <span class="n">cellpose_image</span><span class="p">,</span>
</span><span id="__span-0-3949"><a id="__codelineno-0-3949" name="__codelineno-0-3949"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3950"><a id="__codelineno-0-3950" name="__codelineno-0-3950"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-3951"><a id="__codelineno-0-3951" name="__codelineno-0-3951"></a>            <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3952"><a id="__codelineno-0-3952" name="__codelineno-0-3952"></a>        <span class="p">)</span>
</span><span id="__span-0-3953"><a id="__codelineno-0-3953" name="__codelineno-0-3953"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3954"><a id="__codelineno-0-3954" name="__codelineno-0-3954"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">):</span>
</span><span id="__span-0-3955"><a id="__codelineno-0-3955" name="__codelineno-0-3955"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving Cellpose image."</span><span class="p">)</span>
</span><span id="__span-0-3956"><a id="__codelineno-0-3956" name="__codelineno-0-3956"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_coord_xforms_um"> <code class="highlight language-python"><span class="n">save_global_coord_xforms_um</span><span class="p">(</span><span class="n">affine_zyx_um</span><span class="p">,</span> <span class="n">origin_zyx_um</span><span class="p">,</span> <span class="n">spacing_zyx_um</span><span class="p">,</span> <span class="n">tile</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save global registration transform for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>affine_zyx_um</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Global affine registration transform for one tile.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>origin_zyx_um</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Global origin registration transform for one tile.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>spacing_zyx_um</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Global spacing registration transform for one tile.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3558">3558</a></span>
<span class="normal"><a href="#__codelineno-0-3559">3559</a></span>
<span class="normal"><a href="#__codelineno-0-3560">3560</a></span>
<span class="normal"><a href="#__codelineno-0-3561">3561</a></span>
<span class="normal"><a href="#__codelineno-0-3562">3562</a></span>
<span class="normal"><a href="#__codelineno-0-3563">3563</a></span>
<span class="normal"><a href="#__codelineno-0-3564">3564</a></span>
<span class="normal"><a href="#__codelineno-0-3565">3565</a></span>
<span class="normal"><a href="#__codelineno-0-3566">3566</a></span>
<span class="normal"><a href="#__codelineno-0-3567">3567</a></span>
<span class="normal"><a href="#__codelineno-0-3568">3568</a></span>
<span class="normal"><a href="#__codelineno-0-3569">3569</a></span>
<span class="normal"><a href="#__codelineno-0-3570">3570</a></span>
<span class="normal"><a href="#__codelineno-0-3571">3571</a></span>
<span class="normal"><a href="#__codelineno-0-3572">3572</a></span>
<span class="normal"><a href="#__codelineno-0-3573">3573</a></span>
<span class="normal"><a href="#__codelineno-0-3574">3574</a></span>
<span class="normal"><a href="#__codelineno-0-3575">3575</a></span>
<span class="normal"><a href="#__codelineno-0-3576">3576</a></span>
<span class="normal"><a href="#__codelineno-0-3577">3577</a></span>
<span class="normal"><a href="#__codelineno-0-3578">3578</a></span>
<span class="normal"><a href="#__codelineno-0-3579">3579</a></span>
<span class="normal"><a href="#__codelineno-0-3580">3580</a></span>
<span class="normal"><a href="#__codelineno-0-3581">3581</a></span>
<span class="normal"><a href="#__codelineno-0-3582">3582</a></span>
<span class="normal"><a href="#__codelineno-0-3583">3583</a></span>
<span class="normal"><a href="#__codelineno-0-3584">3584</a></span>
<span class="normal"><a href="#__codelineno-0-3585">3585</a></span>
<span class="normal"><a href="#__codelineno-0-3586">3586</a></span>
<span class="normal"><a href="#__codelineno-0-3587">3587</a></span>
<span class="normal"><a href="#__codelineno-0-3588">3588</a></span>
<span class="normal"><a href="#__codelineno-0-3589">3589</a></span>
<span class="normal"><a href="#__codelineno-0-3590">3590</a></span>
<span class="normal"><a href="#__codelineno-0-3591">3591</a></span>
<span class="normal"><a href="#__codelineno-0-3592">3592</a></span>
<span class="normal"><a href="#__codelineno-0-3593">3593</a></span>
<span class="normal"><a href="#__codelineno-0-3594">3594</a></span>
<span class="normal"><a href="#__codelineno-0-3595">3595</a></span>
<span class="normal"><a href="#__codelineno-0-3596">3596</a></span>
<span class="normal"><a href="#__codelineno-0-3597">3597</a></span>
<span class="normal"><a href="#__codelineno-0-3598">3598</a></span>
<span class="normal"><a href="#__codelineno-0-3599">3599</a></span>
<span class="normal"><a href="#__codelineno-0-3600">3600</a></span>
<span class="normal"><a href="#__codelineno-0-3601">3601</a></span>
<span class="normal"><a href="#__codelineno-0-3602">3602</a></span>
<span class="normal"><a href="#__codelineno-0-3603">3603</a></span>
<span class="normal"><a href="#__codelineno-0-3604">3604</a></span>
<span class="normal"><a href="#__codelineno-0-3605">3605</a></span>
<span class="normal"><a href="#__codelineno-0-3606">3606</a></span>
<span class="normal"><a href="#__codelineno-0-3607">3607</a></span>
<span class="normal"><a href="#__codelineno-0-3608">3608</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3558"><a id="__codelineno-0-3558" name="__codelineno-0-3558"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_global_coord_xforms_um</span><span class="p">(</span>
</span><span id="__span-0-3559"><a id="__codelineno-0-3559" name="__codelineno-0-3559"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3560"><a id="__codelineno-0-3560" name="__codelineno-0-3560"></a>    <span class="n">affine_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3561"><a id="__codelineno-0-3561" name="__codelineno-0-3561"></a>    <span class="n">origin_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3562"><a id="__codelineno-0-3562" name="__codelineno-0-3562"></a>    <span class="n">spacing_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3563"><a id="__codelineno-0-3563" name="__codelineno-0-3563"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3564"><a id="__codelineno-0-3564" name="__codelineno-0-3564"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-3565"><a id="__codelineno-0-3565" name="__codelineno-0-3565"></a><span class="w">    </span><span class="sd">"""Save global registration transform for one tile.</span>
</span><span id="__span-0-3566"><a id="__codelineno-0-3566" name="__codelineno-0-3566"></a>
</span><span id="__span-0-3567"><a id="__codelineno-0-3567" name="__codelineno-0-3567"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3568"><a id="__codelineno-0-3568" name="__codelineno-0-3568"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3569"><a id="__codelineno-0-3569" name="__codelineno-0-3569"></a><span class="sd">    affine_zyx_um : ArrayLike</span>
</span><span id="__span-0-3570"><a id="__codelineno-0-3570" name="__codelineno-0-3570"></a><span class="sd">        Global affine registration transform for one tile.</span>
</span><span id="__span-0-3571"><a id="__codelineno-0-3571" name="__codelineno-0-3571"></a><span class="sd">    origin_zyx_um : ArrayLike</span>
</span><span id="__span-0-3572"><a id="__codelineno-0-3572" name="__codelineno-0-3572"></a><span class="sd">        Global origin registration transform for one tile.</span>
</span><span id="__span-0-3573"><a id="__codelineno-0-3573" name="__codelineno-0-3573"></a><span class="sd">    spacing_zyx_um : ArrayLike</span>
</span><span id="__span-0-3574"><a id="__codelineno-0-3574" name="__codelineno-0-3574"></a><span class="sd">        Global spacing registration transform for one tile.</span>
</span><span id="__span-0-3575"><a id="__codelineno-0-3575" name="__codelineno-0-3575"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-3576"><a id="__codelineno-0-3576" name="__codelineno-0-3576"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-3577"><a id="__codelineno-0-3577" name="__codelineno-0-3577"></a><span class="sd">    """</span>
</span><span id="__span-0-3578"><a id="__codelineno-0-3578" name="__codelineno-0-3578"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3579"><a id="__codelineno-0-3579" name="__codelineno-0-3579"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3580"><a id="__codelineno-0-3580" name="__codelineno-0-3580"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3581"><a id="__codelineno-0-3581" name="__codelineno-0-3581"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3582"><a id="__codelineno-0-3582" name="__codelineno-0-3582"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3583"><a id="__codelineno-0-3583" name="__codelineno-0-3583"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3584"><a id="__codelineno-0-3584" name="__codelineno-0-3584"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3585"><a id="__codelineno-0-3585" name="__codelineno-0-3585"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3586"><a id="__codelineno-0-3586" name="__codelineno-0-3586"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3587"><a id="__codelineno-0-3587" name="__codelineno-0-3587"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3588"><a id="__codelineno-0-3588" name="__codelineno-0-3588"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3589"><a id="__codelineno-0-3589" name="__codelineno-0-3589"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3590"><a id="__codelineno-0-3590" name="__codelineno-0-3590"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3591"><a id="__codelineno-0-3591" name="__codelineno-0-3591"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3592"><a id="__codelineno-0-3592" name="__codelineno-0-3592"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3593"><a id="__codelineno-0-3593" name="__codelineno-0-3593"></a>
</span><span id="__span-0-3594"><a id="__codelineno-0-3594" name="__codelineno-0-3594"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3595"><a id="__codelineno-0-3595" name="__codelineno-0-3595"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3596"><a id="__codelineno-0-3596" name="__codelineno-0-3596"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-3597"><a id="__codelineno-0-3597" name="__codelineno-0-3597"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3598"><a id="__codelineno-0-3598" name="__codelineno-0-3598"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3599"><a id="__codelineno-0-3599" name="__codelineno-0-3599"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-3600"><a id="__codelineno-0-3600" name="__codelineno-0-3600"></a>        <span class="p">)</span>
</span><span id="__span-0-3601"><a id="__codelineno-0-3601" name="__codelineno-0-3601"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3602"><a id="__codelineno-0-3602" name="__codelineno-0-3602"></a>        <span class="n">attributes</span><span class="p">[</span><span class="s2">"affine_zyx_um"</span><span class="p">]</span> <span class="o">=</span> <span class="n">affine_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-3603"><a id="__codelineno-0-3603" name="__codelineno-0-3603"></a>        <span class="n">attributes</span><span class="p">[</span><span class="s2">"origin_zyx_um"</span><span class="p">]</span> <span class="o">=</span> <span class="n">origin_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-3604"><a id="__codelineno-0-3604" name="__codelineno-0-3604"></a>        <span class="n">attributes</span><span class="p">[</span><span class="s2">"spacing_zyx_um"</span><span class="p">]</span> <span class="o">=</span> <span class="n">spacing_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-3605"><a id="__codelineno-0-3605" name="__codelineno-0-3605"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3606"><a id="__codelineno-0-3606" name="__codelineno-0-3606"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-3607"><a id="__codelineno-0-3607" name="__codelineno-0-3607"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-3608"><a id="__codelineno-0-3608" name="__codelineno-0-3608"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Could not save global coordinate transforms."</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_fidicual_image"> <code class="highlight language-python"><span class="n">save_global_fidicual_image</span><span class="p">(</span><span class="n">fused_image</span><span class="p">,</span> <span class="n">affine_zyx_um</span><span class="p">,</span> <span class="n">origin_zyx_um</span><span class="p">,</span> <span class="n">spacing_zyx_um</span><span class="p">,</span> <span class="n">fusion_type</span><span class="o">=</span><span class="s1">'polyDT'</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save downsampled, fused fidicual image.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>fused_image</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Downsampled, fused fidicual image.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>affine_zyx_um</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Global affine registration transform for fused image.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>origin_zyx_um</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Global origin registration transform for fused image.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>spacing_zyx_um</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Global spacing registration transform for fused image.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>fusion_type</code> </td> <td> <code><span title="str">str</span></code> </td> <td> <div class="doc-md-description"> <p>Type of fusion (polyDT or all_channels).</p> </div> </td> <td> <code>'polyDT'</code> </td> </tr> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code> </td> <td> <div class="doc-md-description"> <p>Return future array.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3658">3658</a></span>
<span class="normal"><a href="#__codelineno-0-3659">3659</a></span>
<span class="normal"><a href="#__codelineno-0-3660">3660</a></span>
<span class="normal"><a href="#__codelineno-0-3661">3661</a></span>
<span class="normal"><a href="#__codelineno-0-3662">3662</a></span>
<span class="normal"><a href="#__codelineno-0-3663">3663</a></span>
<span class="normal"><a href="#__codelineno-0-3664">3664</a></span>
<span class="normal"><a href="#__codelineno-0-3665">3665</a></span>
<span class="normal"><a href="#__codelineno-0-3666">3666</a></span>
<span class="normal"><a href="#__codelineno-0-3667">3667</a></span>
<span class="normal"><a href="#__codelineno-0-3668">3668</a></span>
<span class="normal"><a href="#__codelineno-0-3669">3669</a></span>
<span class="normal"><a href="#__codelineno-0-3670">3670</a></span>
<span class="normal"><a href="#__codelineno-0-3671">3671</a></span>
<span class="normal"><a href="#__codelineno-0-3672">3672</a></span>
<span class="normal"><a href="#__codelineno-0-3673">3673</a></span>
<span class="normal"><a href="#__codelineno-0-3674">3674</a></span>
<span class="normal"><a href="#__codelineno-0-3675">3675</a></span>
<span class="normal"><a href="#__codelineno-0-3676">3676</a></span>
<span class="normal"><a href="#__codelineno-0-3677">3677</a></span>
<span class="normal"><a href="#__codelineno-0-3678">3678</a></span>
<span class="normal"><a href="#__codelineno-0-3679">3679</a></span>
<span class="normal"><a href="#__codelineno-0-3680">3680</a></span>
<span class="normal"><a href="#__codelineno-0-3681">3681</a></span>
<span class="normal"><a href="#__codelineno-0-3682">3682</a></span>
<span class="normal"><a href="#__codelineno-0-3683">3683</a></span>
<span class="normal"><a href="#__codelineno-0-3684">3684</a></span>
<span class="normal"><a href="#__codelineno-0-3685">3685</a></span>
<span class="normal"><a href="#__codelineno-0-3686">3686</a></span>
<span class="normal"><a href="#__codelineno-0-3687">3687</a></span>
<span class="normal"><a href="#__codelineno-0-3688">3688</a></span>
<span class="normal"><a href="#__codelineno-0-3689">3689</a></span>
<span class="normal"><a href="#__codelineno-0-3690">3690</a></span>
<span class="normal"><a href="#__codelineno-0-3691">3691</a></span>
<span class="normal"><a href="#__codelineno-0-3692">3692</a></span>
<span class="normal"><a href="#__codelineno-0-3693">3693</a></span>
<span class="normal"><a href="#__codelineno-0-3694">3694</a></span>
<span class="normal"><a href="#__codelineno-0-3695">3695</a></span>
<span class="normal"><a href="#__codelineno-0-3696">3696</a></span>
<span class="normal"><a href="#__codelineno-0-3697">3697</a></span>
<span class="normal"><a href="#__codelineno-0-3698">3698</a></span>
<span class="normal"><a href="#__codelineno-0-3699">3699</a></span>
<span class="normal"><a href="#__codelineno-0-3700">3700</a></span>
<span class="normal"><a href="#__codelineno-0-3701">3701</a></span>
<span class="normal"><a href="#__codelineno-0-3702">3702</a></span>
<span class="normal"><a href="#__codelineno-0-3703">3703</a></span>
<span class="normal"><a href="#__codelineno-0-3704">3704</a></span>
<span class="normal"><a href="#__codelineno-0-3705">3705</a></span>
<span class="normal"><a href="#__codelineno-0-3706">3706</a></span>
<span class="normal"><a href="#__codelineno-0-3707">3707</a></span>
<span class="normal"><a href="#__codelineno-0-3708">3708</a></span>
<span class="normal"><a href="#__codelineno-0-3709">3709</a></span>
<span class="normal"><a href="#__codelineno-0-3710">3710</a></span>
<span class="normal"><a href="#__codelineno-0-3711">3711</a></span>
<span class="normal"><a href="#__codelineno-0-3712">3712</a></span>
<span class="normal"><a href="#__codelineno-0-3713">3713</a></span>
<span class="normal"><a href="#__codelineno-0-3714">3714</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3658"><a id="__codelineno-0-3658" name="__codelineno-0-3658"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_global_fidicual_image</span><span class="p">(</span>
</span><span id="__span-0-3659"><a id="__codelineno-0-3659" name="__codelineno-0-3659"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3660"><a id="__codelineno-0-3660" name="__codelineno-0-3660"></a>    <span class="n">fused_image</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3661"><a id="__codelineno-0-3661" name="__codelineno-0-3661"></a>    <span class="n">affine_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3662"><a id="__codelineno-0-3662" name="__codelineno-0-3662"></a>    <span class="n">origin_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3663"><a id="__codelineno-0-3663" name="__codelineno-0-3663"></a>    <span class="n">spacing_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3664"><a id="__codelineno-0-3664" name="__codelineno-0-3664"></a>    <span class="n">fusion_type</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"polyDT"</span><span class="p">,</span>
</span><span id="__span-0-3665"><a id="__codelineno-0-3665" name="__codelineno-0-3665"></a>    <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-3666"><a id="__codelineno-0-3666" name="__codelineno-0-3666"></a><span class="p">):</span>
</span><span id="__span-0-3667"><a id="__codelineno-0-3667" name="__codelineno-0-3667"></a><span class="w">    </span><span class="sd">"""Save downsampled, fused fidicual image.</span>
</span><span id="__span-0-3668"><a id="__codelineno-0-3668" name="__codelineno-0-3668"></a>
</span><span id="__span-0-3669"><a id="__codelineno-0-3669" name="__codelineno-0-3669"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3670"><a id="__codelineno-0-3670" name="__codelineno-0-3670"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3671"><a id="__codelineno-0-3671" name="__codelineno-0-3671"></a><span class="sd">    fused_image : ArrayLike</span>
</span><span id="__span-0-3672"><a id="__codelineno-0-3672" name="__codelineno-0-3672"></a><span class="sd">        Downsampled, fused fidicual image.</span>
</span><span id="__span-0-3673"><a id="__codelineno-0-3673" name="__codelineno-0-3673"></a><span class="sd">    affine_zyx_um : ArrayLike</span>
</span><span id="__span-0-3674"><a id="__codelineno-0-3674" name="__codelineno-0-3674"></a><span class="sd">        Global affine registration transform for fused image.</span>
</span><span id="__span-0-3675"><a id="__codelineno-0-3675" name="__codelineno-0-3675"></a><span class="sd">    origin_zyx_um : ArrayLike</span>
</span><span id="__span-0-3676"><a id="__codelineno-0-3676" name="__codelineno-0-3676"></a><span class="sd">        Global origin registration transform for fused image.</span>
</span><span id="__span-0-3677"><a id="__codelineno-0-3677" name="__codelineno-0-3677"></a><span class="sd">    spacing_zyx_um : ArrayLike</span>
</span><span id="__span-0-3678"><a id="__codelineno-0-3678" name="__codelineno-0-3678"></a><span class="sd">        Global spacing registration transform for fused image.</span>
</span><span id="__span-0-3679"><a id="__codelineno-0-3679" name="__codelineno-0-3679"></a><span class="sd">    fusion_type : str</span>
</span><span id="__span-0-3680"><a id="__codelineno-0-3680" name="__codelineno-0-3680"></a><span class="sd">        Type of fusion (polyDT or all_channels).</span>
</span><span id="__span-0-3681"><a id="__codelineno-0-3681" name="__codelineno-0-3681"></a><span class="sd">    return_future : Optional[bool]</span>
</span><span id="__span-0-3682"><a id="__codelineno-0-3682" name="__codelineno-0-3682"></a><span class="sd">        Return future array.</span>
</span><span id="__span-0-3683"><a id="__codelineno-0-3683" name="__codelineno-0-3683"></a><span class="sd">    """</span>
</span><span id="__span-0-3684"><a id="__codelineno-0-3684" name="__codelineno-0-3684"></a>
</span><span id="__span-0-3685"><a id="__codelineno-0-3685" name="__codelineno-0-3685"></a>    <span class="k">if</span> <span class="n">fusion_type</span> <span class="o">==</span> <span class="s2">"polyDT"</span><span class="p">:</span>
</span><span id="__span-0-3686"><a id="__codelineno-0-3686" name="__codelineno-0-3686"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="s2">"fused_polyDT_iso_zyx"</span>
</span><span id="__span-0-3687"><a id="__codelineno-0-3687" name="__codelineno-0-3687"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3688"><a id="__codelineno-0-3688" name="__codelineno-0-3688"></a>        <span class="n">filename</span> <span class="o">=</span> <span class="s2">"fused_all_channels_zyx"</span>
</span><span id="__span-0-3689"><a id="__codelineno-0-3689" name="__codelineno-0-3689"></a>    <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3690"><a id="__codelineno-0-3690" name="__codelineno-0-3690"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused.zarr"</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="__span-0-3691"><a id="__codelineno-0-3691" name="__codelineno-0-3691"></a>    <span class="p">)</span>
</span><span id="__span-0-3692"><a id="__codelineno-0-3692" name="__codelineno-0-3692"></a>    <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3693"><a id="__codelineno-0-3693" name="__codelineno-0-3693"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_fused_root_path</span>
</span><span id="__span-0-3694"><a id="__codelineno-0-3694" name="__codelineno-0-3694"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"fused.zarr"</span><span class="p">)</span>
</span><span id="__span-0-3695"><a id="__codelineno-0-3695" name="__codelineno-0-3695"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</span><span id="__span-0-3696"><a id="__codelineno-0-3696" name="__codelineno-0-3696"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-3697"><a id="__codelineno-0-3697" name="__codelineno-0-3697"></a>    <span class="p">)</span>
</span><span id="__span-0-3698"><a id="__codelineno-0-3698" name="__codelineno-0-3698"></a>
</span><span id="__span-0-3699"><a id="__codelineno-0-3699" name="__codelineno-0-3699"></a>    <span class="n">attributes</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="__span-0-3700"><a id="__codelineno-0-3700" name="__codelineno-0-3700"></a>        <span class="s2">"affine_zyx_um"</span><span class="p">:</span> <span class="n">affine_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="__span-0-3701"><a id="__codelineno-0-3701" name="__codelineno-0-3701"></a>        <span class="s2">"origin_zyx_um"</span><span class="p">:</span> <span class="n">origin_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="__span-0-3702"><a id="__codelineno-0-3702" name="__codelineno-0-3702"></a>        <span class="s2">"spacing_zyx_um"</span><span class="p">:</span> <span class="n">spacing_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
</span><span id="__span-0-3703"><a id="__codelineno-0-3703" name="__codelineno-0-3703"></a>    <span class="p">}</span>
</span><span id="__span-0-3704"><a id="__codelineno-0-3704" name="__codelineno-0-3704"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3705"><a id="__codelineno-0-3705" name="__codelineno-0-3705"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3706"><a id="__codelineno-0-3706" name="__codelineno-0-3706"></a>            <span class="n">fused_image</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint16</span><span class="p">),</span>
</span><span id="__span-0-3707"><a id="__codelineno-0-3707" name="__codelineno-0-3707"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3708"><a id="__codelineno-0-3708" name="__codelineno-0-3708"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-3709"><a id="__codelineno-0-3709" name="__codelineno-0-3709"></a>            <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3710"><a id="__codelineno-0-3710" name="__codelineno-0-3710"></a>        <span class="p">)</span>
</span><span id="__span-0-3711"><a id="__codelineno-0-3711" name="__codelineno-0-3711"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3712"><a id="__codelineno-0-3712" name="__codelineno-0-3712"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">):</span>
</span><span id="__span-0-3713"><a id="__codelineno-0-3713" name="__codelineno-0-3713"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving fused image."</span><span class="p">)</span>
</span><span id="__span-0-3714"><a id="__codelineno-0-3714" name="__codelineno-0-3714"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_global_filtered_decoded_spots"> <code class="highlight language-python"><span class="n">save_global_filtered_decoded_spots</span><span class="p">(</span><span class="n">filtered_decoded_df</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save all decoded and filtered spots.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>filtered_decoded_df</code> </td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class="doc-md-description"> <p>All decoded and filtered spots.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3824">3824</a></span>
<span class="normal"><a href="#__codelineno-0-3825">3825</a></span>
<span class="normal"><a href="#__codelineno-0-3826">3826</a></span>
<span class="normal"><a href="#__codelineno-0-3827">3827</a></span>
<span class="normal"><a href="#__codelineno-0-3828">3828</a></span>
<span class="normal"><a href="#__codelineno-0-3829">3829</a></span>
<span class="normal"><a href="#__codelineno-0-3830">3830</a></span>
<span class="normal"><a href="#__codelineno-0-3831">3831</a></span>
<span class="normal"><a href="#__codelineno-0-3832">3832</a></span>
<span class="normal"><a href="#__codelineno-0-3833">3833</a></span>
<span class="normal"><a href="#__codelineno-0-3834">3834</a></span>
<span class="normal"><a href="#__codelineno-0-3835">3835</a></span>
<span class="normal"><a href="#__codelineno-0-3836">3836</a></span>
<span class="normal"><a href="#__codelineno-0-3837">3837</a></span>
<span class="normal"><a href="#__codelineno-0-3838">3838</a></span>
<span class="normal"><a href="#__codelineno-0-3839">3839</a></span>
<span class="normal"><a href="#__codelineno-0-3840">3840</a></span>
<span class="normal"><a href="#__codelineno-0-3841">3841</a></span>
<span class="normal"><a href="#__codelineno-0-3842">3842</a></span>
<span class="normal"><a href="#__codelineno-0-3843">3843</a></span>
<span class="normal"><a href="#__codelineno-0-3844">3844</a></span>
<span class="normal"><a href="#__codelineno-0-3845">3845</a></span>
<span class="normal"><a href="#__codelineno-0-3846">3846</a></span>
<span class="normal"><a href="#__codelineno-0-3847">3847</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3824"><a id="__codelineno-0-3824" name="__codelineno-0-3824"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_global_filtered_decoded_spots</span><span class="p">(</span>
</span><span id="__span-0-3825"><a id="__codelineno-0-3825" name="__codelineno-0-3825"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3826"><a id="__codelineno-0-3826" name="__codelineno-0-3826"></a>    <span class="n">filtered_decoded_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="__span-0-3827"><a id="__codelineno-0-3827" name="__codelineno-0-3827"></a><span class="p">):</span>
</span><span id="__span-0-3828"><a id="__codelineno-0-3828" name="__codelineno-0-3828"></a><span class="w">    </span><span class="sd">"""Save all decoded and filtered spots.</span>
</span><span id="__span-0-3829"><a id="__codelineno-0-3829" name="__codelineno-0-3829"></a>
</span><span id="__span-0-3830"><a id="__codelineno-0-3830" name="__codelineno-0-3830"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3831"><a id="__codelineno-0-3831" name="__codelineno-0-3831"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3832"><a id="__codelineno-0-3832" name="__codelineno-0-3832"></a><span class="sd">    filtered_decoded_df : pd.DataFrame</span>
</span><span id="__span-0-3833"><a id="__codelineno-0-3833" name="__codelineno-0-3833"></a><span class="sd">        All decoded and filtered spots.</span>
</span><span id="__span-0-3834"><a id="__codelineno-0-3834" name="__codelineno-0-3834"></a><span class="sd">    """</span>
</span><span id="__span-0-3835"><a id="__codelineno-0-3835" name="__codelineno-0-3835"></a>
</span><span id="__span-0-3836"><a id="__codelineno-0-3836" name="__codelineno-0-3836"></a>    <span class="n">current_global_filtered_decoded_dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-3837"><a id="__codelineno-0-3837" name="__codelineno-0-3837"></a>        <span class="s2">"all_tiles_filtered_decoded_features"</span>
</span><span id="__span-0-3838"><a id="__codelineno-0-3838" name="__codelineno-0-3838"></a>    <span class="p">)</span>
</span><span id="__span-0-3839"><a id="__codelineno-0-3839" name="__codelineno-0-3839"></a>
</span><span id="__span-0-3840"><a id="__codelineno-0-3840" name="__codelineno-0-3840"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">current_global_filtered_decoded_dir_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3841"><a id="__codelineno-0-3841" name="__codelineno-0-3841"></a>        <span class="n">current_global_filtered_decoded_dir_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-3842"><a id="__codelineno-0-3842" name="__codelineno-0-3842"></a>
</span><span id="__span-0-3843"><a id="__codelineno-0-3843" name="__codelineno-0-3843"></a>    <span class="n">current_global_filtered_decoded_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-3844"><a id="__codelineno-0-3844" name="__codelineno-0-3844"></a>        <span class="n">current_global_filtered_decoded_dir_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"decoded_features.parquet"</span><span class="p">)</span>
</span><span id="__span-0-3845"><a id="__codelineno-0-3845" name="__codelineno-0-3845"></a>    <span class="p">)</span>
</span><span id="__span-0-3846"><a id="__codelineno-0-3846" name="__codelineno-0-3846"></a>
</span><span id="__span-0-3847"><a id="__codelineno-0-3847" name="__codelineno-0-3847"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_parquet</span><span class="p">(</span><span class="n">filtered_decoded_df</span><span class="p">,</span> <span class="n">current_global_filtered_decoded_path</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_bit_linker"> <code class="highlight language-python"><span class="n">save_local_bit_linker</span><span class="p">(</span><span class="n">bit_linker</span><span class="p">,</span> <span class="n">tile</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save readout bits linked to fidicual round for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>bit_linker</code> </td> <td> <code><span title="typing.Sequence">Sequence</span>[<span title="int">int</span>]</code> </td> <td> <div class="doc-md-description"> <p>Readout bits linked to fidicual round for one tile.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1874">1874</a></span>
<span class="normal"><a href="#__codelineno-0-1875">1875</a></span>
<span class="normal"><a href="#__codelineno-0-1876">1876</a></span>
<span class="normal"><a href="#__codelineno-0-1877">1877</a></span>
<span class="normal"><a href="#__codelineno-0-1878">1878</a></span>
<span class="normal"><a href="#__codelineno-0-1879">1879</a></span>
<span class="normal"><a href="#__codelineno-0-1880">1880</a></span>
<span class="normal"><a href="#__codelineno-0-1881">1881</a></span>
<span class="normal"><a href="#__codelineno-0-1882">1882</a></span>
<span class="normal"><a href="#__codelineno-0-1883">1883</a></span>
<span class="normal"><a href="#__codelineno-0-1884">1884</a></span>
<span class="normal"><a href="#__codelineno-0-1885">1885</a></span>
<span class="normal"><a href="#__codelineno-0-1886">1886</a></span>
<span class="normal"><a href="#__codelineno-0-1887">1887</a></span>
<span class="normal"><a href="#__codelineno-0-1888">1888</a></span>
<span class="normal"><a href="#__codelineno-0-1889">1889</a></span>
<span class="normal"><a href="#__codelineno-0-1890">1890</a></span>
<span class="normal"><a href="#__codelineno-0-1891">1891</a></span>
<span class="normal"><a href="#__codelineno-0-1892">1892</a></span>
<span class="normal"><a href="#__codelineno-0-1893">1893</a></span>
<span class="normal"><a href="#__codelineno-0-1894">1894</a></span>
<span class="normal"><a href="#__codelineno-0-1895">1895</a></span>
<span class="normal"><a href="#__codelineno-0-1896">1896</a></span>
<span class="normal"><a href="#__codelineno-0-1897">1897</a></span>
<span class="normal"><a href="#__codelineno-0-1898">1898</a></span>
<span class="normal"><a href="#__codelineno-0-1899">1899</a></span>
<span class="normal"><a href="#__codelineno-0-1900">1900</a></span>
<span class="normal"><a href="#__codelineno-0-1901">1901</a></span>
<span class="normal"><a href="#__codelineno-0-1902">1902</a></span>
<span class="normal"><a href="#__codelineno-0-1903">1903</a></span>
<span class="normal"><a href="#__codelineno-0-1904">1904</a></span>
<span class="normal"><a href="#__codelineno-0-1905">1905</a></span>
<span class="normal"><a href="#__codelineno-0-1906">1906</a></span>
<span class="normal"><a href="#__codelineno-0-1907">1907</a></span>
<span class="normal"><a href="#__codelineno-0-1908">1908</a></span>
<span class="normal"><a href="#__codelineno-0-1909">1909</a></span>
<span class="normal"><a href="#__codelineno-0-1910">1910</a></span>
<span class="normal"><a href="#__codelineno-0-1911">1911</a></span>
<span class="normal"><a href="#__codelineno-0-1912">1912</a></span>
<span class="normal"><a href="#__codelineno-0-1913">1913</a></span>
<span class="normal"><a href="#__codelineno-0-1914">1914</a></span>
<span class="normal"><a href="#__codelineno-0-1915">1915</a></span>
<span class="normal"><a href="#__codelineno-0-1916">1916</a></span>
<span class="normal"><a href="#__codelineno-0-1917">1917</a></span>
<span class="normal"><a href="#__codelineno-0-1918">1918</a></span>
<span class="normal"><a href="#__codelineno-0-1919">1919</a></span>
<span class="normal"><a href="#__codelineno-0-1920">1920</a></span>
<span class="normal"><a href="#__codelineno-0-1921">1921</a></span>
<span class="normal"><a href="#__codelineno-0-1922">1922</a></span>
<span class="normal"><a href="#__codelineno-0-1923">1923</a></span>
<span class="normal"><a href="#__codelineno-0-1924">1924</a></span>
<span class="normal"><a href="#__codelineno-0-1925">1925</a></span>
<span class="normal"><a href="#__codelineno-0-1926">1926</a></span>
<span class="normal"><a href="#__codelineno-0-1927">1927</a></span>
<span class="normal"><a href="#__codelineno-0-1928">1928</a></span>
<span class="normal"><a href="#__codelineno-0-1929">1929</a></span>
<span class="normal"><a href="#__codelineno-0-1930">1930</a></span>
<span class="normal"><a href="#__codelineno-0-1931">1931</a></span>
<span class="normal"><a href="#__codelineno-0-1932">1932</a></span>
<span class="normal"><a href="#__codelineno-0-1933">1933</a></span>
<span class="normal"><a href="#__codelineno-0-1934">1934</a></span>
<span class="normal"><a href="#__codelineno-0-1935">1935</a></span>
<span class="normal"><a href="#__codelineno-0-1936">1936</a></span>
<span class="normal"><a href="#__codelineno-0-1937">1937</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1874"><a id="__codelineno-0-1874" name="__codelineno-0-1874"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_local_bit_linker</span><span class="p">(</span>
</span><span id="__span-0-1875"><a id="__codelineno-0-1875" name="__codelineno-0-1875"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-1876"><a id="__codelineno-0-1876" name="__codelineno-0-1876"></a>    <span class="n">bit_linker</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span>
</span><span id="__span-0-1877"><a id="__codelineno-0-1877" name="__codelineno-0-1877"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1878"><a id="__codelineno-0-1878" name="__codelineno-0-1878"></a>    <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-1879"><a id="__codelineno-0-1879" name="__codelineno-0-1879"></a><span class="p">):</span>
</span><span id="__span-0-1880"><a id="__codelineno-0-1880" name="__codelineno-0-1880"></a><span class="w">    </span><span class="sd">"""Save readout bits linked to fidicual round for one tile.</span>
</span><span id="__span-0-1881"><a id="__codelineno-0-1881" name="__codelineno-0-1881"></a>
</span><span id="__span-0-1882"><a id="__codelineno-0-1882" name="__codelineno-0-1882"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-1883"><a id="__codelineno-0-1883" name="__codelineno-0-1883"></a><span class="sd">    ----------</span>
</span><span id="__span-0-1884"><a id="__codelineno-0-1884" name="__codelineno-0-1884"></a><span class="sd">    bit_linker : Sequence[int]</span>
</span><span id="__span-0-1885"><a id="__codelineno-0-1885" name="__codelineno-0-1885"></a><span class="sd">        Readout bits linked to fidicual round for one tile.</span>
</span><span id="__span-0-1886"><a id="__codelineno-0-1886" name="__codelineno-0-1886"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-1887"><a id="__codelineno-0-1887" name="__codelineno-0-1887"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-1888"><a id="__codelineno-0-1888" name="__codelineno-0-1888"></a><span class="sd">    round : Union[int, str]</span>
</span><span id="__span-0-1889"><a id="__codelineno-0-1889" name="__codelineno-0-1889"></a><span class="sd">        Round index or round id.</span>
</span><span id="__span-0-1890"><a id="__codelineno-0-1890" name="__codelineno-0-1890"></a><span class="sd">    """</span>
</span><span id="__span-0-1891"><a id="__codelineno-0-1891" name="__codelineno-0-1891"></a>
</span><span id="__span-0-1892"><a id="__codelineno-0-1892" name="__codelineno-0-1892"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1893"><a id="__codelineno-0-1893" name="__codelineno-0-1893"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-1894"><a id="__codelineno-0-1894" name="__codelineno-0-1894"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-1895"><a id="__codelineno-0-1895" name="__codelineno-0-1895"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1896"><a id="__codelineno-0-1896" name="__codelineno-0-1896"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1897"><a id="__codelineno-0-1897" name="__codelineno-0-1897"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-1898"><a id="__codelineno-0-1898" name="__codelineno-0-1898"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1899"><a id="__codelineno-0-1899" name="__codelineno-0-1899"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-1900"><a id="__codelineno-0-1900" name="__codelineno-0-1900"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id."</span><span class="p">)</span>
</span><span id="__span-0-1901"><a id="__codelineno-0-1901" name="__codelineno-0-1901"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1902"><a id="__codelineno-0-1902" name="__codelineno-0-1902"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1903"><a id="__codelineno-0-1903" name="__codelineno-0-1903"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-1904"><a id="__codelineno-0-1904" name="__codelineno-0-1904"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1905"><a id="__codelineno-0-1905" name="__codelineno-0-1905"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1906"><a id="__codelineno-0-1906" name="__codelineno-0-1906"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1907"><a id="__codelineno-0-1907" name="__codelineno-0-1907"></a>
</span><span id="__span-0-1908"><a id="__codelineno-0-1908" name="__codelineno-0-1908"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-1909"><a id="__codelineno-0-1909" name="__codelineno-0-1909"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-1910"><a id="__codelineno-0-1910" name="__codelineno-0-1910"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-1911"><a id="__codelineno-0-1911" name="__codelineno-0-1911"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1912"><a id="__codelineno-0-1912" name="__codelineno-0-1912"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1913"><a id="__codelineno-0-1913" name="__codelineno-0-1913"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-1914"><a id="__codelineno-0-1914" name="__codelineno-0-1914"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-1915"><a id="__codelineno-0-1915" name="__codelineno-0-1915"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-1916"><a id="__codelineno-0-1916" name="__codelineno-0-1916"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id."</span><span class="p">)</span>
</span><span id="__span-0-1917"><a id="__codelineno-0-1917" name="__codelineno-0-1917"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1918"><a id="__codelineno-0-1918" name="__codelineno-0-1918"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1919"><a id="__codelineno-0-1919" name="__codelineno-0-1919"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-1920"><a id="__codelineno-0-1920" name="__codelineno-0-1920"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-1921"><a id="__codelineno-0-1921" name="__codelineno-0-1921"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-1922"><a id="__codelineno-0-1922" name="__codelineno-0-1922"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-1923"><a id="__codelineno-0-1923" name="__codelineno-0-1923"></a>
</span><span id="__span-0-1924"><a id="__codelineno-0-1924" name="__codelineno-0-1924"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-1925"><a id="__codelineno-0-1925" name="__codelineno-0-1925"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-1926"><a id="__codelineno-0-1926" name="__codelineno-0-1926"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-1927"><a id="__codelineno-0-1927" name="__codelineno-0-1927"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-1928"><a id="__codelineno-0-1928" name="__codelineno-0-1928"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-1929"><a id="__codelineno-0-1929" name="__codelineno-0-1929"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-1930"><a id="__codelineno-0-1930" name="__codelineno-0-1930"></a>        <span class="p">)</span>
</span><span id="__span-0-1931"><a id="__codelineno-0-1931" name="__codelineno-0-1931"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1932"><a id="__codelineno-0-1932" name="__codelineno-0-1932"></a>        <span class="n">attributes</span><span class="p">[</span><span class="s2">"bits"</span><span class="p">]</span> <span class="o">=</span> <span class="n">bit_linker</span>
</span><span id="__span-0-1933"><a id="__codelineno-0-1933" name="__codelineno-0-1933"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-1934"><a id="__codelineno-0-1934" name="__codelineno-0-1934"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-1935"><a id="__codelineno-0-1935" name="__codelineno-0-1935"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-1936"><a id="__codelineno-0-1936" name="__codelineno-0-1936"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error writing bit linker attribute."</span><span class="p">)</span>
</span><span id="__span-0-1937"><a id="__codelineno-0-1937" name="__codelineno-0-1937"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_corrected_image"> <code class="highlight language-python"><span class="n">save_local_corrected_image</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">tile</span><span class="p">,</span> <span class="n">gain_correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">hotpixel_correction</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">shading_correction</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">psf_idx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save gain and offset corrected image.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>image</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Local corrected image.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>gain_correction</code> </td> <td> <code><span title="bool">bool</span></code> </td> <td> <div class="doc-md-description"> <p>Gain correction applied (True) or not (False).</p> </div> </td> <td> <code>True</code> </td> </tr> <tr class="doc-section-item"> <td> <code>hotpixel_correction</code> </td> <td> <code><span title="bool">bool</span></code> </td> <td> <div class="doc-md-description"> <p>Hotpixel correction applied (True) or not (False).</p> </div> </td> <td> <code>True</code> </td> </tr> <tr class="doc-section-item"> <td> <code>shading_correction</code> </td> <td> <code><span title="bool">bool</span></code> </td> <td> <div class="doc-md-description"> <p>Shading correction applied (True) or not (False).</p> </div> </td> <td> <code>False</code> </td> </tr> <tr class="doc-section-item"> <td> <code>psf_idx</code> </td> <td> <code><span title="int">int</span></code> </td> <td> <div class="doc-md-description"> <p>PSF index.</p> </div> </td> <td> <code>0</code> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class="doc-section-item"> <td> <code>bit</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Bit index or bit id.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code> </td> <td> <div class="doc-md-description"> <p>Return future array.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2513">2513</a></span>
<span class="normal"><a href="#__codelineno-0-2514">2514</a></span>
<span class="normal"><a href="#__codelineno-0-2515">2515</a></span>
<span class="normal"><a href="#__codelineno-0-2516">2516</a></span>
<span class="normal"><a href="#__codelineno-0-2517">2517</a></span>
<span class="normal"><a href="#__codelineno-0-2518">2518</a></span>
<span class="normal"><a href="#__codelineno-0-2519">2519</a></span>
<span class="normal"><a href="#__codelineno-0-2520">2520</a></span>
<span class="normal"><a href="#__codelineno-0-2521">2521</a></span>
<span class="normal"><a href="#__codelineno-0-2522">2522</a></span>
<span class="normal"><a href="#__codelineno-0-2523">2523</a></span>
<span class="normal"><a href="#__codelineno-0-2524">2524</a></span>
<span class="normal"><a href="#__codelineno-0-2525">2525</a></span>
<span class="normal"><a href="#__codelineno-0-2526">2526</a></span>
<span class="normal"><a href="#__codelineno-0-2527">2527</a></span>
<span class="normal"><a href="#__codelineno-0-2528">2528</a></span>
<span class="normal"><a href="#__codelineno-0-2529">2529</a></span>
<span class="normal"><a href="#__codelineno-0-2530">2530</a></span>
<span class="normal"><a href="#__codelineno-0-2531">2531</a></span>
<span class="normal"><a href="#__codelineno-0-2532">2532</a></span>
<span class="normal"><a href="#__codelineno-0-2533">2533</a></span>
<span class="normal"><a href="#__codelineno-0-2534">2534</a></span>
<span class="normal"><a href="#__codelineno-0-2535">2535</a></span>
<span class="normal"><a href="#__codelineno-0-2536">2536</a></span>
<span class="normal"><a href="#__codelineno-0-2537">2537</a></span>
<span class="normal"><a href="#__codelineno-0-2538">2538</a></span>
<span class="normal"><a href="#__codelineno-0-2539">2539</a></span>
<span class="normal"><a href="#__codelineno-0-2540">2540</a></span>
<span class="normal"><a href="#__codelineno-0-2541">2541</a></span>
<span class="normal"><a href="#__codelineno-0-2542">2542</a></span>
<span class="normal"><a href="#__codelineno-0-2543">2543</a></span>
<span class="normal"><a href="#__codelineno-0-2544">2544</a></span>
<span class="normal"><a href="#__codelineno-0-2545">2545</a></span>
<span class="normal"><a href="#__codelineno-0-2546">2546</a></span>
<span class="normal"><a href="#__codelineno-0-2547">2547</a></span>
<span class="normal"><a href="#__codelineno-0-2548">2548</a></span>
<span class="normal"><a href="#__codelineno-0-2549">2549</a></span>
<span class="normal"><a href="#__codelineno-0-2550">2550</a></span>
<span class="normal"><a href="#__codelineno-0-2551">2551</a></span>
<span class="normal"><a href="#__codelineno-0-2552">2552</a></span>
<span class="normal"><a href="#__codelineno-0-2553">2553</a></span>
<span class="normal"><a href="#__codelineno-0-2554">2554</a></span>
<span class="normal"><a href="#__codelineno-0-2555">2555</a></span>
<span class="normal"><a href="#__codelineno-0-2556">2556</a></span>
<span class="normal"><a href="#__codelineno-0-2557">2557</a></span>
<span class="normal"><a href="#__codelineno-0-2558">2558</a></span>
<span class="normal"><a href="#__codelineno-0-2559">2559</a></span>
<span class="normal"><a href="#__codelineno-0-2560">2560</a></span>
<span class="normal"><a href="#__codelineno-0-2561">2561</a></span>
<span class="normal"><a href="#__codelineno-0-2562">2562</a></span>
<span class="normal"><a href="#__codelineno-0-2563">2563</a></span>
<span class="normal"><a href="#__codelineno-0-2564">2564</a></span>
<span class="normal"><a href="#__codelineno-0-2565">2565</a></span>
<span class="normal"><a href="#__codelineno-0-2566">2566</a></span>
<span class="normal"><a href="#__codelineno-0-2567">2567</a></span>
<span class="normal"><a href="#__codelineno-0-2568">2568</a></span>
<span class="normal"><a href="#__codelineno-0-2569">2569</a></span>
<span class="normal"><a href="#__codelineno-0-2570">2570</a></span>
<span class="normal"><a href="#__codelineno-0-2571">2571</a></span>
<span class="normal"><a href="#__codelineno-0-2572">2572</a></span>
<span class="normal"><a href="#__codelineno-0-2573">2573</a></span>
<span class="normal"><a href="#__codelineno-0-2574">2574</a></span>
<span class="normal"><a href="#__codelineno-0-2575">2575</a></span>
<span class="normal"><a href="#__codelineno-0-2576">2576</a></span>
<span class="normal"><a href="#__codelineno-0-2577">2577</a></span>
<span class="normal"><a href="#__codelineno-0-2578">2578</a></span>
<span class="normal"><a href="#__codelineno-0-2579">2579</a></span>
<span class="normal"><a href="#__codelineno-0-2580">2580</a></span>
<span class="normal"><a href="#__codelineno-0-2581">2581</a></span>
<span class="normal"><a href="#__codelineno-0-2582">2582</a></span>
<span class="normal"><a href="#__codelineno-0-2583">2583</a></span>
<span class="normal"><a href="#__codelineno-0-2584">2584</a></span>
<span class="normal"><a href="#__codelineno-0-2585">2585</a></span>
<span class="normal"><a href="#__codelineno-0-2586">2586</a></span>
<span class="normal"><a href="#__codelineno-0-2587">2587</a></span>
<span class="normal"><a href="#__codelineno-0-2588">2588</a></span>
<span class="normal"><a href="#__codelineno-0-2589">2589</a></span>
<span class="normal"><a href="#__codelineno-0-2590">2590</a></span>
<span class="normal"><a href="#__codelineno-0-2591">2591</a></span>
<span class="normal"><a href="#__codelineno-0-2592">2592</a></span>
<span class="normal"><a href="#__codelineno-0-2593">2593</a></span>
<span class="normal"><a href="#__codelineno-0-2594">2594</a></span>
<span class="normal"><a href="#__codelineno-0-2595">2595</a></span>
<span class="normal"><a href="#__codelineno-0-2596">2596</a></span>
<span class="normal"><a href="#__codelineno-0-2597">2597</a></span>
<span class="normal"><a href="#__codelineno-0-2598">2598</a></span>
<span class="normal"><a href="#__codelineno-0-2599">2599</a></span>
<span class="normal"><a href="#__codelineno-0-2600">2600</a></span>
<span class="normal"><a href="#__codelineno-0-2601">2601</a></span>
<span class="normal"><a href="#__codelineno-0-2602">2602</a></span>
<span class="normal"><a href="#__codelineno-0-2603">2603</a></span>
<span class="normal"><a href="#__codelineno-0-2604">2604</a></span>
<span class="normal"><a href="#__codelineno-0-2605">2605</a></span>
<span class="normal"><a href="#__codelineno-0-2606">2606</a></span>
<span class="normal"><a href="#__codelineno-0-2607">2607</a></span>
<span class="normal"><a href="#__codelineno-0-2608">2608</a></span>
<span class="normal"><a href="#__codelineno-0-2609">2609</a></span>
<span class="normal"><a href="#__codelineno-0-2610">2610</a></span>
<span class="normal"><a href="#__codelineno-0-2611">2611</a></span>
<span class="normal"><a href="#__codelineno-0-2612">2612</a></span>
<span class="normal"><a href="#__codelineno-0-2613">2613</a></span>
<span class="normal"><a href="#__codelineno-0-2614">2614</a></span>
<span class="normal"><a href="#__codelineno-0-2615">2615</a></span>
<span class="normal"><a href="#__codelineno-0-2616">2616</a></span>
<span class="normal"><a href="#__codelineno-0-2617">2617</a></span>
<span class="normal"><a href="#__codelineno-0-2618">2618</a></span>
<span class="normal"><a href="#__codelineno-0-2619">2619</a></span>
<span class="normal"><a href="#__codelineno-0-2620">2620</a></span>
<span class="normal"><a href="#__codelineno-0-2621">2621</a></span>
<span class="normal"><a href="#__codelineno-0-2622">2622</a></span>
<span class="normal"><a href="#__codelineno-0-2623">2623</a></span>
<span class="normal"><a href="#__codelineno-0-2624">2624</a></span>
<span class="normal"><a href="#__codelineno-0-2625">2625</a></span>
<span class="normal"><a href="#__codelineno-0-2626">2626</a></span>
<span class="normal"><a href="#__codelineno-0-2627">2627</a></span>
<span class="normal"><a href="#__codelineno-0-2628">2628</a></span>
<span class="normal"><a href="#__codelineno-0-2629">2629</a></span>
<span class="normal"><a href="#__codelineno-0-2630">2630</a></span>
<span class="normal"><a href="#__codelineno-0-2631">2631</a></span>
<span class="normal"><a href="#__codelineno-0-2632">2632</a></span>
<span class="normal"><a href="#__codelineno-0-2633">2633</a></span>
<span class="normal"><a href="#__codelineno-0-2634">2634</a></span>
<span class="normal"><a href="#__codelineno-0-2635">2635</a></span>
<span class="normal"><a href="#__codelineno-0-2636">2636</a></span>
<span class="normal"><a href="#__codelineno-0-2637">2637</a></span>
<span class="normal"><a href="#__codelineno-0-2638">2638</a></span>
<span class="normal"><a href="#__codelineno-0-2639">2639</a></span>
<span class="normal"><a href="#__codelineno-0-2640">2640</a></span>
<span class="normal"><a href="#__codelineno-0-2641">2641</a></span>
<span class="normal"><a href="#__codelineno-0-2642">2642</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2513"><a id="__codelineno-0-2513" name="__codelineno-0-2513"></a> <span class="k">def</span><span class="w"> </span><span class="nf">save_local_corrected_image</span><span class="p">(</span>
</span><span id="__span-0-2514"><a id="__codelineno-0-2514" name="__codelineno-0-2514"></a>     <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2515"><a id="__codelineno-0-2515" name="__codelineno-0-2515"></a>     <span class="n">image</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-2516"><a id="__codelineno-0-2516" name="__codelineno-0-2516"></a>     <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2517"><a id="__codelineno-0-2517" name="__codelineno-0-2517"></a>     <span class="n">gain_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2518"><a id="__codelineno-0-2518" name="__codelineno-0-2518"></a>     <span class="n">hotpixel_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-2519"><a id="__codelineno-0-2519" name="__codelineno-0-2519"></a>     <span class="n">shading_correction</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2520"><a id="__codelineno-0-2520" name="__codelineno-0-2520"></a>     <span class="n">psf_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="__span-0-2521"><a id="__codelineno-0-2521" name="__codelineno-0-2521"></a>     <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2522"><a id="__codelineno-0-2522" name="__codelineno-0-2522"></a>     <span class="n">bit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2523"><a id="__codelineno-0-2523" name="__codelineno-0-2523"></a>     <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-2524"><a id="__codelineno-0-2524" name="__codelineno-0-2524"></a> <span class="p">):</span>
</span><span id="__span-0-2525"><a id="__codelineno-0-2525" name="__codelineno-0-2525"></a><span class="w">     </span><span class="sd">"""Save gain and offset corrected image.</span>
</span><span id="__span-0-2526"><a id="__codelineno-0-2526" name="__codelineno-0-2526"></a>
</span><span id="__span-0-2527"><a id="__codelineno-0-2527" name="__codelineno-0-2527"></a><span class="sd">     Parameters</span>
</span><span id="__span-0-2528"><a id="__codelineno-0-2528" name="__codelineno-0-2528"></a><span class="sd">     ----------</span>
</span><span id="__span-0-2529"><a id="__codelineno-0-2529" name="__codelineno-0-2529"></a><span class="sd">     image : ArrayLike</span>
</span><span id="__span-0-2530"><a id="__codelineno-0-2530" name="__codelineno-0-2530"></a><span class="sd">         Local corrected image.</span>
</span><span id="__span-0-2531"><a id="__codelineno-0-2531" name="__codelineno-0-2531"></a><span class="sd">     tile : Union[int, str]</span>
</span><span id="__span-0-2532"><a id="__codelineno-0-2532" name="__codelineno-0-2532"></a><span class="sd">         Tile index or tile id.</span>
</span><span id="__span-0-2533"><a id="__codelineno-0-2533" name="__codelineno-0-2533"></a><span class="sd">     gain_correction : bool</span>
</span><span id="__span-0-2534"><a id="__codelineno-0-2534" name="__codelineno-0-2534"></a><span class="sd">         Gain correction applied (True) or not (False).</span>
</span><span id="__span-0-2535"><a id="__codelineno-0-2535" name="__codelineno-0-2535"></a><span class="sd">     hotpixel_correction : bool</span>
</span><span id="__span-0-2536"><a id="__codelineno-0-2536" name="__codelineno-0-2536"></a><span class="sd">         Hotpixel correction applied (True) or not (False).</span>
</span><span id="__span-0-2537"><a id="__codelineno-0-2537" name="__codelineno-0-2537"></a><span class="sd">     shading_correction : bool</span>
</span><span id="__span-0-2538"><a id="__codelineno-0-2538" name="__codelineno-0-2538"></a><span class="sd">         Shading correction applied (True) or not (False).</span>
</span><span id="__span-0-2539"><a id="__codelineno-0-2539" name="__codelineno-0-2539"></a><span class="sd">     psf_idx : int</span>
</span><span id="__span-0-2540"><a id="__codelineno-0-2540" name="__codelineno-0-2540"></a><span class="sd">         PSF index.</span>
</span><span id="__span-0-2541"><a id="__codelineno-0-2541" name="__codelineno-0-2541"></a><span class="sd">     round : Optional[Union[int, str]]</span>
</span><span id="__span-0-2542"><a id="__codelineno-0-2542" name="__codelineno-0-2542"></a><span class="sd">         Round index or round id.</span>
</span><span id="__span-0-2543"><a id="__codelineno-0-2543" name="__codelineno-0-2543"></a><span class="sd">     bit : Optional[Union[int, str]]</span>
</span><span id="__span-0-2544"><a id="__codelineno-0-2544" name="__codelineno-0-2544"></a><span class="sd">         Bit index or bit id.</span>
</span><span id="__span-0-2545"><a id="__codelineno-0-2545" name="__codelineno-0-2545"></a><span class="sd">     return_future : Optional[bool]</span>
</span><span id="__span-0-2546"><a id="__codelineno-0-2546" name="__codelineno-0-2546"></a><span class="sd">         Return future array.</span>
</span><span id="__span-0-2547"><a id="__codelineno-0-2547" name="__codelineno-0-2547"></a><span class="sd">"""</span>
</span><span id="__span-0-2548"><a id="__codelineno-0-2548" name="__codelineno-0-2548"></a>
</span><span id="__span-0-2549"><a id="__codelineno-0-2549" name="__codelineno-0-2549"></a>     <span class="k">if</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2550"><a id="__codelineno-0-2550" name="__codelineno-0-2550"></a>         <span class="nb">print</span><span class="p">(</span><span class="s2">"Provide either 'round' or 'bit', but not both"</span><span class="p">)</span>
</span><span id="__span-0-2551"><a id="__codelineno-0-2551" name="__codelineno-0-2551"></a>         <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2552"><a id="__codelineno-0-2552" name="__codelineno-0-2552"></a>
</span><span id="__span-0-2553"><a id="__codelineno-0-2553" name="__codelineno-0-2553"></a>     <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2554"><a id="__codelineno-0-2554" name="__codelineno-0-2554"></a>         <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2555"><a id="__codelineno-0-2555" name="__codelineno-0-2555"></a>             <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2556"><a id="__codelineno-0-2556" name="__codelineno-0-2556"></a>             <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2557"><a id="__codelineno-0-2557" name="__codelineno-0-2557"></a>         <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2558"><a id="__codelineno-0-2558" name="__codelineno-0-2558"></a>             <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2559"><a id="__codelineno-0-2559" name="__codelineno-0-2559"></a>     <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2560"><a id="__codelineno-0-2560" name="__codelineno-0-2560"></a>         <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2561"><a id="__codelineno-0-2561" name="__codelineno-0-2561"></a>             <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2562"><a id="__codelineno-0-2562" name="__codelineno-0-2562"></a>             <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2563"><a id="__codelineno-0-2563" name="__codelineno-0-2563"></a>         <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2564"><a id="__codelineno-0-2564" name="__codelineno-0-2564"></a>             <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2565"><a id="__codelineno-0-2565" name="__codelineno-0-2565"></a>     <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2566"><a id="__codelineno-0-2566" name="__codelineno-0-2566"></a>         <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2567"><a id="__codelineno-0-2567" name="__codelineno-0-2567"></a>         <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2568"><a id="__codelineno-0-2568" name="__codelineno-0-2568"></a>
</span><span id="__span-0-2569"><a id="__codelineno-0-2569" name="__codelineno-0-2569"></a>     <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-2570"><a id="__codelineno-0-2570" name="__codelineno-0-2570"></a>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2571"><a id="__codelineno-0-2571" name="__codelineno-0-2571"></a>             <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-2572"><a id="__codelineno-0-2572" name="__codelineno-0-2572"></a>                 <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-2573"><a id="__codelineno-0-2573" name="__codelineno-0-2573"></a>                 <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2574"><a id="__codelineno-0-2574" name="__codelineno-0-2574"></a>             <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2575"><a id="__codelineno-0-2575" name="__codelineno-0-2575"></a>                 <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-2576"><a id="__codelineno-0-2576" name="__codelineno-0-2576"></a>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2577"><a id="__codelineno-0-2577" name="__codelineno-0-2577"></a>             <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-2578"><a id="__codelineno-0-2578" name="__codelineno-0-2578"></a>                 <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-2579"><a id="__codelineno-0-2579" name="__codelineno-0-2579"></a>                 <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2580"><a id="__codelineno-0-2580" name="__codelineno-0-2580"></a>             <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2581"><a id="__codelineno-0-2581" name="__codelineno-0-2581"></a>                 <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-2582"><a id="__codelineno-0-2582" name="__codelineno-0-2582"></a>         <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2583"><a id="__codelineno-0-2583" name="__codelineno-0-2583"></a>             <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2584"><a id="__codelineno-0-2584" name="__codelineno-0-2584"></a>             <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2585"><a id="__codelineno-0-2585" name="__codelineno-0-2585"></a>         <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2586"><a id="__codelineno-0-2586" name="__codelineno-0-2586"></a>             <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-2587"><a id="__codelineno-0-2587" name="__codelineno-0-2587"></a>             <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2588"><a id="__codelineno-0-2588" name="__codelineno-0-2588"></a>             <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2589"><a id="__codelineno-0-2589" name="__codelineno-0-2589"></a>             <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"corrected_data"</span><span class="p">)</span>
</span><span id="__span-0-2590"><a id="__codelineno-0-2590" name="__codelineno-0-2590"></a>         <span class="p">)</span>
</span><span id="__span-0-2591"><a id="__codelineno-0-2591" name="__codelineno-0-2591"></a>         <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2592"><a id="__codelineno-0-2592" name="__codelineno-0-2592"></a>             <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-2593"><a id="__codelineno-0-2593" name="__codelineno-0-2593"></a>             <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2594"><a id="__codelineno-0-2594" name="__codelineno-0-2594"></a>             <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2595"><a id="__codelineno-0-2595" name="__codelineno-0-2595"></a>             <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2596"><a id="__codelineno-0-2596" name="__codelineno-0-2596"></a>         <span class="p">)</span>
</span><span id="__span-0-2597"><a id="__codelineno-0-2597" name="__codelineno-0-2597"></a>     <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2598"><a id="__codelineno-0-2598" name="__codelineno-0-2598"></a>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2599"><a id="__codelineno-0-2599" name="__codelineno-0-2599"></a>             <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2600"><a id="__codelineno-0-2600" name="__codelineno-0-2600"></a>                 <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2601"><a id="__codelineno-0-2601" name="__codelineno-0-2601"></a>                 <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2602"><a id="__codelineno-0-2602" name="__codelineno-0-2602"></a>             <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2603"><a id="__codelineno-0-2603" name="__codelineno-0-2603"></a>                 <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2604"><a id="__codelineno-0-2604" name="__codelineno-0-2604"></a>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2605"><a id="__codelineno-0-2605" name="__codelineno-0-2605"></a>             <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2606"><a id="__codelineno-0-2606" name="__codelineno-0-2606"></a>                 <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2607"><a id="__codelineno-0-2607" name="__codelineno-0-2607"></a>                 <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2608"><a id="__codelineno-0-2608" name="__codelineno-0-2608"></a>             <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2609"><a id="__codelineno-0-2609" name="__codelineno-0-2609"></a>                 <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2610"><a id="__codelineno-0-2610" name="__codelineno-0-2610"></a>         <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2611"><a id="__codelineno-0-2611" name="__codelineno-0-2611"></a>             <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2612"><a id="__codelineno-0-2612" name="__codelineno-0-2612"></a>             <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2613"><a id="__codelineno-0-2613" name="__codelineno-0-2613"></a>         <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2614"><a id="__codelineno-0-2614" name="__codelineno-0-2614"></a>             <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2615"><a id="__codelineno-0-2615" name="__codelineno-0-2615"></a>             <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2616"><a id="__codelineno-0-2616" name="__codelineno-0-2616"></a>             <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2617"><a id="__codelineno-0-2617" name="__codelineno-0-2617"></a>             <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"corrected_data"</span><span class="p">)</span>
</span><span id="__span-0-2618"><a id="__codelineno-0-2618" name="__codelineno-0-2618"></a>         <span class="p">)</span>
</span><span id="__span-0-2619"><a id="__codelineno-0-2619" name="__codelineno-0-2619"></a>         <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2620"><a id="__codelineno-0-2620" name="__codelineno-0-2620"></a>             <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2621"><a id="__codelineno-0-2621" name="__codelineno-0-2621"></a>             <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2622"><a id="__codelineno-0-2622" name="__codelineno-0-2622"></a>             <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2623"><a id="__codelineno-0-2623" name="__codelineno-0-2623"></a>             <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2624"><a id="__codelineno-0-2624" name="__codelineno-0-2624"></a>         <span class="p">)</span>
</span><span id="__span-0-2625"><a id="__codelineno-0-2625" name="__codelineno-0-2625"></a>
</span><span id="__span-0-2626"><a id="__codelineno-0-2626" name="__codelineno-0-2626"></a>     <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2627"><a id="__codelineno-0-2627" name="__codelineno-0-2627"></a>         <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-2628"><a id="__codelineno-0-2628" name="__codelineno-0-2628"></a>             <span class="n">image</span><span class="p">,</span>
</span><span id="__span-0-2629"><a id="__codelineno-0-2629" name="__codelineno-0-2629"></a>             <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-2630"><a id="__codelineno-0-2630" name="__codelineno-0-2630"></a>             <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="p">,</span>
</span><span id="__span-0-2631"><a id="__codelineno-0-2631" name="__codelineno-0-2631"></a>             <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-2632"><a id="__codelineno-0-2632" name="__codelineno-0-2632"></a>         <span class="p">)</span>
</span><span id="__span-0-2633"><a id="__codelineno-0-2633" name="__codelineno-0-2633"></a>         <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2634"><a id="__codelineno-0-2634" name="__codelineno-0-2634"></a>         <span class="n">attributes</span><span class="p">[</span><span class="s2">"gain_correction"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">gain_correction</span><span class="p">,)</span>
</span><span id="__span-0-2635"><a id="__codelineno-0-2635" name="__codelineno-0-2635"></a>         <span class="n">attributes</span><span class="p">[</span><span class="s2">"hotpixel_correction"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">hotpixel_correction</span><span class="p">,)</span>
</span><span id="__span-0-2636"><a id="__codelineno-0-2636" name="__codelineno-0-2636"></a>         <span class="n">attributes</span><span class="p">[</span><span class="s2">"shading_correction"</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">shading_correction</span><span class="p">)</span>
</span><span id="__span-0-2637"><a id="__codelineno-0-2637" name="__codelineno-0-2637"></a>         <span class="n">attributes</span><span class="p">[</span><span class="s2">"psf_idx"</span><span class="p">]</span> <span class="o">=</span> <span class="n">psf_idx</span>
</span><span id="__span-0-2638"><a id="__codelineno-0-2638" name="__codelineno-0-2638"></a>         <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2639"><a id="__codelineno-0-2639" name="__codelineno-0-2639"></a>     <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-2640"><a id="__codelineno-0-2640" name="__codelineno-0-2640"></a>         <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-2641"><a id="__codelineno-0-2641" name="__codelineno-0-2641"></a>         <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving corrected image."</span><span class="p">)</span>
</span><span id="__span-0-2642"><a id="__codelineno-0-2642" name="__codelineno-0-2642"></a>         <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_decoded_spots"> <code class="highlight language-python"><span class="n">save_local_decoded_spots</span><span class="p">(</span><span class="n">features_df</span><span class="p">,</span> <span class="n">tile</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save decoded spots and features for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>features_df</code> </td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class="doc-md-description"> <p>Decoded spots and features for one tile.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3760">3760</a></span>
<span class="normal"><a href="#__codelineno-0-3761">3761</a></span>
<span class="normal"><a href="#__codelineno-0-3762">3762</a></span>
<span class="normal"><a href="#__codelineno-0-3763">3763</a></span>
<span class="normal"><a href="#__codelineno-0-3764">3764</a></span>
<span class="normal"><a href="#__codelineno-0-3765">3765</a></span>
<span class="normal"><a href="#__codelineno-0-3766">3766</a></span>
<span class="normal"><a href="#__codelineno-0-3767">3767</a></span>
<span class="normal"><a href="#__codelineno-0-3768">3768</a></span>
<span class="normal"><a href="#__codelineno-0-3769">3769</a></span>
<span class="normal"><a href="#__codelineno-0-3770">3770</a></span>
<span class="normal"><a href="#__codelineno-0-3771">3771</a></span>
<span class="normal"><a href="#__codelineno-0-3772">3772</a></span>
<span class="normal"><a href="#__codelineno-0-3773">3773</a></span>
<span class="normal"><a href="#__codelineno-0-3774">3774</a></span>
<span class="normal"><a href="#__codelineno-0-3775">3775</a></span>
<span class="normal"><a href="#__codelineno-0-3776">3776</a></span>
<span class="normal"><a href="#__codelineno-0-3777">3777</a></span>
<span class="normal"><a href="#__codelineno-0-3778">3778</a></span>
<span class="normal"><a href="#__codelineno-0-3779">3779</a></span>
<span class="normal"><a href="#__codelineno-0-3780">3780</a></span>
<span class="normal"><a href="#__codelineno-0-3781">3781</a></span>
<span class="normal"><a href="#__codelineno-0-3782">3782</a></span>
<span class="normal"><a href="#__codelineno-0-3783">3783</a></span>
<span class="normal"><a href="#__codelineno-0-3784">3784</a></span>
<span class="normal"><a href="#__codelineno-0-3785">3785</a></span>
<span class="normal"><a href="#__codelineno-0-3786">3786</a></span>
<span class="normal"><a href="#__codelineno-0-3787">3787</a></span>
<span class="normal"><a href="#__codelineno-0-3788">3788</a></span>
<span class="normal"><a href="#__codelineno-0-3789">3789</a></span>
<span class="normal"><a href="#__codelineno-0-3790">3790</a></span>
<span class="normal"><a href="#__codelineno-0-3791">3791</a></span>
<span class="normal"><a href="#__codelineno-0-3792">3792</a></span>
<span class="normal"><a href="#__codelineno-0-3793">3793</a></span>
<span class="normal"><a href="#__codelineno-0-3794">3794</a></span>
<span class="normal"><a href="#__codelineno-0-3795">3795</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3760"><a id="__codelineno-0-3760" name="__codelineno-0-3760"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_local_decoded_spots</span><span class="p">(</span>
</span><span id="__span-0-3761"><a id="__codelineno-0-3761" name="__codelineno-0-3761"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3762"><a id="__codelineno-0-3762" name="__codelineno-0-3762"></a>    <span class="n">features_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="__span-0-3763"><a id="__codelineno-0-3763" name="__codelineno-0-3763"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3764"><a id="__codelineno-0-3764" name="__codelineno-0-3764"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-3765"><a id="__codelineno-0-3765" name="__codelineno-0-3765"></a><span class="w">    </span><span class="sd">"""Save decoded spots and features for one tile.</span>
</span><span id="__span-0-3766"><a id="__codelineno-0-3766" name="__codelineno-0-3766"></a>
</span><span id="__span-0-3767"><a id="__codelineno-0-3767" name="__codelineno-0-3767"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3768"><a id="__codelineno-0-3768" name="__codelineno-0-3768"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3769"><a id="__codelineno-0-3769" name="__codelineno-0-3769"></a><span class="sd">    features_df : pd.DataFrame</span>
</span><span id="__span-0-3770"><a id="__codelineno-0-3770" name="__codelineno-0-3770"></a><span class="sd">        Decoded spots and features for one tile.</span>
</span><span id="__span-0-3771"><a id="__codelineno-0-3771" name="__codelineno-0-3771"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-3772"><a id="__codelineno-0-3772" name="__codelineno-0-3772"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-3773"><a id="__codelineno-0-3773" name="__codelineno-0-3773"></a><span class="sd">    """</span>
</span><span id="__span-0-3774"><a id="__codelineno-0-3774" name="__codelineno-0-3774"></a>
</span><span id="__span-0-3775"><a id="__codelineno-0-3775" name="__codelineno-0-3775"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3776"><a id="__codelineno-0-3776" name="__codelineno-0-3776"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3777"><a id="__codelineno-0-3777" name="__codelineno-0-3777"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3778"><a id="__codelineno-0-3778" name="__codelineno-0-3778"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3779"><a id="__codelineno-0-3779" name="__codelineno-0-3779"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3780"><a id="__codelineno-0-3780" name="__codelineno-0-3780"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3781"><a id="__codelineno-0-3781" name="__codelineno-0-3781"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3782"><a id="__codelineno-0-3782" name="__codelineno-0-3782"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3783"><a id="__codelineno-0-3783" name="__codelineno-0-3783"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3784"><a id="__codelineno-0-3784" name="__codelineno-0-3784"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3785"><a id="__codelineno-0-3785" name="__codelineno-0-3785"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3786"><a id="__codelineno-0-3786" name="__codelineno-0-3786"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3787"><a id="__codelineno-0-3787" name="__codelineno-0-3787"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3788"><a id="__codelineno-0-3788" name="__codelineno-0-3788"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3789"><a id="__codelineno-0-3789" name="__codelineno-0-3789"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3790"><a id="__codelineno-0-3790" name="__codelineno-0-3790"></a>
</span><span id="__span-0-3791"><a id="__codelineno-0-3791" name="__codelineno-0-3791"></a>    <span class="n">current_tile_features_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_decoded_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-3792"><a id="__codelineno-0-3792" name="__codelineno-0-3792"></a>        <span class="n">tile_id</span> <span class="o">+</span> <span class="s2">"_decoded_features.parquet"</span>
</span><span id="__span-0-3793"><a id="__codelineno-0-3793" name="__codelineno-0-3793"></a>    <span class="p">)</span>
</span><span id="__span-0-3794"><a id="__codelineno-0-3794" name="__codelineno-0-3794"></a>
</span><span id="__span-0-3795"><a id="__codelineno-0-3795" name="__codelineno-0-3795"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_parquet</span><span class="p">(</span><span class="n">features_df</span><span class="p">,</span> <span class="n">current_tile_features_path</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_registered_image"> <code class="highlight language-python"><span class="n">save_local_registered_image</span><span class="p">(</span><span class="n">registered_image</span><span class="p">,</span> <span class="n">tile</span><span class="p">,</span> <span class="n">deconvolution</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bit</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save registered, deconvolved image.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>registered_image</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Registered, deconvolved image.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>deconvolution</code> </td> <td> <code><span title="bool">bool</span></code> </td> <td> <div class="doc-md-description"> <p>Deconvolution applied (True) or not (False).</p> </div> </td> <td> <code>True</code> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class="doc-section-item"> <td> <code>bit</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Bit index or bit id.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code> </td> <td> <div class="doc-md-description"> <p>Return future array.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3100">3100</a></span>
<span class="normal"><a href="#__codelineno-0-3101">3101</a></span>
<span class="normal"><a href="#__codelineno-0-3102">3102</a></span>
<span class="normal"><a href="#__codelineno-0-3103">3103</a></span>
<span class="normal"><a href="#__codelineno-0-3104">3104</a></span>
<span class="normal"><a href="#__codelineno-0-3105">3105</a></span>
<span class="normal"><a href="#__codelineno-0-3106">3106</a></span>
<span class="normal"><a href="#__codelineno-0-3107">3107</a></span>
<span class="normal"><a href="#__codelineno-0-3108">3108</a></span>
<span class="normal"><a href="#__codelineno-0-3109">3109</a></span>
<span class="normal"><a href="#__codelineno-0-3110">3110</a></span>
<span class="normal"><a href="#__codelineno-0-3111">3111</a></span>
<span class="normal"><a href="#__codelineno-0-3112">3112</a></span>
<span class="normal"><a href="#__codelineno-0-3113">3113</a></span>
<span class="normal"><a href="#__codelineno-0-3114">3114</a></span>
<span class="normal"><a href="#__codelineno-0-3115">3115</a></span>
<span class="normal"><a href="#__codelineno-0-3116">3116</a></span>
<span class="normal"><a href="#__codelineno-0-3117">3117</a></span>
<span class="normal"><a href="#__codelineno-0-3118">3118</a></span>
<span class="normal"><a href="#__codelineno-0-3119">3119</a></span>
<span class="normal"><a href="#__codelineno-0-3120">3120</a></span>
<span class="normal"><a href="#__codelineno-0-3121">3121</a></span>
<span class="normal"><a href="#__codelineno-0-3122">3122</a></span>
<span class="normal"><a href="#__codelineno-0-3123">3123</a></span>
<span class="normal"><a href="#__codelineno-0-3124">3124</a></span>
<span class="normal"><a href="#__codelineno-0-3125">3125</a></span>
<span class="normal"><a href="#__codelineno-0-3126">3126</a></span>
<span class="normal"><a href="#__codelineno-0-3127">3127</a></span>
<span class="normal"><a href="#__codelineno-0-3128">3128</a></span>
<span class="normal"><a href="#__codelineno-0-3129">3129</a></span>
<span class="normal"><a href="#__codelineno-0-3130">3130</a></span>
<span class="normal"><a href="#__codelineno-0-3131">3131</a></span>
<span class="normal"><a href="#__codelineno-0-3132">3132</a></span>
<span class="normal"><a href="#__codelineno-0-3133">3133</a></span>
<span class="normal"><a href="#__codelineno-0-3134">3134</a></span>
<span class="normal"><a href="#__codelineno-0-3135">3135</a></span>
<span class="normal"><a href="#__codelineno-0-3136">3136</a></span>
<span class="normal"><a href="#__codelineno-0-3137">3137</a></span>
<span class="normal"><a href="#__codelineno-0-3138">3138</a></span>
<span class="normal"><a href="#__codelineno-0-3139">3139</a></span>
<span class="normal"><a href="#__codelineno-0-3140">3140</a></span>
<span class="normal"><a href="#__codelineno-0-3141">3141</a></span>
<span class="normal"><a href="#__codelineno-0-3142">3142</a></span>
<span class="normal"><a href="#__codelineno-0-3143">3143</a></span>
<span class="normal"><a href="#__codelineno-0-3144">3144</a></span>
<span class="normal"><a href="#__codelineno-0-3145">3145</a></span>
<span class="normal"><a href="#__codelineno-0-3146">3146</a></span>
<span class="normal"><a href="#__codelineno-0-3147">3147</a></span>
<span class="normal"><a href="#__codelineno-0-3148">3148</a></span>
<span class="normal"><a href="#__codelineno-0-3149">3149</a></span>
<span class="normal"><a href="#__codelineno-0-3150">3150</a></span>
<span class="normal"><a href="#__codelineno-0-3151">3151</a></span>
<span class="normal"><a href="#__codelineno-0-3152">3152</a></span>
<span class="normal"><a href="#__codelineno-0-3153">3153</a></span>
<span class="normal"><a href="#__codelineno-0-3154">3154</a></span>
<span class="normal"><a href="#__codelineno-0-3155">3155</a></span>
<span class="normal"><a href="#__codelineno-0-3156">3156</a></span>
<span class="normal"><a href="#__codelineno-0-3157">3157</a></span>
<span class="normal"><a href="#__codelineno-0-3158">3158</a></span>
<span class="normal"><a href="#__codelineno-0-3159">3159</a></span>
<span class="normal"><a href="#__codelineno-0-3160">3160</a></span>
<span class="normal"><a href="#__codelineno-0-3161">3161</a></span>
<span class="normal"><a href="#__codelineno-0-3162">3162</a></span>
<span class="normal"><a href="#__codelineno-0-3163">3163</a></span>
<span class="normal"><a href="#__codelineno-0-3164">3164</a></span>
<span class="normal"><a href="#__codelineno-0-3165">3165</a></span>
<span class="normal"><a href="#__codelineno-0-3166">3166</a></span>
<span class="normal"><a href="#__codelineno-0-3167">3167</a></span>
<span class="normal"><a href="#__codelineno-0-3168">3168</a></span>
<span class="normal"><a href="#__codelineno-0-3169">3169</a></span>
<span class="normal"><a href="#__codelineno-0-3170">3170</a></span>
<span class="normal"><a href="#__codelineno-0-3171">3171</a></span>
<span class="normal"><a href="#__codelineno-0-3172">3172</a></span>
<span class="normal"><a href="#__codelineno-0-3173">3173</a></span>
<span class="normal"><a href="#__codelineno-0-3174">3174</a></span>
<span class="normal"><a href="#__codelineno-0-3175">3175</a></span>
<span class="normal"><a href="#__codelineno-0-3176">3176</a></span>
<span class="normal"><a href="#__codelineno-0-3177">3177</a></span>
<span class="normal"><a href="#__codelineno-0-3178">3178</a></span>
<span class="normal"><a href="#__codelineno-0-3179">3179</a></span>
<span class="normal"><a href="#__codelineno-0-3180">3180</a></span>
<span class="normal"><a href="#__codelineno-0-3181">3181</a></span>
<span class="normal"><a href="#__codelineno-0-3182">3182</a></span>
<span class="normal"><a href="#__codelineno-0-3183">3183</a></span>
<span class="normal"><a href="#__codelineno-0-3184">3184</a></span>
<span class="normal"><a href="#__codelineno-0-3185">3185</a></span>
<span class="normal"><a href="#__codelineno-0-3186">3186</a></span>
<span class="normal"><a href="#__codelineno-0-3187">3187</a></span>
<span class="normal"><a href="#__codelineno-0-3188">3188</a></span>
<span class="normal"><a href="#__codelineno-0-3189">3189</a></span>
<span class="normal"><a href="#__codelineno-0-3190">3190</a></span>
<span class="normal"><a href="#__codelineno-0-3191">3191</a></span>
<span class="normal"><a href="#__codelineno-0-3192">3192</a></span>
<span class="normal"><a href="#__codelineno-0-3193">3193</a></span>
<span class="normal"><a href="#__codelineno-0-3194">3194</a></span>
<span class="normal"><a href="#__codelineno-0-3195">3195</a></span>
<span class="normal"><a href="#__codelineno-0-3196">3196</a></span>
<span class="normal"><a href="#__codelineno-0-3197">3197</a></span>
<span class="normal"><a href="#__codelineno-0-3198">3198</a></span>
<span class="normal"><a href="#__codelineno-0-3199">3199</a></span>
<span class="normal"><a href="#__codelineno-0-3200">3200</a></span>
<span class="normal"><a href="#__codelineno-0-3201">3201</a></span>
<span class="normal"><a href="#__codelineno-0-3202">3202</a></span>
<span class="normal"><a href="#__codelineno-0-3203">3203</a></span>
<span class="normal"><a href="#__codelineno-0-3204">3204</a></span>
<span class="normal"><a href="#__codelineno-0-3205">3205</a></span>
<span class="normal"><a href="#__codelineno-0-3206">3206</a></span>
<span class="normal"><a href="#__codelineno-0-3207">3207</a></span>
<span class="normal"><a href="#__codelineno-0-3208">3208</a></span>
<span class="normal"><a href="#__codelineno-0-3209">3209</a></span>
<span class="normal"><a href="#__codelineno-0-3210">3210</a></span>
<span class="normal"><a href="#__codelineno-0-3211">3211</a></span>
<span class="normal"><a href="#__codelineno-0-3212">3212</a></span>
<span class="normal"><a href="#__codelineno-0-3213">3213</a></span>
<span class="normal"><a href="#__codelineno-0-3214">3214</a></span>
<span class="normal"><a href="#__codelineno-0-3215">3215</a></span>
<span class="normal"><a href="#__codelineno-0-3216">3216</a></span>
<span class="normal"><a href="#__codelineno-0-3217">3217</a></span>
<span class="normal"><a href="#__codelineno-0-3218">3218</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3100"><a id="__codelineno-0-3100" name="__codelineno-0-3100"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_local_registered_image</span><span class="p">(</span>
</span><span id="__span-0-3101"><a id="__codelineno-0-3101" name="__codelineno-0-3101"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3102"><a id="__codelineno-0-3102" name="__codelineno-0-3102"></a>    <span class="n">registered_image</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3103"><a id="__codelineno-0-3103" name="__codelineno-0-3103"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3104"><a id="__codelineno-0-3104" name="__codelineno-0-3104"></a>    <span class="n">deconvolution</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="__span-0-3105"><a id="__codelineno-0-3105" name="__codelineno-0-3105"></a>    <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-3106"><a id="__codelineno-0-3106" name="__codelineno-0-3106"></a>    <span class="n">bit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-3107"><a id="__codelineno-0-3107" name="__codelineno-0-3107"></a>    <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-3108"><a id="__codelineno-0-3108" name="__codelineno-0-3108"></a><span class="p">):</span>
</span><span id="__span-0-3109"><a id="__codelineno-0-3109" name="__codelineno-0-3109"></a><span class="w">    </span><span class="sd">"""Save registered, deconvolved image.</span>
</span><span id="__span-0-3110"><a id="__codelineno-0-3110" name="__codelineno-0-3110"></a>
</span><span id="__span-0-3111"><a id="__codelineno-0-3111" name="__codelineno-0-3111"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3112"><a id="__codelineno-0-3112" name="__codelineno-0-3112"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3113"><a id="__codelineno-0-3113" name="__codelineno-0-3113"></a><span class="sd">    registered_image : ArrayLike</span>
</span><span id="__span-0-3114"><a id="__codelineno-0-3114" name="__codelineno-0-3114"></a><span class="sd">        Registered, deconvolved image.</span>
</span><span id="__span-0-3115"><a id="__codelineno-0-3115" name="__codelineno-0-3115"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-3116"><a id="__codelineno-0-3116" name="__codelineno-0-3116"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-3117"><a id="__codelineno-0-3117" name="__codelineno-0-3117"></a><span class="sd">    deconvolution : bool</span>
</span><span id="__span-0-3118"><a id="__codelineno-0-3118" name="__codelineno-0-3118"></a><span class="sd">        Deconvolution applied (True) or not (False).</span>
</span><span id="__span-0-3119"><a id="__codelineno-0-3119" name="__codelineno-0-3119"></a><span class="sd">    round : Optional[Union[int, str]]</span>
</span><span id="__span-0-3120"><a id="__codelineno-0-3120" name="__codelineno-0-3120"></a><span class="sd">        Round index or round id.</span>
</span><span id="__span-0-3121"><a id="__codelineno-0-3121" name="__codelineno-0-3121"></a><span class="sd">    bit : Optional[Union[int, str]]</span>
</span><span id="__span-0-3122"><a id="__codelineno-0-3122" name="__codelineno-0-3122"></a><span class="sd">        Bit index or bit id.</span>
</span><span id="__span-0-3123"><a id="__codelineno-0-3123" name="__codelineno-0-3123"></a><span class="sd">    return_future : Optional[bool]</span>
</span><span id="__span-0-3124"><a id="__codelineno-0-3124" name="__codelineno-0-3124"></a><span class="sd">        Return future array.</span>
</span><span id="__span-0-3125"><a id="__codelineno-0-3125" name="__codelineno-0-3125"></a><span class="sd">    """</span>
</span><span id="__span-0-3126"><a id="__codelineno-0-3126" name="__codelineno-0-3126"></a>
</span><span id="__span-0-3127"><a id="__codelineno-0-3127" name="__codelineno-0-3127"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-3128"><a id="__codelineno-0-3128" name="__codelineno-0-3128"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Provide either 'round' or 'bit', but not both"</span><span class="p">)</span>
</span><span id="__span-0-3129"><a id="__codelineno-0-3129" name="__codelineno-0-3129"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3130"><a id="__codelineno-0-3130" name="__codelineno-0-3130"></a>
</span><span id="__span-0-3131"><a id="__codelineno-0-3131" name="__codelineno-0-3131"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3132"><a id="__codelineno-0-3132" name="__codelineno-0-3132"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3133"><a id="__codelineno-0-3133" name="__codelineno-0-3133"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3134"><a id="__codelineno-0-3134" name="__codelineno-0-3134"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3135"><a id="__codelineno-0-3135" name="__codelineno-0-3135"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3136"><a id="__codelineno-0-3136" name="__codelineno-0-3136"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3137"><a id="__codelineno-0-3137" name="__codelineno-0-3137"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3138"><a id="__codelineno-0-3138" name="__codelineno-0-3138"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3139"><a id="__codelineno-0-3139" name="__codelineno-0-3139"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3140"><a id="__codelineno-0-3140" name="__codelineno-0-3140"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3141"><a id="__codelineno-0-3141" name="__codelineno-0-3141"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3142"><a id="__codelineno-0-3142" name="__codelineno-0-3142"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3143"><a id="__codelineno-0-3143" name="__codelineno-0-3143"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3144"><a id="__codelineno-0-3144" name="__codelineno-0-3144"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3145"><a id="__codelineno-0-3145" name="__codelineno-0-3145"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3146"><a id="__codelineno-0-3146" name="__codelineno-0-3146"></a>
</span><span id="__span-0-3147"><a id="__codelineno-0-3147" name="__codelineno-0-3147"></a>    <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-3148"><a id="__codelineno-0-3148" name="__codelineno-0-3148"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3149"><a id="__codelineno-0-3149" name="__codelineno-0-3149"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-3150"><a id="__codelineno-0-3150" name="__codelineno-0-3150"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-3151"><a id="__codelineno-0-3151" name="__codelineno-0-3151"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3152"><a id="__codelineno-0-3152" name="__codelineno-0-3152"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3153"><a id="__codelineno-0-3153" name="__codelineno-0-3153"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-3154"><a id="__codelineno-0-3154" name="__codelineno-0-3154"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3155"><a id="__codelineno-0-3155" name="__codelineno-0-3155"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-3156"><a id="__codelineno-0-3156" name="__codelineno-0-3156"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-3157"><a id="__codelineno-0-3157" name="__codelineno-0-3157"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3158"><a id="__codelineno-0-3158" name="__codelineno-0-3158"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3159"><a id="__codelineno-0-3159" name="__codelineno-0-3159"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-3160"><a id="__codelineno-0-3160" name="__codelineno-0-3160"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3161"><a id="__codelineno-0-3161" name="__codelineno-0-3161"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3162"><a id="__codelineno-0-3162" name="__codelineno-0-3162"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3163"><a id="__codelineno-0-3163" name="__codelineno-0-3163"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3164"><a id="__codelineno-0-3164" name="__codelineno-0-3164"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-3165"><a id="__codelineno-0-3165" name="__codelineno-0-3165"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3166"><a id="__codelineno-0-3166" name="__codelineno-0-3166"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3167"><a id="__codelineno-0-3167" name="__codelineno-0-3167"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_decon_data"</span><span class="p">)</span>
</span><span id="__span-0-3168"><a id="__codelineno-0-3168" name="__codelineno-0-3168"></a>        <span class="p">)</span>
</span><span id="__span-0-3169"><a id="__codelineno-0-3169" name="__codelineno-0-3169"></a>        <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3170"><a id="__codelineno-0-3170" name="__codelineno-0-3170"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-3171"><a id="__codelineno-0-3171" name="__codelineno-0-3171"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3172"><a id="__codelineno-0-3172" name="__codelineno-0-3172"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3173"><a id="__codelineno-0-3173" name="__codelineno-0-3173"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-3174"><a id="__codelineno-0-3174" name="__codelineno-0-3174"></a>        <span class="p">)</span>
</span><span id="__span-0-3175"><a id="__codelineno-0-3175" name="__codelineno-0-3175"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3176"><a id="__codelineno-0-3176" name="__codelineno-0-3176"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3177"><a id="__codelineno-0-3177" name="__codelineno-0-3177"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-3178"><a id="__codelineno-0-3178" name="__codelineno-0-3178"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-3179"><a id="__codelineno-0-3179" name="__codelineno-0-3179"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3180"><a id="__codelineno-0-3180" name="__codelineno-0-3180"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3181"><a id="__codelineno-0-3181" name="__codelineno-0-3181"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-3182"><a id="__codelineno-0-3182" name="__codelineno-0-3182"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3183"><a id="__codelineno-0-3183" name="__codelineno-0-3183"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-3184"><a id="__codelineno-0-3184" name="__codelineno-0-3184"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-3185"><a id="__codelineno-0-3185" name="__codelineno-0-3185"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3186"><a id="__codelineno-0-3186" name="__codelineno-0-3186"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3187"><a id="__codelineno-0-3187" name="__codelineno-0-3187"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-3188"><a id="__codelineno-0-3188" name="__codelineno-0-3188"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3189"><a id="__codelineno-0-3189" name="__codelineno-0-3189"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3190"><a id="__codelineno-0-3190" name="__codelineno-0-3190"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3191"><a id="__codelineno-0-3191" name="__codelineno-0-3191"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3192"><a id="__codelineno-0-3192" name="__codelineno-0-3192"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-3193"><a id="__codelineno-0-3193" name="__codelineno-0-3193"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3194"><a id="__codelineno-0-3194" name="__codelineno-0-3194"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3195"><a id="__codelineno-0-3195" name="__codelineno-0-3195"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_decon_data"</span><span class="p">)</span>
</span><span id="__span-0-3196"><a id="__codelineno-0-3196" name="__codelineno-0-3196"></a>        <span class="p">)</span>
</span><span id="__span-0-3197"><a id="__codelineno-0-3197" name="__codelineno-0-3197"></a>        <span class="n">current_local_zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3198"><a id="__codelineno-0-3198" name="__codelineno-0-3198"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-3199"><a id="__codelineno-0-3199" name="__codelineno-0-3199"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3200"><a id="__codelineno-0-3200" name="__codelineno-0-3200"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3201"><a id="__codelineno-0-3201" name="__codelineno-0-3201"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-3202"><a id="__codelineno-0-3202" name="__codelineno-0-3202"></a>        <span class="p">)</span>
</span><span id="__span-0-3203"><a id="__codelineno-0-3203" name="__codelineno-0-3203"></a>
</span><span id="__span-0-3204"><a id="__codelineno-0-3204" name="__codelineno-0-3204"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3205"><a id="__codelineno-0-3205" name="__codelineno-0-3205"></a>        <span class="n">spec</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</span><span id="__span-0-3206"><a id="__codelineno-0-3206" name="__codelineno-0-3206"></a>        <span class="n">spec</span><span class="p">[</span><span class="s2">"metadata"</span><span class="p">][</span><span class="s2">"dtype"</span><span class="p">]</span> <span class="o">=</span> <span class="s2">"&lt;u2"</span>
</span><span id="__span-0-3207"><a id="__codelineno-0-3207" name="__codelineno-0-3207"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3208"><a id="__codelineno-0-3208" name="__codelineno-0-3208"></a>            <span class="n">registered_image</span><span class="p">,</span>
</span><span id="__span-0-3209"><a id="__codelineno-0-3209" name="__codelineno-0-3209"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3210"><a id="__codelineno-0-3210" name="__codelineno-0-3210"></a>            <span class="n">spec</span><span class="p">,</span>
</span><span id="__span-0-3211"><a id="__codelineno-0-3211" name="__codelineno-0-3211"></a>            <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3212"><a id="__codelineno-0-3212" name="__codelineno-0-3212"></a>        <span class="p">)</span>
</span><span id="__span-0-3213"><a id="__codelineno-0-3213" name="__codelineno-0-3213"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3214"><a id="__codelineno-0-3214" name="__codelineno-0-3214"></a>        <span class="n">attributes</span><span class="p">[</span><span class="s2">"deconvolution"</span><span class="p">]</span> <span class="o">=</span> <span class="n">deconvolution</span>
</span><span id="__span-0-3215"><a id="__codelineno-0-3215" name="__codelineno-0-3215"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">current_local_zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-3216"><a id="__codelineno-0-3216" name="__codelineno-0-3216"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="ne">TimeoutError</span><span class="p">):</span>
</span><span id="__span-0-3217"><a id="__codelineno-0-3217" name="__codelineno-0-3217"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving corrected image."</span><span class="p">)</span>
</span><span id="__span-0-3218"><a id="__codelineno-0-3218" name="__codelineno-0-3218"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_rigid_xform_xyz_px"> <code class="highlight language-python"><span class="n">save_local_rigid_xform_xyz_px</span><span class="p">(</span><span class="n">rigid_xform_xyz_px</span><span class="p">,</span> <span class="n">tile</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save calculated rigid registration transform for one round and tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>rigid_xform_xyz_px</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Local rigid registration transform for one round and tile.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>rigid_xform_xyz_px</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="numpy.typing.ArrayLike">ArrayLike</span>]</code> </td> <td> <div class="doc-md-description"> <p>Local rigid registration transform for one round and tile.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2712">2712</a></span>
<span class="normal"><a href="#__codelineno-0-2713">2713</a></span>
<span class="normal"><a href="#__codelineno-0-2714">2714</a></span>
<span class="normal"><a href="#__codelineno-0-2715">2715</a></span>
<span class="normal"><a href="#__codelineno-0-2716">2716</a></span>
<span class="normal"><a href="#__codelineno-0-2717">2717</a></span>
<span class="normal"><a href="#__codelineno-0-2718">2718</a></span>
<span class="normal"><a href="#__codelineno-0-2719">2719</a></span>
<span class="normal"><a href="#__codelineno-0-2720">2720</a></span>
<span class="normal"><a href="#__codelineno-0-2721">2721</a></span>
<span class="normal"><a href="#__codelineno-0-2722">2722</a></span>
<span class="normal"><a href="#__codelineno-0-2723">2723</a></span>
<span class="normal"><a href="#__codelineno-0-2724">2724</a></span>
<span class="normal"><a href="#__codelineno-0-2725">2725</a></span>
<span class="normal"><a href="#__codelineno-0-2726">2726</a></span>
<span class="normal"><a href="#__codelineno-0-2727">2727</a></span>
<span class="normal"><a href="#__codelineno-0-2728">2728</a></span>
<span class="normal"><a href="#__codelineno-0-2729">2729</a></span>
<span class="normal"><a href="#__codelineno-0-2730">2730</a></span>
<span class="normal"><a href="#__codelineno-0-2731">2731</a></span>
<span class="normal"><a href="#__codelineno-0-2732">2732</a></span>
<span class="normal"><a href="#__codelineno-0-2733">2733</a></span>
<span class="normal"><a href="#__codelineno-0-2734">2734</a></span>
<span class="normal"><a href="#__codelineno-0-2735">2735</a></span>
<span class="normal"><a href="#__codelineno-0-2736">2736</a></span>
<span class="normal"><a href="#__codelineno-0-2737">2737</a></span>
<span class="normal"><a href="#__codelineno-0-2738">2738</a></span>
<span class="normal"><a href="#__codelineno-0-2739">2739</a></span>
<span class="normal"><a href="#__codelineno-0-2740">2740</a></span>
<span class="normal"><a href="#__codelineno-0-2741">2741</a></span>
<span class="normal"><a href="#__codelineno-0-2742">2742</a></span>
<span class="normal"><a href="#__codelineno-0-2743">2743</a></span>
<span class="normal"><a href="#__codelineno-0-2744">2744</a></span>
<span class="normal"><a href="#__codelineno-0-2745">2745</a></span>
<span class="normal"><a href="#__codelineno-0-2746">2746</a></span>
<span class="normal"><a href="#__codelineno-0-2747">2747</a></span>
<span class="normal"><a href="#__codelineno-0-2748">2748</a></span>
<span class="normal"><a href="#__codelineno-0-2749">2749</a></span>
<span class="normal"><a href="#__codelineno-0-2750">2750</a></span>
<span class="normal"><a href="#__codelineno-0-2751">2751</a></span>
<span class="normal"><a href="#__codelineno-0-2752">2752</a></span>
<span class="normal"><a href="#__codelineno-0-2753">2753</a></span>
<span class="normal"><a href="#__codelineno-0-2754">2754</a></span>
<span class="normal"><a href="#__codelineno-0-2755">2755</a></span>
<span class="normal"><a href="#__codelineno-0-2756">2756</a></span>
<span class="normal"><a href="#__codelineno-0-2757">2757</a></span>
<span class="normal"><a href="#__codelineno-0-2758">2758</a></span>
<span class="normal"><a href="#__codelineno-0-2759">2759</a></span>
<span class="normal"><a href="#__codelineno-0-2760">2760</a></span>
<span class="normal"><a href="#__codelineno-0-2761">2761</a></span>
<span class="normal"><a href="#__codelineno-0-2762">2762</a></span>
<span class="normal"><a href="#__codelineno-0-2763">2763</a></span>
<span class="normal"><a href="#__codelineno-0-2764">2764</a></span>
<span class="normal"><a href="#__codelineno-0-2765">2765</a></span>
<span class="normal"><a href="#__codelineno-0-2766">2766</a></span>
<span class="normal"><a href="#__codelineno-0-2767">2767</a></span>
<span class="normal"><a href="#__codelineno-0-2768">2768</a></span>
<span class="normal"><a href="#__codelineno-0-2769">2769</a></span>
<span class="normal"><a href="#__codelineno-0-2770">2770</a></span>
<span class="normal"><a href="#__codelineno-0-2771">2771</a></span>
<span class="normal"><a href="#__codelineno-0-2772">2772</a></span>
<span class="normal"><a href="#__codelineno-0-2773">2773</a></span>
<span class="normal"><a href="#__codelineno-0-2774">2774</a></span>
<span class="normal"><a href="#__codelineno-0-2775">2775</a></span>
<span class="normal"><a href="#__codelineno-0-2776">2776</a></span>
<span class="normal"><a href="#__codelineno-0-2777">2777</a></span>
<span class="normal"><a href="#__codelineno-0-2778">2778</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2712"><a id="__codelineno-0-2712" name="__codelineno-0-2712"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_local_rigid_xform_xyz_px</span><span class="p">(</span>
</span><span id="__span-0-2713"><a id="__codelineno-0-2713" name="__codelineno-0-2713"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2714"><a id="__codelineno-0-2714" name="__codelineno-0-2714"></a>    <span class="n">rigid_xform_xyz_px</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-2715"><a id="__codelineno-0-2715" name="__codelineno-0-2715"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2716"><a id="__codelineno-0-2716" name="__codelineno-0-2716"></a>    <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2717"><a id="__codelineno-0-2717" name="__codelineno-0-2717"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]:</span>
</span><span id="__span-0-2718"><a id="__codelineno-0-2718" name="__codelineno-0-2718"></a><span class="w">    </span><span class="sd">"""Save calculated rigid registration transform for one round and tile.</span>
</span><span id="__span-0-2719"><a id="__codelineno-0-2719" name="__codelineno-0-2719"></a>
</span><span id="__span-0-2720"><a id="__codelineno-0-2720" name="__codelineno-0-2720"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-2721"><a id="__codelineno-0-2721" name="__codelineno-0-2721"></a><span class="sd">    ----------</span>
</span><span id="__span-0-2722"><a id="__codelineno-0-2722" name="__codelineno-0-2722"></a><span class="sd">    rigid_xform_xyz_px : ArrayLike</span>
</span><span id="__span-0-2723"><a id="__codelineno-0-2723" name="__codelineno-0-2723"></a><span class="sd">        Local rigid registration transform for one round and tile.</span>
</span><span id="__span-0-2724"><a id="__codelineno-0-2724" name="__codelineno-0-2724"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-2725"><a id="__codelineno-0-2725" name="__codelineno-0-2725"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-2726"><a id="__codelineno-0-2726" name="__codelineno-0-2726"></a><span class="sd">    round : Union[int, str]</span>
</span><span id="__span-0-2727"><a id="__codelineno-0-2727" name="__codelineno-0-2727"></a><span class="sd">        Round index or round id.</span>
</span><span id="__span-0-2728"><a id="__codelineno-0-2728" name="__codelineno-0-2728"></a>
</span><span id="__span-0-2729"><a id="__codelineno-0-2729" name="__codelineno-0-2729"></a><span class="sd">    Returns</span>
</span><span id="__span-0-2730"><a id="__codelineno-0-2730" name="__codelineno-0-2730"></a><span class="sd">    -------</span>
</span><span id="__span-0-2731"><a id="__codelineno-0-2731" name="__codelineno-0-2731"></a><span class="sd">    rigid_xform_xyz_px : Optional[ArrayLike]</span>
</span><span id="__span-0-2732"><a id="__codelineno-0-2732" name="__codelineno-0-2732"></a><span class="sd">        Local rigid registration transform for one round and tile.</span>
</span><span id="__span-0-2733"><a id="__codelineno-0-2733" name="__codelineno-0-2733"></a><span class="sd">    """</span>
</span><span id="__span-0-2734"><a id="__codelineno-0-2734" name="__codelineno-0-2734"></a>
</span><span id="__span-0-2735"><a id="__codelineno-0-2735" name="__codelineno-0-2735"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2736"><a id="__codelineno-0-2736" name="__codelineno-0-2736"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2737"><a id="__codelineno-0-2737" name="__codelineno-0-2737"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2738"><a id="__codelineno-0-2738" name="__codelineno-0-2738"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2739"><a id="__codelineno-0-2739" name="__codelineno-0-2739"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2740"><a id="__codelineno-0-2740" name="__codelineno-0-2740"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2741"><a id="__codelineno-0-2741" name="__codelineno-0-2741"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2742"><a id="__codelineno-0-2742" name="__codelineno-0-2742"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2743"><a id="__codelineno-0-2743" name="__codelineno-0-2743"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2744"><a id="__codelineno-0-2744" name="__codelineno-0-2744"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2745"><a id="__codelineno-0-2745" name="__codelineno-0-2745"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2746"><a id="__codelineno-0-2746" name="__codelineno-0-2746"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2747"><a id="__codelineno-0-2747" name="__codelineno-0-2747"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2748"><a id="__codelineno-0-2748" name="__codelineno-0-2748"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2749"><a id="__codelineno-0-2749" name="__codelineno-0-2749"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2750"><a id="__codelineno-0-2750" name="__codelineno-0-2750"></a>
</span><span id="__span-0-2751"><a id="__codelineno-0-2751" name="__codelineno-0-2751"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2752"><a id="__codelineno-0-2752" name="__codelineno-0-2752"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2753"><a id="__codelineno-0-2753" name="__codelineno-0-2753"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2754"><a id="__codelineno-0-2754" name="__codelineno-0-2754"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2755"><a id="__codelineno-0-2755" name="__codelineno-0-2755"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2756"><a id="__codelineno-0-2756" name="__codelineno-0-2756"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2757"><a id="__codelineno-0-2757" name="__codelineno-0-2757"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2758"><a id="__codelineno-0-2758" name="__codelineno-0-2758"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2759"><a id="__codelineno-0-2759" name="__codelineno-0-2759"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2760"><a id="__codelineno-0-2760" name="__codelineno-0-2760"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2761"><a id="__codelineno-0-2761" name="__codelineno-0-2761"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2762"><a id="__codelineno-0-2762" name="__codelineno-0-2762"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2763"><a id="__codelineno-0-2763" name="__codelineno-0-2763"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2764"><a id="__codelineno-0-2764" name="__codelineno-0-2764"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2765"><a id="__codelineno-0-2765" name="__codelineno-0-2765"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2766"><a id="__codelineno-0-2766" name="__codelineno-0-2766"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2767"><a id="__codelineno-0-2767" name="__codelineno-0-2767"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2768"><a id="__codelineno-0-2768" name="__codelineno-0-2768"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2769"><a id="__codelineno-0-2769" name="__codelineno-0-2769"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2770"><a id="__codelineno-0-2770" name="__codelineno-0-2770"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2771"><a id="__codelineno-0-2771" name="__codelineno-0-2771"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2772"><a id="__codelineno-0-2772" name="__codelineno-0-2772"></a>        <span class="p">)</span>
</span><span id="__span-0-2773"><a id="__codelineno-0-2773" name="__codelineno-0-2773"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2774"><a id="__codelineno-0-2774" name="__codelineno-0-2774"></a>        <span class="n">attributes</span><span class="p">[</span><span class="s2">"rigid_xform_xyz_px"</span><span class="p">]</span> <span class="o">=</span> <span class="n">rigid_xform_xyz_px</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-2775"><a id="__codelineno-0-2775" name="__codelineno-0-2775"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2776"><a id="__codelineno-0-2776" name="__codelineno-0-2776"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-2777"><a id="__codelineno-0-2777" name="__codelineno-0-2777"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error writing rigid transform attribute."</span><span class="p">)</span>
</span><span id="__span-0-2778"><a id="__codelineno-0-2778" name="__codelineno-0-2778"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_round_linker"> <code class="highlight language-python"><span class="n">save_local_round_linker</span><span class="p">(</span><span class="n">round_linker</span><span class="p">,</span> <span class="n">tile</span><span class="p">,</span> <span class="n">bit</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save fidicual round linker attribute to readout bit for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>round_linker</code> </td> <td> <code><span title="int">int</span></code> </td> <td> <div class="doc-md-description"> <p>Fidicual round linked to readout bit for one tile.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>bit</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Bit index or bit id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2005">2005</a></span>
<span class="normal"><a href="#__codelineno-0-2006">2006</a></span>
<span class="normal"><a href="#__codelineno-0-2007">2007</a></span>
<span class="normal"><a href="#__codelineno-0-2008">2008</a></span>
<span class="normal"><a href="#__codelineno-0-2009">2009</a></span>
<span class="normal"><a href="#__codelineno-0-2010">2010</a></span>
<span class="normal"><a href="#__codelineno-0-2011">2011</a></span>
<span class="normal"><a href="#__codelineno-0-2012">2012</a></span>
<span class="normal"><a href="#__codelineno-0-2013">2013</a></span>
<span class="normal"><a href="#__codelineno-0-2014">2014</a></span>
<span class="normal"><a href="#__codelineno-0-2015">2015</a></span>
<span class="normal"><a href="#__codelineno-0-2016">2016</a></span>
<span class="normal"><a href="#__codelineno-0-2017">2017</a></span>
<span class="normal"><a href="#__codelineno-0-2018">2018</a></span>
<span class="normal"><a href="#__codelineno-0-2019">2019</a></span>
<span class="normal"><a href="#__codelineno-0-2020">2020</a></span>
<span class="normal"><a href="#__codelineno-0-2021">2021</a></span>
<span class="normal"><a href="#__codelineno-0-2022">2022</a></span>
<span class="normal"><a href="#__codelineno-0-2023">2023</a></span>
<span class="normal"><a href="#__codelineno-0-2024">2024</a></span>
<span class="normal"><a href="#__codelineno-0-2025">2025</a></span>
<span class="normal"><a href="#__codelineno-0-2026">2026</a></span>
<span class="normal"><a href="#__codelineno-0-2027">2027</a></span>
<span class="normal"><a href="#__codelineno-0-2028">2028</a></span>
<span class="normal"><a href="#__codelineno-0-2029">2029</a></span>
<span class="normal"><a href="#__codelineno-0-2030">2030</a></span>
<span class="normal"><a href="#__codelineno-0-2031">2031</a></span>
<span class="normal"><a href="#__codelineno-0-2032">2032</a></span>
<span class="normal"><a href="#__codelineno-0-2033">2033</a></span>
<span class="normal"><a href="#__codelineno-0-2034">2034</a></span>
<span class="normal"><a href="#__codelineno-0-2035">2035</a></span>
<span class="normal"><a href="#__codelineno-0-2036">2036</a></span>
<span class="normal"><a href="#__codelineno-0-2037">2037</a></span>
<span class="normal"><a href="#__codelineno-0-2038">2038</a></span>
<span class="normal"><a href="#__codelineno-0-2039">2039</a></span>
<span class="normal"><a href="#__codelineno-0-2040">2040</a></span>
<span class="normal"><a href="#__codelineno-0-2041">2041</a></span>
<span class="normal"><a href="#__codelineno-0-2042">2042</a></span>
<span class="normal"><a href="#__codelineno-0-2043">2043</a></span>
<span class="normal"><a href="#__codelineno-0-2044">2044</a></span>
<span class="normal"><a href="#__codelineno-0-2045">2045</a></span>
<span class="normal"><a href="#__codelineno-0-2046">2046</a></span>
<span class="normal"><a href="#__codelineno-0-2047">2047</a></span>
<span class="normal"><a href="#__codelineno-0-2048">2048</a></span>
<span class="normal"><a href="#__codelineno-0-2049">2049</a></span>
<span class="normal"><a href="#__codelineno-0-2050">2050</a></span>
<span class="normal"><a href="#__codelineno-0-2051">2051</a></span>
<span class="normal"><a href="#__codelineno-0-2052">2052</a></span>
<span class="normal"><a href="#__codelineno-0-2053">2053</a></span>
<span class="normal"><a href="#__codelineno-0-2054">2054</a></span>
<span class="normal"><a href="#__codelineno-0-2055">2055</a></span>
<span class="normal"><a href="#__codelineno-0-2056">2056</a></span>
<span class="normal"><a href="#__codelineno-0-2057">2057</a></span>
<span class="normal"><a href="#__codelineno-0-2058">2058</a></span>
<span class="normal"><a href="#__codelineno-0-2059">2059</a></span>
<span class="normal"><a href="#__codelineno-0-2060">2060</a></span>
<span class="normal"><a href="#__codelineno-0-2061">2061</a></span>
<span class="normal"><a href="#__codelineno-0-2062">2062</a></span>
<span class="normal"><a href="#__codelineno-0-2063">2063</a></span>
<span class="normal"><a href="#__codelineno-0-2064">2064</a></span>
<span class="normal"><a href="#__codelineno-0-2065">2065</a></span>
<span class="normal"><a href="#__codelineno-0-2066">2066</a></span>
<span class="normal"><a href="#__codelineno-0-2067">2067</a></span>
<span class="normal"><a href="#__codelineno-0-2068">2068</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2005"><a id="__codelineno-0-2005" name="__codelineno-0-2005"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_local_round_linker</span><span class="p">(</span>
</span><span id="__span-0-2006"><a id="__codelineno-0-2006" name="__codelineno-0-2006"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2007"><a id="__codelineno-0-2007" name="__codelineno-0-2007"></a>    <span class="n">round_linker</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="__span-0-2008"><a id="__codelineno-0-2008" name="__codelineno-0-2008"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2009"><a id="__codelineno-0-2009" name="__codelineno-0-2009"></a>    <span class="n">bit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2010"><a id="__codelineno-0-2010" name="__codelineno-0-2010"></a><span class="p">):</span>
</span><span id="__span-0-2011"><a id="__codelineno-0-2011" name="__codelineno-0-2011"></a><span class="w">    </span><span class="sd">"""Save fidicual round linker attribute to readout bit for one tile.</span>
</span><span id="__span-0-2012"><a id="__codelineno-0-2012" name="__codelineno-0-2012"></a>
</span><span id="__span-0-2013"><a id="__codelineno-0-2013" name="__codelineno-0-2013"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-2014"><a id="__codelineno-0-2014" name="__codelineno-0-2014"></a><span class="sd">    ----------</span>
</span><span id="__span-0-2015"><a id="__codelineno-0-2015" name="__codelineno-0-2015"></a><span class="sd">    round_linker : int</span>
</span><span id="__span-0-2016"><a id="__codelineno-0-2016" name="__codelineno-0-2016"></a><span class="sd">        Fidicual round linked to readout bit for one tile.</span>
</span><span id="__span-0-2017"><a id="__codelineno-0-2017" name="__codelineno-0-2017"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-2018"><a id="__codelineno-0-2018" name="__codelineno-0-2018"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-2019"><a id="__codelineno-0-2019" name="__codelineno-0-2019"></a><span class="sd">    bit : Union[int, str]</span>
</span><span id="__span-0-2020"><a id="__codelineno-0-2020" name="__codelineno-0-2020"></a><span class="sd">        Bit index or bit id.</span>
</span><span id="__span-0-2021"><a id="__codelineno-0-2021" name="__codelineno-0-2021"></a><span class="sd">    """</span>
</span><span id="__span-0-2022"><a id="__codelineno-0-2022" name="__codelineno-0-2022"></a>
</span><span id="__span-0-2023"><a id="__codelineno-0-2023" name="__codelineno-0-2023"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2024"><a id="__codelineno-0-2024" name="__codelineno-0-2024"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2025"><a id="__codelineno-0-2025" name="__codelineno-0-2025"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2026"><a id="__codelineno-0-2026" name="__codelineno-0-2026"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2027"><a id="__codelineno-0-2027" name="__codelineno-0-2027"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2028"><a id="__codelineno-0-2028" name="__codelineno-0-2028"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2029"><a id="__codelineno-0-2029" name="__codelineno-0-2029"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2030"><a id="__codelineno-0-2030" name="__codelineno-0-2030"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2031"><a id="__codelineno-0-2031" name="__codelineno-0-2031"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id."</span><span class="p">)</span>
</span><span id="__span-0-2032"><a id="__codelineno-0-2032" name="__codelineno-0-2032"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2033"><a id="__codelineno-0-2033" name="__codelineno-0-2033"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2034"><a id="__codelineno-0-2034" name="__codelineno-0-2034"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2035"><a id="__codelineno-0-2035" name="__codelineno-0-2035"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2036"><a id="__codelineno-0-2036" name="__codelineno-0-2036"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2037"><a id="__codelineno-0-2037" name="__codelineno-0-2037"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2038"><a id="__codelineno-0-2038" name="__codelineno-0-2038"></a>
</span><span id="__span-0-2039"><a id="__codelineno-0-2039" name="__codelineno-0-2039"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2040"><a id="__codelineno-0-2040" name="__codelineno-0-2040"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-2041"><a id="__codelineno-0-2041" name="__codelineno-0-2041"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-2042"><a id="__codelineno-0-2042" name="__codelineno-0-2042"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2043"><a id="__codelineno-0-2043" name="__codelineno-0-2043"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2044"><a id="__codelineno-0-2044" name="__codelineno-0-2044"></a>            <span class="n">bit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-2045"><a id="__codelineno-0-2045" name="__codelineno-0-2045"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2046"><a id="__codelineno-0-2046" name="__codelineno-0-2046"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-2047"><a id="__codelineno-0-2047" name="__codelineno-0-2047"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id."</span><span class="p">)</span>
</span><span id="__span-0-2048"><a id="__codelineno-0-2048" name="__codelineno-0-2048"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2049"><a id="__codelineno-0-2049" name="__codelineno-0-2049"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2050"><a id="__codelineno-0-2050" name="__codelineno-0-2050"></a>            <span class="n">bit_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-2051"><a id="__codelineno-0-2051" name="__codelineno-0-2051"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2052"><a id="__codelineno-0-2052" name="__codelineno-0-2052"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2053"><a id="__codelineno-0-2053" name="__codelineno-0-2053"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2054"><a id="__codelineno-0-2054" name="__codelineno-0-2054"></a>
</span><span id="__span-0-2055"><a id="__codelineno-0-2055" name="__codelineno-0-2055"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2056"><a id="__codelineno-0-2056" name="__codelineno-0-2056"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2057"><a id="__codelineno-0-2057" name="__codelineno-0-2057"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-2058"><a id="__codelineno-0-2058" name="__codelineno-0-2058"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2059"><a id="__codelineno-0-2059" name="__codelineno-0-2059"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2060"><a id="__codelineno-0-2060" name="__codelineno-0-2060"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2061"><a id="__codelineno-0-2061" name="__codelineno-0-2061"></a>        <span class="p">)</span>
</span><span id="__span-0-2062"><a id="__codelineno-0-2062" name="__codelineno-0-2062"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2063"><a id="__codelineno-0-2063" name="__codelineno-0-2063"></a>        <span class="n">attributes</span><span class="p">[</span><span class="s2">"round"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">round_linker</span><span class="p">)</span>
</span><span id="__span-0-2064"><a id="__codelineno-0-2064" name="__codelineno-0-2064"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2065"><a id="__codelineno-0-2065" name="__codelineno-0-2065"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-2066"><a id="__codelineno-0-2066" name="__codelineno-0-2066"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">bit_id</span><span class="p">)</span>
</span><span id="__span-0-2067"><a id="__codelineno-0-2067" name="__codelineno-0-2067"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error writing round linker attribute."</span><span class="p">)</span>
</span><span id="__span-0-2068"><a id="__codelineno-0-2068" name="__codelineno-0-2068"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_stage_position_zyx_um"> <code class="highlight language-python"><span class="n">save_local_stage_position_zyx_um</span><span class="p">(</span><span class="n">stage_zyx_um</span><span class="p">,</span> <span class="n">affine_zyx_px</span><span class="p">,</span> <span class="n">tile</span><span class="p">,</span> <span class="nb">round</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save tile stage position for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>stage_zyx_um</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>Tile stage position for one tile.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>affine_zyx_px</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>4x4 homogeneous affine matrix for stage transformation</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2139">2139</a></span>
<span class="normal"><a href="#__codelineno-0-2140">2140</a></span>
<span class="normal"><a href="#__codelineno-0-2141">2141</a></span>
<span class="normal"><a href="#__codelineno-0-2142">2142</a></span>
<span class="normal"><a href="#__codelineno-0-2143">2143</a></span>
<span class="normal"><a href="#__codelineno-0-2144">2144</a></span>
<span class="normal"><a href="#__codelineno-0-2145">2145</a></span>
<span class="normal"><a href="#__codelineno-0-2146">2146</a></span>
<span class="normal"><a href="#__codelineno-0-2147">2147</a></span>
<span class="normal"><a href="#__codelineno-0-2148">2148</a></span>
<span class="normal"><a href="#__codelineno-0-2149">2149</a></span>
<span class="normal"><a href="#__codelineno-0-2150">2150</a></span>
<span class="normal"><a href="#__codelineno-0-2151">2151</a></span>
<span class="normal"><a href="#__codelineno-0-2152">2152</a></span>
<span class="normal"><a href="#__codelineno-0-2153">2153</a></span>
<span class="normal"><a href="#__codelineno-0-2154">2154</a></span>
<span class="normal"><a href="#__codelineno-0-2155">2155</a></span>
<span class="normal"><a href="#__codelineno-0-2156">2156</a></span>
<span class="normal"><a href="#__codelineno-0-2157">2157</a></span>
<span class="normal"><a href="#__codelineno-0-2158">2158</a></span>
<span class="normal"><a href="#__codelineno-0-2159">2159</a></span>
<span class="normal"><a href="#__codelineno-0-2160">2160</a></span>
<span class="normal"><a href="#__codelineno-0-2161">2161</a></span>
<span class="normal"><a href="#__codelineno-0-2162">2162</a></span>
<span class="normal"><a href="#__codelineno-0-2163">2163</a></span>
<span class="normal"><a href="#__codelineno-0-2164">2164</a></span>
<span class="normal"><a href="#__codelineno-0-2165">2165</a></span>
<span class="normal"><a href="#__codelineno-0-2166">2166</a></span>
<span class="normal"><a href="#__codelineno-0-2167">2167</a></span>
<span class="normal"><a href="#__codelineno-0-2168">2168</a></span>
<span class="normal"><a href="#__codelineno-0-2169">2169</a></span>
<span class="normal"><a href="#__codelineno-0-2170">2170</a></span>
<span class="normal"><a href="#__codelineno-0-2171">2171</a></span>
<span class="normal"><a href="#__codelineno-0-2172">2172</a></span>
<span class="normal"><a href="#__codelineno-0-2173">2173</a></span>
<span class="normal"><a href="#__codelineno-0-2174">2174</a></span>
<span class="normal"><a href="#__codelineno-0-2175">2175</a></span>
<span class="normal"><a href="#__codelineno-0-2176">2176</a></span>
<span class="normal"><a href="#__codelineno-0-2177">2177</a></span>
<span class="normal"><a href="#__codelineno-0-2178">2178</a></span>
<span class="normal"><a href="#__codelineno-0-2179">2179</a></span>
<span class="normal"><a href="#__codelineno-0-2180">2180</a></span>
<span class="normal"><a href="#__codelineno-0-2181">2181</a></span>
<span class="normal"><a href="#__codelineno-0-2182">2182</a></span>
<span class="normal"><a href="#__codelineno-0-2183">2183</a></span>
<span class="normal"><a href="#__codelineno-0-2184">2184</a></span>
<span class="normal"><a href="#__codelineno-0-2185">2185</a></span>
<span class="normal"><a href="#__codelineno-0-2186">2186</a></span>
<span class="normal"><a href="#__codelineno-0-2187">2187</a></span>
<span class="normal"><a href="#__codelineno-0-2188">2188</a></span>
<span class="normal"><a href="#__codelineno-0-2189">2189</a></span>
<span class="normal"><a href="#__codelineno-0-2190">2190</a></span>
<span class="normal"><a href="#__codelineno-0-2191">2191</a></span>
<span class="normal"><a href="#__codelineno-0-2192">2192</a></span>
<span class="normal"><a href="#__codelineno-0-2193">2193</a></span>
<span class="normal"><a href="#__codelineno-0-2194">2194</a></span>
<span class="normal"><a href="#__codelineno-0-2195">2195</a></span>
<span class="normal"><a href="#__codelineno-0-2196">2196</a></span>
<span class="normal"><a href="#__codelineno-0-2197">2197</a></span>
<span class="normal"><a href="#__codelineno-0-2198">2198</a></span>
<span class="normal"><a href="#__codelineno-0-2199">2199</a></span>
<span class="normal"><a href="#__codelineno-0-2200">2200</a></span>
<span class="normal"><a href="#__codelineno-0-2201">2201</a></span>
<span class="normal"><a href="#__codelineno-0-2202">2202</a></span>
<span class="normal"><a href="#__codelineno-0-2203">2203</a></span>
<span class="normal"><a href="#__codelineno-0-2204">2204</a></span>
<span class="normal"><a href="#__codelineno-0-2205">2205</a></span>
<span class="normal"><a href="#__codelineno-0-2206">2206</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2139"><a id="__codelineno-0-2139" name="__codelineno-0-2139"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_local_stage_position_zyx_um</span><span class="p">(</span>
</span><span id="__span-0-2140"><a id="__codelineno-0-2140" name="__codelineno-0-2140"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2141"><a id="__codelineno-0-2141" name="__codelineno-0-2141"></a>    <span class="n">stage_zyx_um</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-2142"><a id="__codelineno-0-2142" name="__codelineno-0-2142"></a>    <span class="n">affine_zyx_px</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-2143"><a id="__codelineno-0-2143" name="__codelineno-0-2143"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2144"><a id="__codelineno-0-2144" name="__codelineno-0-2144"></a>    <span class="nb">round</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2145"><a id="__codelineno-0-2145" name="__codelineno-0-2145"></a><span class="p">):</span>
</span><span id="__span-0-2146"><a id="__codelineno-0-2146" name="__codelineno-0-2146"></a><span class="w">    </span><span class="sd">"""Save tile stage position for one tile.</span>
</span><span id="__span-0-2147"><a id="__codelineno-0-2147" name="__codelineno-0-2147"></a>
</span><span id="__span-0-2148"><a id="__codelineno-0-2148" name="__codelineno-0-2148"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-2149"><a id="__codelineno-0-2149" name="__codelineno-0-2149"></a><span class="sd">    ----------</span>
</span><span id="__span-0-2150"><a id="__codelineno-0-2150" name="__codelineno-0-2150"></a><span class="sd">    stage_zyx_um : ArrayLike</span>
</span><span id="__span-0-2151"><a id="__codelineno-0-2151" name="__codelineno-0-2151"></a><span class="sd">        Tile stage position for one tile.</span>
</span><span id="__span-0-2152"><a id="__codelineno-0-2152" name="__codelineno-0-2152"></a><span class="sd">    affine_zyx_px; ArrayLike</span>
</span><span id="__span-0-2153"><a id="__codelineno-0-2153" name="__codelineno-0-2153"></a><span class="sd">        4x4 homogeneous affine matrix for stage transformation</span>
</span><span id="__span-0-2154"><a id="__codelineno-0-2154" name="__codelineno-0-2154"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-2155"><a id="__codelineno-0-2155" name="__codelineno-0-2155"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-2156"><a id="__codelineno-0-2156" name="__codelineno-0-2156"></a><span class="sd">    round : Union[int, str]</span>
</span><span id="__span-0-2157"><a id="__codelineno-0-2157" name="__codelineno-0-2157"></a><span class="sd">        Round index or round id.</span>
</span><span id="__span-0-2158"><a id="__codelineno-0-2158" name="__codelineno-0-2158"></a><span class="sd">    """</span>
</span><span id="__span-0-2159"><a id="__codelineno-0-2159" name="__codelineno-0-2159"></a>
</span><span id="__span-0-2160"><a id="__codelineno-0-2160" name="__codelineno-0-2160"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2161"><a id="__codelineno-0-2161" name="__codelineno-0-2161"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2162"><a id="__codelineno-0-2162" name="__codelineno-0-2162"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2163"><a id="__codelineno-0-2163" name="__codelineno-0-2163"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2164"><a id="__codelineno-0-2164" name="__codelineno-0-2164"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2165"><a id="__codelineno-0-2165" name="__codelineno-0-2165"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2166"><a id="__codelineno-0-2166" name="__codelineno-0-2166"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2167"><a id="__codelineno-0-2167" name="__codelineno-0-2167"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2168"><a id="__codelineno-0-2168" name="__codelineno-0-2168"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id."</span><span class="p">)</span>
</span><span id="__span-0-2169"><a id="__codelineno-0-2169" name="__codelineno-0-2169"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2170"><a id="__codelineno-0-2170" name="__codelineno-0-2170"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2171"><a id="__codelineno-0-2171" name="__codelineno-0-2171"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2172"><a id="__codelineno-0-2172" name="__codelineno-0-2172"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2173"><a id="__codelineno-0-2173" name="__codelineno-0-2173"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2174"><a id="__codelineno-0-2174" name="__codelineno-0-2174"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2175"><a id="__codelineno-0-2175" name="__codelineno-0-2175"></a>
</span><span id="__span-0-2176"><a id="__codelineno-0-2176" name="__codelineno-0-2176"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2177"><a id="__codelineno-0-2177" name="__codelineno-0-2177"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2178"><a id="__codelineno-0-2178" name="__codelineno-0-2178"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2179"><a id="__codelineno-0-2179" name="__codelineno-0-2179"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2180"><a id="__codelineno-0-2180" name="__codelineno-0-2180"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2181"><a id="__codelineno-0-2181" name="__codelineno-0-2181"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2182"><a id="__codelineno-0-2182" name="__codelineno-0-2182"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2183"><a id="__codelineno-0-2183" name="__codelineno-0-2183"></a>        <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2184"><a id="__codelineno-0-2184" name="__codelineno-0-2184"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id."</span><span class="p">)</span>
</span><span id="__span-0-2185"><a id="__codelineno-0-2185" name="__codelineno-0-2185"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2186"><a id="__codelineno-0-2186" name="__codelineno-0-2186"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2187"><a id="__codelineno-0-2187" name="__codelineno-0-2187"></a>            <span class="n">round_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2188"><a id="__codelineno-0-2188" name="__codelineno-0-2188"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2189"><a id="__codelineno-0-2189" name="__codelineno-0-2189"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2190"><a id="__codelineno-0-2190" name="__codelineno-0-2190"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2191"><a id="__codelineno-0-2191" name="__codelineno-0-2191"></a>
</span><span id="__span-0-2192"><a id="__codelineno-0-2192" name="__codelineno-0-2192"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2193"><a id="__codelineno-0-2193" name="__codelineno-0-2193"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2194"><a id="__codelineno-0-2194" name="__codelineno-0-2194"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2195"><a id="__codelineno-0-2195" name="__codelineno-0-2195"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2196"><a id="__codelineno-0-2196" name="__codelineno-0-2196"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">round_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2197"><a id="__codelineno-0-2197" name="__codelineno-0-2197"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2198"><a id="__codelineno-0-2198" name="__codelineno-0-2198"></a>        <span class="p">)</span>
</span><span id="__span-0-2199"><a id="__codelineno-0-2199" name="__codelineno-0-2199"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2200"><a id="__codelineno-0-2200" name="__codelineno-0-2200"></a>        <span class="n">attributes</span><span class="p">[</span><span class="s2">"stage_zyx_um"</span><span class="p">]</span> <span class="o">=</span> <span class="n">stage_zyx_um</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-2201"><a id="__codelineno-0-2201" name="__codelineno-0-2201"></a>        <span class="n">attributes</span><span class="p">[</span><span class="s2">"affine_zyx_px"</span><span class="p">]</span> <span class="o">=</span> <span class="n">affine_zyx_px</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
</span><span id="__span-0-2202"><a id="__codelineno-0-2202" name="__codelineno-0-2202"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2203"><a id="__codelineno-0-2203" name="__codelineno-0-2203"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-2204"><a id="__codelineno-0-2204" name="__codelineno-0-2204"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">tile_id</span><span class="p">,</span> <span class="n">round_id</span><span class="p">)</span>
</span><span id="__span-0-2205"><a id="__codelineno-0-2205" name="__codelineno-0-2205"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error writing stage position attribute."</span><span class="p">)</span>
</span><span id="__span-0-2206"><a id="__codelineno-0-2206" name="__codelineno-0-2206"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_ufish_image"> <code class="highlight language-python"><span class="n">save_local_ufish_image</span><span class="p">(</span><span class="n">ufish_image</span><span class="p">,</span> <span class="n">tile</span><span class="p">,</span> <span class="n">bit</span><span class="p">,</span> <span class="n">return_future</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save U-FISH prediction image.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>ufish_image</code> </td> <td> <code><span title="numpy.typing.ArrayLike">ArrayLike</span></code> </td> <td> <div class="doc-md-description"> <p>U-FISH prediction image.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>bit</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Bit index or bit id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>return_future</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="bool">bool</span>]</code> </td> <td> <div class="doc-md-description"> <p>Return future array.</p> </div> </td> <td> <code>False</code> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3299">3299</a></span>
<span class="normal"><a href="#__codelineno-0-3300">3300</a></span>
<span class="normal"><a href="#__codelineno-0-3301">3301</a></span>
<span class="normal"><a href="#__codelineno-0-3302">3302</a></span>
<span class="normal"><a href="#__codelineno-0-3303">3303</a></span>
<span class="normal"><a href="#__codelineno-0-3304">3304</a></span>
<span class="normal"><a href="#__codelineno-0-3305">3305</a></span>
<span class="normal"><a href="#__codelineno-0-3306">3306</a></span>
<span class="normal"><a href="#__codelineno-0-3307">3307</a></span>
<span class="normal"><a href="#__codelineno-0-3308">3308</a></span>
<span class="normal"><a href="#__codelineno-0-3309">3309</a></span>
<span class="normal"><a href="#__codelineno-0-3310">3310</a></span>
<span class="normal"><a href="#__codelineno-0-3311">3311</a></span>
<span class="normal"><a href="#__codelineno-0-3312">3312</a></span>
<span class="normal"><a href="#__codelineno-0-3313">3313</a></span>
<span class="normal"><a href="#__codelineno-0-3314">3314</a></span>
<span class="normal"><a href="#__codelineno-0-3315">3315</a></span>
<span class="normal"><a href="#__codelineno-0-3316">3316</a></span>
<span class="normal"><a href="#__codelineno-0-3317">3317</a></span>
<span class="normal"><a href="#__codelineno-0-3318">3318</a></span>
<span class="normal"><a href="#__codelineno-0-3319">3319</a></span>
<span class="normal"><a href="#__codelineno-0-3320">3320</a></span>
<span class="normal"><a href="#__codelineno-0-3321">3321</a></span>
<span class="normal"><a href="#__codelineno-0-3322">3322</a></span>
<span class="normal"><a href="#__codelineno-0-3323">3323</a></span>
<span class="normal"><a href="#__codelineno-0-3324">3324</a></span>
<span class="normal"><a href="#__codelineno-0-3325">3325</a></span>
<span class="normal"><a href="#__codelineno-0-3326">3326</a></span>
<span class="normal"><a href="#__codelineno-0-3327">3327</a></span>
<span class="normal"><a href="#__codelineno-0-3328">3328</a></span>
<span class="normal"><a href="#__codelineno-0-3329">3329</a></span>
<span class="normal"><a href="#__codelineno-0-3330">3330</a></span>
<span class="normal"><a href="#__codelineno-0-3331">3331</a></span>
<span class="normal"><a href="#__codelineno-0-3332">3332</a></span>
<span class="normal"><a href="#__codelineno-0-3333">3333</a></span>
<span class="normal"><a href="#__codelineno-0-3334">3334</a></span>
<span class="normal"><a href="#__codelineno-0-3335">3335</a></span>
<span class="normal"><a href="#__codelineno-0-3336">3336</a></span>
<span class="normal"><a href="#__codelineno-0-3337">3337</a></span>
<span class="normal"><a href="#__codelineno-0-3338">3338</a></span>
<span class="normal"><a href="#__codelineno-0-3339">3339</a></span>
<span class="normal"><a href="#__codelineno-0-3340">3340</a></span>
<span class="normal"><a href="#__codelineno-0-3341">3341</a></span>
<span class="normal"><a href="#__codelineno-0-3342">3342</a></span>
<span class="normal"><a href="#__codelineno-0-3343">3343</a></span>
<span class="normal"><a href="#__codelineno-0-3344">3344</a></span>
<span class="normal"><a href="#__codelineno-0-3345">3345</a></span>
<span class="normal"><a href="#__codelineno-0-3346">3346</a></span>
<span class="normal"><a href="#__codelineno-0-3347">3347</a></span>
<span class="normal"><a href="#__codelineno-0-3348">3348</a></span>
<span class="normal"><a href="#__codelineno-0-3349">3349</a></span>
<span class="normal"><a href="#__codelineno-0-3350">3350</a></span>
<span class="normal"><a href="#__codelineno-0-3351">3351</a></span>
<span class="normal"><a href="#__codelineno-0-3352">3352</a></span>
<span class="normal"><a href="#__codelineno-0-3353">3353</a></span>
<span class="normal"><a href="#__codelineno-0-3354">3354</a></span>
<span class="normal"><a href="#__codelineno-0-3355">3355</a></span>
<span class="normal"><a href="#__codelineno-0-3356">3356</a></span>
<span class="normal"><a href="#__codelineno-0-3357">3357</a></span>
<span class="normal"><a href="#__codelineno-0-3358">3358</a></span>
<span class="normal"><a href="#__codelineno-0-3359">3359</a></span>
<span class="normal"><a href="#__codelineno-0-3360">3360</a></span>
<span class="normal"><a href="#__codelineno-0-3361">3361</a></span>
<span class="normal"><a href="#__codelineno-0-3362">3362</a></span>
<span class="normal"><a href="#__codelineno-0-3363">3363</a></span>
<span class="normal"><a href="#__codelineno-0-3364">3364</a></span>
<span class="normal"><a href="#__codelineno-0-3365">3365</a></span>
<span class="normal"><a href="#__codelineno-0-3366">3366</a></span>
<span class="normal"><a href="#__codelineno-0-3367">3367</a></span>
<span class="normal"><a href="#__codelineno-0-3368">3368</a></span>
<span class="normal"><a href="#__codelineno-0-3369">3369</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3299"><a id="__codelineno-0-3299" name="__codelineno-0-3299"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_local_ufish_image</span><span class="p">(</span>
</span><span id="__span-0-3300"><a id="__codelineno-0-3300" name="__codelineno-0-3300"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3301"><a id="__codelineno-0-3301" name="__codelineno-0-3301"></a>    <span class="n">ufish_image</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="__span-0-3302"><a id="__codelineno-0-3302" name="__codelineno-0-3302"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3303"><a id="__codelineno-0-3303" name="__codelineno-0-3303"></a>    <span class="n">bit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3304"><a id="__codelineno-0-3304" name="__codelineno-0-3304"></a>    <span class="n">return_future</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="__span-0-3305"><a id="__codelineno-0-3305" name="__codelineno-0-3305"></a><span class="p">):</span>
</span><span id="__span-0-3306"><a id="__codelineno-0-3306" name="__codelineno-0-3306"></a><span class="w">    </span><span class="sd">"""Save U-FISH prediction image.</span>
</span><span id="__span-0-3307"><a id="__codelineno-0-3307" name="__codelineno-0-3307"></a>
</span><span id="__span-0-3308"><a id="__codelineno-0-3308" name="__codelineno-0-3308"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3309"><a id="__codelineno-0-3309" name="__codelineno-0-3309"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3310"><a id="__codelineno-0-3310" name="__codelineno-0-3310"></a><span class="sd">    ufish_image : ArrayLike</span>
</span><span id="__span-0-3311"><a id="__codelineno-0-3311" name="__codelineno-0-3311"></a><span class="sd">        U-FISH prediction image.</span>
</span><span id="__span-0-3312"><a id="__codelineno-0-3312" name="__codelineno-0-3312"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-3313"><a id="__codelineno-0-3313" name="__codelineno-0-3313"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-3314"><a id="__codelineno-0-3314" name="__codelineno-0-3314"></a><span class="sd">    bit : Union[int, str]</span>
</span><span id="__span-0-3315"><a id="__codelineno-0-3315" name="__codelineno-0-3315"></a><span class="sd">        Bit index or bit id.</span>
</span><span id="__span-0-3316"><a id="__codelineno-0-3316" name="__codelineno-0-3316"></a><span class="sd">    return_future : Optional[bool]</span>
</span><span id="__span-0-3317"><a id="__codelineno-0-3317" name="__codelineno-0-3317"></a><span class="sd">        Return future array.</span>
</span><span id="__span-0-3318"><a id="__codelineno-0-3318" name="__codelineno-0-3318"></a><span class="sd">    """</span>
</span><span id="__span-0-3319"><a id="__codelineno-0-3319" name="__codelineno-0-3319"></a>
</span><span id="__span-0-3320"><a id="__codelineno-0-3320" name="__codelineno-0-3320"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3321"><a id="__codelineno-0-3321" name="__codelineno-0-3321"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3322"><a id="__codelineno-0-3322" name="__codelineno-0-3322"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3323"><a id="__codelineno-0-3323" name="__codelineno-0-3323"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3324"><a id="__codelineno-0-3324" name="__codelineno-0-3324"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3325"><a id="__codelineno-0-3325" name="__codelineno-0-3325"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3326"><a id="__codelineno-0-3326" name="__codelineno-0-3326"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3327"><a id="__codelineno-0-3327" name="__codelineno-0-3327"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3328"><a id="__codelineno-0-3328" name="__codelineno-0-3328"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3329"><a id="__codelineno-0-3329" name="__codelineno-0-3329"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3330"><a id="__codelineno-0-3330" name="__codelineno-0-3330"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3331"><a id="__codelineno-0-3331" name="__codelineno-0-3331"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3332"><a id="__codelineno-0-3332" name="__codelineno-0-3332"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3333"><a id="__codelineno-0-3333" name="__codelineno-0-3333"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3334"><a id="__codelineno-0-3334" name="__codelineno-0-3334"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3335"><a id="__codelineno-0-3335" name="__codelineno-0-3335"></a>
</span><span id="__span-0-3336"><a id="__codelineno-0-3336" name="__codelineno-0-3336"></a>    <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-3337"><a id="__codelineno-0-3337" name="__codelineno-0-3337"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3338"><a id="__codelineno-0-3338" name="__codelineno-0-3338"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-3339"><a id="__codelineno-0-3339" name="__codelineno-0-3339"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-3340"><a id="__codelineno-0-3340" name="__codelineno-0-3340"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3341"><a id="__codelineno-0-3341" name="__codelineno-0-3341"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3342"><a id="__codelineno-0-3342" name="__codelineno-0-3342"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-3343"><a id="__codelineno-0-3343" name="__codelineno-0-3343"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3344"><a id="__codelineno-0-3344" name="__codelineno-0-3344"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-3345"><a id="__codelineno-0-3345" name="__codelineno-0-3345"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-3346"><a id="__codelineno-0-3346" name="__codelineno-0-3346"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3347"><a id="__codelineno-0-3347" name="__codelineno-0-3347"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3348"><a id="__codelineno-0-3348" name="__codelineno-0-3348"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-3349"><a id="__codelineno-0-3349" name="__codelineno-0-3349"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3350"><a id="__codelineno-0-3350" name="__codelineno-0-3350"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3351"><a id="__codelineno-0-3351" name="__codelineno-0-3351"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3352"><a id="__codelineno-0-3352" name="__codelineno-0-3352"></a>        <span class="n">current_local_zarr_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-3353"><a id="__codelineno-0-3353" name="__codelineno-0-3353"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-3354"><a id="__codelineno-0-3354" name="__codelineno-0-3354"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3355"><a id="__codelineno-0-3355" name="__codelineno-0-3355"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-3356"><a id="__codelineno-0-3356" name="__codelineno-0-3356"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"registered_ufish_data"</span><span class="p">)</span>
</span><span id="__span-0-3357"><a id="__codelineno-0-3357" name="__codelineno-0-3357"></a>        <span class="p">)</span>
</span><span id="__span-0-3358"><a id="__codelineno-0-3358" name="__codelineno-0-3358"></a>
</span><span id="__span-0-3359"><a id="__codelineno-0-3359" name="__codelineno-0-3359"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3360"><a id="__codelineno-0-3360" name="__codelineno-0-3360"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_zarr_array</span><span class="p">(</span>
</span><span id="__span-0-3361"><a id="__codelineno-0-3361" name="__codelineno-0-3361"></a>            <span class="n">ufish_image</span><span class="p">,</span>
</span><span id="__span-0-3362"><a id="__codelineno-0-3362" name="__codelineno-0-3362"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_get_kvstore_key</span><span class="p">(</span><span class="n">current_local_zarr_path</span><span class="p">),</span>
</span><span id="__span-0-3363"><a id="__codelineno-0-3363" name="__codelineno-0-3363"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_zarrv2_spec</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span>
</span><span id="__span-0-3364"><a id="__codelineno-0-3364" name="__codelineno-0-3364"></a>            <span class="n">return_future</span><span class="p">,</span>
</span><span id="__span-0-3365"><a id="__codelineno-0-3365" name="__codelineno-0-3365"></a>        <span class="p">)</span>
</span><span id="__span-0-3366"><a id="__codelineno-0-3366" name="__codelineno-0-3366"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">,</span> <span class="n">ZarrError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-3367"><a id="__codelineno-0-3367" name="__codelineno-0-3367"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-3368"><a id="__codelineno-0-3368" name="__codelineno-0-3368"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving U-Fish image."</span><span class="p">)</span>
</span><span id="__span-0-3369"><a id="__codelineno-0-3369" name="__codelineno-0-3369"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_ufish_spots"> <code class="highlight language-python"><span class="n">save_local_ufish_spots</span><span class="p">(</span><span class="n">spot_df</span><span class="p">,</span> <span class="n">tile</span><span class="p">,</span> <span class="n">bit</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save U-FISH localizations and features.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>spot_df</code> </td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class="doc-md-description"> <p>U-FISH localizations and features.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>bit</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Bit index or bit id.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3438">3438</a></span>
<span class="normal"><a href="#__codelineno-0-3439">3439</a></span>
<span class="normal"><a href="#__codelineno-0-3440">3440</a></span>
<span class="normal"><a href="#__codelineno-0-3441">3441</a></span>
<span class="normal"><a href="#__codelineno-0-3442">3442</a></span>
<span class="normal"><a href="#__codelineno-0-3443">3443</a></span>
<span class="normal"><a href="#__codelineno-0-3444">3444</a></span>
<span class="normal"><a href="#__codelineno-0-3445">3445</a></span>
<span class="normal"><a href="#__codelineno-0-3446">3446</a></span>
<span class="normal"><a href="#__codelineno-0-3447">3447</a></span>
<span class="normal"><a href="#__codelineno-0-3448">3448</a></span>
<span class="normal"><a href="#__codelineno-0-3449">3449</a></span>
<span class="normal"><a href="#__codelineno-0-3450">3450</a></span>
<span class="normal"><a href="#__codelineno-0-3451">3451</a></span>
<span class="normal"><a href="#__codelineno-0-3452">3452</a></span>
<span class="normal"><a href="#__codelineno-0-3453">3453</a></span>
<span class="normal"><a href="#__codelineno-0-3454">3454</a></span>
<span class="normal"><a href="#__codelineno-0-3455">3455</a></span>
<span class="normal"><a href="#__codelineno-0-3456">3456</a></span>
<span class="normal"><a href="#__codelineno-0-3457">3457</a></span>
<span class="normal"><a href="#__codelineno-0-3458">3458</a></span>
<span class="normal"><a href="#__codelineno-0-3459">3459</a></span>
<span class="normal"><a href="#__codelineno-0-3460">3460</a></span>
<span class="normal"><a href="#__codelineno-0-3461">3461</a></span>
<span class="normal"><a href="#__codelineno-0-3462">3462</a></span>
<span class="normal"><a href="#__codelineno-0-3463">3463</a></span>
<span class="normal"><a href="#__codelineno-0-3464">3464</a></span>
<span class="normal"><a href="#__codelineno-0-3465">3465</a></span>
<span class="normal"><a href="#__codelineno-0-3466">3466</a></span>
<span class="normal"><a href="#__codelineno-0-3467">3467</a></span>
<span class="normal"><a href="#__codelineno-0-3468">3468</a></span>
<span class="normal"><a href="#__codelineno-0-3469">3469</a></span>
<span class="normal"><a href="#__codelineno-0-3470">3470</a></span>
<span class="normal"><a href="#__codelineno-0-3471">3471</a></span>
<span class="normal"><a href="#__codelineno-0-3472">3472</a></span>
<span class="normal"><a href="#__codelineno-0-3473">3473</a></span>
<span class="normal"><a href="#__codelineno-0-3474">3474</a></span>
<span class="normal"><a href="#__codelineno-0-3475">3475</a></span>
<span class="normal"><a href="#__codelineno-0-3476">3476</a></span>
<span class="normal"><a href="#__codelineno-0-3477">3477</a></span>
<span class="normal"><a href="#__codelineno-0-3478">3478</a></span>
<span class="normal"><a href="#__codelineno-0-3479">3479</a></span>
<span class="normal"><a href="#__codelineno-0-3480">3480</a></span>
<span class="normal"><a href="#__codelineno-0-3481">3481</a></span>
<span class="normal"><a href="#__codelineno-0-3482">3482</a></span>
<span class="normal"><a href="#__codelineno-0-3483">3483</a></span>
<span class="normal"><a href="#__codelineno-0-3484">3484</a></span>
<span class="normal"><a href="#__codelineno-0-3485">3485</a></span>
<span class="normal"><a href="#__codelineno-0-3486">3486</a></span>
<span class="normal"><a href="#__codelineno-0-3487">3487</a></span>
<span class="normal"><a href="#__codelineno-0-3488">3488</a></span>
<span class="normal"><a href="#__codelineno-0-3489">3489</a></span>
<span class="normal"><a href="#__codelineno-0-3490">3490</a></span>
<span class="normal"><a href="#__codelineno-0-3491">3491</a></span>
<span class="normal"><a href="#__codelineno-0-3492">3492</a></span>
<span class="normal"><a href="#__codelineno-0-3493">3493</a></span>
<span class="normal"><a href="#__codelineno-0-3494">3494</a></span>
<span class="normal"><a href="#__codelineno-0-3495">3495</a></span>
<span class="normal"><a href="#__codelineno-0-3496">3496</a></span>
<span class="normal"><a href="#__codelineno-0-3497">3497</a></span>
<span class="normal"><a href="#__codelineno-0-3498">3498</a></span>
<span class="normal"><a href="#__codelineno-0-3499">3499</a></span>
<span class="normal"><a href="#__codelineno-0-3500">3500</a></span>
<span class="normal"><a href="#__codelineno-0-3501">3501</a></span>
<span class="normal"><a href="#__codelineno-0-3502">3502</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3438"><a id="__codelineno-0-3438" name="__codelineno-0-3438"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_local_ufish_spots</span><span class="p">(</span>
</span><span id="__span-0-3439"><a id="__codelineno-0-3439" name="__codelineno-0-3439"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-3440"><a id="__codelineno-0-3440" name="__codelineno-0-3440"></a>    <span class="n">spot_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
</span><span id="__span-0-3441"><a id="__codelineno-0-3441" name="__codelineno-0-3441"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3442"><a id="__codelineno-0-3442" name="__codelineno-0-3442"></a>    <span class="n">bit</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-3443"><a id="__codelineno-0-3443" name="__codelineno-0-3443"></a><span class="p">):</span>
</span><span id="__span-0-3444"><a id="__codelineno-0-3444" name="__codelineno-0-3444"></a><span class="w">    </span><span class="sd">"""Save U-FISH localizations and features.</span>
</span><span id="__span-0-3445"><a id="__codelineno-0-3445" name="__codelineno-0-3445"></a>
</span><span id="__span-0-3446"><a id="__codelineno-0-3446" name="__codelineno-0-3446"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3447"><a id="__codelineno-0-3447" name="__codelineno-0-3447"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3448"><a id="__codelineno-0-3448" name="__codelineno-0-3448"></a><span class="sd">    spot_df : pd.DataFrame</span>
</span><span id="__span-0-3449"><a id="__codelineno-0-3449" name="__codelineno-0-3449"></a><span class="sd">        U-FISH localizations and features.</span>
</span><span id="__span-0-3450"><a id="__codelineno-0-3450" name="__codelineno-0-3450"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-3451"><a id="__codelineno-0-3451" name="__codelineno-0-3451"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-3452"><a id="__codelineno-0-3452" name="__codelineno-0-3452"></a><span class="sd">    bit : Union[int, str]</span>
</span><span id="__span-0-3453"><a id="__codelineno-0-3453" name="__codelineno-0-3453"></a><span class="sd">        Bit index or bit id.</span>
</span><span id="__span-0-3454"><a id="__codelineno-0-3454" name="__codelineno-0-3454"></a><span class="sd">    """</span>
</span><span id="__span-0-3455"><a id="__codelineno-0-3455" name="__codelineno-0-3455"></a>
</span><span id="__span-0-3456"><a id="__codelineno-0-3456" name="__codelineno-0-3456"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3457"><a id="__codelineno-0-3457" name="__codelineno-0-3457"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-3458"><a id="__codelineno-0-3458" name="__codelineno-0-3458"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-3459"><a id="__codelineno-0-3459" name="__codelineno-0-3459"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3460"><a id="__codelineno-0-3460" name="__codelineno-0-3460"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3461"><a id="__codelineno-0-3461" name="__codelineno-0-3461"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-3462"><a id="__codelineno-0-3462" name="__codelineno-0-3462"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3463"><a id="__codelineno-0-3463" name="__codelineno-0-3463"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-3464"><a id="__codelineno-0-3464" name="__codelineno-0-3464"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-3465"><a id="__codelineno-0-3465" name="__codelineno-0-3465"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3466"><a id="__codelineno-0-3466" name="__codelineno-0-3466"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3467"><a id="__codelineno-0-3467" name="__codelineno-0-3467"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-3468"><a id="__codelineno-0-3468" name="__codelineno-0-3468"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3469"><a id="__codelineno-0-3469" name="__codelineno-0-3469"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3470"><a id="__codelineno-0-3470" name="__codelineno-0-3470"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3471"><a id="__codelineno-0-3471" name="__codelineno-0-3471"></a>
</span><span id="__span-0-3472"><a id="__codelineno-0-3472" name="__codelineno-0-3472"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-3473"><a id="__codelineno-0-3473" name="__codelineno-0-3473"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-3474"><a id="__codelineno-0-3474" name="__codelineno-0-3474"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-3475"><a id="__codelineno-0-3475" name="__codelineno-0-3475"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3476"><a id="__codelineno-0-3476" name="__codelineno-0-3476"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3477"><a id="__codelineno-0-3477" name="__codelineno-0-3477"></a>            <span class="n">bit_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-3478"><a id="__codelineno-0-3478" name="__codelineno-0-3478"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-3479"><a id="__codelineno-0-3479" name="__codelineno-0-3479"></a>        <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-3480"><a id="__codelineno-0-3480" name="__codelineno-0-3480"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-3481"><a id="__codelineno-0-3481" name="__codelineno-0-3481"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3482"><a id="__codelineno-0-3482" name="__codelineno-0-3482"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3483"><a id="__codelineno-0-3483" name="__codelineno-0-3483"></a>            <span class="n">bit_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-3484"><a id="__codelineno-0-3484" name="__codelineno-0-3484"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-3485"><a id="__codelineno-0-3485" name="__codelineno-0-3485"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-3486"><a id="__codelineno-0-3486" name="__codelineno-0-3486"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-3487"><a id="__codelineno-0-3487" name="__codelineno-0-3487"></a>
</span><span id="__span-0-3488"><a id="__codelineno-0-3488" name="__codelineno-0-3488"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">))</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3489"><a id="__codelineno-0-3489" name="__codelineno-0-3489"></a>        <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">))</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-3490"><a id="__codelineno-0-3490" name="__codelineno-0-3490"></a>
</span><span id="__span-0-3491"><a id="__codelineno-0-3491" name="__codelineno-0-3491"></a>    <span class="n">current_ufish_localizations_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-3492"><a id="__codelineno-0-3492" name="__codelineno-0-3492"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_ufish_localizations_root_path</span>
</span><span id="__span-0-3493"><a id="__codelineno-0-3493" name="__codelineno-0-3493"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-3494"><a id="__codelineno-0-3494" name="__codelineno-0-3494"></a>        <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">bit_id</span> <span class="o">+</span> <span class="s2">".parquet"</span><span class="p">)</span>
</span><span id="__span-0-3495"><a id="__codelineno-0-3495" name="__codelineno-0-3495"></a>    <span class="p">)</span>
</span><span id="__span-0-3496"><a id="__codelineno-0-3496" name="__codelineno-0-3496"></a>
</span><span id="__span-0-3497"><a id="__codelineno-0-3497" name="__codelineno-0-3497"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-3498"><a id="__codelineno-0-3498" name="__codelineno-0-3498"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_parquet</span><span class="p">(</span><span class="n">spot_df</span><span class="p">,</span> <span class="n">current_ufish_localizations_path</span><span class="p">)</span>
</span><span id="__span-0-3499"><a id="__codelineno-0-3499" name="__codelineno-0-3499"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">IOError</span><span class="p">,</span> <span class="ne">OSError</span><span class="p">)</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span><span id="__span-0-3500"><a id="__codelineno-0-3500" name="__codelineno-0-3500"></a>        <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</span><span id="__span-0-3501"><a id="__codelineno-0-3501" name="__codelineno-0-3501"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error saving U-FISH localizations."</span><span class="p">)</span>
</span><span id="__span-0-3502"><a id="__codelineno-0-3502" name="__codelineno-0-3502"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_local_wavelengths_um"> <code class="highlight language-python"><span class="n">save_local_wavelengths_um</span><span class="p">(</span><span class="n">wavelengths_um</span><span class="p">,</span> <span class="n">tile</span><span class="p">,</span> <span class="nb">round</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">bit</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save wavelengths for fidicual OR readout bit for one tile.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>wavelengths_um</code> </td> <td> <code><span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>]</code> </td> <td> <div class="doc-md-description"> <p>Wavelengths for fidicual OR readout bit for one tile.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>tile</code> </td> <td> <code><span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]</code> </td> <td> <div class="doc-md-description"> <p>Tile index or tile id.</p> </div> </td> <td> <em>required</em> </td> </tr> <tr class="doc-section-item"> <td> <code>round</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Round index or round id.</p> </div> </td> <td> <code>None</code> </td> </tr> <tr class="doc-section-item"> <td> <code>bit</code> </td> <td> <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[<span title="int">int</span>, <span title="str">str</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Bit index or bit id.</p> </div> </td> <td> <code>None</code> </td> </tr> </tbody> </table> <p><span class="doc-section-title">Returns:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td><code>wavelengths_um</code></td> <td> <code><span title="typing.Optional">Optional</span>[<span title="tuple">tuple</span>[<span title="float">float</span>, <span title="float">float</span>]]</code> </td> <td> <div class="doc-md-description"> <p>Wavelengths for fidicual OR readout bit for one tile.</p> </div> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-2305">2305</a></span>
<span class="normal"><a href="#__codelineno-0-2306">2306</a></span>
<span class="normal"><a href="#__codelineno-0-2307">2307</a></span>
<span class="normal"><a href="#__codelineno-0-2308">2308</a></span>
<span class="normal"><a href="#__codelineno-0-2309">2309</a></span>
<span class="normal"><a href="#__codelineno-0-2310">2310</a></span>
<span class="normal"><a href="#__codelineno-0-2311">2311</a></span>
<span class="normal"><a href="#__codelineno-0-2312">2312</a></span>
<span class="normal"><a href="#__codelineno-0-2313">2313</a></span>
<span class="normal"><a href="#__codelineno-0-2314">2314</a></span>
<span class="normal"><a href="#__codelineno-0-2315">2315</a></span>
<span class="normal"><a href="#__codelineno-0-2316">2316</a></span>
<span class="normal"><a href="#__codelineno-0-2317">2317</a></span>
<span class="normal"><a href="#__codelineno-0-2318">2318</a></span>
<span class="normal"><a href="#__codelineno-0-2319">2319</a></span>
<span class="normal"><a href="#__codelineno-0-2320">2320</a></span>
<span class="normal"><a href="#__codelineno-0-2321">2321</a></span>
<span class="normal"><a href="#__codelineno-0-2322">2322</a></span>
<span class="normal"><a href="#__codelineno-0-2323">2323</a></span>
<span class="normal"><a href="#__codelineno-0-2324">2324</a></span>
<span class="normal"><a href="#__codelineno-0-2325">2325</a></span>
<span class="normal"><a href="#__codelineno-0-2326">2326</a></span>
<span class="normal"><a href="#__codelineno-0-2327">2327</a></span>
<span class="normal"><a href="#__codelineno-0-2328">2328</a></span>
<span class="normal"><a href="#__codelineno-0-2329">2329</a></span>
<span class="normal"><a href="#__codelineno-0-2330">2330</a></span>
<span class="normal"><a href="#__codelineno-0-2331">2331</a></span>
<span class="normal"><a href="#__codelineno-0-2332">2332</a></span>
<span class="normal"><a href="#__codelineno-0-2333">2333</a></span>
<span class="normal"><a href="#__codelineno-0-2334">2334</a></span>
<span class="normal"><a href="#__codelineno-0-2335">2335</a></span>
<span class="normal"><a href="#__codelineno-0-2336">2336</a></span>
<span class="normal"><a href="#__codelineno-0-2337">2337</a></span>
<span class="normal"><a href="#__codelineno-0-2338">2338</a></span>
<span class="normal"><a href="#__codelineno-0-2339">2339</a></span>
<span class="normal"><a href="#__codelineno-0-2340">2340</a></span>
<span class="normal"><a href="#__codelineno-0-2341">2341</a></span>
<span class="normal"><a href="#__codelineno-0-2342">2342</a></span>
<span class="normal"><a href="#__codelineno-0-2343">2343</a></span>
<span class="normal"><a href="#__codelineno-0-2344">2344</a></span>
<span class="normal"><a href="#__codelineno-0-2345">2345</a></span>
<span class="normal"><a href="#__codelineno-0-2346">2346</a></span>
<span class="normal"><a href="#__codelineno-0-2347">2347</a></span>
<span class="normal"><a href="#__codelineno-0-2348">2348</a></span>
<span class="normal"><a href="#__codelineno-0-2349">2349</a></span>
<span class="normal"><a href="#__codelineno-0-2350">2350</a></span>
<span class="normal"><a href="#__codelineno-0-2351">2351</a></span>
<span class="normal"><a href="#__codelineno-0-2352">2352</a></span>
<span class="normal"><a href="#__codelineno-0-2353">2353</a></span>
<span class="normal"><a href="#__codelineno-0-2354">2354</a></span>
<span class="normal"><a href="#__codelineno-0-2355">2355</a></span>
<span class="normal"><a href="#__codelineno-0-2356">2356</a></span>
<span class="normal"><a href="#__codelineno-0-2357">2357</a></span>
<span class="normal"><a href="#__codelineno-0-2358">2358</a></span>
<span class="normal"><a href="#__codelineno-0-2359">2359</a></span>
<span class="normal"><a href="#__codelineno-0-2360">2360</a></span>
<span class="normal"><a href="#__codelineno-0-2361">2361</a></span>
<span class="normal"><a href="#__codelineno-0-2362">2362</a></span>
<span class="normal"><a href="#__codelineno-0-2363">2363</a></span>
<span class="normal"><a href="#__codelineno-0-2364">2364</a></span>
<span class="normal"><a href="#__codelineno-0-2365">2365</a></span>
<span class="normal"><a href="#__codelineno-0-2366">2366</a></span>
<span class="normal"><a href="#__codelineno-0-2367">2367</a></span>
<span class="normal"><a href="#__codelineno-0-2368">2368</a></span>
<span class="normal"><a href="#__codelineno-0-2369">2369</a></span>
<span class="normal"><a href="#__codelineno-0-2370">2370</a></span>
<span class="normal"><a href="#__codelineno-0-2371">2371</a></span>
<span class="normal"><a href="#__codelineno-0-2372">2372</a></span>
<span class="normal"><a href="#__codelineno-0-2373">2373</a></span>
<span class="normal"><a href="#__codelineno-0-2374">2374</a></span>
<span class="normal"><a href="#__codelineno-0-2375">2375</a></span>
<span class="normal"><a href="#__codelineno-0-2376">2376</a></span>
<span class="normal"><a href="#__codelineno-0-2377">2377</a></span>
<span class="normal"><a href="#__codelineno-0-2378">2378</a></span>
<span class="normal"><a href="#__codelineno-0-2379">2379</a></span>
<span class="normal"><a href="#__codelineno-0-2380">2380</a></span>
<span class="normal"><a href="#__codelineno-0-2381">2381</a></span>
<span class="normal"><a href="#__codelineno-0-2382">2382</a></span>
<span class="normal"><a href="#__codelineno-0-2383">2383</a></span>
<span class="normal"><a href="#__codelineno-0-2384">2384</a></span>
<span class="normal"><a href="#__codelineno-0-2385">2385</a></span>
<span class="normal"><a href="#__codelineno-0-2386">2386</a></span>
<span class="normal"><a href="#__codelineno-0-2387">2387</a></span>
<span class="normal"><a href="#__codelineno-0-2388">2388</a></span>
<span class="normal"><a href="#__codelineno-0-2389">2389</a></span>
<span class="normal"><a href="#__codelineno-0-2390">2390</a></span>
<span class="normal"><a href="#__codelineno-0-2391">2391</a></span>
<span class="normal"><a href="#__codelineno-0-2392">2392</a></span>
<span class="normal"><a href="#__codelineno-0-2393">2393</a></span>
<span class="normal"><a href="#__codelineno-0-2394">2394</a></span>
<span class="normal"><a href="#__codelineno-0-2395">2395</a></span>
<span class="normal"><a href="#__codelineno-0-2396">2396</a></span>
<span class="normal"><a href="#__codelineno-0-2397">2397</a></span>
<span class="normal"><a href="#__codelineno-0-2398">2398</a></span>
<span class="normal"><a href="#__codelineno-0-2399">2399</a></span>
<span class="normal"><a href="#__codelineno-0-2400">2400</a></span>
<span class="normal"><a href="#__codelineno-0-2401">2401</a></span>
<span class="normal"><a href="#__codelineno-0-2402">2402</a></span>
<span class="normal"><a href="#__codelineno-0-2403">2403</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-2305"><a id="__codelineno-0-2305" name="__codelineno-0-2305"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_local_wavelengths_um</span><span class="p">(</span>
</span><span id="__span-0-2306"><a id="__codelineno-0-2306" name="__codelineno-0-2306"></a>    <span class="bp">self</span><span class="p">,</span>
</span><span id="__span-0-2307"><a id="__codelineno-0-2307" name="__codelineno-0-2307"></a>    <span class="n">wavelengths_um</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">],</span>
</span><span id="__span-0-2308"><a id="__codelineno-0-2308" name="__codelineno-0-2308"></a>    <span class="n">tile</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span>
</span><span id="__span-0-2309"><a id="__codelineno-0-2309" name="__codelineno-0-2309"></a>    <span class="nb">round</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2310"><a id="__codelineno-0-2310" name="__codelineno-0-2310"></a>    <span class="n">bit</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">str</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="__span-0-2311"><a id="__codelineno-0-2311" name="__codelineno-0-2311"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">tuple</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]:</span>
</span><span id="__span-0-2312"><a id="__codelineno-0-2312" name="__codelineno-0-2312"></a><span class="w">    </span><span class="sd">"""Save wavelengths for fidicual OR readout bit for one tile.</span>
</span><span id="__span-0-2313"><a id="__codelineno-0-2313" name="__codelineno-0-2313"></a>
</span><span id="__span-0-2314"><a id="__codelineno-0-2314" name="__codelineno-0-2314"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-2315"><a id="__codelineno-0-2315" name="__codelineno-0-2315"></a><span class="sd">    ----------</span>
</span><span id="__span-0-2316"><a id="__codelineno-0-2316" name="__codelineno-0-2316"></a><span class="sd">    wavelengths_um : tuple[float, float]</span>
</span><span id="__span-0-2317"><a id="__codelineno-0-2317" name="__codelineno-0-2317"></a><span class="sd">        Wavelengths for fidicual OR readout bit for one tile.</span>
</span><span id="__span-0-2318"><a id="__codelineno-0-2318" name="__codelineno-0-2318"></a><span class="sd">    tile : Union[int, str]</span>
</span><span id="__span-0-2319"><a id="__codelineno-0-2319" name="__codelineno-0-2319"></a><span class="sd">        Tile index or tile id.</span>
</span><span id="__span-0-2320"><a id="__codelineno-0-2320" name="__codelineno-0-2320"></a><span class="sd">    round : Optional[Union[int, str]]</span>
</span><span id="__span-0-2321"><a id="__codelineno-0-2321" name="__codelineno-0-2321"></a><span class="sd">        Round index or round id.</span>
</span><span id="__span-0-2322"><a id="__codelineno-0-2322" name="__codelineno-0-2322"></a><span class="sd">    bit : Optional[Union[int, str]]</span>
</span><span id="__span-0-2323"><a id="__codelineno-0-2323" name="__codelineno-0-2323"></a><span class="sd">        Bit index or bit id.</span>
</span><span id="__span-0-2324"><a id="__codelineno-0-2324" name="__codelineno-0-2324"></a>
</span><span id="__span-0-2325"><a id="__codelineno-0-2325" name="__codelineno-0-2325"></a><span class="sd">    Returns</span>
</span><span id="__span-0-2326"><a id="__codelineno-0-2326" name="__codelineno-0-2326"></a><span class="sd">    -------</span>
</span><span id="__span-0-2327"><a id="__codelineno-0-2327" name="__codelineno-0-2327"></a><span class="sd">    wavelengths_um : Optional[tuple[float, float]]</span>
</span><span id="__span-0-2328"><a id="__codelineno-0-2328" name="__codelineno-0-2328"></a><span class="sd">        Wavelengths for fidicual OR readout bit for one tile.</span>
</span><span id="__span-0-2329"><a id="__codelineno-0-2329" name="__codelineno-0-2329"></a><span class="sd">    """</span>
</span><span id="__span-0-2330"><a id="__codelineno-0-2330" name="__codelineno-0-2330"></a>
</span><span id="__span-0-2331"><a id="__codelineno-0-2331" name="__codelineno-0-2331"></a>    <span class="k">if</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">round</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">):</span>
</span><span id="__span-0-2332"><a id="__codelineno-0-2332" name="__codelineno-0-2332"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Provide either 'round' or 'bit', but not both"</span><span class="p">)</span>
</span><span id="__span-0-2333"><a id="__codelineno-0-2333" name="__codelineno-0-2333"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2334"><a id="__codelineno-0-2334" name="__codelineno-0-2334"></a>
</span><span id="__span-0-2335"><a id="__codelineno-0-2335" name="__codelineno-0-2335"></a>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2336"><a id="__codelineno-0-2336" name="__codelineno-0-2336"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">tile</span> <span class="o">&gt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">:</span>
</span><span id="__span-0-2337"><a id="__codelineno-0-2337" name="__codelineno-0-2337"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"Set tile index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_tiles</span><span class="p">))</span>
</span><span id="__span-0-2338"><a id="__codelineno-0-2338" name="__codelineno-0-2338"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2339"><a id="__codelineno-0-2339" name="__codelineno-0-2339"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2340"><a id="__codelineno-0-2340" name="__codelineno-0-2340"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">[</span><span class="n">tile</span><span class="p">]</span>
</span><span id="__span-0-2341"><a id="__codelineno-0-2341" name="__codelineno-0-2341"></a>    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2342"><a id="__codelineno-0-2342" name="__codelineno-0-2342"></a>        <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tile_ids</span><span class="p">:</span>
</span><span id="__span-0-2343"><a id="__codelineno-0-2343" name="__codelineno-0-2343"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"set valid tiled id"</span><span class="p">)</span>
</span><span id="__span-0-2344"><a id="__codelineno-0-2344" name="__codelineno-0-2344"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2345"><a id="__codelineno-0-2345" name="__codelineno-0-2345"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2346"><a id="__codelineno-0-2346" name="__codelineno-0-2346"></a>            <span class="n">tile_id</span> <span class="o">=</span> <span class="n">tile</span>
</span><span id="__span-0-2347"><a id="__codelineno-0-2347" name="__codelineno-0-2347"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2348"><a id="__codelineno-0-2348" name="__codelineno-0-2348"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"'tile' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2349"><a id="__codelineno-0-2349" name="__codelineno-0-2349"></a>        <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2350"><a id="__codelineno-0-2350" name="__codelineno-0-2350"></a>
</span><span id="__span-0-2351"><a id="__codelineno-0-2351" name="__codelineno-0-2351"></a>    <span class="k">if</span> <span class="n">bit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="__span-0-2352"><a id="__codelineno-0-2352" name="__codelineno-0-2352"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2353"><a id="__codelineno-0-2353" name="__codelineno-0-2353"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">bit</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">):</span>
</span><span id="__span-0-2354"><a id="__codelineno-0-2354" name="__codelineno-0-2354"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set bit index &gt;=0 and &lt;="</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">)))</span>
</span><span id="__span-0-2355"><a id="__codelineno-0-2355" name="__codelineno-0-2355"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2356"><a id="__codelineno-0-2356" name="__codelineno-0-2356"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2357"><a id="__codelineno-0-2357" name="__codelineno-0-2357"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">[</span><span class="n">bit</span><span class="p">]</span>
</span><span id="__span-0-2358"><a id="__codelineno-0-2358" name="__codelineno-0-2358"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bit</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2359"><a id="__codelineno-0-2359" name="__codelineno-0-2359"></a>            <span class="k">if</span> <span class="n">bit</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_bit_ids</span><span class="p">:</span>
</span><span id="__span-0-2360"><a id="__codelineno-0-2360" name="__codelineno-0-2360"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid bit id"</span><span class="p">)</span>
</span><span id="__span-0-2361"><a id="__codelineno-0-2361" name="__codelineno-0-2361"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2362"><a id="__codelineno-0-2362" name="__codelineno-0-2362"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2363"><a id="__codelineno-0-2363" name="__codelineno-0-2363"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="n">bit</span>
</span><span id="__span-0-2364"><a id="__codelineno-0-2364" name="__codelineno-0-2364"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2365"><a id="__codelineno-0-2365" name="__codelineno-0-2365"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'bit' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2366"><a id="__codelineno-0-2366" name="__codelineno-0-2366"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2367"><a id="__codelineno-0-2367" name="__codelineno-0-2367"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2368"><a id="__codelineno-0-2368" name="__codelineno-0-2368"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_readouts_root_path</span>
</span><span id="__span-0-2369"><a id="__codelineno-0-2369" name="__codelineno-0-2369"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2370"><a id="__codelineno-0-2370" name="__codelineno-0-2370"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2371"><a id="__codelineno-0-2371" name="__codelineno-0-2371"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2372"><a id="__codelineno-0-2372" name="__codelineno-0-2372"></a>        <span class="p">)</span>
</span><span id="__span-0-2373"><a id="__codelineno-0-2373" name="__codelineno-0-2373"></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2374"><a id="__codelineno-0-2374" name="__codelineno-0-2374"></a>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
</span><span id="__span-0-2375"><a id="__codelineno-0-2375" name="__codelineno-0-2375"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="__span-0-2376"><a id="__codelineno-0-2376" name="__codelineno-0-2376"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set round index &gt;=0 and &lt;"</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_num_rounds</span><span class="p">))</span>
</span><span id="__span-0-2377"><a id="__codelineno-0-2377" name="__codelineno-0-2377"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2378"><a id="__codelineno-0-2378" name="__codelineno-0-2378"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2379"><a id="__codelineno-0-2379" name="__codelineno-0-2379"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">[</span><span class="nb">round</span><span class="p">]</span>
</span><span id="__span-0-2380"><a id="__codelineno-0-2380" name="__codelineno-0-2380"></a>        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="nb">round</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
</span><span id="__span-0-2381"><a id="__codelineno-0-2381" name="__codelineno-0-2381"></a>            <span class="k">if</span> <span class="nb">round</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_round_ids</span><span class="p">:</span>
</span><span id="__span-0-2382"><a id="__codelineno-0-2382" name="__codelineno-0-2382"></a>                <span class="nb">print</span><span class="p">(</span><span class="s2">"Set valid round id"</span><span class="p">)</span>
</span><span id="__span-0-2383"><a id="__codelineno-0-2383" name="__codelineno-0-2383"></a>                <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2384"><a id="__codelineno-0-2384" name="__codelineno-0-2384"></a>            <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2385"><a id="__codelineno-0-2385" name="__codelineno-0-2385"></a>                <span class="n">local_id</span> <span class="o">=</span> <span class="nb">round</span>
</span><span id="__span-0-2386"><a id="__codelineno-0-2386" name="__codelineno-0-2386"></a>        <span class="k">else</span><span class="p">:</span>
</span><span id="__span-0-2387"><a id="__codelineno-0-2387" name="__codelineno-0-2387"></a>            <span class="nb">print</span><span class="p">(</span><span class="s2">"'round' must be integer index or string identifier"</span><span class="p">)</span>
</span><span id="__span-0-2388"><a id="__codelineno-0-2388" name="__codelineno-0-2388"></a>            <span class="k">return</span> <span class="kc">None</span>
</span><span id="__span-0-2389"><a id="__codelineno-0-2389" name="__codelineno-0-2389"></a>        <span class="n">zattrs_path</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span>
</span><span id="__span-0-2390"><a id="__codelineno-0-2390" name="__codelineno-0-2390"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_polyDT_root_path</span>
</span><span id="__span-0-2391"><a id="__codelineno-0-2391" name="__codelineno-0-2391"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">tile_id</span><span class="p">)</span>
</span><span id="__span-0-2392"><a id="__codelineno-0-2392" name="__codelineno-0-2392"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_id</span> <span class="o">+</span> <span class="s2">".zarr"</span><span class="p">)</span>
</span><span id="__span-0-2393"><a id="__codelineno-0-2393" name="__codelineno-0-2393"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">".zattrs"</span><span class="p">)</span>
</span><span id="__span-0-2394"><a id="__codelineno-0-2394" name="__codelineno-0-2394"></a>        <span class="p">)</span>
</span><span id="__span-0-2395"><a id="__codelineno-0-2395" name="__codelineno-0-2395"></a>
</span><span id="__span-0-2396"><a id="__codelineno-0-2396" name="__codelineno-0-2396"></a>    <span class="k">try</span><span class="p">:</span>
</span><span id="__span-0-2397"><a id="__codelineno-0-2397" name="__codelineno-0-2397"></a>        <span class="n">attributes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_load_from_json</span><span class="p">(</span><span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2398"><a id="__codelineno-0-2398" name="__codelineno-0-2398"></a>        <span class="n">attributes</span><span class="p">[</span><span class="s2">"excitation_um"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wavelengths_um</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="__span-0-2399"><a id="__codelineno-0-2399" name="__codelineno-0-2399"></a>        <span class="n">attributes</span><span class="p">[</span><span class="s2">"emission_um"</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">wavelengths_um</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</span><span id="__span-0-2400"><a id="__codelineno-0-2400" name="__codelineno-0-2400"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_json</span><span class="p">(</span><span class="n">attributes</span><span class="p">,</span> <span class="n">zattrs_path</span><span class="p">)</span>
</span><span id="__span-0-2401"><a id="__codelineno-0-2401" name="__codelineno-0-2401"></a>    <span class="k">except</span> <span class="p">(</span><span class="ne">FileNotFoundError</span><span class="p">,</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONDecodeError</span><span class="p">):</span>
</span><span id="__span-0-2402"><a id="__codelineno-0-2402" name="__codelineno-0-2402"></a>        <span class="nb">print</span><span class="p">(</span><span class="s2">"Error writing wavelength attributes."</span><span class="p">)</span>
</span><span id="__span-0-2403"><a id="__codelineno-0-2403" name="__codelineno-0-2403"></a>        <span class="k">return</span> <span class="kc">None</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_mtx"> <code class="highlight language-python"><span class="n">save_mtx</span><span class="p">(</span><span class="n">spots_source</span><span class="o">=</span><span class="s1">'baysor'</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save mtx file for downstream analysis. Assumes Baysor has been run.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>spots_source</code> </td> <td> <code><span title="str">str</span></code> </td> <td> <div class="doc-md-description"> <p>source of spots. "baysor" or "resegmented".</p> </div> </td> <td> <code>'baysor'</code> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-4220">4220</a></span>
<span class="normal"><a href="#__codelineno-0-4221">4221</a></span>
<span class="normal"><a href="#__codelineno-0-4222">4222</a></span>
<span class="normal"><a href="#__codelineno-0-4223">4223</a></span>
<span class="normal"><a href="#__codelineno-0-4224">4224</a></span>
<span class="normal"><a href="#__codelineno-0-4225">4225</a></span>
<span class="normal"><a href="#__codelineno-0-4226">4226</a></span>
<span class="normal"><a href="#__codelineno-0-4227">4227</a></span>
<span class="normal"><a href="#__codelineno-0-4228">4228</a></span>
<span class="normal"><a href="#__codelineno-0-4229">4229</a></span>
<span class="normal"><a href="#__codelineno-0-4230">4230</a></span>
<span class="normal"><a href="#__codelineno-0-4231">4231</a></span>
<span class="normal"><a href="#__codelineno-0-4232">4232</a></span>
<span class="normal"><a href="#__codelineno-0-4233">4233</a></span>
<span class="normal"><a href="#__codelineno-0-4234">4234</a></span>
<span class="normal"><a href="#__codelineno-0-4235">4235</a></span>
<span class="normal"><a href="#__codelineno-0-4236">4236</a></span>
<span class="normal"><a href="#__codelineno-0-4237">4237</a></span>
<span class="normal"><a href="#__codelineno-0-4238">4238</a></span>
<span class="normal"><a href="#__codelineno-0-4239">4239</a></span>
<span class="normal"><a href="#__codelineno-0-4240">4240</a></span>
<span class="normal"><a href="#__codelineno-0-4241">4241</a></span>
<span class="normal"><a href="#__codelineno-0-4242">4242</a></span>
<span class="normal"><a href="#__codelineno-0-4243">4243</a></span>
<span class="normal"><a href="#__codelineno-0-4244">4244</a></span>
<span class="normal"><a href="#__codelineno-0-4245">4245</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-4220"><a id="__codelineno-0-4220" name="__codelineno-0-4220"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_mtx</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">spots_source</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">"baysor"</span><span class="p">):</span>
</span><span id="__span-0-4221"><a id="__codelineno-0-4221" name="__codelineno-0-4221"></a><span class="w">    </span><span class="sd">"""Save mtx file for downstream analysis. Assumes Baysor has been run.</span>
</span><span id="__span-0-4222"><a id="__codelineno-0-4222" name="__codelineno-0-4222"></a>
</span><span id="__span-0-4223"><a id="__codelineno-0-4223" name="__codelineno-0-4223"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-4224"><a id="__codelineno-0-4224" name="__codelineno-0-4224"></a><span class="sd">    ----------</span>
</span><span id="__span-0-4225"><a id="__codelineno-0-4225" name="__codelineno-0-4225"></a><span class="sd">    spots_source: str, default "baysor"</span>
</span><span id="__span-0-4226"><a id="__codelineno-0-4226" name="__codelineno-0-4226"></a><span class="sd">        source of spots. "baysor" or "resegmented".</span>
</span><span id="__span-0-4227"><a id="__codelineno-0-4227" name="__codelineno-0-4227"></a><span class="sd">    """</span>
</span><span id="__span-0-4228"><a id="__codelineno-0-4228" name="__codelineno-0-4228"></a>
</span><span id="__span-0-4229"><a id="__codelineno-0-4229" name="__codelineno-0-4229"></a>    <span class="kn">from</span><span class="w"> </span><span class="nn">merfish3danalysis.utils.dataio</span><span class="w"> </span><span class="kn">import</span> <span class="n">create_mtx</span>
</span><span id="__span-0-4230"><a id="__codelineno-0-4230" name="__codelineno-0-4230"></a>
</span><span id="__span-0-4231"><a id="__codelineno-0-4231" name="__codelineno-0-4231"></a>    <span class="k">if</span> <span class="n">spots_source</span> <span class="o">==</span> <span class="s2">"baysor"</span><span class="p">:</span>
</span><span id="__span-0-4232"><a id="__codelineno-0-4232" name="__codelineno-0-4232"></a>        <span class="n">spots_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"segmentation"</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"baysor"</span><span class="p">)</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"segmentation.csv"</span><span class="p">)</span>
</span><span id="__span-0-4233"><a id="__codelineno-0-4233" name="__codelineno-0-4233"></a>    <span class="k">elif</span> <span class="n">spots_source</span> <span class="o">==</span> <span class="s2">"resegmented"</span><span class="p">:</span>
</span><span id="__span-0-4234"><a id="__codelineno-0-4234" name="__codelineno-0-4234"></a>        <span class="n">spots_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-4235"><a id="__codelineno-0-4235" name="__codelineno-0-4235"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> 
</span><span id="__span-0-4236"><a id="__codelineno-0-4236" name="__codelineno-0-4236"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"all_tiles_filtered_decoded_features"</span><span class="p">)</span>
</span><span id="__span-0-4237"><a id="__codelineno-0-4237" name="__codelineno-0-4237"></a>            <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"refined_transcripts.parquet"</span><span class="p">)</span>
</span><span id="__span-0-4238"><a id="__codelineno-0-4238" name="__codelineno-0-4238"></a>        <span class="p">)</span>
</span><span id="__span-0-4239"><a id="__codelineno-0-4239" name="__codelineno-0-4239"></a>
</span><span id="__span-0-4240"><a id="__codelineno-0-4240" name="__codelineno-0-4240"></a>    <span class="n">mtx_output_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"mtx_output"</span><span class="p">)</span>
</span><span id="__span-0-4241"><a id="__codelineno-0-4241" name="__codelineno-0-4241"></a>
</span><span id="__span-0-4242"><a id="__codelineno-0-4242" name="__codelineno-0-4242"></a>    <span class="n">create_mtx</span><span class="p">(</span>
</span><span id="__span-0-4243"><a id="__codelineno-0-4243" name="__codelineno-0-4243"></a>        <span class="n">spots_path</span><span class="o">=</span><span class="n">spots_path</span><span class="p">,</span>
</span><span id="__span-0-4244"><a id="__codelineno-0-4244" name="__codelineno-0-4244"></a>        <span class="n">output_dir_path</span><span class="o">=</span><span class="n">mtx_output_path</span><span class="p">,</span>
</span><span id="__span-0-4245"><a id="__codelineno-0-4245" name="__codelineno-0-4245"></a>    <span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> <div class="doc doc-object doc-function"> <h3 class="doc doc-heading" id="merfish3danalysis.qi2labDataStore.qi2labDataStore.save_spots_prepped_for_baysor"> <code class="highlight language-python"><span class="n">save_spots_prepped_for_baysor</span><span class="p">(</span><span class="n">prepped_for_baysor_df</span><span class="p">)</span></code> </h3> <div class="doc doc-contents"> <p>Save spots prepped for Baysor.</p> <p><span class="doc-section-title">Parameters:</span></p> <table> <thead> <tr> <th>Name</th> <th>Type</th> <th>Description</th> <th>Default</th> </tr> </thead> <tbody> <tr class="doc-section-item"> <td> <code>prepped_for_baysor_df</code> </td> <td> <code><span title="pandas.DataFrame">DataFrame</span></code> </td> <td> <div class="doc-md-description"> <p>Spots prepped for Baysor.</p> </div> </td> <td> <em>required</em> </td> </tr> </tbody> </table> <details class="quote"> <summary>Source code in <code>src/merfish3danalysis/qi2labDataStore.py</code></summary> <div class="language-python highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-3958">3958</a></span>
<span class="normal"><a href="#__codelineno-0-3959">3959</a></span>
<span class="normal"><a href="#__codelineno-0-3960">3960</a></span>
<span class="normal"><a href="#__codelineno-0-3961">3961</a></span>
<span class="normal"><a href="#__codelineno-0-3962">3962</a></span>
<span class="normal"><a href="#__codelineno-0-3963">3963</a></span>
<span class="normal"><a href="#__codelineno-0-3964">3964</a></span>
<span class="normal"><a href="#__codelineno-0-3965">3965</a></span>
<span class="normal"><a href="#__codelineno-0-3966">3966</a></span>
<span class="normal"><a href="#__codelineno-0-3967">3967</a></span>
<span class="normal"><a href="#__codelineno-0-3968">3968</a></span>
<span class="normal"><a href="#__codelineno-0-3969">3969</a></span>
<span class="normal"><a href="#__codelineno-0-3970">3970</a></span>
<span class="normal"><a href="#__codelineno-0-3971">3971</a></span>
<span class="normal"><a href="#__codelineno-0-3972">3972</a></span>
<span class="normal"><a href="#__codelineno-0-3973">3973</a></span>
<span class="normal"><a href="#__codelineno-0-3974">3974</a></span>
<span class="normal"><a href="#__codelineno-0-3975">3975</a></span>
<span class="normal"><a href="#__codelineno-0-3976">3976</a></span>
<span class="normal"><a href="#__codelineno-0-3977">3977</a></span>
<span class="normal"><a href="#__codelineno-0-3978">3978</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-3958"><a id="__codelineno-0-3958" name="__codelineno-0-3958"></a><span class="k">def</span><span class="w"> </span><span class="nf">save_spots_prepped_for_baysor</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">prepped_for_baysor_df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
</span><span id="__span-0-3959"><a id="__codelineno-0-3959" name="__codelineno-0-3959"></a><span class="w">    </span><span class="sd">"""Save spots prepped for Baysor.</span>
</span><span id="__span-0-3960"><a id="__codelineno-0-3960" name="__codelineno-0-3960"></a>
</span><span id="__span-0-3961"><a id="__codelineno-0-3961" name="__codelineno-0-3961"></a><span class="sd">    Parameters</span>
</span><span id="__span-0-3962"><a id="__codelineno-0-3962" name="__codelineno-0-3962"></a><span class="sd">    ----------</span>
</span><span id="__span-0-3963"><a id="__codelineno-0-3963" name="__codelineno-0-3963"></a><span class="sd">    prepped_for_baysor_df : pd.DataFrame</span>
</span><span id="__span-0-3964"><a id="__codelineno-0-3964" name="__codelineno-0-3964"></a><span class="sd">        Spots prepped for Baysor.</span>
</span><span id="__span-0-3965"><a id="__codelineno-0-3965" name="__codelineno-0-3965"></a><span class="sd">    """</span>
</span><span id="__span-0-3966"><a id="__codelineno-0-3966" name="__codelineno-0-3966"></a>
</span><span id="__span-0-3967"><a id="__codelineno-0-3967" name="__codelineno-0-3967"></a>    <span class="n">current_global_filtered_decoded_dir_path</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_datastore_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span>
</span><span id="__span-0-3968"><a id="__codelineno-0-3968" name="__codelineno-0-3968"></a>        <span class="s2">"all_tiles_filtered_decoded_features"</span>
</span><span id="__span-0-3969"><a id="__codelineno-0-3969" name="__codelineno-0-3969"></a>    <span class="p">)</span>
</span><span id="__span-0-3970"><a id="__codelineno-0-3970" name="__codelineno-0-3970"></a>
</span><span id="__span-0-3971"><a id="__codelineno-0-3971" name="__codelineno-0-3971"></a>    <span class="k">if</span> <span class="ow">not</span> <span class="n">current_global_filtered_decoded_dir_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
</span><span id="__span-0-3972"><a id="__codelineno-0-3972" name="__codelineno-0-3972"></a>        <span class="n">current_global_filtered_decoded_dir_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">()</span>
</span><span id="__span-0-3973"><a id="__codelineno-0-3973" name="__codelineno-0-3973"></a>
</span><span id="__span-0-3974"><a id="__codelineno-0-3974" name="__codelineno-0-3974"></a>    <span class="n">current_global_filtered_decoded_path</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="__span-0-3975"><a id="__codelineno-0-3975" name="__codelineno-0-3975"></a>        <span class="n">current_global_filtered_decoded_dir_path</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="s2">"transcripts.parquet"</span><span class="p">)</span>
</span><span id="__span-0-3976"><a id="__codelineno-0-3976" name="__codelineno-0-3976"></a>    <span class="p">)</span>
</span><span id="__span-0-3977"><a id="__codelineno-0-3977" name="__codelineno-0-3977"></a>
</span><span id="__span-0-3978"><a id="__codelineno-0-3978" name="__codelineno-0-3978"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">_save_to_parquet</span><span class="p">(</span><span class="n">prepped_for_baysor_df</span><span class="p">,</span> <span class="n">current_global_filtered_decoded_path</span><span class="p">)</span>
</span></code></pre></div></td></tr></table></div> </details> </div> </div> </div> </div> </div> </div> </div> </div> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> </main> <footer class="md-footer"> <nav aria-label="Footer" class="md-footer__inner md-grid"> <a aria-label="Previous: PixelDecoder" class="md-footer__link md-footer__link--prev" href="../PixelDecoder/"> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"></path></svg> </div> <div class="md-footer__title"> <span class="md-footer__direction"> Previous </span> <div class="md-ellipsis"> PixelDecoder </div> </div> </a> <a aria-label="Next: dataio" class="md-footer__link md-footer__link--next" href="../../modules/dataio/"> <div class="md-footer__title"> <span class="md-footer__direction"> Next </span> <div class="md-ellipsis"> dataio </div> </div> <div class="md-footer__button md-icon"> <svg viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"></path></svg> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class="md-copyright"> Made with <a href="https://squidfunk.github.io/mkdocs-material/" rel="noopener" target="_blank"> Material for MkDocs </a> </div> </div> </div> </footer> </div> <div class="md-dialog" data-md-component="dialog"> <div class="md-dialog__inner md-typeset"></div> </div> <div class="md-progress" data-md-component="progress" role="progressbar"></div> <script id="__config" type="application/json">{"base": "../../..", "features": ["content.tabs.link", "content.code.annotate", "content.code.copy", "navigation.footer", "navigation.instant", "navigation.instant.progress"], "search": "../../../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src="../../../assets/javascripts/bundle.f55a23d4.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script> </body> </html>